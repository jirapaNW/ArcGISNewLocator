System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-core/react"],(function(e,t){var a={},n={},s={},i={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.AllDataSourceTypes=e.AllDataSourceTypes,a.DataLevel=e.DataLevel,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.classNames=e.classNames,a.css=e.css,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.jsx=e.jsx,a.moduleLoader=e.moduleLoader,a.urlUtils=e.urlUtils},function(e){n.featureUtils=e.featureUtils},function(e){s.Button=e.Button,s.Popper=e.Popper,s.Select=e.Select},function(e){i.default=e.default}],execute:function(){e((()=>{var e={28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=s}},t={};function o(a){var n=t[a];if(void 0!==n)return n.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,o),s.exports}o.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return o.d(t,{a:t}),t},o.d=(e,t)=>{for(var a in t)o.o(t,a)&&!o.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{"use strict";o.r(r),o.d(r,{default:()=>A});var e,t=o(79244),a=o(62686),n=o(14321);!function(e){e.Standard="standard",e.Custom="custom",e.RasterFunction="rfx"}(e||(e={}));var s=o(68972),i=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};class l{constructor(){this.cache={}}static getInstance(){return l.instance||(l.instance=new l),l.instance}getStrings(e){return i(this,void 0,void 0,(function*(){return this.cache[e]?this.cache[e]:function(e){return i(this,void 0,void 0,(function*(){const t=yield fetch(e);return yield t.json()}))}(e).then((t=>(this.cache[e]=t,t)))}))}}function c(){return e="arcgis-analysis-assets",`${t.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/${e}/`;var e}const u=e=>(e=>{const[t,a]=s.default.useState();return s.default.useEffect((()=>{l.getInstance().getStrings(e).then(a).catch((()=>{a({})}))}),[]),t})(`${c()}assets/t9n/common.t9n.${null!=e?e:"en-US"}.json`),d=(e,t)=>{let a=e;return void 0!==t&&void 0!==e&&e.startsWith("$")&&(a=t[e.replace("$","")]),a},m={_widgetLabel:"Analysis",history:"History",result:"Result",viewDetails:"View details",openTool:"Open tool",historyEmptyPlaceholder:"After you run a tool, you can track the status at history.",run:"Run",completeAtTime:"Complete at {time}",canceling:"Canceling...",canceledAtTime:"Canceled at {time}",canceled:"Canceled",jobFailedAtTime:"Failed at {time}",jobFailed:"Failed",provisioningResources:"Provisioning resources...",submitted:"Submitted...",waiting:"Waiting...",running:"Running",cancelLabel:"Cancel analysis",uncancellableLabel:"This tool cannot be canceled.",cancelWarningText:"Are you sure you want to cancel this analysis? Current process will be lost.",keepRunning:"Keep running",cancelAnalysis:"Cancel analysis",jobAlertStatusCancelled:"{toolName} canceled",jobAlertStatusDeleted:"{toolName} deleted",jobAlertStatusFailed:"{toolName} failed",jobAlertStatusSucceededWithWarnings:"{toolName} succeeded with warnings",jobAlertStatusSucceededWithoutWarnings:"{toolName} succeeded",jobAlertStatusTimedOut:"{toolName} timed out",submittedAlertLabel:"{toolName} submitted",parameters:"Parameters",environments:"Environments",context:"Context",spatialReference:"Spatial reference",environmentSettings:"Environment settings",outputCoordinateSystem:"Output coordinate system",processingExtent:"Processing extent",snapRaster:"Snap raster",cellSize:"Cell size",resamplingMethod:"Resampling method",mask:"Mask",sameAsInput:"Same as input (default)",fullExtent:"Full extent (default)",maxOf:"Maximum of inputs",minOf:"Minimum of inputs",asSpecified:"As specified",fromLayer:"From layer",nearest:"Nearest neighbor (for discrete data)",bilinear:"Bilinear interpolation (for continuous data)",cubic:"Cubic convolution (for continuous data)",xmin:"Left (x-min)",xmax:"Right (x-max)",ymin:"Bottom (y-min)",ymax:"Top (y-max)",nowDate:"Now ({dateString})",optimizeTableView:"Optimize table view",genericFailureMessage:"{toolName} failed.",messages:"Messages",startTime:"Start time",endTime:"Completed",creditMessage:"<a href='{docLink}' target='_blank'>Credits consumed</a>",creditsMessageNoLink:"Credits consumed",zeroCreditsMessage:"No credits were consumed for this tool.",warning:"Warning",elapsedTime:"Elapsed time",failedTime:"Failed time: {failedTime}",minutes:"Minutes",hours:"Hours",days:"Days",jobCancelled:"{toolName} canceled.",jobId:"Run ID",checkCreditUsage:"Administrators can check credit usage through the credit status page. <calcite-link target='_blank' href='{url}'>Learn more.</calcite-link>",noAccess:"You do not have permission to access this result.",invalidUrl:"The result no longer exists. Run the analysis again to recreate it.",defaultLayerFailure:"The result cannot be accessed. Run the analysis again to recreate it.",toolInaccessible:"Tool is inaccessible.",_action_setAsAnalysisInput_label:"Set as Analysis input",selectTool:"Select a tool",selectParameter:"Select a parameter",noApplicableParameter:"No applicable parameter"};var f=o(28996),p=o.n(f),g=function(e,t){var a={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(a[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(a[n[s]]=e[n[s]])}return a};const y=e=>{const a=window.SVG,{className:n}=e,s=g(e,["className"]),i=(0,t.classNames)("jimu-icon jimu-icon-component",n);return a?t.React.createElement(a,Object.assign({className:i,src:p()},s)):t.React.createElement("svg",Object.assign({className:i},s))};var v=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};const h=e=>e.type===t.AllDataSourceTypes.ImageryLayer||e.type===t.AllDataSourceTypes.ImageryTileLayer,S=e=>{var a;return e.type===t.AllDataSourceTypes.FeatureLayer||"feature"===(null===(a=e.layer)||void 0===a?void 0:a.type)},b={width:320,height:280},x={width:320,height:280},j=a=>{var n;const i=t.ReactRedux.useSelector((e=>window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig.utilities:e.appConfig.utilities)),o=null===(n=null==a?void 0:a.getLocaleInfo())||void 0===n?void 0:n.locale,r=u(o),l=(e=>{const t=u(e);return s.default.useMemo((()=>t?Object.assign(Object.assign({},t.toolInfo||{}),t.toolInfoKeys||{}):null),[t])})(o);return{getDisplayedToolName:t=>t&&a?t.type===e.Standard?function(e,t,a,n,s){const i=`${s(e)}${n(t)}`;return(null==a?void 0:a[i])||e}(t.toolName,t.analysisEngine,l,a.formatAnalysisEngineSuffix,a.toCamelToolName):function(e,t){var a;if(!e)return"";const n=e.config;if(n.utility){const{utilityId:e,task:a}=n.utility,s=null==t?void 0:t[e];if(a){const e=s&&s.tasks?s.tasks.find((e=>e.name===a)):null;if(e&&e.label)return e.label}else if(s&&s.label)return s.label}return(null===(a=e.config.toolInfo)||void 0===a?void 0:a.displayName)||e.toolName}(t,i):"",getDisplayedParameterName:e=>d(e.label,r)||e.displayName}},R=e=>{const{translate:a,analysisSharedUtils:s,toolList:i,selectedTool:o,onSelectedToolChange:r,validParameters:l,selectedParameter:c,onSelectedParameterChange:u}=e,{getDisplayedToolName:d,getDisplayedParameterName:m}=j(s);return(0,t.jsx)("div",null,(0,t.jsx)("div",null,(0,t.jsx)("div",{className:"mb-1 form-item-label"},a("selectTool")),(0,t.jsx)("div",null,(0,t.jsx)(n.Select,{value:null==o?void 0:o.id,onChange:r},i.map((e=>(0,t.jsx)("option",{key:e.id,value:e.id},d(e))))))),o&&(0,t.jsx)("div",{className:"mt-4"},(0,t.jsx)("div",{className:"mb-1 form-item-label"},a("selectParameter")),(0,t.jsx)("div",null,(0,t.jsx)(n.Select,{value:null==c?void 0:c.name,onChange:u,disabled:!l.length},l.map((e=>(0,t.jsx)("option",{key:e.name,value:e.name},m(e))))),!l.length&&(0,t.jsx)("div",{className:"mt-2 warning-msg"},(0,t.jsx)(y,{className:"mr-2",color:"var(--warning-900)"}),a("noApplicableParameter")))))},T=t.css`
  flex-direction: column;
  justify-content: space-between;
  .form-item-label {
    line-height: 18px;
    font-weight: 500;
    color: var(--ref-palette-black);
  }
  .warning-msg {
    display: flex;
    align-items: center;
    line-height: 24px;
  }
  .footer{
    text-align: right;
    .btn {
      min-width: 75px;
      font-weight: 500;
    }
  }
`,w=s=>{const{activeRef:i,widgetId:o,dataSet:r,dataLevel:l,version:c,intl:u}=s,{dataSource:f}=r,[p,g]=t.React.useState(x),[y,j]=t.React.useState(!0),w=(()=>{const[e,a]=t.React.useState();return t.React.useEffect((()=>{t.moduleLoader.loadModule("arcgis-amd-packages/arcgis-analysis-shared-utils").then((e=>{a(e)}))}),[]),e})(),P=t.React.useMemo((()=>{var e;return(null===(e=null==w?void 0:w.getLocaleInfo())||void 0===e?void 0:e.locale)||""}),[w]),A=e=>u.formatMessage({id:e,defaultMessage:Object.assign(Object.assign({},m),t.defaultMessages)[e]});t.React.useEffect((()=>{j(!0),C(null),F(null)}),[c,f.id,o]);const L=()=>{j(!1),setTimeout((()=>{i.focus()}),10)},[D,M]=t.React.useState([]);t.React.useEffect((()=>{var a,n,s,i,r;if(!y)return;const l=null!==(n=null===(a=(0,t.getAppStore)().getState())||void 0===a?void 0:a.appStateInBuilder)&&void 0!==n?n:(0,t.getAppStore)().getState(),c=null===(r=null===(i=null===(s=null==l?void 0:l.appConfig)||void 0===s?void 0:s.widgets)||void 0===i?void 0:i[o])||void 0===r?void 0:r.config;Array.isArray(null==c?void 0:c.toolList)&&M(c.toolList.asMutable({deep:!0}).filter((t=>t.type!==e.RasterFunction)))}),[y]);const[N,C]=t.React.useState(),[O,k]=t.React.useState([]),[I,F]=t.React.useState(),U=t.React.useMemo((()=>{const e=f.getGeometryType(),a=S(f),n=h(f);return O.filter((s=>{if("esriGPParameterDirectionOutput"===s.direction)return!1;if(a&&("GPRecordSet"===s.dataType||"GPMultiValue:GPRecordSet"===s.dataType))return!0;const i=l===t.DataLevel.DataSource&&a||l===t.DataLevel.Records;if(e&&i&&("GPFeatureRecordSetLayer"===s.dataType||"GPMultiValue:GPFeatureRecordSetLayer"===s.dataType)){const t=(e=>{var t;const{filter:a,defaultValue:n}=e;if("featureClass"===(null==a?void 0:a.type)&&(null===(t=null==a?void 0:a.list)||void 0===t?void 0:t.length))return a.list;if(Array.isArray(n))return n.filter((e=>!!e.geometryType)).map((e=>e.geometryType));const s=null==n?void 0:n.geometryType;return s?[s]:[]})(s);return!t.length||t.includes(e)}return!(l!==t.DataLevel.DataSource||!n||"GPRasterDataLayer"!==s.dataType&&"GPMultiValue:GPRasterDataLayer"!==s.dataType)}))}),[l,f,O]);t.hooks.useUpdateEffect((()=>{if(N&&P){if(N.type===e.Standard){const e=`${N.toolName.toLowerCase()}${null==w?void 0:w.formatAnalysisEngineSuffix(N.analysisEngine)}`,a=`${t.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/tool-json/${e}.tool.json`,n=`${t.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/tool-ui-json/${e}.tool.ui.json`,s=`${t.urlUtils.getAbsoluteRootUrl()}arcgis-amd-packages/arcgis-analysis-assets/assets/t9n/${e}/${e}.t9n.${P}.json`;Promise.all([fetch(a).then((e=>e.json())),fetch(n).then((e=>e.json())),fetch(s).then((e=>e.json()))]).then((([e,t,a])=>{var n;const s=e.parameters,i=t.UIparameters.map((e=>e.UIparameters||[])).flat(),o=null===(n=s.filter((e=>"esriGPParameterDirectionOutput"!==e.direction)))||void 0===n?void 0:n.map((e=>{const t=i.find((t=>t.name===e.name)),n=Object.assign(Object.assign({},t),e),s=d(n.label,a);return s&&(n.label=s),n}));k(o)}))}else N.type===e.Custom&&k(N.config.toolInfo.parameters);F(null)}}),[N,P]);const $=(e,t)=>{const a=e.dataType.startsWith("GPMultiValue");let n=Object.assign({},t);return"GPRasterDataLayer"!==e.dataType&&"GPMultiValue:GPRasterDataLayer"!==e.dataType||(n.inputType="layer"),a&&(n=[n]),n};return(0,t.jsx)(n.Popper,{floating:!0,open:y,headerTitle:A("_action_setAsAnalysisInput_label"),onHeaderClose:L,minSize:b,onResize:e=>{g(e)},dragBounds:"body",defaultSize:p,reference:i,toggle:(e,t)=>{"clickOutside"!==t&&L()}},(0,t.jsx)("div",{className:"h-100 p-4 d-flex",css:T},w&&(0,t.jsx)(R,{translate:A,analysisSharedUtils:w,toolList:D,selectedTool:N,onSelectedToolChange:e=>{const t=D.find((t=>t.id===e.target.value));C(t)},validParameters:U,selectedParameter:I,onSelectedParameterChange:e=>{const t=U.find((t=>t.name===e.target.value));F(t)}}),(0,t.jsx)("div",{className:"footer"},(0,t.jsx)(n.Button,{type:"primary",disabled:!N||!I,onClick:()=>v(void 0,void 0,void 0,(function*(){var e,n,s,i,c;const{records:u,fields:d,name:m}=r,p=!!f.url,g=l===t.DataLevel.DataSource,y=null===(e=f.getDataSourceJson())||void 0===e?void 0:e.isOutputFromWidget,v=t.MutableStoreManager.getInstance().readStateValue(o,"input")||{};let h;const S=f;if(g&&p&&!y){const{url:e}=S;h={url:e};const t=null===(s=null===(n=S.getCurrentQueryParams)||void 0===n?void 0:n.call(S))||void 0===s?void 0:s.where;t&&(h.filter=t)}else if(g)try{const e=yield S.createJSAPILayerByDataSource();h=yield w.getGPFeatureRecordSetLayerValue(e),p&&y&&(h.title=m)}catch(e){console.error("create feature set error",e)}else try{const e=yield a.featureUtils.convertDataRecordSetToFeatureSet({dataSource:f,records:u,fields:d,name:m}),n=f.getSchema(),s=(null==d?void 0:d.length)?d:Object.keys(null==n?void 0:n.fields)||[],o=f.getGeometryType(),r={name:`${n.label||f.getLabel()}${l===t.DataLevel.Records?" - Selection":""}`,type:o?"Feature Layer":"Table",geometryType:o,fields:s.map((e=>{const t=n.fields[e];return{name:t.name,type:t.esriType,alias:t.alias,format:t.format}})),objectIdField:n.idField,spatialReference:e.spatialReference},p=null===(c=(i=f).getCurrentQueryParams)||void 0===c?void 0:c.call(i);(null==p?void 0:p.where)&&(r.definitionExpression=p.where,r.defaultVisibility=!0),h={layerDefinition:r,featureSet:e}}catch(e){console.error("create feature set error",e)}t.MutableStoreManager.getInstance().updateStateValue(o,"toolId",N.id),t.MutableStoreManager.getInstance().updateStateValue(o,"input",Object.assign(Object.assign({},v),{[I.name]:$(I,h)})),L()}))},A("ok")),(0,t.jsx)(n.Button,{className:"ml-2",onClick:L},A("cancel")))))};var P=function(e,t,a,n){return new(a||(a=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function r(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,r)}l((n=n.apply(e,t||[])).next())}))};class A extends t.AbstractDataAction{isSupported(e,n){return P(this,void 0,void 0,(function*(){if(e.length>1)return!1;const s=e[0];if(h(s.dataSource))return!0;if(n===t.DataLevel.DataSource)return S(s.dataSource);const{dataSource:i,records:o,fields:r,name:l}=s;try{if((yield a.featureUtils.convertDataRecordSetToFeatureSet({dataSource:i,records:o,fields:r,name:l})).features.length)return!0}catch(e){return!1}}))}onExecute(e,a){return P(this,void 0,void 0,(function*(){const n=e[0];return this._version||(this._version=0,this._versionPrefix=Date.now()),t.React.createElement(w,{activeRef:document.querySelector(".active-data-action-item"),widgetId:this.widgetId,dataSet:n,dataLevel:a,version:`${this._versionPrefix}_${this._version++}`,intl:this.intl})}))}}})(),r})())}}}));