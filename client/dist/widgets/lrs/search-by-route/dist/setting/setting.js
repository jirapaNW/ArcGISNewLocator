System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-for-builder","jimu-ui/basic/color-picker","widgets/shared-code/lrs","jimu-ui/basic/list-tree","jimu-core/react","jimu-ui/advanced/sql-expression-builder","jimu-ui/advanced/data-source-selector"],(function(e,t){var s={},i={},a={},n={},o={},r={},l={},u={},d={},c={};return{setters:[function(e){s.DataSourceManager=e.DataSourceManager,s.DataSourceTypes=e.DataSourceTypes,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.OrderRule=e.OrderRule,s.React=e.React,s.ReactRedux=e.ReactRedux,s.SessionManager=e.SessionManager,s.classNames=e.classNames,s.css=e.css,s.esri=e.esri,s.getAppStore=e.getAppStore,s.hooks=e.hooks,s.jsx=e.jsx,s.polished=e.polished,s.urlUtils=e.urlUtils},function(e){i.Button=e.Button,i.Checkbox=e.Checkbox,i.NumericInput=e.NumericInput,i.Select=e.Select,i.Switch=e.Switch,i.TextInput=e.TextInput,i.defaultMessages=e.defaultMessages},function(e){a.MapWidgetSelector=e.MapWidgetSelector,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper,a.getOutputJsonOriginDs=e.getOutputJsonOriginDs},function(e){n.getAppConfigAction=e.getAppConfigAction},function(e){o.ColorPicker=e.ColorPicker},function(e){r.GetEsriUnits=e.GetEsriUnits,r.GetUnits=e.GetUnits,r.SearchMethod=e.SearchMethod,r.colorBlack=e.colorBlack,r.errorMessageDelay=e.errorMessageDelay,r.formatMessage=e.formatMessage,r.highlightColor=e.highlightColor,r.isDefined=e.isDefined,r.messages=e.messages},function(e){l.List=e.List,l.TreeItemActionType=e.TreeItemActionType},function(e){u.Fragment=e.Fragment},function(e){d.Sort=e.Sort},function(e){c.DataSourceRemoveWaringReason=e.DataSourceRemoveWaringReason,c.DataSourceRemoveWarningPopup=e.DataSourceRemoveWarningPopup,c.dataComponentsUtils=e.dataComponentsUtils}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=s},68972:e=>{"use strict";e.exports=u},4108:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=i},13089:e=>{"use strict";e.exports=c},79298:e=>{"use strict";e.exports=a},71442:e=>{"use strict";e.exports=d},54337:e=>{"use strict";e.exports=o},98640:e=>{"use strict";e.exports=l},47626:e=>{"use strict";e.exports=r}},t={};function g(s){var i=t[s];if(void 0!==i)return i.exports;var a=t[s]={exports:{}};return e[s](a,a.exports,g),a.exports}g.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return g.d(t,{a:t}),t},g.d=(e,t)=>{for(var s in t)g.o(t,s)&&!g.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},g.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),g.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},g.p="";var p={};return g.p=window.jimuConfig.baseUrl,(()=>{"use strict";g.r(p),g.d(p,{__set_webpack_public_path__:()=>J,default:()=>W});var e=g(79244),t=g(14321),s=g(79298),i=g(4108);const a={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer Configuration",importAll:"Import all",selectMap:"Select Map",networkConfig:"Network Configuration",referentConfig:"Referent Configuration",networkLabel:"Label",routeIdentifier:"Identifier",spatialReference:"Spatial Reference",routeId:"Route ID",routeName:"Route name",multiField:"Multi field",searchMethod:"Search Methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result Settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",defaultReferent:"Default Referent",defaultOffsetUnit:"Default Offset Units",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection Settings",results:"Results",sortResults:"Sort results by:",radiusWithUnits:"Radius ({units})",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",lrs:"LRS",defaultStr:"Default",configureFields:"Configure Fields",defaultNetwork:"Default Network",searchMeasures:"Search Measures",singleLabel:"Single",multipleLabel:"Multiple",rangeLabel:"Range",expandByDefault:"Expand by default",loadLayers:"Load layers",clearLayers:"Clear layers",labelColor:"Label color",labelSize:"Label size"};var n,o,r,l,u=g(54337),d=g(47626),c=g(98640);!function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(n||(n={})),function(e){e.Map="MAP",e.Lrs="LRS"}(o||(o={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(r||(r={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(l||(l={}));var h=g(68972),m=g(28996),f=g.n(m),S=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const v=t=>{const s=window.SVG,{className:i}=t,a=S(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:f()},a)):e.React.createElement("svg",Object.assign({className:n},a))};function I(i){const{networkItem:n,onPropertyChanged:o,onPropertiesChanged:r}=i,l=e.hooks.useTranslation(a),u=Object.assign({},{},n),c=(e,t)=>{if(e.target)if(g(t)){const s=[],i=[];s.push(t),i.push(e.target.checked),s.push("defaultMethod"),i.push(p(t)),r(s,i,!0)}else o(t,e.target.checked,!0)},g=e=>{let t=!1;switch(e){case"useMeasure":t=u.defaultMethod===d.SearchMethod.Measure;break;case"useCoordinate":t=u.defaultMethod===d.SearchMethod.Coordinate;break;case"useReferent":t=u.defaultMethod===d.SearchMethod.Referent}return t},p=e=>"useMeasure"!==e&&u.useMeasure&&u.defaultMethod!==d.SearchMethod.Measure?d.SearchMethod.Measure:"useCoordinate"!==e&&u.useCoordinate&&u.defaultMethod!==d.SearchMethod.Coordinate?d.SearchMethod.Coordinate:d.SearchMethod.Referent,h=()=>{let e=0;return u.useMeasure&&e++,u.useCoordinate&&e++,u.useReferent&&e++,e};return(0,e.jsx)(s.SettingSection,{role:"group","aria-label":l("searchMethod"),title:l("searchMethod")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:l("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":l("defaultStr"),className:"w-100",size:"sm",value:u.defaultMethod,disabled:1===h(),onChange:e=>{o("defaultMethod",e.target.value,!0)}},u.useMeasure&&(0,e.jsx)("option",{value:d.SearchMethod.Measure},l("measure")),u.useCoordinate&&(0,e.jsx)("option",{value:d.SearchMethod.Coordinate},l("coordinate")),u.useReferent&&(0,e.jsx)("option",{value:d.SearchMethod.Referent},l("referent")))),(0,e.jsx)(s.SettingRow,{label:l("measure")},(0,e.jsx)(t.Switch,{"aria-label":l("measure"),checked:u.useMeasure,disabled:1===h()&&u.useMeasure,onChange:e=>{c(e,"useMeasure")}})),(0,e.jsx)(s.SettingRow,{label:l("coordinate")},(0,e.jsx)(t.Switch,{"aria-label":l("coordinate"),checked:u.useCoordinate,disabled:1===h()&&u.useCoordinate,onChange:e=>{c(e,"useCoordinate")}})),(0,e.jsx)(s.SettingRow,{label:l("referent")},(0,e.jsx)(t.Switch,{"aria-label":l("referent"),checked:u.useReferent,disabled:1===h()&&u.useReferent,onChange:e=>{c(e,"useReferent")}})))}function w(i){const{networkItem:o,onPropertyChanged:r}=i,l=e.hooks.useTranslation(a),u=Object.assign({},{},o),d=e=>u.routeIdFields[e].enabled,g=e=>{const t=u.routeIdFields.asMutable({deep:!0});t[e].enabled=!t[e].enabled,r("routeIdFields",t,!0)},p={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:c.TreeItemActionType.RenderOverrideItem,children:[{name:c.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:c.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:c.TreeItemActionType.RenderOverrideItemBody,children:[{name:c.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:c.TreeItemActionType.RenderOverrideItemDragHandle},{name:c.TreeItemActionType.RenderOverrideItemDetailToggle},{name:c.TreeItemActionType.RenderOverrideItemTitle},{name:c.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,e.jsx)(s.SettingSection,{title:l("routeIdentifier")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:l("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":l("defaultStr"),className:"w-100",size:"sm",value:u.defaultIdentifer,disabled:1===(()=>{let e=0;return u.useRouteId&&e++,u.useRouteName&&e++,u.useMultiField&&e++,e})(),onChange:e=>{r("defaultIdentifer",e.target.value,!0)}},u.useRouteId&&(0,e.jsx)("option",{value:n.RouteId},l("routeId")),u.useRouteName&&(0,e.jsx)("option",{value:n.RouteName},l("routeName")),u.useMultiField&&(0,e.jsx)("option",{value:n.MultiField},l("routeFields")))),u.defaultIdentifer===n.MultiField&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(c.List,Object.assign({className:"list-routeid-fields pt-2",showCheckbox:!0,dndEnabled:!0,itemsJson:Array.from(u.routeIdFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:d(t),itemStateTitle:e.field.alias,itemStateCommands:[]}))),onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s;var a;a=i.map((e=>e.itemStateDetailContent)),r("routeIdFields",a,!0)},renderOverrideItemDetailToggle:(s,i)=>{const{itemJsons:a,itemJsons:[{itemStateDetailVisible:n,itemStateDetailContent:o}]}=i.props,[r]=a,l=+r.itemKey;return o?(0,e.jsx)(t.Checkbox,{"aria-expanded":!!n,className:"jimu-tree-item__detail-toggle mr-2",checked:d(l),onClick:e=>{g(l)}}):null},onClickItemBody:(e,t)=>{const{itemJsons:[s]}=t.props;g(+s.itemKey)}},p))))}function y(t){const{widgetId:s,useDataSourceId:i}=t;return e.ReactRedux.useSelector((e=>{var t;let a;a=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig;return(null!==(t=a.widgets[s].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===i))}))}var b=g(71442);function x(i){const{networkItem:n,onPropertyChanged:o,onQueryItemChanged:r}=i,l=e.hooks.useTranslation(a);return(0,e.jsx)("div",null,(null==n?void 0:n.sortOptions)&&(0,e.jsx)(s.SettingSection,{role:"group","aria-label":l("results"),title:l("results")},(0,e.jsx)(s.SettingRow,{"aria-label":l("sortResults"),flow:"wrap",label:l("sortResults")},(0,e.jsx)(b.Sort,{onChange:e=>{const{dataSourceId:t,mainDataSourceId:s,dataViewId:i,rootDataSourceId:a}=n.useDataSource,o={dataSourceId:t,mainDataSourceId:s,dataViewId:i,rootDataSourceId:a,fields:n.useDataSource.fields};let l=n.set("sortOptions",e);l=l.set("useDataSource",o),r(l,!0)},value:(0,e.Immutable)(n.sortOptions),useDataSource:n.useDataSource})),(0,e.jsx)(s.SettingRow,{flow:"no-wrap",label:l("expandByDefault")},(0,e.jsx)(t.Switch,{"aria-label":l("expandByDefault"),checked:n.expandByDefault,onChange:e=>{o("expandByDefault",e.target.checked,!0)}}))))}function R(i){const{networkItem:n,onPropertyChanged:o}=i,r=e.hooks.useTranslation(a),l=Object.assign({},{},n),u=(e,t)=>{e.target&&o(t,e.target.checked,!0)},d=()=>{let e=0;return l.searchSingle&&e++,l.searchMultiple&&e++,l.searchRange&&e++,e};return(0,e.jsx)(s.SettingSection,{role:"group","aria-label":r("searchMeasures"),title:r("searchMeasures")},(0,e.jsx)(s.SettingRow,{label:r("singleLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("singleLabel"),checked:l.searchSingle,disabled:1===d()&&l.searchSingle,onChange:e=>{u(e,"searchSingle")}})),(0,e.jsx)(s.SettingRow,{label:r("multipleLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("multipleLabel"),checked:l.searchMultiple,disabled:1===d()&&l.searchMultiple,onChange:e=>{u(e,"searchMultiple")}})),(0,e.jsx)(s.SettingRow,{label:r("rangeLabel")},(0,e.jsx)(t.Switch,{"aria-label":r("rangeLabel"),checked:l.searchRange,disabled:1===d()&&l.searchRange,onChange:e=>{u(e,"searchRange")}})))}function C(i){const{networkItem:n,onPropertyChanged:r}=i,l=e.hooks.useTranslation(a),u=Object.assign({},{},n);return(0,e.jsx)(s.SettingSection,{title:l("spatialReference")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:l("Default")},(0,e.jsx)(t.Select,{"aria-label":l("Default"),className:"w-100",size:"sm",value:u.defaultSpatialReferenceFrom,onChange:e=>{r("defaultSpatialReferenceFrom",e.target.value,!0)}},(0,e.jsx)("option",{value:o.Map},l("map")),(0,e.jsx)("option",{value:o.Lrs},l("lrs")))))}function k(i){const{networkItem:n,intl:o,onPropertyChanged:r}=i,l=e.hooks.useTranslation(a),u=Object.assign({},{},n);return(0,e.jsx)(s.SettingSection,{title:l("search")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:l("radiusWithUnits",{units:(0,d.GetUnits)(u.unitsOfMeasure,o)})},(0,e.jsx)(t.NumericInput,{size:"sm",value:u.searchRadius,precision:3,onAcceptValue:e=>{r("searchRadius",e,!0)},"aria-label":l("radius"),className:"w-100"})))}function M(i){var n;const{intl:o,widgetId:r,index:l,networkItem:u,onNetworkItemChanged:d}=i,c=e.hooks.useTranslation(a),[g,p]=e.React.useState(null==u?void 0:u.name),h=y({widgetId:r,useDataSourceId:null===(n=null==u?void 0:u.useDataSource)||void 0===n?void 0:n.dataSourceId});e.React.useEffect((()=>{(null==u?void 0:u.name)&&g!==(null==u?void 0:u.name)&&p(null==u?void 0:u.name)}),[null==u?void 0:u.name]);const m=e.React.useCallback(((e,t,s=!1)=>{let i;i=null==t?u.without(e):u.set(e,t),d(l,i,s)}),[d,l,u]),f=e.React.useCallback(((e,t,s=!1)=>{if(e.length!==t.length)return;let i;e.forEach(((e,s)=>{i=null==t[s]?null==i?u.without(e):i.without(e):null==i?u.set(e,t[s]):i.set(e,t[s])})),d(l,i,s)}),[d,l,u]),S=e.React.useCallback((e=>{p(e.target.value)}),[]),v=e.React.useCallback((e=>{e.trim().length>0?m("name",e,!0):p(null==u?void 0:u.name)}),[null==u?void 0:u.name,m]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},u&&h&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingSection,{role:"group","aria-label":c("networkLabel"),title:c("networkLabel")},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:S,onAcceptValue:v,"aria-label":c("networkLabel")}))),(0,e.jsx)(I,{widgetId:r,networkItem:u,onPropertyChanged:m,onPropertiesChanged:f}),u.useMeasure&&(0,e.jsx)(R,{networkItem:u,onPropertyChanged:m}),(0,e.jsx)(w,{widgetId:r,networkItem:u,onPropertyChanged:m}),u.useCoordinate&&(0,e.jsx)(C,{networkItem:u,onPropertyChanged:m}),u.useCoordinate&&(0,e.jsx)(k,{intl:o,networkItem:u,onPropertyChanged:m}),(0,e.jsx)(x,{networkItem:u,onPropertyChanged:m,onQueryItemChanged:(e,t=!1)=>{d(l,e,t)}}))))}var j=g(31027),D=g.n(j),N=function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(i=Object.getOwnPropertySymbols(e);a<i.length;a++)t.indexOf(i[a])<0&&Object.prototype.propertyIsEnumerable.call(e,i[a])&&(s[i[a]]=e[i[a]])}return s};const O=t=>{const s=window.SVG,{className:i}=t,a=N(t,["className"]),n=(0,e.classNames)("jimu-icon jimu-icon-component",i);return s?e.React.createElement(s,Object.assign({className:n,src:D()},a)):e.React.createElement("svg",Object.assign({className:n},a))},L=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],T="Distance",F=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],P="Network_OBJECTID";function U(i){var n,o;const{widgetId:r,index:l,referentItem:u,onReferentItemChanged:d}=i,c=e.hooks.useTranslation(a),[g,p]=e.React.useState(null==u?void 0:u.name),[h,m]=e.React.useState(null===(n=null==u?void 0:u.layerFields[0])||void 0===n?void 0:n.name),f=y({widgetId:r,useDataSourceId:null===(o=null==u?void 0:u.useDataSource)||void 0===o?void 0:o.dataSourceId});e.React.useEffect((()=>{var e;(null==u?void 0:u.name)&&g!==(null==u?void 0:u.name)&&(p(null==u?void 0:u.name),m(null===(e=null==u?void 0:u.layerFields[0])||void 0===e?void 0:e.name)),(null==u?void 0:u.displayName)&&m(null==u?void 0:u.displayName)}),[null==u?void 0:u.name]);const S=e.React.useCallback(((e,t,s=!1)=>{let i;i=null==t?u.without(e):u.set(e,t),d(l,i,s)}),[d,l,u]),v=e.React.useCallback((e=>{p(e.target.value)}),[]),I=e.React.useCallback((e=>{e.trim().length>0?S("name",e,!0):p(null==u?void 0:u.name)}),[null==u?void 0:u.name,S]);return(0,e.jsx)("div",{className:"h-100"},(0,e.jsx)("div",{css:e.css`height: 100%; overflow:auto;`},u&&f&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)(s.SettingSection,{role:"group","aria-label":c("networkLabel"),title:c("networkLabel")},(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.TextInput,{size:"sm",type:"text",className:"w-100",value:g,onChange:v,onAcceptValue:I,"aria-label":c("networkLabel")}))),(0,e.jsx)(s.SettingSection,{role:"group","aria-label":c("configureFields"),title:c("configureFields")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:c("defaultStr")},(0,e.jsx)(t.Select,{"aria-label":c("defaultStr"),className:"w-100",size:"sm",value:h,onChange:e=>{(e=>{m(e);const t=u.set("displayName",e);d(l,t,!1)})(e.target.value)}},(()=>{const t=null==u?void 0:u.layerFields;if(0===(null==t?void 0:t.length))return[];const s=[];return t.forEach(((t,i)=>{s.push((0,e.jsx)("option",{key:i,value:t.name},t.name))})),s})()))))))}var A=function(e,t,s,i){return new(s||(s=Promise))((function(a,n){function o(e){try{l(i.next(e))}catch(e){n(e)}}function r(e){try{l(i.throw(e))}catch(e){n(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(o,r)}l((i=i.apply(e,t||[])).next())}))};const E=g(62838);function z(i){var r,l;const{intl:u,widgetId:g,networkItems:p=[],mapWidgetIds:m,portalUrl:f,theme:S,onNewNetworkItemsAdded:I,onNetworkItemRemoved:w,onClearAll:y,onNetworkItemChanged:b,onNetworkOrderChanged:x,onMapWidgetChanged:R}=i,C=e.React.useRef(null),[k,j]=e.React.useState(!1),[D,N]=e.React.useState(!1),[T,F]=e.React.useState(!1),[P,z]=e.React.useState(-1),[B,W]=e.React.useState(!1),J=e.hooks.useTranslation(a,d.messages),_=()=>{const e=null==m?void 0:m[0],t=H(e),s=[];return t.forEach((e=>{var t;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,a=X(i);s.includes(a)||s.push(a)})),s},H=t=>{var s,i,a,n,o;let r=[];if(!t)return r;const l=(null===(s=null===window||void 0===window?void 0:window.jimuConfig)||void 0===s?void 0:s.isBuilder)?null===(a=null===(i=(0,e.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(n=(0,e.getAppStore)().getState())||void 0===n?void 0:n.appConfig;if(!l)return r;const u=null===(o=l.widgets[t])||void 0===o?void 0:o.useDataSources;if(void 0!==u){u.map((e=>e.dataSourceId)).forEach((t=>{const s=e.DataSourceManager.getInstance().getDataSource(t),i=null==s?void 0:s.getDataSourcesByType(e.DataSourceTypes.FeatureLayer);i&&(r=r.concat(i))}))}return r},G=(t,s)=>A(this,void 0,void 0,(function*(){let i=!1;const a=t[s];let n=null;const o=e.SessionManager.getInstance().getSessionByUrl(f),r=o&&o.token?o.token:"";return n=r?{f:"json",token:r}:{f:"json"},i=yield $({method:"GET",url:a,params:n}).then((e=>{if(e.hasOwnProperty("lrs")){if(e.hasOwnProperty("networkLayers")||e.hasOwnProperty("eventLayers")||e.hasOwnProperty("calibrationPointLayers")||e.hasOwnProperty("intersectionLayers")||e.hasOwnProperty("nonLRSLayers")){return["networkLayers","eventLayers","calibrationPointLayers","intersectionLayers","nonLRSLayers"].forEach((t=>A(this,void 0,void 0,(function*(){if(e.hasOwnProperty(t)){if("eventLayers"===t){const s=e[t];e[t]=s.filter((e=>"esriLRSPointEventLayer"===e.type))}const s=e[t];(null==s?void 0:s.length)>0&&(yield V(e[t],t))}})))),!0}return N(!0),setTimeout((()=>{N(!1)}),d.errorMessageDelay),!1}return j(!0),setTimeout((()=>{j(!1)}),d.errorMessageDelay),!1})).catch((e=>!1)),i})),$=t=>new Promise((function(s,i){const a={params:t.params,httpMethod:t.method};e.esri.restRequest.request(t.url,a).then((e=>{s(e)})).catch((e=>{s(e)}))})),V=(e,t)=>A(this,void 0,void 0,(function*(){const s=null==m?void 0:m[0],i=H(s),a=[],n=[];e.forEach((e=>{n.push(e.id)}));const o=[];i.forEach((e=>{var t,s;const i=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,r=null==e?void 0:e.getLayerDefinition(),l=-1===p.findIndex((t=>t.id===e.id)),u=n.findIndex((e=>e===r.id))>-1,d=-1===o.findIndex((e=>e===r.id));i&&l&&u&&d&&(o.push(r.id),a.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(s=e.getRootDataSource())||void 0===s?void 0:s.id}))})),"networkLayers"===t&&0===n.length?(N(!0),setTimeout((()=>{N(!1)}),d.errorMessageDelay)):a.length>0&&(yield q(a,t))})),q=(t,s)=>A(this,void 0,void 0,(function*(){if(0===(null==t?void 0:t.length)||!s)return;const i=yield(()=>A(this,void 0,void 0,(function*(){let i=[];const a=[];return t.forEach((t=>{a.push(e.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,e.Immutable)(t)).then((a=>A(this,void 0,void 0,(function*(){const n=Q(a);n||Promise.reject(Error(""));const o=null==a?void 0:a.getLayerDefinition(),r=null==n?void 0:n.url;let l;"networkLayers"===s?l=X(r)+"/networkLayers/"+o.id:"eventLayers"===s?l=X(r)+"/eventLayers/"+o.id:"calibrationPointLayers"===s?l=X(r)+"/calibrationPointLayers/"+o.id:"intersectionLayers"===s?l=X(r)+"/intersectionLayers/"+o.id:"nonLRSLayers"===s&&(l=X(r)+"/nonLRSLayers/"+o.id),"networkLayers"===s?yield K(a,t,n,l,r).then((t=>(t&&(i=i.concat([(0,e.Immutable)(t)])),i))):yield Y(a,t,n,l,s).then((t=>(t&&(i=i.concat([(0,e.Immutable)(t)])),i)))})))))})),yield Promise.all(a),i})))();I(i)})),K=(t,s,i,a,r)=>{const l=e.SessionManager.getInstance().getSessionByUrl(f),u=l&&l.token?l.token:"";let c=null;return c=u?{f:"json",token:u}:{f:"json"},new Promise(((r,l)=>{$({method:"POST",url:a,params:c}).then((l=>A(this,void 0,void 0,(function*(){if(!l)return;const u=l.routeIdFieldName,c=l.routeNameFieldName,p=l.routeIdFields,h=!!u&&u.length>0,m=!!c&&c.length>0,f=!!p&&p.length>1,S=l.supportsLines,v=[],I=l.measurePrecision;let w=n.RouteId;S?w=n.RouteName:(null==p?void 0:p.length)>1&&(w=n.MultiField);const y=[];p&&p.forEach((e=>{u!==e&&c!==e&&y.push(e)}));const b=null==t?void 0:t.getSchema(),x=(null==b?void 0:b.fields)?Object.values(null==b?void 0:b.fields):[],R=x.find((e=>u===e.name)),C=x.find((e=>c===e.name)),k=x.filter((e=>y.includes(e.name)));w===n.RouteName&&null==C&&(w=n.RouteId,(null==p?void 0:p.length)>1&&(w=n.MultiField)),R&&v.push(R.alias),C&&v.push(C.alias),k.length>1&&k.forEach((e=>{v.push(e.alias)})),v.push(L.at(0).value),v.push(L.at(1).value);const M=[];k.forEach((e=>{const t={field:e,enabled:!0};M.push(t)}));let j="";j=S?null==C?void 0:C.jimuName:null==R?void 0:R.jimuName;const D=[],N={jimuFieldName:j,order:e.OrderRule.Asc};D.push(N);const O=`${Math.random()}`.slice(2),T=null==i?void 0:i.getLabel();let F=1e3;if("esriMeters"!==l.unitsOfMeasure)switch(l.unitsOfMeasure){case"esriDecimalDegrees":F=.009;break;case"esriNauticalMiles":case"esriIntNauticalMiles":F=.54;break;case"esriMiles":case"esriIntMiles":F=.62;break;case"esriKilometers":F=1;break;case"esriYards":case"esriIntYards":F=5468;break;case"esriFeet":case"esriIntFeet":F=1093.6;break;case"esriDecimeters":F=1e4;break;case"esriInches":case"esriIntInches":F=39370;break;case"esriCentimeters":F=1e5;break;case"esriMillimeters":F=1e6;break;case"esriPoints":F=2834640}const P={id:t.id,name:T,configId:O,lrsNetworkId:l.lrsNetworkId,outputLineDsId:`${g}_output_line_${O}`,outputPointDsId:`${g}_output_point_${O}`,networkUrl:a,useRouteId:h,useRouteName:m,useMultiField:f,useMeasure:!0,useCoordinate:!0,useReferent:!0,useDataSource:s,defaultMethod:d.SearchMethod.Measure,enabledMethods:[d.SearchMethod.Measure],defaultIdentifer:w,routeIdFieldName:u,routeNameFieldName:c,routeIdFields:M,routeIdField:R||void 0,routeNameField:C||void 0,routeIdFieldNames:p,supportsLines:S,unitsOfMeasure:l.unitsOfMeasure,sortOptions:D,measurePrecision:I,defaultSpatialReferenceFrom:o.Lrs,searchRadius:F,referent:!1,fromDateFieldName:null==l?void 0:l.fromDateFieldName,toDateFieldName:null==l?void 0:l.toDateFieldName,searchSingle:!0,searchMultiple:!0,searchRange:!0,expandByDefault:!1,spatialReferenceInfo:{wkid:l.spatialReferenceInfo.wkid,wkt:l.spatialReferenceInfo.wkt}},U=(0,e.Immutable)(Object.assign({},P,{networkInfo:P}));r(U)}))))}))},Y=(t,s,i,a,n)=>{const o=e.SessionManager.getInstance().getSessionByUrl(f),r=o&&o.token?o.token:"";let l=null;return l=r?{f:"json",token:r}:{f:"json"},new Promise(((o,r)=>{$({method:"POST",url:a,params:l}).then((r=>A(this,void 0,void 0,(function*(){var l,u;if(!r)return;const c=null==i?void 0:i.getLabel(),g=[],p=null==t?void 0:t.getLayerDefinition(),h=[null==p?void 0:p.globalIdField],m=null==p?void 0:p.editFieldsInfo;m&&(h.push(m.creationDateField),h.push(m.creatorField),h.push(m.editDateField),h.push(m.editorField));const f=null==p?void 0:p.fields;(null==f?void 0:f.length)>0&&f.forEach((e=>{"esriFieldTypeDate"===(null==e?void 0:e.type)&&h.push(null==e?void 0:e.name)}));const S=null===(l=null==t?void 0:t.getSchema())||void 0===l?void 0:l.fields;for(const e in S)h.includes(e)||g.push(S[e]);const v={id:t.id,layerId:r.id,name:c,networkUrl:a,type:n,useDataSource:s,referent:!0,defaultMethod:d.SearchMethod.Referent,displayName:null===(u=g[0])||void 0===u?void 0:u.name,layerFields:g,routeIdFieldName:null==r?void 0:r.routeIdFieldName,fromDateFieldName:null==r?void 0:r.fromDateFieldName,toDateFieldName:null==r?void 0:r.toDateFieldName,dateFormat:null==r?void 0:r.dateFormat,allFields:null==r?void 0:r.fields},I=(0,e.Immutable)(Object.assign({},v,{networkInfo:v}));o(I)}))))}))},Q=t=>t?t.type===e.DataSourceTypes.SceneLayer?t.getAssociatedDataSource():t:null,X=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},Z=e.React.useCallback((()=>{z(-1)}),[]),ee=e.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${S.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${S.ref.palette.neutral[1e3]};
          font-size: ${e.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${S.ref.palette.neutral[800]};
        }
      }
    }
  `,te={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:c.TreeItemActionType.RenderOverrideItem,children:[{name:c.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:c.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:c.TreeItemActionType.RenderOverrideItemBody,children:[{name:c.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:c.TreeItemActionType.RenderOverrideItemDragHandle},{name:c.TreeItemActionType.RenderOverrideItemTitle},{name:c.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};let se=J("networkConfig");return(null===(r=p[P])||void 0===r?void 0:r.referent)&&(se=J("referentConfig")),(0,e.jsx)("div",{ref:C,css:ee,className:(0,e.classNames)("d-flex flex-column",{"h-100":0===p.length})},(0,e.jsx)(s.SettingSection,{className:"border-0"},(0,e.jsx)(h.Fragment,null,(0,e.jsx)(s.SettingRow,{label:J("selectMap")}),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(s.MapWidgetSelector,{onSelect:e=>{R(e)},useMapWidgetIds:m})),(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",type:"primary",className:"w-100 text-dark",onClick:()=>{if(j(!1),W(!1),N(!1),F(!1),void 0===(null==m?void 0:m[0]))F(!0),setTimeout((()=>{F(!1)}),d.errorMessageDelay);else{const e=_();e.length>1?(W(!0),setTimeout((()=>{W(!1)}),d.errorMessageDelay)):e.length>0?G(e,0).then((e=>{e||(j(!0),setTimeout((()=>{j(!1)}),d.errorMessageDelay))})):(j(!0),setTimeout((()=>{j(!1)}),d.errorMessageDelay))}},title:J("importAll"),"aria-label":J("importAll")},J("loadLayers"))),p&&p.length>0&&(0,e.jsx)(s.SettingRow,null,(0,e.jsx)(t.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:y,title:J("clearLayers"),"aria-label":J("clearLayers")},J("clearLayers"))),k&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(h.Fragment,null,(0,e.jsx)(v,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,d.formatMessage)(u,"noLrsLayersTips")))),T&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(h.Fragment,null,(0,e.jsx)(v,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,d.formatMessage)(u,"noMapSelectedTips")))),D&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(h.Fragment,null,(0,e.jsx)(v,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,d.formatMessage)(u,"noNetworkLayersTips")))),B&&(0,e.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,e.jsx)(h.Fragment,null,(0,e.jsx)(v,{color:S.sys.color.error.main}),(0,e.jsx)("div",{className:"display-error-tips"},(0,d.formatMessage)(u,"multipleServicesTips")))))),(0,e.jsx)(s.SettingSection,{className:(0,e.classNames)("pt-0 border-0",{"h-100":0===p.length})},(0,e.jsx)("div",{className:"setting-ui-unit-list"},(0,e.jsx)(c.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:p.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:P===t,itemStateTitle:e.name,itemStateCommands:[{label:J("removeNetwork"),iconProps:()=>({icon:E,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,s=+t.itemKey;s===P&&Z(),w(s)}}]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:s}=t.props,[,i]=s;x(i.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[s]}=t.props;var i;i=+s.itemKey,z(i===P?-1:i)}},te)),p.length===P&&(0,e.jsx)(c.List,Object.assign({className:"setting-ui-unit-list-new",css:e.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${P}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},te))),0===p.length&&(0,e.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,e.jsx)("div",{className:"empty-placeholder-inner"},(0,e.jsx)("div",{className:"empty-placeholder-icon"},(0,e.jsx)(O,{size:48})),(0,e.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:J("blankStatus")}}))),(0,e.jsx)(s.SidePopper,{isOpen:P>=0&&!e.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:Z,position:"right",trigger:null==C?void 0:C.current,title:se},!1===(null===(l=p[P])||void 0===l?void 0:l.referent)?(0,e.jsx)(M,{intl:u,widgetId:g,index:P,total:p.length,networkItem:p[P],onNetworkItemChanged:b}):(0,e.jsx)(U,{widgetId:g,index:P,total:p.length,referentItem:p[P],onReferentItemChanged:b}))))}var B=g(13089);class W extends e.React.PureComponent{constructor(n){super(n),this.updateWidgetJson=(...e)=>{const[t,...s]=e,i=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(i,...s)},this.updateConfigForOptions=(...e)=>{let t=null;const s=e.reduce(((e,[s,i,a])=>("networkItems"===s&&(null==a?void 0:a.dsUpdateRequired)&&(t=this.getAllDataSources(i)),e.set(s,i))),this.props.config);t?this.updateWidgetJson({config:s,useDataSources:Object.values(t.useDataSourceMap)},t.outputDataSources):this.updateWidgetJson({config:s})},this.tryRemoveNetworkItem=e=>{const t=this.props.config.networkItems[e],s=(0,i.getAppConfigAction)().appConfig;0===B.dataComponentsUtils.getWidgetsUsingDsOrItsDescendantDss(t.outputLineDsId,s.widgets).length?this.doRemoveNetworkItem(e,!0):this.setState({showRemoveNetworkItemWarning:!0,indexOfNetworkItemToRemove:e,dsToRemove:t.outputLineDsId})},this.beforeRemovingDataSource=()=>{this.doRemoveNetworkItem(this.state.indexOfNetworkItemToRemove)},this.doRemoveNetworkItem=(e,t=!1)=>{const s={dsUpdateRequired:t},i=this.props.config.networkItems.asMutable({deep:!0});i.splice(e,1),this.updateConfigForOptions(["networkItems",i,s])},this.afterRemovingDataSource=()=>{this.setState({showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null})},this.addNetworkItems=(t,s=!0)=>{var i,a,n;let o=null!==(i=this.props.config.networkItems)&&void 0!==i?i:(0,e.Immutable)([]),r=null!==(n=null===(a=this.props.config.networkItems)||void 0===a?void 0:a.length)&&void 0!==n?n:0;t.forEach((t=>{o=e.Immutable.set(o,r,t),r++})),this.updateConfigForOptions(["networkItems",o,{dsUpdateRequired:s}])},this.updateNetworkItem=(t,s,i=!1)=>{var a;let n=null!==(a=this.props.config.networkItems)&&void 0!==a?a:(0,e.Immutable)([]);n=e.Immutable.set(n,t,s),this.updateConfigForOptions(["networkItems",n,{dsUpdateRequired:i}])},this.reOrderNetworkItems=e=>{this.updateConfigForOptions(["networkItems",e])},this.getAllDataSources=t=>(0,e.Immutable)(t).asMutable({deep:!0}).reduce(((t,i)=>{var a,n;const o=i.useDataSource,r=o.dataSourceId;if(t.useDataSourceMap[r]=t.useDataSourceMap[r]||o,t.useDataSourceMap[r].fields=o.fields,!i.referent){const o=e.DataSourceManager.getInstance().getDataSource(null===(a=i.useDataSource)||void 0===a?void 0:a.dataSourceId);if(o){const e=null===(n=(0,s.getOutputJsonOriginDs)(o))||void 0===n?void 0:n.getDataSourceJson(),a=this.getInitOutDataSource(this.props.widgetId,e,i,!0),r=this.getInitOutDataSource(this.props.widgetId,e,i,!1);t.outputDataSources.push(a),t.outputDataSources.push(r)}}return t}),{useDataSourceMap:{},outputDataSources:[]}),this.getInitOutDataSource=(e,t,s,i)=>{const a=i?this.getI18nMessage("outputDsLabelPoint",{label:`${s.name}`}):this.getI18nMessage("outputDsLabelLine",{label:`${s.name}`}),n=i?s.outputPointDsId:s.outputLineDsId,o=this.getInitSchema(a,s);return{id:n,type:null==t?void 0:t.type,label:a,originDataSources:[s.useDataSource],url:null==t?void 0:t.url,itemId:null==t?void 0:t.itemId,portalUrl:null==t?void 0:t.portalUrl,layerId:null==t?void 0:t.layerId,layers:null==t?void 0:t.layers,isOutputFromWidget:!0,isDataInDataSourceInstance:!0,schema:o,geometryType:i?"esriGeometryPoint":"esriGeometryPolyline"}},this.getInitSchema=(t="",s)=>{const i={},a=e.DataSourceManager.getInstance().getDataSource(s.useDataSource.dataSourceId),n=null==a?void 0:a.getSchema().fields.asMutable({deep:!0}),o=[];return Object.keys(n).forEach((e=>{o.push(n[e])})),L.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.Number,jimuName:t.value,name:t.value})})),o.push({alias:T,type:e.JimuFieldType.String,jimuName:T,name:T}),F.forEach((t=>{o.push({alias:t.value,type:e.JimuFieldType.String,jimuName:t.value,name:t.value})})),o.push({alias:P,type:e.JimuFieldType.String,jimuName:P,name:P}),null==o||o.forEach((e=>{i[null==e?void 0:e.jimuName]=e})),{label:t,idField:"OBJECTID",fields:i}},this.hideRemovePopup=()=>{this.setState({showRemoveNetworkItemWarning:!1})},this.getI18nMessage=(e,s)=>{const i=Object.assign({},a,t.defaultMessages,d.messages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},s)},this.handleHighlishStyleChange=e=>{const t=this.props.config.highlightStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",t)})},this.handleLabelStyleChange=e=>{const t=this.props.config.labelStyle.asMutable({deep:!0});"string"==typeof e&&(t.color=e),"number"==typeof e&&(t.size=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",t)})},this.handleDefaultOffsetUnitChange=e=>{var t;const s=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,i=this.props.config.resultConfig.asMutable({deep:!0});i.defaultOffsetUnit=s,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",i)})},this.handleDefaultReferentChange=t=>{var s;const i=null===(s=null==t?void 0:t.target)||void 0===s?void 0:s.value,a=this.props.config.networkItems.find((e=>e.layerId===i)),n=this.props.config.resultConfig.asMutable({deep:!0});n.defaultReferentLayer=(0,e.Immutable)(a),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",n)})},this.handlePageSizeChange=e=>{const t=this.props.config.resultConfig.asMutable({deep:!0});t.pageSize=e,this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})},this.handleHideMethodChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideMethod",t)})},this.handleHideNetworkChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("hideNetwork",t)})},this.handleDefaultNetworkChange=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})},this.removeAllLayers=(e=!1)=>{const t={dsUpdateRequired:e};this.updateConfigForOptions(["networkItems",[],t])},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.state={showLayerPanel:!1,noLrsLayers:!1,showRemoveNetworkItemWarning:!1,indexOfNetworkItemToRemove:-1,dsToRemove:null}}getUnits(){return[this.getI18nMessage("inches"),this.getI18nMessage("points"),this.getI18nMessage("feet"),this.getI18nMessage("yards"),this.getI18nMessage("miles"),this.getI18nMessage("nauticalMiles"),this.getI18nMessage("millimeters"),this.getI18nMessage("centimeters"),this.getI18nMessage("meters"),this.getI18nMessage("kilometers"),this.getI18nMessage("decimalDegrees"),this.getI18nMessage("decimeters"),this.getI18nMessage("intFeet")]}getUnit(e){const t=this.getUnits();return e?(0,d.GetEsriUnits)(t[e],this.props.intl):(0,d.GetEsriUnits)(t[0],this.props.intl)}getHighlightStyleConfig(){if(this.props.config.highlightStyle)return this.props.config.highlightStyle;{const e=this.getDefaultHighlightStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",e)}),e}}getDefaultHighlightStyleConfig(){return{color:d.highlightColor,size:3}}getLabelStyleConfig(){if(this.props.config.labelStyle)return this.props.config.labelStyle;{const e=this.getDefaultLabelStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("labelStyle",e)}),e}}getDefaultLabelStyleConfig(){return{color:d.colorBlack,size:12}}getResultConfig(){if(this.props.config.resultConfig)return this.props.config.resultConfig;{const e=this.getDefaultResultsConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",e)}),e}}getDefaultResultsConfig(){return{pageSize:25}}getDefaultOffsetUnitsConfig(){let t=this.props.config.resultConfig.asMutable({deep:!0});return(0,d.isDefined)(t)||(t=this.getDefaultResultsConfig()),(0,d.isDefined)(t.defaultOffsetUnit)&&""!==t.defaultOffsetUnit||(t.defaultOffsetUnit=this.getUnit(),(0,d.isDefined)(t.defaultReferentLayer)||(t.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent)))),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",t)})),t.defaultOffsetUnit}getDefaultReferentConfig(){const t=this.props.config;let s=this.props.config.resultConfig.asMutable({deep:!0});return(0,d.isDefined)(s)||(s=this.getDefaultResultsConfig()),s&&(0,d.isDefined)(s.defaultReferentLayer)&&t.networkItems.findIndex((e=>e.layerId===s.defaultReferentLayer.layerId))>-1||(s.defaultReferentLayer=(0,e.Immutable)(this.props.config.networkItems.find((e=>e.referent))),""===s.defaultOffsetUnit&&(s.defaultOffsetUnit=this.getUnit()),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("resultConfig",s)})}),200)),s.defaultReferentLayer.layerId}getHideMethodConfig(){return this.props.config.hideMethod}getHideNetworkConfig(){return this.props.config.hideNetwork}getDefaultNetworkConfig(){const e=this.props.config;if(this.props.config.defaultNetwork&&""!==e.defaultNetwork&&this.props.config.networkItems.findIndex((t=>t.name===e.defaultNetwork))>-1)return this.props.config.defaultNetwork;if(this.props.config.networkItems.filter((e=>!e.referent)).length>0){const e=this.props.config.networkItems.find((e=>!e.referent)).name;return setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetwork",e)})}),200),e}}render(){var i,a;const{config:n}=this.props;return(0,e.jsx)("div",{className:"setting-search-by-route h-100"},(0,e.jsx)("div",{className:"jimu-widget-setting setting-search-by-route__setting-content h-100"},(0,e.jsx)(z,{intl:this.props.intl,widgetId:this.props.id,networkItems:this.props.config.networkItems,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onNewNetworkItemsAdded:this.addNetworkItems,onNetworkItemChanged:this.updateNetworkItem,onClearAll:this.removeAllLayers,onNetworkItemRemoved:this.tryRemoveNetworkItem,onNetworkOrderChanged:this.reOrderNetworkItems,onMapWidgetChanged:this.mapWidgetIdUpdated}),0!==n.networkItems.length&&(0,e.jsx)("div",null,(0,e.jsx)(s.SettingSection,{role:"group",title:this.getI18nMessage("selectionSettings"),"aria-label":this.getI18nMessage("selectionSettings")},(0,e.jsx)(s.SettingRow,{label:this.getI18nMessage("selectionHighlight")},(0,e.jsx)(u.ColorPicker,{color:this.props.config.highlightStyle.color?this.props.config.highlightStyle.color:d.highlightColor,value:this.getHighlightStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("selectionHighlight")})),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("graphicWidth")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getHighlightStyleConfig().size||3,precision:1,min:0,max:15,step:.1,onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("graphicWidth"),className:"w-100"})),(0,e.jsx)(s.SettingRow,{label:this.getI18nMessage("labelColor")},(0,e.jsx)(u.ColorPicker,{color:this.props.config.labelStyle.color?this.props.config.labelStyle.color:d.colorBlack,value:this.getLabelStyleConfig().color||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelColor")})),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("labelSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getLabelStyleConfig().size,precision:1,min:0,max:30,step:.1,onChange:this.handleLabelStyleChange,"aria-label":this.getI18nMessage("labelSize"),className:"w-100"}))),(0,e.jsx)(s.SettingSection,{role:"group",title:this.getI18nMessage("resultSettings"),"aria-label":this.getI18nMessage("resultSettings")},(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("resultsPageSize")},(0,e.jsx)(t.NumericInput,{size:"sm",value:this.getResultConfig().pageSize,precision:0,min:5,max:500,onChange:this.handlePageSizeChange,"aria-label":this.getI18nMessage("resultsPageSize"),className:"w-100"}))),(0,e.jsx)(s.SettingSection,{role:"group",title:(0,d.formatMessage)(this.props.intl,"displaySettings"),"aria-label":(0,d.formatMessage)(this.props.intl,"displaySettings")},(0,e.jsx)(s.SettingRow,{label:(0,d.formatMessage)(this.props.intl,"hideMethod")},(0,e.jsx)(t.Switch,{"aria-label":(0,d.formatMessage)(this.props.intl,"hideMethod"),checked:this.getHideMethodConfig(),onChange:this.handleHideMethodChange})),(0,e.jsx)(s.SettingRow,{label:(0,d.formatMessage)(this.props.intl,"hideNetwork")},(0,e.jsx)(t.Switch,{"aria-label":(0,d.formatMessage)(this.props.intl,"hideNetwork"),checked:this.getHideNetworkConfig(),onChange:this.handleHideNetworkChange})),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultNetwork")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultNetwork"),className:"w-100",size:"sm",value:this.getDefaultNetworkConfig(),disabled:1===n.networkItems.length,onChange:e=>{this.handleDefaultNetworkChange(e.target.value)}},n.networkItems.filter((e=>!e.referent)).map(((t,s)=>(0,e.jsx)("option",{key:s,value:t.name},t.name))))),this.props.config.networkItems&&(null===(i=this.props.config.networkItems.filter((e=>e.referent)))||void 0===i?void 0:i.length)>0&&(0,e.jsx)(h.Fragment,null,(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultReferent")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultReferent"),value:this.getDefaultReferentConfig(),onChange:this.handleDefaultReferentChange},null===(a=this.props.config.networkItems.filter((e=>e.referent)))||void 0===a?void 0:a.map(((t,s)=>(0,e.jsx)("option",{key:s,value:t.layerId},t.name))))),(0,e.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("defaultOffsetUnit")},(0,e.jsx)(t.Select,{"aria-label":this.getI18nMessage("defaultOffsetUnit"),value:this.getDefaultOffsetUnitsConfig(),onChange:this.handleDefaultOffsetUnitChange},this.getUnits().map(((t,s)=>(0,e.jsx)("option",{key:s,value:(0,d.GetEsriUnits)(t,this.props.intl)},t)))))))),(0,e.jsx)(B.DataSourceRemoveWarningPopup,{dataSourceId:this.state.dsToRemove,isOpen:this.state.showRemoveNetworkItemWarning,toggle:this.hideRemovePopup,reason:B.DataSourceRemoveWaringReason.DataSourceRemoved,afterRemove:this.afterRemovingDataSource,beforeRemove:this.beforeRemovingDataSource})))}}function J(e){g.p=e}})(),p})())}}}));