System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","calcite-components","jimu-core/react","esri/Graphic","jimu-theme","esri/layers/GraphicsLayer","esri/geometry/geometryEngine"],(function(e,t){var a={},o={},n={},i={},r={},s={},l={},u={},c={},d={};return{setters:[function(e){a.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,a.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,a.DataSourceComponent=e.DataSourceComponent,a.DataSourceManager=e.DataSourceManager,a.DataSourceStatus=e.DataSourceStatus,a.Immutable=e.Immutable,a.JimuFieldType=e.JimuFieldType,a.MessageManager=e.MessageManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.RecordSetChangeType=e.RecordSetChangeType,a.SessionManager=e.SessionManager,a.classNames=e.classNames,a.css=e.css,a.hooks=e.hooks,a.injectIntl=e.injectIntl,a.jsx=e.jsx,a.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){o.ConvertUnits=e.ConvertUnits,o.GetUnits=e.GetUnits,o.InlineEditableDropdown=e.InlineEditableDropdown,o.Intellisense=e.Intellisense,o.IntellisenseTextInput=e.IntellisenseTextInput,o.SearchMethod=e.SearchMethod,o.convertStationToNumber=e.convertStationToNumber,o.createLabelLayer=e.createLabelLayer,o.formatMessage=e.formatMessage,o.getCalciteBasicTheme=e.getCalciteBasicTheme,o.getDateWithTZOffset=e.getDateWithTZOffset,o.getGeometryGraphic=e.getGeometryGraphic,o.getPolylineMidPoint=e.getPolylineMidPoint,o.getSimplePointGraphic=e.getSimplePointGraphic,o.getSuggestions=e.getSuggestions,o.isDefined=e.isDefined,o.isInWidgetController=e.isInWidgetController,o.removeLabelLayer=e.removeLabelLayer,o.requestService=e.requestService},function(e){n.Alert=e.Alert,n.Button=e.Button,n.DataActionList=e.DataActionList,n.DataActionListStyle=e.DataActionListStyle,n.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,n.Label=e.Label,n.Loading=e.Loading,n.LoadingType=e.LoadingType,n.NumericInput=e.NumericInput,n.Pagination=e.Pagination,n.Select=e.Select,n.TextInput=e.TextInput,n.Tooltip=e.Tooltip,n.WidgetPlaceholder=e.WidgetPlaceholder},function(e){i.JimuMapViewComponent=e.JimuMapViewComponent,i.geometryUtils=e.geometryUtils,i.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.CalciteSegmentedControl=e.CalciteSegmentedControl,r.CalciteSegmentedControlItem=e.CalciteSegmentedControlItem},function(e){s.useImperativeHandle=e.useImperativeHandle},function(e){l.default=e.default},function(e){u.withTheme=e.withTheme},function(e){c.default=e.default},function(e){d.default=e.default}],execute:function(){e((()=>{var e={37264:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M5 4.5h3.5V0h1v4.5H20v1h-4.5V10h-1V5.5H5z"></path><path fill="#000" fill-rule="evenodd" d="M8.682 9.318a4.5 4.5 0 0 1 .334 5.991l3.97 3.97-.708.706-3.969-3.969a4.5 4.5 0 1 1 .373-6.698m-.707 5.657a3.5 3.5 0 1 0-4.95-4.95 3.5 3.5 0 0 0 4.95 4.95" clip-rule="evenodd"></path></svg>'},35737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m14 4-6 8-6-8z"></path></svg>'},23001:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m4 2 8 6-8 6z"></path></svg>'},96300:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M15 7.5a.52.52 0 0 1-.516.527H2.976L6.473 11.6a.535.535 0 0 1 0 .746.51.51 0 0 1-.73 0L1 7.5l4.743-4.846a.51.51 0 0 1 .73 0 .535.535 0 0 1 0 .746L2.976 6.973h11.508c.285 0 .516.236.516.527"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},99037:e=>{"use strict";e.exports=r},22089:e=>{"use strict";e.exports=l},77958:e=>{"use strict";e.exports=d},59620:e=>{"use strict";e.exports=c},62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=a},68972:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=u},14321:e=>{"use strict";e.exports=n},47626:e=>{"use strict";e.exports=o}},t={};function f(a){var o=t[a];if(void 0!==o)return o.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,f),n.exports}f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var a in t)f.o(t,a)&&!f.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="";var m={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(m),f.d(m,{__set_webpack_public_path__:()=>rt,default:()=>it});var e=f(79244),t=f(47626);const a={_widgetLabel:"Search By Route",method:"Method *",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",network:"Network *",referent:"Referent",referentRequired:"Referent *",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidCoordinate:"Invalid coordinate value",invalidRouteField:"Route could not be found with provided value",measureWithUnits:"Measure ({units})",measuresWithUnits:"Measures ({units})",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",coordinateSearchDisabled:"Provide coordinate",xCoordinateRequiredLabel:"X Coordinate *",yCoordinateRequiredLabel:"Y Coordinate *",zCoordinateLabel:"Z Coordinate",searchRadiusResultsError:"No routes found in search radius.",offsetlabel:"Offset ({unit})",invalidOffset:"Invalid Offset",invalidReferent:"Invalid Referent",searchReferentTooltip:"Search By Referent",referentDisplayName:"{displayName} *",noResultReferent:"No routes found for the given offset value",addAnotherMeasure:"Add another measure",range:"Range",noResults:"No results with provided values",noResultsMeasure:"No results found with provided measure(s)",fieldNameRequired:"{field} *",measureType:"Measure Type"};var o,n,i,r,s=f(14321),l=f(37264),u=f.n(l),c=f(62686);function d(o){var n;const i=e.hooks.useTranslation(a),{config:r,defaultReferent:l,networkConfig:u,onMethodChanged:c,onNetworkChanged:d,onReferentChanged:f}=o,[m,h]=e.React.useState(u[0]),[p,g]=e.React.useState(null===(n=null==r?void 0:r.resultConfig)||void 0===n?void 0:n.defaultReferentLayer),[v,y]=e.React.useState(m.defaultMethod),[S,R]=e.React.useState([]);e.React.useEffect((()=>{g(l)}),[l]),e.React.useEffect((()=>{for(let a=0;a<u.length;a++){const a=u.find((e=>e.name===r.defaultNetwork));if((0,t.isDefined)(a)&&!(null==a?void 0:a.referent)){h((0,e.Immutable)(a)),y(a.defaultMethod);break}}}),[r.defaultNetwork,u]);const b=(e,t)=>{const a=u.findIndex((t=>t.name===e));"network"===t?(h(u[a]),d(u[a])):(g(u[a]),f(u[a])),y(u[a].defaultMethod),c(u[a].defaultMethod)};e.React.useEffect((()=>{const e=u.filter((e=>!e.referent)).map((e=>e.name)).asMutable();R(e)}),[u]);const w=e.React.useMemo((()=>{let e=0;return m.useMeasure&&e++,m.useCoordinate&&e++,m.useReferent&&e++,e}),[m]);return(0,e.jsx)("div",{className:"search-method-form"},!r.hideMethod&&(0,e.jsx)(t.InlineEditableDropdown,{label:i("method"),isDisabled:1===w,defaultItem:v,altItemDescriptions:(()=>{const e=[];return m.useMeasure&&e.push(i("measure")),m.useCoordinate&&e.push(i("coordinate")),m.useReferent&&e.push(i("referent")),e})(),listItems:(()=>{const e=[];return m.useMeasure&&e.push(t.SearchMethod.Measure),m.useCoordinate&&e.push(t.SearchMethod.Coordinate),m.useReferent&&e.push(t.SearchMethod.Referent),e})(),onSelectionChanged:e=>{let a=t.SearchMethod.Measure;e===t.SearchMethod.Coordinate?a=t.SearchMethod.Coordinate:e===t.SearchMethod.Referent&&(a=t.SearchMethod.Referent),y(a),c(a)}}),!r.hideNetwork&&(0,e.jsx)(t.InlineEditableDropdown,{label:i("network"),isDisabled:1===u.length,defaultItem:(0,t.isDefined)(m)?m.name:"",listItems:S,onSelectionChanged:e=>{b(e,"network")}}),v===t.SearchMethod.Referent&&(0,e.jsx)("div",{className:"search-method-form__network-label px-3",style:{paddingTop:"12px"}},(0,e.jsx)(s.Label,{size:"default",className:"mb-1",style:{width:100,alignItems:"center",fontWeight:"500"}},i("referentRequired")),(0,e.jsx)(s.Select,{"aria-label":i("referent"),className:"w-100",size:"sm",disabled:1===u.length,value:p.name,onChange:e=>{b(e.target.value,"point")}},u.map(((t,a)=>(null==t?void 0:t.referent)?(0,e.jsx)("option",{key:a,value:t.name},t.name):null)))))}!function(e){e.RouteId="ROUTEID",e.RouteName="ROUTENAME",e.MultiField="MULTIFIELD"}(o||(o={})),function(e){e.Map="MAP",e.Lrs="LRS"}(n||(n={})),function(e){e.X="X",e.Y="Y",e.Z="Z"}(i||(i={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE",e.Range="RANGE"}(r||(r={}));const h=e.React.memo((n=>{const{intl:i,reset:r,widgetId:l,networkItem:u,dataSource:c,isDataSourceReady:d,routeAndMeasureRequest:f,onChange:m,onAccept:h}=n,{routeIdField:p,routeNameField:g,routeIdFields:v}=u,y=e.hooks.useTranslation(a),S=e.React.useMemo((()=>c),[c]),R=(e,t)=>{N(e,t)},b=(e,t,a)=>{w(e,t,a)},w=(e,t,a)=>{const n=f;u.defaultIdentifer===o.RouteId&&"string"==typeof e?(n.routeId=e,h(n,t)):u.defaultIdentifer===o.RouteName&&"string"==typeof e?(n.routeName=e,h(n,t)):(n.routeIdFields[a]=e,h(n,t,a))},N=(e,t)=>{const a=f;u.defaultIdentifer===o.RouteId&&"string"==typeof e?(a.routeId=e,m(a)):u.defaultIdentifer===o.RouteName&&"string"==typeof e?(a.routeName=e,m(a)):(a.routeIdFields[t]=e,m(a,t))},I=e.React.useMemo((()=>{const e={};return v&&v.length>1&&S&&v.forEach(((t,a)=>{const o=null==S?void 0:S.getFieldCodedValueList(t.field.jimuName);o&&(e[a]=o)})),e}),[S,v]);return(0,e.jsx)("div",{className:"route-input-control"},u.defaultIdentifer===o.RouteId&&(0,e.jsx)("div",{className:"search-by-measure-form__route-id-label px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},y("fieldNameRequired",{field:p.alias})),(0,e.jsx)(t.IntellisenseTextInput,{reset:r,widgetId:l,fieldName:u.routeIdField.name,fieldType:u.routeIdField.type,dataSource:c,isDataSourceReady:d,onChange:R,onAccept:b})),u.defaultIdentifer===o.RouteName&&(0,e.jsx)("div",{className:"search-by-measure-form__route-name-label px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},y("fieldNameRequired",{field:g.alias})),(0,e.jsx)(t.IntellisenseTextInput,{reset:r,widgetId:l,fieldName:u.routeNameField.name,fieldType:u.routeNameField.type,dataSource:c,isDataSourceReady:d,onChange:R,onAccept:b})),u.defaultIdentifer===o.MultiField&&v.filter((e=>e.enabled)).map(((a,o)=>{var n,u;return(0,e.jsx)("div",{key:o,className:"search-by-measure-form__multi-field-id px-3"},I[o]&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__coded-domain-label",{"pt-2":o>0})},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(s.Select,{"aria-label":a.field.name,size:"sm",style:{width:"100%"},value:null===(n=null==f?void 0:f.routeIdFields)||void 0===n?void 0:n[o],onChange:e=>{((e,t)=>{w(e.target.value,!0,t)})(e,o)}},(0,e.jsx)("option",{key:-1,value:""},(0,t.formatMessage)(i,"nullLabel")),I[o].map(((t,a)=>(0,e.jsx)("option",{key:a,value:t.value},`${t.value} - ${t.label}`))))),!I[o]&&a.field.type===e.JimuFieldType.Number&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__numeric-label",{"pt-2":o>0})},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(s.NumericInput,{value:null===(u=null==f?void 0:f.routeIdFields)||void 0===u?void 0:u[o],"aria-label":a.field.name,size:"sm",style:{width:"100%"},step:1,disabled:!d,onAcceptValue:e=>{((e,t)=>{w(e,!0,t)})(e,o)}})),!I[o]&&a.field.type===e.JimuFieldType.String&&(0,e.jsx)("div",{className:(0,e.classNames)("search-by-measure-form__text-label",{"pt-2":o>0})},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},a.field.alias),(0,e.jsx)(t.IntellisenseTextInput,{reset:r,widgetId:l,fieldName:a.field.name,fieldType:a.field.type,dataSource:c,isDataSourceReady:d,onChange:e=>{R(e,o)},onAccept:(e,t)=>{b(e,t,o)}})))})))}));var p=f(99037);const g=e.React.memo((o=>{const{networkItem:n,searchMeasureBy:i,onChange:l}=o,u=e.hooks.useTranslation(a);return(0,e.jsx)("div",{className:"measures-segment-control"},(()=>{let e=0;return n.searchSingle&&e++,n.searchMultiple&&e++,n.searchRange&&e++,e>1})()&&(0,e.jsx)("div",{className:"w-100 px-3 pt-2",css:(0,t.getCalciteBasicTheme)()},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},u("measureType")),(0,e.jsx)(p.CalciteSegmentedControl,{width:"full",value:i,appearance:"outline-fill",scale:"s",onCalciteSegmentedControlChange:e=>{l(e.target.value)}},n.searchSingle&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:i===r.Single||void 0,value:r.Single},u("single")),n.searchMultiple&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:i===r.Multiple||void 0,value:r.Multiple},u("multiple")),n.searchRange&&(0,e.jsx)(p.CalciteSegmentedControlItem,{checked:i===r.Range||void 0,value:r.Range},u("range")))))}));var v=f(62838),y=f.n(v),S=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const R=t=>{const a=window.SVG,{className:o}=t,n=S(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:i,src:y()},n)):e.React.createElement("svg",Object.assign({className:i},n))};function b(o){const{reset:n,networkItem:i,isDataSourceReady:l,searchMeasureBy:u,routeAndMeasureRequest:c,intl:d,onChange:f}=o,m=e.hooks.useTranslation(a),h=(0,t.GetUnits)(i.unitsOfMeasure,d),[p,g]=e.React.useState(null),[v,y]=e.React.useState(null),[S,b]=e.React.useState(null),[w,N]=e.React.useState(new Array(1).fill(""));e.React.useEffect((()=>{g(null),y(null),b(null),N(new Array(1).fill(""))}),[n]);const I=(e,a,o)=>{if(isNaN(Number(e))){const n=(0,t.convertStationToNumber)(e);return isNaN(n)?(x(NaN,a,!1,o,""),{valid:!1,msg:m("invalidMeasure")}):(x(n,a,!0,o,e),{valid:!0})}return x(Number(""===e?NaN:e),a,!0,o,""),{valid:!0}},x=(e,t,a,o,n)=>{const i=c;i.searchMeasureBy===r.Single?(i.measure=e,i.station=n):i.searchMeasureBy===r.Multiple?(i.measures[o]=e,i.stations[o]=n):i.searchMeasureBy===r.Range&&(t?(i.fromMeasure=e,i.fromStation=n):(i.toMeasure=e,i.toStation=n)),f(i,a)};return(0,e.jsx)("div",{className:"measure-input-control"},(0,e.jsx)("div",{className:"measure-input-control__content pt-2"},u===r.Single&&(0,e.jsx)("div",{className:"measure-input-control__single px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},m("measureWithUnits",{units:h})),(0,e.jsx)(s.TextInput,{"aria-label":m("measureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:p,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;g(a)},checkValidityOnAccept:e=>I(e,!0)})),u===r.Multiple&&(0,e.jsx)("div",{className:"measure-input-control__multiple"},(0,e.jsx)("div",{className:"measure-input-control__multiple-measure px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},m("measuresWithUnits",{units:h})),w&&w.map(((t,a)=>(0,e.jsx)("div",{key:a,className:"d-flex w-100"},(0,e.jsx)(s.TextInput,{"aria-label":m("measuresWithUnits",{units:h}),type:"text",className:"mb-1",size:"sm",style:{width:"93%",float:"left"},disabled:!l,allowClear:!0,checkValidityOnAccept:e=>I(e,!0,a),onChange:e=>{((e,t)=>{w[t]=e.target.value;const a=[];w.forEach(((e,t)=>{a.push(e)})),N(a)})(e,a)},value:t}),a>0&&(0,e.jsx)(s.Button,{className:"text-input-clear clear-content",style:{float:"left",width:"7%"},type:"tertiary","aria-label":m("clear"),title:m("clear"),icon:!0,size:"sm",onClick:()=>{(e=>{c.measures.splice(e,1),c.stations.splice(e,1),w.splice(e,1);const t=[];w.forEach(((e,a)=>{t.push(e)})),N(t)})(a)}},(0,e.jsx)(R,{size:"s"})))))),(0,e.jsx)("div",{className:"measure-input-control__multiple-add-input pt-2 px-3"},(0,e.jsx)(s.Button,{type:"secondary",size:"sm",style:{width:"93%"},onClick:()=>{let e=[];e.push(""),w&&(e=w.concat(e)),c.measures.push(Number(NaN)),c.stations.push(""),N(e)}},m("addAnotherMeasure")))),u===r.Range&&(0,e.jsx)("div",{className:"measure-input-control__range"},(0,e.jsx)("div",{className:"measure-input-control__range-from-measure px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},m("fromMeasureWithUnits",{units:h})),(0,e.jsx)(s.TextInput,{"aria-label":m("fromMeasureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:v,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;y(a)},checkValidityOnAccept:e=>I(e,!0)})),(0,e.jsx)("div",{className:"measure-input-control__range-to-measure pt-2 px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-0 w-100",centric:!0,style:{fontWeight:500}},m("toMeasureWithUnits",{units:h})),(0,e.jsx)(s.TextInput,{"aria-label":m("toMeasureWithUnits",{units:h}),type:"text",size:"sm",style:{width:"100%"},disabled:!l,allowClear:!0,value:S,onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;b(a)},checkValidityOnAccept:e=>I(e,!1)})))))}var w=f(68972);const N=e.React.forwardRef(((t,a)=>{var n;const{widgetId:i,reset:s,networkItem:l,dataSource:u,isDataSourceReady:c,intl:d,onSubmit:f,onValidationChanged:m}=t,[p,v]=e.React.useState({}),[y,S]=e.React.useState(!1),[R,N]=e.React.useState(new Array(null===(n=null==l?void 0:l.routeIdFields)||void 0===n?void 0:n.length).fill(!0)),[I,x]=e.React.useState(!0),[D,C]=e.React.useState(r.Single);(0,w.useImperativeHandle)(a,(()=>({submitForm:M}))),e.React.useEffect((()=>{var e;let t=r.Single;l.searchSingle?t=r.Single:l.searchMultiple?t=r.Multiple:l.searchRange&&(t=r.Range),C(t);const a={routeId:"",routeName:"",routeIdFields:new Array(null===(e=null==l?void 0:l.routeIdFields)||void 0===e?void 0:e.length).fill(""),measure:NaN,station:"",fromMeasure:NaN,fromStation:"",toMeasure:NaN,toStation:"",measures:[NaN],stations:[""],isPoint:!1,searchMeasureBy:t};v(a)}),[l,s]);const M=()=>{const e=Object.assign({},p);e.isMeasureToGeometryOperation=!1,e.isPoint=!1,e.searchMeasureBy===r.Single?isNaN(e.measure)||(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):e.searchMeasureBy===r.Multiple?e.measures.some((e=>!isNaN(e)))&&(e.isMeasureToGeometryOperation=!0,e.isPoint=!0):(e.isPoint=!1,isNaN(e.fromMeasure)&&isNaN(e.toMeasure)||(isNaN(e.fromMeasure)&&!isNaN(e.toMeasure)&&(e.fromMeasure=e.toMeasure,e.toMeasure=NaN,e.isPoint=!0),!isNaN(e.fromMeasure)&&isNaN(e.toMeasure)&&(e.isPoint=!0),e.fromMeasure===e.toMeasure&&(e.toMeasure=NaN,e.isPoint=!0),e.isMeasureToGeometryOperation=!0)),f(e)},j=e.React.useMemo((()=>c&&y&&I),[c,y,I]);e.React.useEffect((()=>{m(j)}),[j,m]);const F=e.React.useCallback(((e,t)=>{v(e)}),[]),O=e.React.useCallback(((e,t,a)=>{if(v(e),l.defaultIdentifer===o.RouteId&&""===e.routeId)S(!1);else if(l.defaultIdentifer===o.RouteName&&""===e.routeName)S(!1);else if(l.defaultIdentifer===o.MultiField&&a>-1){let o=!0;const n=R;n[a]=t,n.forEach(((t,a)=>{t||""===e.routeIdFields[a]||(o=!1),e.routeIdFields.every((e=>""===e))&&(o=!1)})),S(o),N(n)}else S(t)}),[R,l.defaultIdentifer]),k=e.React.useCallback((e=>{const t=p;t.searchMeasureBy=e,v(t),C(e)}),[p]),L=e.React.useCallback(((e,t)=>{v(e),x(t)}),[]);return(0,e.jsx)("div",{className:"search-by-measure-form",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-measure-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-measure-form__content pt-3"},(0,e.jsx)(h,{reset:s,intl:d,widgetId:i,networkItem:l,dataSource:u,routeAndMeasureRequest:p,isDataSourceReady:c,onChange:F,onAccept:O}),(0,e.jsx)(g,{networkItem:l,searchMeasureBy:D,onChange:k}),(0,e.jsx)(b,{reset:s,intl:d,networkItem:l,dataSource:u,isDataSourceReady:c,searchMeasureBy:D,routeAndMeasureRequest:p,onChange:L})))})),I=[{value:"Measure",label:"Measure"},{value:"ToMeasure",label:"To Measure"}],x={value:"Distance",label:"Distance"},D=[{value:"Station",label:"Station"},{value:"FromStation",label:"From Station"},{value:"ToStation",label:"To Station"}],C={value:"Network_OBJECTID",label:"Network OBJECTID"};function M(e,a,n,i){const r=n.getSchema(),s=(null==r?void 0:r.fields)?Object.values(r.fields).map((e=>e.jimuName)):[],l=function(e,t){const a=[];a.push(e.routeIdField.jimuName),e.useRouteName&&a.push(e.routeNameField.jimuName);e.defaultIdentifer===o.MultiField&&e.routeIdFields.forEach((e=>{a.push(e.field.jimuName)}));const n=t.attributes[I.at(1).value],i=t.attributes[D.at(0).value],r=t.attributes[D.at(1).value],s=t.attributes[D.at(2).value],l=t.attributes[x.value];a.push(I.at(0).value),isNaN(n)||null==n||a.push(I.at(1).value);null!=i&&a.push(D.at(0).value);null!=r&&a.push(D.at(1).value);null!=s&&a.push(D.at(2).value);null!=l&&a.push(x.value);e.fromDateFieldName&&a.push(e.fromDateFieldName);e.toDateFieldName&&a.push(e.toDateFieldName);return a}(i,a),u=`{${function(e){if(e.defaultIdentifer===o.RouteName)return e.routeNameField.jimuName;return e.routeIdField.jimuName}(i)}}`;if(s){const a=[];return l.forEach((o=>{var i,r;const l=s.find((e=>e===o));if(l)if(o===x.value){const o=n.getOriginDataSources()[0],s=null===(r=null===(i=null==o?void 0:o.layerDefinition)||void 0===i?void 0:i.geometryProperties)||void 0===r?void 0:r.units,u="esriDecimalDegrees"===s;a.push({fieldName:l,label:l+(u?" ("+(0,t.GetUnits)("esriMeters",e)+")":(0,t.isDefined)(s)?" ("+(0,t.GetUnits)(s,e)+")":"")})}else a.push({fieldName:l,label:l})})),{fieldInfos:a,content:[{type:"fields"}],title:u}}return null}function j(e,t){let a="";return a=t?e.useRouteName?`'${e.routeNameField.alias}: ' + $feature.${e.routeNameField.name} + textformatting.NewLine + \n                    '${I.at(0).label}: ' + $feature.Measure`:`'${e.routeIdField.alias}: ' + $feature.${e.routeIdField.name} + textformatting.NewLine + \n                    '${I.at(0).label}: ' + $feature.Measure`:e.useRouteName?`'${e.routeNameField.alias}: ' + $feature.${e.routeNameField.name} + textformatting.NewLine +\n                    '${I.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${I.at(1).label}: ' + $feature.ToMeasure`:`'${e.routeIdField.alias}: ' + $feature.${e.routeIdField.name} + textformatting.NewLine +\n                    '${I.at(0).label}: ' + $feature.Measure + textformatting.NewLine +\n                    '${I.at(1).label}: ' + $feature.ToMeasure`,a}const F=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const O="object"==typeof global&&global&&global.Object===Object&&global;var k="object"==typeof self&&self&&self.Object===Object&&self;const L=O||k||Function("return this")();const P=function(){return L.Date.now()};var T=/\s/;const E=function(e){for(var t=e.length;t--&&T.test(e.charAt(t)););return t};var A=/^\s+/;const z=function(e){return e?e.slice(0,E(e)+1).replace(A,""):e};const _=L.Symbol;var G=Object.prototype,V=G.hasOwnProperty,B=G.toString,$=_?_.toStringTag:void 0;const U=function(e){var t=V.call(e,$),a=e[$];try{e[$]=void 0;var o=!0}catch(e){}var n=B.call(e);return o&&(t?e[$]=a:delete e[$]),n};var W=Object.prototype.toString;const J=function(e){return W.call(e)};var q=_?_.toStringTag:void 0;const Z=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":q&&q in Object(e)?U(e):J(e)};const Q=function(e){return null!=e&&"object"==typeof e};const H=function(e){return"symbol"==typeof e||Q(e)&&"[object Symbol]"==Z(e)};var K=/^[-+]0x[0-9a-f]+$/i,Y=/^0b[01]+$/i,X=/^0o[0-7]+$/i,ee=parseInt;const te=function(e){if("number"==typeof e)return e;if(H(e))return NaN;if(F(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=F(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=z(e);var a=Y.test(e);return a||X.test(e)?ee(e.slice(2),a?2:8):K.test(e)?NaN:+e};var ae=Math.max,oe=Math.min;const ne=function(e,t,a){var o,n,i,r,s,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var a=o,i=n;return o=n=void 0,u=t,r=e.apply(i,a)}function h(e){var a=e-l;return void 0===l||a>=t||a<0||d&&e-u>=i}function p(){var e=P();if(h(e))return g(e);s=setTimeout(p,function(e){var a=t-(e-l);return d?oe(a,i-(e-u)):a}(e))}function g(e){return s=void 0,f&&o?m(e):(o=n=void 0,r)}function v(){var e=P(),a=h(e);if(o=arguments,n=this,l=e,a){if(void 0===s)return function(e){return u=e,s=setTimeout(p,t),c?m(e):r}(l);if(d)return clearTimeout(s),s=setTimeout(p,t),m(l)}return void 0===s&&(s=setTimeout(p,t)),r}return t=te(t)||0,F(a)&&(c=!!a.leading,i=(d="maxWait"in a)?ae(te(a.maxWait)||0,t):i,f="trailing"in a?!!a.trailing:f),v.cancel=function(){void 0!==s&&clearTimeout(s),u=0,o=l=n=s=void 0},v.flush=function(){return void 0===s?r:g(P())},v},ie=e.React.forwardRef(((o,n)=>{var i;const[r,l]=e.React.useState({}),[u,c]=e.React.useState(!1),[d,f]=e.React.useState(!0),[m,h]=e.React.useState(),p=e.hooks.useTranslation(a),{config:g,widgetId:v,referentItem:y,isDataSourceReady:S,onSubmit:R,onValidationChanged:b,intl:N,reset:I}=o,x=null==y?void 0:y.displayName,D=e.React.useRef(null),C=e.React.useRef((e=>{}));(0,w.useImperativeHandle)(n,(()=>({submitForm:ae})));const M=e.React.useMemo((()=>S&&d&&u),[S,d,u]);e.React.useEffect((()=>{U()}),[I]),e.React.useEffect((()=>{b(M)}),[M,b]);const j=e.React.useRef(null),F=e.React.useRef(null),O=e.React.useRef(null),k=e.React.useRef(null),L=e.React.useRef(null),P=e.React.useRef(!1),T=e.React.useRef(!1),[E,A]=e.React.useState(null),[z,_]=e.React.useState(null),[G,V]=e.React.useState(!1),[B,$]=e.React.useState([]);e.React.useEffect((()=>{U(),C.current=ne(W,400)}),[y]);const U=()=>{A(null),_(null),setTimeout((()=>{F.current.select(),F.current.focus(),F.current.blur(),O.current.select(),O.current.focus(),O.current.blur()}),200)},W=e.hooks.useEventCallback((e=>{const a=null==y?void 0:y.displayName,o=m,n=(0,t.getSuggestions)(a,e,o);Promise.all([n]).then((e=>{const t=null==e?void 0:e[0];t&&$(t),j.current&&V(!0)})).catch((e=>{}))})),J=e=>{A(e),j.current=e},q=()=>{var e;null===(e=F.current)||void 0===e||e.focus(),Z(!0,!1)},Z=(e=!1,t=!0)=>{e||(T.current=!1)},Q=e=>{if(isNaN(Number(e))){const t=function(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let o=100*parseInt(a[0],10);return isNaN(o)?o=NaN:2===a.length&&(t?o-=parseFloat(a[1]):o+=parseFloat(a[1])),o}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),a=e.split("+");let o=1e3*parseInt(a[0],10);return isNaN(o)?o=NaN:2===a.length&&(t?o-=parseFloat(a[1]):o+=parseFloat(a[1])),o}return NaN}(e);return isNaN(t)?(K(NaN,!1),{valid:!1,msg:p("invalidOffset")}):(K(t,!0),{valid:!0})}return K(Number(""===e?NaN:e),!0),{valid:!0}},H=e=>e?new Promise((t=>{setTimeout((()=>{const a=[];L.current&&(e=L.current);const o=m,n={},i=ee(y.displayName),r=te(e);r&&(e=r),"NUMBER"===i?n.where=`${y.displayName} = ${e}`:"STRING"===i&&(n.where=`${y.displayName} = '${e}'`);const s=o.query(n).then((e=>{const t=null==e?void 0:e.records,n=[],i=o.getLayerDefinition(),r=null==i?void 0:i.objectIdField,s=null==y?void 0:y.fromDateFieldName;return(null==t?void 0:t.length)>0&&t.forEach((e=>{const t=null==e?void 0:e.getFieldValue(r);n.push(t)})),(null==t?void 0:t.length)>0&&(t.forEach((e=>{const t=null==e?void 0:e.getFieldValue(r),o=null==e?void 0:e.getFieldValue(s);a[t]=o})),X(a)),(null==n?void 0:n.length)>0?(Y(n,!0),{valid:!0}):(Y(n,!1),{valid:!1,msg:p("invalidReferent")})})).catch((e=>(console.error(e),{valid:!1,msg:p("invalidReferent")})));t(s)}),200)})):(c(!1),{valid:!0}),K=(e,t)=>{const a=r;a.offset=e,f(t),l(a)},Y=(e,t)=>{const a=r;a.objectId=e,c(t),l(a)},X=e=>{const t=r;t.objectIdFromDt=e,l(t)},ee=e=>{const t=null==y?void 0:y.layerFields;for(let a=0;a<t.length;a++)if(t[a].name===e)return t[a].type},te=e=>{const t=null==y?void 0:y.allFields;let a,o=[];return(null==t?void 0:t.length)>0&&t.forEach((e=>{var t,a;(null==e?void 0:e.name)===x&&"codedValue"===(null===(t=null==e?void 0:e.domain)||void 0===t?void 0:t.type)&&(o=null===(a=null==e?void 0:e.domain)||void 0===a?void 0:a.codedValues)})),(null==o?void 0:o.length)>0&&o.forEach((t=>{t.name===e&&(a=t.code)})),a||null},ae=()=>{(()=>{const e=z||0,t=E;setTimeout((()=>{Q(e),setTimeout((()=>{H(t),setTimeout((()=>{const e=[],t=null==r?void 0:r.objectId,a=null==y?void 0:y.layerId,o=(null==r?void 0:r.offset)||0,n=null==r?void 0:r.objectIdFromDt;null==t||t.forEach((t=>{e.push({layerId:a,offset:o,objectId:t})})),R(e,n)}),200)}),200)}),200)})()},oe=(0,t.GetUnits)(null===(i=null==g?void 0:g.resultConfig)||void 0===i?void 0:i.defaultOffsetUnit,N),ie=p("offsetlabel",{unit:oe}),re=p("referentDisplayName",{displayName:x});return(0,e.jsx)("div",{className:"search-method-form h-100",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-referent-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-referent-form__content"},(0,e.jsx)(e.DataSourceComponent,{useDataSource:null==y?void 0:y.useDataSource,onDataSourceCreated:e=>{h(e)}}),(0,e.jsx)("div",{className:"search-method-form__method-label px-3 pt-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-1",style:{alignItems:"center",fontWeight:"500"}},re),(0,e.jsx)("div",{ref:D},(0,e.jsx)(s.TextInput,{"aria-label":re,size:"sm",type:"text",style:{width:"100%"},ref:F,allowClear:!!E,value:E||"",onChange:e=>{var t;L.current=null;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=(null==a?void 0:a.length)>2;if(J(a),!o)return V(!1),!1;C.current(a)},onBlur:()=>{k.current=setTimeout((()=>{P.current||V(!1),T.current||Z(!1)}),200)},disabled:!S,checkValidityOnAccept:e=>H(e)}),E&&(0,e.jsx)(t.Intellisense,{isOpen:(G||(P.current=!1),G),reference:D,searchText:E,searchSuggestion:B,onRecordItemClick:(e,t)=>{if(t)return q(),!1;L.current=e,J(e)},id:v,searchInputRef:F}))),(0,e.jsx)("div",{className:"search-method-form__method-label px-3 pt-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-1 w-100",style:{fontWeight:"500"}},ie),(0,e.jsx)(s.TextInput,{"aria-label":ie,size:"sm",type:"text",style:{width:"100%"},ref:O,allowClear:z,value:z||"",onChange:e=>{var t;const a=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;_(a)},disabled:!S,checkValidityOnAccept:e=>Q(e)}))))}));var re=function(e,t,a,o){return new(a||(a=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const se=e.React.forwardRef(((o,r)=>{const{reset:l,isDataSourceReady:u,onSubmit:c,networkItem:d,onValidationChanged:f,coordinateGraphic:m}=o,[h,p]=e.React.useState({}),[g,v]=e.React.useState(!1),[y,S]=e.React.useState(!1),[R,b]=e.React.useState(!0),[N,I]=e.React.useState(null),[x,D]=e.React.useState(null),[C,M]=e.React.useState(null),j=e.React.useRef(null),F=e.React.useRef(null),O=e.React.useRef(null),k=e.hooks.useTranslation(a);(0,w.useImperativeHandle)(r,(()=>({submitForm:L})));const L=()=>{c(h)},P=e.React.useMemo((()=>g&&y&&R),[g,y,R]);e.React.useEffect((()=>{f(P)}),[P,f]),e.React.useEffect((()=>{I(""),D(""),M("");p({xCoordinate:NaN,yCoordinate:NaN,zCoordinate:NaN})}),[d,l]),e.React.useEffect((()=>{setTimeout((()=>{j.current.select(),j.current.focus(),j.current.blur(),F.current.select(),F.current.focus(),F.current.blur(),O.current.select(),O.current.focus(),O.current.blur()}),200)}),[l]);const T=(a,o)=>{if(isNaN(Number(a)))return z(NaN,!1,o),A(),{valid:!1,msg:k("invalidCoordinate")};""===a?z(Number(NaN),o===i.Z,o):z(Number(a),!0,o);let r=null,s=null;return(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[r,s]=e})).then((()=>re(void 0,void 0,void 0,(function*(){const e=new r;e.x=Number(N),e.y=Number(x),e.z=C?Number(C):0,d.defaultSpatialReferenceFrom===n.Map?e.spatialReference=new s({wkid:102100}):e.spatialReference=new s({wkid:d.spatialReferenceInfo.wkid,wkt:d.spatialReferenceInfo.wkt}),E(yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e),"#FFFF00"))})))),{valid:!0}},E=e=>{(0,t.isDefined)(e)?(0,t.isDefined)(m)&&(m.removeAll(),m.add(e)):A()},A=()=>{(0,t.isDefined)(m)&&m.removeAll()},z=(e,t,a)=>{const o=h;switch(a){case i.X:o.xCoordinate=e,v(t);break;case i.Y:o.yCoordinate=e,S(t);break;case i.Z:o.zCoordinate=e,b(t)}p(o)},_=(e,t)=>{var a;const o=null===(a=null==e?void 0:e.target)||void 0===a?void 0:a.value;switch(t){case i.X:I(o);break;case i.Y:D(o);break;case i.Z:M(o)}};return(0,e.jsx)("div",{className:"search-by-coordinates-form",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    .search-by-coordinates-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
  `},(0,e.jsx)("div",{className:"search-by-coordinates-form__content my-2"},(0,e.jsx)("div",{className:"search-by-coordinates-form__x-coordinate-label pt-2 px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-1",style:{width:"100%"}},k("xCoordinateRequiredLabel")),(0,e.jsx)(s.TextInput,{"aria-label":k("xCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:j,disabled:!u,allowClear:!!N,value:N||"",onChange:e=>{_(e,i.X)},checkValidityOnAccept:e=>T(e,i.X)})),(0,e.jsx)("div",{className:"search-by-coordinates-form__y-coordinate-label pt-2 px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-1",style:{width:"100%"}},k("yCoordinateRequiredLabel")),(0,e.jsx)(s.TextInput,{"aria-label":k("yCoordinateRequiredLabel"),type:"text",size:"sm",style:{width:"100%"},ref:F,disabled:!u,allowClear:!!x,value:x||"",onChange:e=>{_(e,i.Y)},checkValidityOnAccept:e=>T(e,i.Y)})),(0,e.jsx)("div",{className:"search-by-coordinates-form__z-coordinate-label pt-2 px-3"},(0,e.jsx)(s.Label,{size:"default",className:"mb-1",style:{width:"100%"}},k("zCoordinateLabel")),(0,e.jsx)(s.TextInput,{"aria-label":k("zCoordinateLabel"),type:"text",size:"sm",style:{width:"100%"},ref:O,disabled:!u,allowClear:!!C,value:C||"",onChange:e=>{_(e,i.Z)},checkValidityOnAccept:e=>T(e,i.Z)}))))}));var le=f(23001),ue=f.n(le),ce=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const de=t=>{const a=window.SVG,{className:o}=t,n=ce(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:i,src:ue()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var fe=f(35737),me=f.n(fe),he=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const pe=t=>{const a=window.SVG,{className:o}=t,n=he(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:i,src:me()},n)):e.React.createElement("svg",Object.assign({className:i},n))},ge=e.css`
  border: 1px solid var(--ref-palette-neutral-300);
  .esri-widget__heading {
    font-size: 14px;
    font-weight: 500;
    margin: 0;
    color: var(--ref-palette-black);
  }

  .esri-feature__content-element {
    padding: 0;
  }

  .jimu-btn.expanded {
    align-self: flex-start;
  }

  .esri-feature.esri-widget {
    background-color: transparent;
  }
`;class ve extends e.React.PureComponent{constructor(e){super(e),this.toggleExpanded=e=>{e.stopPropagation(),this.setState({showContent:!this.state.showContent})};const{expanded:t=!1}=this.props;this.state={showContent:t}}componentDidMount(){this.createFeature()}componentDidUpdate(){this.feature&&(this.feature.graphic.popupTemplate=this.props.popupTemplate,this.feature.visibleElements=this.getVisibleElements())}destoryFeature(){this.feature&&!this.feature.destroyed&&this.feature.destroy()}getVisibleElements(){const{togglable:e=!1}=this.props,{showContent:t}=this.state,a=!e||t;return{title:!0,content:{fields:a,text:a},lastEditedInfo:!1}}createFeature(){let e;return e=this.Feature?Promise.resolve():(0,c.loadArcGISJSAPIModules)(["esri/widgets/Feature"]).then((e=>{[this.Feature]=e})),e.then((()=>{var e,t,a;const o=document&&document.createElement("div");o.className="jimu-widget",this.refs.featureContainer.appendChild(o);const n=this.props.dataSource.getOriginDataSources(),i=null===(e=null==n?void 0:n[0])||void 0===e?void 0:e.getRootDataSource();this.destoryFeature(),this.props.graphic.popupTemplate=this.props.popupTemplate,this.feature=new this.Feature({container:o,defaultPopupTemplateEnabled:!0,spatialReference:(null===(a=null===(t=this.props.dataSource)||void 0===t?void 0:t.layer)||void 0===a?void 0:a.spatialReference)||null,map:(null==i?void 0:i.map)||null,graphic:this.props.graphic,visibleElements:this.getVisibleElements()})}))}render(){const{togglable:t=!1,intl:a}=this.props,{showContent:o}=this.state;return(0,e.jsx)("div",{className:"item-feature-info-component d-flex align-items-center p-2",css:ge},t&&(0,e.jsx)(s.Button,{"aria-label":a.formatMessage({id:o?"collapse":"expand"}),className:(0,e.classNames)("p-0 jimu-outline-inside",{expanded:o}),type:"tertiary",icon:!0,size:"sm",onClick:this.toggleExpanded},o?(0,e.jsx)(pe,{size:"s"}):(0,e.jsx)(de,{size:"s",autoFlip:!0})),(0,e.jsx)("div",{className:"flex-grow-1",ref:"featureContainer"}))}}const ye=(0,e.injectIntl)(ve);var Se=f(22089),Re=1/0;const be=function(e){return e?(e=te(e))===Re||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const we=function(e){var t=be(e),a=t%1;return t==t?a?t-a:t:0};const Ne=function(e,t){for(var a=-1,o=null==e?0:e.length,n=Array(o);++a<o;)n[a]=t(e[a],a,e);return n};const Ie=Array.isArray;var xe=_?_.prototype:void 0,De=xe?xe.toString:void 0;const Ce=function e(t){if("string"==typeof t)return t;if(Ie(t))return Ne(t,e)+"";if(H(t))return De?De.call(t):"";var a=t+"";return"0"==a&&1/t==-Infinity?"-0":a};const Me=function(e){return null==e?"":Ce(e)};var je=L.isFinite,Fe=Math.min;const Oe=function(e){var t=Math[e];return function(e,a){if(e=te(e),(a=null==a?0:Fe(we(a),292))&&je(e)){var o=(Me(e)+"e").split("e"),n=t(o[0]+"e"+(+o[1]+a));return+((o=(Me(n)+"e").split("e"))[0]+"e"+(+o[1]-a))}return t(e)}}("round");var ke=function(e,t,a,o){return new(a||(a=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};function Le(a,o,n,i,r){return ke(this,void 0,void 0,(function*(){const s=o.networkUrl,l={f:"json",token:yield e.SessionManager.getInstance().getSessionByUrl(s).getToken(s),locations:a,offsetUnit:n};i&&(l.gdbVersion=i),r&&(l.temporalViewDate=r);const u=`${s}/referentToGeometry`;return yield(0,t.requestService)({method:"POST",url:u,params:l})}))}function Pe(a,o,n,i,s,l){return ke(this,void 0,void 0,(function*(){var u;if(!s.isMeasureToGeometryOperation)return function(a,o,n,i,r,s){return ke(this,void 0,void 0,(function*(){const l=[],u=i.getOriginDataSources()[0],c=yield Te(u);let d=null,f=null;return(0,e.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/Graphic"]).then((e=>{[d,f]=e})).then((()=>ke(this,void 0,void 0,(function*(){return yield Promise.all(n.map(((e,a)=>ke(this,void 0,void 0,(function*(){const n=e.getData(),u=e.getGeometry(),c=new d(u),m=c.getPoint(0,0),h=c.paths[c.paths.length-1].length-1,p=c.getPoint(c.paths.length-1,h);n[I.at(0).value]=Oe(m.m,r),n[I.at(1).value]=Oe(p.m,r),n[C.value]=e.getId(),n.OBJECTID=a+1;const g=n[o.fromDateFieldName],v=n[o.toDateFieldName];v&&(n[o.toDateFieldName]=(0,t.getDateWithTZOffset)(v,i.getOriginDataSources()[0]).valueOf()),g&&(n[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(g,i.getOriginDataSources()[0]).valueOf());const y=new f({geometry:c,attributes:n});if((0,t.isDefined)(s)){const e=yield(0,t.getPolylineMidPoint)(c),a=new f({geometry:e,attributes:n});yield s.applyEdits({addFeatures:[a.clone()]})}const S=i.buildRecord(y);l.push(S)}))))),l.forEach((e=>{const t=e.feature;t.sourceLayer=c.associatedLayer||c,t.layer=t.sourceLayer})),i.setSourceRecords(l),i.setStatus(e.DataSourceStatus.Unloaded),i.setCountStatus(e.DataSourceStatus.Unloaded),Ee(i,a),l}))))}))}(a,n,i,o,n.measurePrecision,l);const c=n.networkUrl,d=`${c}/measureToGeometry`,f=yield e.SessionManager.getInstance().getSessionByUrl(c).getToken(c),m=[];for(const e of i){const a=e.getData()[n.fromDateFieldName],o=(0,t.isDefined)(a)?new Date(a):new Date(0);m.push(o)}const h=o.getOriginDataSources()[0],p=yield Te(h);let g=h.getGDBVersion();g||(g="");const v=function(e){const t=new Set;e.forEach((e=>{0!==e.valueOf()&&(t.has(e.valueOf())||t.add(e.valueOf()))}));const a=Array.from(t).map((e=>new Date(e)));return Array.from(a).sort(((e,t)=>e.getTime()-t.getTime()))}(m);let y=0;const S=[];if(yield Promise.all(v.map((a=>ke(this,void 0,void 0,(function*(){const u=[],c=[];i.forEach((e=>{const o=e.getData()[n.fromDateFieldName],i=(0,t.isDefined)(o)?new Date(o):new Date(0);if(a.valueOf()===i.valueOf()){const t=e.getFieldValue(n.routeIdField.jimuName);u.push(t),s.searchMeasureBy===r.Single?c.push({routeId:t,measure:Oe(s.measure,n.measurePrecision),station:s.station}):s.searchMeasureBy===r.Multiple?s.measures.forEach(((e,a)=>{c.push({routeId:t,measure:Oe(e,n.measurePrecision),station:s.stations.at(a)})})):isNaN(s.toMeasure)?c.push({routeId:t,measure:Oe(s.fromMeasure,n.measurePrecision),station:s.fromStation}):c.push({routeId:t,fromMeasure:Oe(s.fromMeasure,n.measurePrecision),toMeasure:Oe(s.toMeasure,n.measurePrecision),fromStation:s.fromStation,toStation:s.toStation})}}));const m={f:"json",token:f,locations:c,gdbVersion:g,temporalViewDate:a.valueOf()};yield(0,t.requestService)({method:"POST",url:d,params:m}).then((a=>ke(this,void 0,void 0,(function*(){if(!a||!a.locations)return S;let r=null,s=null,u=null,c=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/Polyline","esri/geometry/SpatialReference","esri/Graphic"]).then((e=>{[r,s,u,c]=e})).then((()=>ke(this,void 0,void 0,(function*(){yield Promise.all(a.locations.map(((e,d)=>ke(this,void 0,void 0,(function*(){var f;if(e&&e.geometry){const h=i.findIndex((t=>t.getFieldValue(n.routeIdField.jimuName)===e.routeId&&t.getFieldValue(n.fromDateFieldName)===m.temporalViewDate)),p=i[h].clone(!0).getData(),g=new u({wkid:a.spatialReference.wkid});if("esriGeometryPoint"===e.geometryType){const a=new r(e.geometry);a.spatialReference=g,p[I.at(0).value]=Oe(a.m,n.measurePrecision),p[C.value]=i[h].getId(),p.OBJECTID=y+1,y++;const s=p[n.fromDateFieldName],u=p[n.toDateFieldName];u&&(p[n.toDateFieldName]=(0,t.getDateWithTZOffset)(u,o.getOriginDataSources()[0]).valueOf()),s&&(p[n.fromDateFieldName]=(0,t.getDateWithTZOffset)(s,o.getOriginDataSources()[0]).valueOf()),m.locations[d].station&&(p[D.at(0).value]=m.locations[d].station);const f=new c({geometry:a,attributes:p});(0,t.isDefined)(l)&&(yield l.applyEdits({addFeatures:[f.clone()]}));const v=o.buildRecord(f);S.push(v)}else{const a=new s(e.geometry);if(a.spatialReference=g,(null===(f=a.paths)||void 0===f?void 0:f.length)>0){const e=a.getPoint(0,0),r=a.paths[a.paths.length-1].length-1,s=a.getPoint(a.paths.length-1,r);p[I.at(0).value]=Oe(e.m,n.measurePrecision),p[I.at(1).value]=Oe(s.m,n.measurePrecision),p[C.value]=i[h].getId(),p.OBJECTID=y+1,y++;const l=p[n.fromDateFieldName],u=p[n.toDateFieldName];u&&(p[n.toDateFieldName]=(0,t.getDateWithTZOffset)(u,o.getOriginDataSources()[0]).valueOf()),l&&(p[n.fromDateFieldName]=(0,t.getDateWithTZOffset)(l,o.getOriginDataSources()[0]).valueOf()),m.locations[d].fromStation&&(p[D.at(1).value]=m.locations[d].fromStation),m.locations[d].toStation&&(p[D.at(2).value]=m.locations[d].toStation)}const r=new c({geometry:a,attributes:p});if((0,t.isDefined)(l)){const e=yield(0,t.getPolylineMidPoint)(a),o=new c({geometry:e,attributes:p});yield l.applyEdits({addFeatures:[o.clone()]})}const u=o.buildRecord(r);S.push(u)}}})))))}))))}))))}))))),S.forEach((e=>{const t=e.feature;t.sourceLayer=p.associatedLayer||p,t.layer=t.sourceLayer})),o.setSourceRecords(S),o.setStatus(e.DataSourceStatus.Unloaded),o.setCountStatus(e.DataSourceStatus.Unloaded),Ee(o,a),v.length>1){const e={returnGeometry:!0,where:"1=1",outFields:["*"],notAddFieldsToClient:!0};return(null===(u=n.sortOptions)||void 0===u?void 0:u.length)>0&&Object.assign(e,{orderByFields:n.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))}),yield o.query(e).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:S})).catch((e=>S))}return S}))}function Te(e){return ke(this,void 0,void 0,(function*(){if(null==e?void 0:e.layer)return yield e.layer.load(),e.layer;{const t=yield e.createJSAPILayerByDataSource();return yield t.load(),t}}))}function Ee(t,a){if(!t)return;const o=t.getOriginDataSources()[0],n=o.getPopupInfo(),i=o.getLayerDefinition(),r=(e=>{return e.length?e:[{fieldName:null!==(t=null==i?void 0:i.objectIdField)&&void 0!==t?t:"objectid",label:"OBJECTID",tooltip:"",visible:!0}];var t})(((null==n?void 0:n.fieldInfos)||[]).filter((e=>e.visible))),s=new e.DataRecordSetChangeMessage(a,e.RecordSetChangeType.CreateUpdate,[{records:t.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:t,name:t.id}]);e.MessageManager.getInstance().publishMessage(s)}const Ae=e.css`
  overflow: auto;
  flex-flow: row;
  cursor: pointer;
  flex-shrink: 0;
  min-height: 2rem;
  &.selected {
    .item-feature-info-component {
      border-color: var(--sys-color-primary-main);
      border-width: 2px;
    }
  }
`,ze=a=>{const{widgetId:o,autoSelect:n,network:i,data:r,outputDS:s,inputDS:l,highlightGraphicLayer:u,flashGraphicsLayer:d,highlightStyle:f,jimuMapView:m,intl:h}=a,p=e.ReactRedux.useSelector((e=>{var t,a,o;return null===(o=null===(a=null===(t=e.dataSourcesInfo)||void 0===t?void 0:t[s.id])||void 0===a?void 0:a.selectedIds)||void 0===o?void 0:o.includes(r.getId())}));e.React.useEffect((()=>{n&&R()}),[n]);const g=e.React.useCallback((e=>{const a=e;(0,t.getGeometryGraphic)(null==a?void 0:a.getFeature(),"#FFFF00",f.size,!0).then((e=>{d&&e&&(d.removeAll(),d.add(e),setTimeout((()=>{d.removeAll(),setTimeout((()=>{d.add(e),setTimeout((()=>{d.removeAll()}),800)}),800)}),800))}))}),[d,f.size]),v=e.React.useCallback((e=>{c.geometryUtils.projectToSpatialReference([e.geometry],m.view.spatialReference).then((t=>{const a=new Se.default({geometry:t[0],symbol:e.symbol});"point"===a.geometry.type?null==m||m.view.goTo({target:t,zoom:100}):null==m||m.view.goTo({center:a.geometry.extent.expand(1.25)})}))}),[m.view]),y=e.React.useCallback((e=>{(function(e,a,o,n){return ke(this,void 0,void 0,(function*(){const i=e.getFieldValue(o.routeIdField.name),r=`${o.routeIdField.name} = '${i}'`;if((0,t.isDefined)(a&&(0,t.isDefined)(a.layer))){const t=a.layer.createQuery();t.spatialRelationship="intersects",t.outSpatialReference=n.view.spatialReference,t.returnGeometry=!0,t.outFields=["*"],t.returnM=!0,t.returnZ=!0,t.where=r;const o=e.getFieldValue(C.value);return a.layer.queryFeatures(t).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features.map((e=>a.buildRecord(e))).find((e=>e.getId()===o)):null})).catch((e=>null))}{const t={returnGeometry:!0,returnM:!0,returnZ:!0,where:r,spatialRel:"esriSpatialRelIntersects"},o=e.getFieldValue(C.value);return a.query(t).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records.find((e=>e.getId()===o)):null})).catch((e=>null))}}))})(e,l,i,m).then((a=>{(0,t.isDefined)(a)&&g(a);const o=e;(0,t.getGeometryGraphic)(null==o?void 0:o.getFeature(),f.color,f.size,!0).then((e=>{u&&e&&(u.removeAll(),u.add(e),v(e))}))}))}),[g,u,f.color,f.size,l,m,i,v]),S=e.React.useCallback((()=>{u&&u.removeAll()}),[u]),R=e.React.useCallback((()=>{var t,a;const n=r.getId(),i=(null!==(t=s.getSelectedRecordIds())&&void 0!==t?t:[]).includes(n)?[]:[r];e.MessageManager.getInstance().publishMessage(new e.DataRecordsSelectionChangeMessage(o,i)),null===(a=s.selectRecordsByIds)||void 0===a||a.call(s,i.map((e=>e.getId()))),i.length>0?y(r):S()}),[r,s,o,y,S]);return(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-result-item",{selected:p}),onClick:R,css:Ae,role:"option","aria-selected":p,tabIndex:0},(0,e.jsx)(ye,{graphic:r.feature,togglable:!0,dataSource:s,popupTemplate:M(h,r.feature,s,i),expanded:i.expandByDefault}))};var _e,Ge=f(1888);!function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(_e||(_e={}));(0,Ge.withTheme)((t=>{const{theme:a,className:o,title:n,statusType:i}=t;return i&&(0,e.jsx)("div",{className:`${null!=o?o:""} ui-unit-status-indicator ui-unit-status-indicator_status-type-${i}`,title:n,css:e.css`
    &.ui-unit-status-indicator {
      display: flex;
      &.ui-unit-status-indicator_status-type-loading {
        &:before {
          @keyframes loading {
            0% {transform: rotate(0deg); };
            100% {transform: rotate(360deg)};
          }
          content: '';
          width: 1rem;
          height: 1rem;
          display: block;
          border: 1px solid ${null===(s=null===(r=null==a?void 0:a.ref.palette)||void 0===r?void 0:r.neutral)||void 0===s?void 0:s[500]};
          border-radius: 50%;
          border-top: 1px solid ${null===(u=null===(l=null==a?void 0:a.sys.color)||void 0===l?void 0:l.primary)||void 0===u?void 0:u.main};
          box-sizing: border-box;
          animation: loading 2s infinite linear;
          margin-right: .25rem;
        }
      }
    }
  `});var r,s,l,u}));var Ve=function(e,t,a,o){return new(a||(a=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const{useRef:Be,useState:$e}=e.React,Ue=t=>e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .list_items {
      flex: 1 1 auto;
      max-height: auto;
      overflow: auto;
      display: flex;
      flex-direction: row;
    }

    .search-by-route-result-item + .search-by-route-result-item {
      margin-left: 0.5rem;
      margin-top: 0;
    }

    &.list {
      .list_items {
        flex-direction: column;
      }
      .feature-info-component {
        width: 100%;
      }
      .search-by-route-result-item + .search-by-route-result-item {
        margin-top: 0.5rem;
        margin-left: 0;
      }
    }
  `;function We(t){const{widgetId:a,networkItem:o,outputDS:n,inputDS:i,resultCount:r,records:l,highlightGraphicsLayer:u,flashGraphicsLayer:c,highlightStyle:d,jimuMapView:f,onRenderDone:m,intl:h,defaultPageSize:p=25}=t,[g,v]=$e(l),[y,S]=$e(_e.Init),R=Be(1),b=Be(p),[w,N]=$e(p);e.React.useEffect((()=>{R.current=1,v(l),N(b.current)}),[l]);const I=e.React.useCallback(((e,t)=>Ve(this,void 0,void 0,(function*(){R.current=e,S(_e.Loading);const a=n.getRecordsByPage(e,t);v(a),null==m||m({dataItems:a,pageSize:t,page:R.current}),S(_e.Loaded)}))),[m,n]);return e.React.useEffect((()=>{p!==b.current&&(p<b.current?v(g.slice(0,p)):I(1,p),b.current=p,N(p))}),[p,g,I]),(0,e.jsx)("div",{className:"list",css:Ue(!0)},(0,e.jsx)("div",{className:"list_items mb-2 px-3",role:"listbox"},null==g?void 0:g.map(((t,r)=>(0,e.jsx)(ze,{key:t.getId()+r,autoSelect:1===l.length,network:o,data:t,outputDS:n,inputDS:i,widgetId:a,highlightGraphicLayer:u,flashGraphicsLayer:c,highlightStyle:d,jimuMapView:f,intl:h})))),y===_e.Loading&&(0,e.jsx)(s.Loading,{type:s.LoadingType.Donut}),r>0&&(0,e.jsx)("div",{className:"d-flex justify-content-s align-items-center px-3 pb-3",style:{justifyContent:"space-evenly"}},(0,e.jsx)(s.Pagination,{className:"d-flex justify-content-end",disabled:y===_e.Loading,current:R.current,totalPage:Math.ceil(r/w),onChangePage:e=>I(e,w),pageSize:w,showQuickJumper:Math.ceil(r/w)>1})))}var Je=f(96300),qe=f.n(Je),Ze=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(a[o[n]]=e[o[n]])}return a};const Qe=t=>{const a=window.SVG,{className:o}=t,n=Ze(t,["className"]),i=(0,e.classNames)("jimu-icon jimu-icon-component",o);return a?e.React.createElement(a,Object.assign({className:i,src:qe()},n)):e.React.createElement("svg",Object.assign({className:i},n))};var He=f(59620);const Ke=e.css`
  display: flex;
  flex-direction: column;

  .search-by-route-result__header {
    color: var(--ref-palette-neutral-1100);
    font-weight: 500;
    font-size: 14px;
    line-height: 18px;
  }

  .search-by-route-result-container {
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    overflow: auto
  }

  .search-by-route-result-info {
    height: 18px;
  }
`;function Ye(t){var o,n;const{currentNetwork:i,selectedMethod:r,resultCount:l,maxPerPage:u,records:c,routeRecords:d,defaultPageSize:f,widgetId:m,outputDS:h,inputDS:p,isPoint:g,jimuMapView:v,highlightStyle:y,intl:S,onNavBack:R}=t,b=e.hooks.useTranslation(a),[w,N]=e.React.useState(null),[I,x]=e.React.useState([]),[D,M]=e.React.useState(null),[j,F]=e.React.useState(null),O=e.React.useRef(),k=e.ReactRedux.useSelector((e=>{var t;return null===(t=e.appConfig.widgets[m].enableDataAction)||void 0===t||t})),L=e.React.useMemo((()=>{const e=null==h?void 0:h.getOriginDataSources()[0],t=null==e?void 0:e.getLayerDefinition();let a=!1;const o=[];return null==d||d.forEach((e=>{const n=e.clone();n.getFieldValue(C.value)&&n.getFieldValue(C.value).length>0&&(n.getData()[t.objectIdField]=n.getFieldValue(C.value),a=!0),o.push(n)})),{dataSource:a?null==h?void 0:h.getOriginDataSources()[0]:h,type:(null==I?void 0:I.length)>0?"selected":"loaded",records:a?o:(null==I?void 0:I.length)>0?I:null==w?void 0:w.records,name:null==h?void 0:h.getLabel()}}),[d,I,h,w]);e.hooks.useEffectOnce((()=>{O.current.focus()})),e.React.useEffect((()=>{var e,t;if(N({records:c,pageSize:f,page:1}),(!D||!j)&&v){const a=new He.default({listMode:"hide"}),o=new He.default({listMode:"hide"});null===(t=null===(e=null==v?void 0:v.view)||void 0===e?void 0:e.map)||void 0===t||t.addMany([a,o]),M(a),F(o)}}),[c,f,null===(o=null==v?void 0:v.view)||void 0===o?void 0:o.map,D,j,v]);const P=e.React.useCallback((({dataItems:e,pageSize:t,page:a})=>{N({records:e,pageSize:t,page:a})}),[]),T=e.React.useCallback((()=>{if(w){const e=(w.page-1)*w.pageSize+1,t=e+w.pageSize-1;return l>0?`${b("resultsDisplay")} ${e} - ${Math.min(t,l)} / ${l}`:`${b("resultsDisplay")}: 0 - 0 / 0`}return""}),[w,l,b]),E=e.React.useCallback((e=>{var t;"Escape"===e.key&&(e.stopPropagation(),null===(t=O.current)||void 0===t||t.focus())}),[]),A=()=>{D&&(D.removeAll(),D.destroy(),M(null)),j&&(j.removeAll(),j.destroy(),F(null))},z=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:g?i.outputPointDsId:i.outputLineDsId,mainDataSourceId:g?i.outputPointDsId:i.outputLineDsId})),[i.outputLineDsId,i.outputPointDsId,g]),_=e.React.useCallback((()=>{var t;const a=e.DataSourceManager.getInstance().getDataSource(null==h?void 0:h.id),o=null==a?void 0:a.getSelectedRecords(),n=null!==(t=null==a?void 0:a.getSelectedRecordIds())&&void 0!==t?t:[];let i=!1;i=n.length!==I.length||n.some((e=>null==I.find((t=>t.getId()===e)))),i&&x(o)}),[null==h?void 0:h.id,I]);return(0,e.jsx)("div",{className:"search-by-route-result h-100 pt-3",onKeyUp:E,css:Ke,role:"listbox","aria-label":b("results")},(0,e.jsx)(e.DataSourceComponent,{useDataSource:z,onDataSourceInfoChange:_}),(0,e.jsx)("div",{className:"search-by-route-result__header d-flex align-items-center px-3"},(0,e.jsx)(s.Tooltip,{title:b("backLabel")},(0,e.jsx)(s.Button,{ref:O,className:"p-0 mr-2",size:"sm",type:"tertiary",icon:!0,onClick:()=>{A(),R(),N(null)}},(0,e.jsx)(Qe,{autoFlip:!0}))),i.name,(null===(n=null==w?void 0:w.records)||void 0===n?void 0:n.length)>0&&k&&(0,e.jsx)(e.React.Fragment,null,(0,e.jsx)("div",{className:"ml-auto"},(0,e.jsx)(s.DataActionList,{widgetId:m,dataSets:[L],listStyle:s.DataActionListStyle.Dropdown,buttonSize:"sm",buttonType:"tertiary"})))),(0,e.jsx)("div",{className:"search-by-route-result-container mt-1"},(0,e.jsx)("div",{className:"search-by-route-result-info mb-2 px-3",role:"alert","aria-live":"polite"},T()),l>0&&(0,e.jsx)(We,{widgetId:m,networkItem:i,selectedMethod:r,outputDS:h,inputDS:p,resultCount:l,maxPerPage:u,records:c,highlightGraphicsLayer:D,flashGraphicsLayer:j,highlightStyle:y,jimuMapView:v,onRenderDone:P,defaultPageSize:f,intl:S})))}function Xe(t){const{networkItem:a,dataSourceReady:o,onCreateDs:n,onCreatePointDs:i,onCreateLineDs:r}=t,[s,l]=e.React.useState(null!=a?a:null);e.React.useEffect((()=>{a&&l(a)}),[a]);const u=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:s.outputLineDsId,mainDataSourceId:s.outputLineDsId})),[s.outputLineDsId]),c=e.React.useMemo((()=>(0,e.Immutable)({dataSourceId:s.outputPointDsId,mainDataSourceId:s.outputPointDsId})),[s.outputPointDsId]),d=e.React.useCallback((e=>{n(e)}),[n]),f=e.React.useCallback((t=>{if(t){const{status:a,instanceStatus:n}=t;n===e.DataSourceStatus.NotCreated||n===e.DataSourceStatus.CreateError||a===e.DataSourceStatus.LoadError||a===e.DataSourceStatus.NotReady?o(!1):o(!0)}}),[o]),m=e.React.useCallback((()=>{o(!1)}),[o]);return(0,e.jsx)("div",null,(0,e.jsx)(e.DataSourceComponent,{useDataSource:u,onDataSourceCreated:e=>{r(e)}}),(0,e.jsx)(e.DataSourceComponent,{useDataSource:c,onDataSourceCreated:e=>{i(e)}}),(0,e.jsx)(e.DataSourceComponent,{useDataSource:s.useDataSource,onDataSourceInfoChange:f,onCreateDataSourceFailed:m,onDataSourceCreated:d}))}var et=f(77958),tt=function(e,t,a,o){return new(a||(a=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};function at(o){var i,r,l,u;const c=e.hooks.useTranslation(a),{widgetId:f,jimuMapView:m,config:h,intl:p,hideTitle:g,coordinateGraphic:v}=o,[y,S]=e.React.useState((0,e.Immutable)(null===(i=h.networkItems)||void 0===i?void 0:i.find((e=>!(null==e?void 0:e.referent))))),[R,b]=e.React.useState((0,e.Immutable)(null===(r=h.networkItems)||void 0===r?void 0:r.find((e=>null==e?void 0:e.referent)))||null),[w,D]=e.React.useState((null==y?void 0:y.defaultMethod)||t.SearchMethod.Measure),[M,F]=e.React.useState(0),[O,k]=e.React.useState(0),[L,P]=e.React.useState(null),[T,E]=e.React.useState(null),[A,z]=e.React.useState(!1),[_,G]=e.React.useState(null),[V,B]=e.React.useState(!1),[$,U]=e.React.useState(!1),[W,J]=e.React.useState(!1),[q,Z]=e.React.useState(),[Q,H]=e.React.useState(""),[K,Y]=e.React.useState(!1),[X,ee]=e.React.useState(null),te=e.React.useRef(null),ae=e.React.useRef(null),oe=function(t){const{widgetId:a,useDataSourceId:o}=t;return e.ReactRedux.useSelector((e=>{var t;let n;return n=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(t=n.widgets[a].useDataSources)&&void 0!==t?t:[]).some((e=>e.dataSourceId===o))}))}({widgetId:o.widgetId,useDataSourceId:null===(l=null==y?void 0:y.useDataSource)||void 0===l?void 0:l.dataSourceId}),ne="search-by-route-layer-",[re,le]=e.React.useState(!0),ue=e.React.useRef(null),ce=e.React.useRef(null),de=e.React.useRef(null);e.React.useEffect((()=>{var t,a,o;if((null===(t=h.networkItems)||void 0===t?void 0:t.length)>0){const t=null===(o=null===(a=null==h?void 0:h.resultConfig)||void 0===a?void 0:a.defaultReferentLayer)||void 0===o?void 0:o.layerId,n=h.networkItems.find((e=>(null==e?void 0:e.layerId)===t));b((0,e.Immutable)(n)),ee((0,e.Immutable)(n));for(let e=0;e<h.networkItems.length;e++){const t=h.networkItems[e];if(!(null==t?void 0:t.referent)){S(t);break}}}}),[]),e.React.useEffect((()=>{$&&(Z("error"),H(Q),J(!0),setTimeout((()=>{J(!1),U(!1)}),5e3))}),[$,c,Q]),e.React.useEffect((()=>{for(let a=0;a<h.networkItems.length;a++){const a=h.networkItems.find((e=>(null==e?void 0:e.name)===h.defaultNetwork));if((0,t.isDefined)(a)&&!(null==a?void 0:a.referent)){S((0,e.Immutable)(a));break}}}),[h.defaultNetwork,h.networkItems]),e.React.useEffect((()=>{if((0,t.isDefined)(h.resultConfig.defaultReferentLayer)){const a=h.networkItems.find((e=>e.name===h.resultConfig.defaultReferentLayer.name));(0,t.isDefined)(a)&&b((0,e.Immutable)(a))}}),[h.resultConfig.defaultReferentLayer]);const fe=()=>{(0,t.isDefined)(v)&&v.removeAll()},me=e.React.useCallback((()=>{if(L&&T){const t=A?T.id:L.id,a=new e.DataRecordSetChangeMessage(f,e.RecordSetChangeType.Remove,[t]);e.MessageManager.getInstance().publishMessage(a)}}),[L,T,A,f]),he=e.React.useCallback((a=>tt(this,void 0,void 0,(function*(){const o=_;let n,i;if(a.isPoint?(z(!0),n=T):(z(!1),n=L),h.labelStyle.size>0){const e=(null==n?void 0:n.layer)||(yield n.createJSAPILayerByDataSource());n.layer=e;const o=j(y,a.isPoint);i=yield(0,t.createLabelLayer)(n,m,o,ne,h.labelStyle.color,h.labelStyle.size)}me(),te.current=null,function(a,o,n,i){return ke(this,void 0,void 0,(function*(){var r;const s=[];let l="";if(n.routeId.length>0?l=`LOWER(${o.routeIdField.jimuName}) LIKE LOWER('${n.routeId}')`:n.routeName.length>0?l=`LOWER(${o.routeNameField.jimuName}) LIKE LOWER('${n.routeName}')`:n.routeIdFields.forEach(((t,a)=>{t&&(o.routeIdFields[a].field.type===e.JimuFieldType.Number?(l.length>0&&(l+=" AND "),l+=`${o.routeIdFields[a].field.name} LIKE ${n.routeIdFields[a]}`):t.length>0&&(l.length>0&&(l+=" AND "),l+=`LOWER(${o.routeIdFields[a].field.name}) LIKE LOWER('${n.routeIdFields[a]}')`))})),(0,t.isDefined)(a&&(0,t.isDefined)(a.layer)))return yield(0,e.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((e=>{var t;let n=null;n=e[0];const r=a.layer.createQuery();r.spatialRelationship="intersects",r.outSpatialReference=i.view.spatialReference,r.returnGeometry=!0,r.outFields=["*"],r.returnM=!0,r.returnZ=!0,r.where=l,r.orderByFields=[],(null===(t=o.sortOptions)||void 0===t?void 0:t.length)>0&&Object.assign(r.orderByFields,{orderByFields:o.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))});const u=a.getCurrentQueryParams();return(null==u?void 0:u.time)&&(r.timeExtent=new n({start:u.time[0],end:u.time[1]})),a.layer.queryFeatures(r).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features.map((e=>a.buildRecord(e))):s})).catch((e=>s))}));{const e=a.getCurrentQueryParams(),t={returnGeometry:!0,returnM:!0,returnZ:!0,where:l,time:null==e?void 0:e.time,outFields:["*"],notAddFieldsToClient:!0};return(null===(r=o.sortOptions)||void 0===r?void 0:r.length)>0&&Object.assign(t,{orderByFields:o.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))}),a.query(t).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:s})).catch((e=>s))}}))}(o,y,a,m).then((e=>{Pe(f,n,y,e,a,i).then((e=>{(null==e?void 0:e.length)>0?(n.setRecords(e),F(null==e?void 0:e.length),te.current=n.getRecordsByPage(1,h.resultConfig.pageSize),U(!1),k(1)):(U(!0),H(a.isMeasureToGeometryOperation?c("noResultsMeasure"):c("noResults")))})).finally((()=>{}))}))}))),[_,y,m,h,me,T,L,f,c]),pe=e.React.useCallback((a=>tt(this,void 0,void 0,(function*(){const o=_;z(!0);const i=T;let r;if(h.labelStyle.size>0){const e=(null==i?void 0:i.layer)||(yield i.createJSAPILayerByDataSource());i.layer=e;const a=j(y,!0);r=yield(0,t.createLabelLayer)(i,m,a,ne,h.labelStyle.color,h.labelStyle.size)}me(),te.current=null,function(t,a,o){return ke(this,void 0,void 0,(function*(){const i=[];let r,s=null,l=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[s,l]=e})).then((()=>{var e,i,u;const c=new s;c.x=o.xCoordinate,c.y=o.yCoordinate,o.zCoordinate?c.z=o.zCoordinate:c.z=0,a.defaultSpatialReferenceFrom===n.Map?c.spatialReference=new l({wkid:102100}):c.spatialReference=new l({wkid:a.spatialReferenceInfo.wkid,wkt:a.spatialReferenceInfo.wkt});let d=null!==(i=null===(e=t.getTimeInfo())||void 0===e?void 0:e.timeExtent)&&void 0!==i?i:0;const f=t.getCurrentQueryParams();(null==f?void 0:f.time)&&(d=[f.time[0],f.time[1]]),r={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:c.toJSON?c.toJSON():c,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",time:d},(null===(u=a.sortOptions)||void 0===u?void 0:u.length)>0&&Object.assign(r,{orderByFields:a.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))})})),t.query(r).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}(o,y,a).then((s=>tt(this,void 0,void 0,(function*(){s.length>0?function(a,o,i,r,s,l){return ke(this,void 0,void 0,(function*(){const u=i.networkUrl,c=`${u}/geometryToMeasure`,d=yield e.SessionManager.getInstance().getSessionByUrl(u).getToken(u),f=[],m=[];let h=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{[h]=e})).then((()=>{const e=new h;e.x=s.xCoordinate,e.y=s.yCoordinate,s.zCoordinate?e.z=s.zCoordinate:e.z=0,r.forEach((t=>{const a=t.getFieldValue(i.routeIdField.jimuName);f.push(a),m.push({routeId:a,geometry:e.toJSON?e.toJSON():e})}))}));const p=o.getOriginDataSources()[0],g=yield Te(p);let v=p.getGDBVersion();v||(v="");const y=p.getCurrentQueryParams();let S=null;(null==y?void 0:y.time)&&(S=null==y?void 0:y.time[0]);const R={f:"json",token:d,locations:m,inSR:i.defaultSpatialReferenceFrom===n.Map?102100:null,gdbVersion:v,temporalViewDate:S},b=[];return(0,t.requestService)({method:"POST",url:c,params:R}).then((n=>ke(this,void 0,void 0,(function*(){if(!n||!n.locations)return b;let u=null,c=null,d=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic"]).then((e=>{[u,c,d]=e})).then((()=>{const f=new u;f.x=s.xCoordinate,f.y=s.yCoordinate,s.zCoordinate?f.z=s.zCoordinate:f.z=0,n.locations.forEach(((e,a)=>{e&&e.results.forEach(((e,a)=>{if(e){const a=r.findIndex((t=>t.getFieldValue(i.routeIdField.jimuName)===e.routeId)),s=r[a].getData();s[I.at(0).value]=Oe(e.measure,i.measurePrecision),s[x.value]=Oe(e.distance,i.measurePrecision),s[C.value]=r[a].getId();const f=s[i.fromDateFieldName],m=s[i.toDateFieldName];m&&(s[i.toDateFieldName]=(0,t.getDateWithTZOffset)(m,o.getOriginDataSources()[0]).valueOf()),f&&(s[i.fromDateFieldName]=(0,t.getDateWithTZOffset)(f,o.getOriginDataSources()[0]).valueOf());const h=new c({wkid:n.spatialReference.wkid}),p=new u(e.geometry);p.spatialReference=h;const g=new d({geometry:p,attributes:s});(0,t.isDefined)(l)&&l.applyEdits({addFeatures:[g.clone()]});const v=o.buildRecord(g);b.push(v)}}))})),b.forEach((e=>{const t=e.feature;t.sourceLayer=g.associatedLayer||g,t.layer=t.sourceLayer})),o.setSourceRecords(b),o.setStatus(e.DataSourceStatus.Unloaded),o.setCountStatus(e.DataSourceStatus.Unloaded),Ee(o,a)})),b}))))}))}(f,i,y,s,a,r).then((e=>{i.setRecords(e),F(null==e?void 0:e.length)})).finally((()=>{te.current=i.getRecordsByPage(1,h.resultConfig.pageSize),k(1)})):yield function(a,o,i){return ke(this,void 0,void 0,(function*(){const r=[];let s,l=null,u=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[l,u]=e})).then((()=>{var e,r,c,d,f,m,h,p;const g=new l;g.x=i.xCoordinate,g.y=i.yCoordinate,i.zCoordinate?g.z=i.zCoordinate:g.z=0,o.defaultSpatialReferenceFrom===n.Map?g.spatialReference=new u({wkid:102100}):g.spatialReference=new u({wkid:o.spatialReferenceInfo.wkid,wkt:o.spatialReferenceInfo.wkt});let v=null!==(r=null===(e=a.getTimeInfo())||void 0===e?void 0:e.timeExtent)&&void 0!==r?r:0;const y=a.getCurrentQueryParams();(null==y?void 0:y.time)&&(v=[y.time[0],y.time[1]]);const S=a.getOriginDataSources()[0],R=o.unitsOfMeasure;let b="esriMeters";(null===(c=null==S?void 0:S.layerDefinition)||void 0===c?void 0:c.hasGeometryProperties)&&(null===(f=null===(d=null==S?void 0:S.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===f?void 0:f.units)&&(b=null===(h=null===(m=null==S?void 0:S.layerDefinition)||void 0===m?void 0:m.geometryProperties)||void 0===h?void 0:h.units);const w=(0,t.ConvertUnits)(o.searchRadius,R,b);s={returnGeometry:!0,returnM:!0,returnZ:!0,geometry:g.toJSON?g.toJSON():g,geometryType:"esriGeometryPoint",spatialRel:"esriSpatialRelIntersects",distance:w,units:"esriSRUnit_Meter",time:v,outFields:[o.routeIdFieldName],notAddFieldsToClient:!0},(null===(p=o.sortOptions)||void 0===p?void 0:p.length)>0&&Object.assign(s,{orderByFields:o.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))})})),a.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:r})).catch((e=>r))}))}(o,y,a).then((s=>tt(this,void 0,void 0,(function*(){if(s.length>0){let l,u=[];yield Promise.all(s.map((o=>tt(this,void 0,void 0,(function*(){yield function(a,o,i,r){return ke(this,void 0,void 0,(function*(){var s,l,u,c,d;const f=o.getOriginDataSources()[0];let m=f.getGDBVersion();m||(m="");const h=i.unitsOfMeasure;let p=i.unitsOfMeasure;(null===(s=null==f?void 0:f.layerDefinition)||void 0===s?void 0:s.hasGeometryProperties)&&(null===(u=null===(l=null==f?void 0:f.layerDefinition)||void 0===l?void 0:l.geometryProperties)||void 0===u?void 0:u.units)&&(p=null===(d=null===(c=null==f?void 0:f.layerDefinition)||void 0===c?void 0:c.geometryProperties)||void 0===d?void 0:d.units);const g=(0,t.ConvertUnits)(i.searchRadius,h,p),v=[];let y=null,S=null;yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[y,S]=e})).then((()=>{const e=new y;e.x=r.xCoordinate,e.y=r.yCoordinate,r.zCoordinate?e.z=r.zCoordinate:e.z=0,i.defaultSpatialReferenceFrom===n.Map?e.spatialReference=new S({wkid:102100}):e.spatialReference=new S({wkid:i.spatialReferenceInfo.wkid,wkt:i.spatialReferenceInfo.wkt}),v.push({routeId:a.getFieldValue(i.routeIdFieldName),geometry:e.toJSON?e.toJSON():e})}));const R=i.networkUrl,b={f:"json",token:yield e.SessionManager.getInstance().getSessionByUrl(R).getToken(R),locations:v,inSR:i.defaultSpatialReferenceFrom===n.Map?102100:null,gdbVersion:m,tolerance:g,temporalViewDate:a.getFieldValue(i.fromDateFieldName)},w=`${R}/geometryToMeasure`;return(0,t.requestService)({method:"POST",url:w,params:b}).then((e=>ke(this,void 0,void 0,(function*(){return e&&e.locations?{resultLocations:e.locations,resultWkid:e.spatialReference.wkid}:{resultLocations:[],resultWkid:NaN}}))))}))}(o,i,y,a).then((({resultLocations:e,resultWkid:t})=>{u=u.concat(e),l=t}))})))));let d=null,m=null;(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[d,m]=e})).then((()=>{let s=-1;const p=new d;p.x=a.xCoordinate,p.y=a.yCoordinate,a.zCoordinate?p.z=a.zCoordinate:p.z=0,y.defaultSpatialReferenceFrom===n.Map?p.spatialReference=new m({wkid:102100}):y.spatialReferenceInfo.wkid?p.spatialReference=new m({wkid:y.spatialReferenceInfo.wkid}):y.spatialReferenceInfo.wkt&&(p.spatialReference=new m({wkt:y.spatialReferenceInfo.wkt}));let g=[],v=[];u.forEach((e=>{e&&e.results.forEach((e=>{if(e){const t=et.default.nearestCoordinate(new d(e.geometry),p).distance;(-1===s||t<=s)&&((-1===s||t<s)&&(g=[],v=[],s=t),g.push(e),v.push(e.routeId))}}))})),function(a,o,n,i,r,s,l,u){return ke(this,void 0,void 0,(function*(){var c,d,f;const m=n.getOriginDataSources()[0],h=yield Te(m),p=[];let g="";if(!(r.length>0))return{newRecords:p};g=o.routeIdField.jimuName+" IN ('"+r.join("','")+"')";let v=null!==(d=null===(c=a.getTimeInfo())||void 0===c?void 0:c.timeExtent)&&void 0!==d?d:0;const y=a.getCurrentQueryParams();(null==y?void 0:y.time)&&(v=[y.time[0],y.time[1]]);const S={returnGeometry:!0,returnM:!0,returnZ:!0,where:g,time:v,outFields:[o.routeIdField.jimuName],notAddFieldsToClient:!0};return(null===(f=o.sortOptions)||void 0===f?void 0:f.length)>0&&Object.assign(S,{orderByFields:o.sortOptions.map((e=>`${e.jimuFieldName} ${e.order}`))}),a.query(S).then((a=>ke(this,void 0,void 0,(function*(){var r;if((null===(r=a.records)||void 0===r?void 0:r.length)>0){const r=a.records;let c=null,d=null,f=null;return yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic"]).then((e=>{[c,d,f]=e})).then((()=>{i.forEach((e=>{const a=r.findIndex((t=>t.getFieldValue(o.routeIdField.jimuName)===e.routeId));if(a>-1){const i=r[a].getData();i[I.at(0).value]=Oe(e.measure,o.measurePrecision),i[x.value]=Oe(e.distance,o.measurePrecision),i[C.value]=r[a].getId();const l=i[o.fromDateFieldName],m=i[o.toDateFieldName];m&&(i[o.toDateFieldName]=(0,t.getDateWithTZOffset)(m,n.getOriginDataSources()[0]).valueOf()),l&&(i[o.fromDateFieldName]=(0,t.getDateWithTZOffset)(l,n.getOriginDataSources()[0]).valueOf());const h=new d({wkid:s}),g=new c(e.geometry);g.spatialReference=h;const v=new f({geometry:g,attributes:i});(0,t.isDefined)(u)&&u.applyEdits({addFeatures:[v.clone()]});const y=n.buildRecord(v);p.push(y)}}))})),p.forEach((e=>{const t=e.feature;t.sourceLayer=h.associatedLayer||h,t.layer=t.sourceLayer})),n.setSourceRecords(p),n.setStatus(e.DataSourceStatus.Unloaded),n.setCountStatus(e.DataSourceStatus.Unloaded),Ee(n,l),{newRecords:p}}return{newRecords:p}})))).catch((e=>({newRecords:p})))}))}(o,y,i,g,v,l,f,r).then((({newRecords:e})=>{i.setRecords(e),F(null==e?void 0:e.length),(null==e?void 0:e.length)>0?(te.current=i.getRecordsByPage(1,h.resultConfig.pageSize),k(1),U(!1)):(U(!0),H(c("searchRadiusResultsError")))}))}))}else U(!0),H(c("searchRadiusResultsError"))}))))}))))}))),[_,T,y,m,h,me,f,c]),ge=e.React.useCallback((()=>{te.current=null,A?(null==T||T.clearSelection(),null==T||T.clearRecords(),null==T||T.setCountStatus(e.DataSourceStatus.NotReady),null==T||T.setStatus(e.DataSourceStatus.NotReady)):(null==L||L.clearSelection(),null==L||L.clearRecords(),null==L||L.setCountStatus(e.DataSourceStatus.NotReady),null==L||L.setStatus(e.DataSourceStatus.NotReady)),(0,t.removeLabelLayer)(m,ne),F(0),me(),k(0)}),[m,A,L,T,me]),ve=e.React.useCallback((()=>{var e,a,o;w===t.SearchMethod.Measure?null===(e=ue.current)||void 0===e||e.submitForm():w===t.SearchMethod.Referent?null===(a=ce.current)||void 0===a||a.submitForm():w===t.SearchMethod.Coordinate&&(null===(o=de.current)||void 0===o||o.submitForm())}),[w]),ye=e.React.useCallback((e=>{le(e)}),[]),Se=e.React.useMemo((()=>w===t.SearchMethod.Measure?c(re?"search":"searchDisabled"):w===t.SearchMethod.Referent?c(re?"search":"searchReferentTooltip"):w===t.SearchMethod.Coordinate?c(re?"search":"coordinateSearchDisabled"):void 0),[c,re,w]);return(0,e.jsx)("div",{className:"search-by-route-task h-100 d-flex",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .search-by-route-form {
      height: 100%;
    }
    .search-by-route-task__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .toast {
      position: relative;
      top: 4%;
    }
    .search-by-route-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-form__header px-3 pt-3 align-items-center",{"d-none":1===O,[s.FOCUSABLE_CONTAINER_CLASS]:1!==O})},!g&&(0,e.jsx)("div",{className:"search-by-route_title d-flex align-items-center text-truncate",css:e.css`font-weight: 500; font-size: 14px;`},(0,e.jsx)("div",{className:"text-truncate"},c("_widgetLabel")))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-task__content",{"d-none":1===O,[s.FOCUSABLE_CONTAINER_CLASS]:1!==O})},(0,e.jsx)(Xe,{networkItem:y,dataSourceReady:e=>{B(e)},onCreateDs:e=>{G(e)},onCreateLineDs:e=>{P(e)},onCreatePointDs:e=>{E(e)}}),(0,e.jsx)(d,{config:h,networkConfig:h.networkItems,onMethodChanged:e=>{D(e),fe()},onNetworkChanged:e=>{B(!1),S(e),fe()},onReferentChanged:e=>{B(!1),b(e)},defaultReferent:R}),V&&oe&&w===t.SearchMethod.Measure&&(0,e.jsx)(N,{ref:ue,intl:p,widgetId:f,networkItem:y,dataSource:_,isDataSourceReady:null!=_,onSubmit:he,onValidationChanged:ye,reset:K}),w===t.SearchMethod.Coordinate&&(0,e.jsx)(se,{ref:de,networkItem:y,dataSource:_,isDataSourceReady:null!=_,onSubmit:pe,onValidationChanged:ye,coordinateGraphic:v,reset:K}),w===t.SearchMethod.Referent&&(0,e.jsx)(ie,{ref:ce,networkItem:y,referentItem:R,dataSource:_,isDataSourceReady:null!=_,onSubmit:(a,o)=>tt(this,void 0,void 0,(function*(){const n=_,i=T;let r;if(h.labelStyle.size>0){const e=(null==i?void 0:i.layer)||(yield i.createJSAPILayerByDataSource());i.layer=e;const a=j(y,!0);r=yield(0,t.createLabelLayer)(i,m,a,ne,h.labelStyle.color,h.labelStyle.size)}z(!0),me(),te.current=null,function(a,o,n,i,r,s,l,u,c,d){return ke(this,void 0,void 0,(function*(){var f;const m=[],h=[],p=null===(f=null==c?void 0:c.resultConfig)||void 0===f?void 0:f.defaultOffsetUnit;let g=null,v=null,y=null,S=o.getGDBVersion();return S||(S=""),yield(0,e.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference","esri/Graphic"]).then((e=>{[g,v,y]=e})).then((()=>ke(this,void 0,void 0,(function*(){const c=yield Le(n,i,p,S,null);if(!c||!(null==c?void 0:c.locations)||0===(null==c?void 0:c.locations.length))return[];if(c.locations.forEach((e=>{const t=e.results;if("esriLocatingMultipleLocation"===(null==e?void 0:e.status))t.forEach((e=>{const t=e.routeId;m.includes(t)||m.push(t)}));else if("esriLocatingOK"===(null==e?void 0:e.status)){const t=e.results[0].routeId;m.includes(t)||m.push(t)}})),!m||0===m.length)return[];const f=(e,t)=>{const a=new y({geometry:t,attributes:e}),o=s.buildRecord(a);h.push(o),l++},R=(e,a,n)=>ke(this,void 0,void 0,(function*(){const r=o.getLayerDefinition(),u=null==e?void 0:e.results,m=new v({wkid:c.spatialReference.wkid});if("esriLocatingMultipleLocation"===(null==e?void 0:e.status))u.forEach(((e,o)=>{const u=null==a?void 0:a.getData();if(u)if((null==e?void 0:e.routeId)!==u[i.routeIdFieldName]);else{n.push(e);let o=null==e?void 0:e.measure,m=null;"esriGeometryPoint"===(null==e?void 0:e.geometryType)&&(m=new g(e.geometry),m.spatialReference=c.spatialReference),o=o<0?0:Oe(o,i.measurePrecision),u[I.at(0).value]=o,u[r.objectIdField]=l,u[C.value]=a.getId();const h=u[i.fromDateFieldName],p=u[i.toDateFieldName];if(h||p){const e=(0,t.isDefined)(h)?(0,t.getDateWithTZOffset)(h,s.getOriginDataSources()[0]).valueOf():null,a=(0,t.isDefined)(p)?(0,t.getDateWithTZOffset)(p,s.getOriginDataSources()[0]).valueOf():null;if(u[i.fromDateFieldName]=e,u[i.toDateFieldName]=a,(0,t.isDefined)(d)){const e=new y({geometry:m,attributes:u});d.applyEdits({addFeatures:[e.clone()]})}f(u,m)}else{if((0,t.isDefined)(d)){const e=new y({geometry:m,attributes:u});d.applyEdits({addFeatures:[e.clone()]})}f(u,m)}}}));else if("esriLocatingOK"===(null==e?void 0:e.status)){const o=e.results[0];let u=o.measure;const c=a.getData();let h=null;if(n.some((e=>JSON.stringify(e)===JSON.stringify(o)))||(null==o?void 0:o.routeId)!==c[i.routeIdFieldName]);else{n.push(o),"esriGeometryPoint"===o.geometryType&&(h=new g(o.geometry),h.spatialReference=m),u=u<0?0:Oe(u,i.measurePrecision),c[I.at(0).value]=u,c[r.objectIdField]=l,c[C.value]=a.getId();const e=c[i.fromDateFieldName],p=c[i.toDateFieldName];if(e||p){const a=(0,t.isDefined)(e)?(0,t.getDateWithTZOffset)(e,s.getOriginDataSources()[0]).valueOf():null,o=(0,t.isDefined)(p)?(0,t.getDateWithTZOffset)(p,s.getOriginDataSources()[0]).valueOf():null;if(c[i.fromDateFieldName]=a,c[i.toDateFieldName]=o,(0,t.isDefined)(d)){const e=new y({geometry:h,attributes:c});d.applyEdits({addFeatures:[e.clone()]})}f(c,h)}else{if((0,t.isDefined)(d)){const e=new y({geometry:h,attributes:c});d.applyEdits({addFeatures:[e.clone()]})}f(c,h)}}}}));yield(()=>ke(this,void 0,void 0,(function*(){var e;const t=null==i?void 0:i.routeIdFieldName,a=[],s=[];let l="";m.length>0&&(l=t+" IN ('"+m.join("','")+"')");const c={where:l},d=yield o.query(c);if(0===(null===(e=null==d?void 0:d.records)||void 0===e?void 0:e.length))return[];d.records.forEach((e=>ke(this,void 0,void 0,(function*(){s.push(e);const t=e.getData()[null==r?void 0:r.fromDateFieldName];null==n||n.forEach((e=>{const o=e.objectId;let s=u[o];"eventLayers"!==(null==r?void 0:r.type)&&(s=t),a.push(Le(n,i,p,S,s))}))}))));const f=yield Promise.all(a),h=[];f.forEach(((e,t)=>{const a=null==e?void 0:e.locations;if((null==a?void 0:a.length)>0){const e=s[t];null==a||a.forEach(((t,a)=>{R(t,e,h)}))}}))})))(),s.setSourceRecords(h),s.setStatus(e.DataSourceStatus.Unloaded),s.setCountStatus(e.DataSourceStatus.Unloaded),Ee(s,a);const b=yield Te(o);return h.forEach((e=>{const t=e.feature;t.sourceLayer=b.associatedLayer||b,t.layer=t.sourceLayer})),h}))))}))}(f,n,a,y,R,i,1,o,h,r).then((e=>{(null==e?void 0:e.length)>0?(i.setSourceRecords(e),i.setRecords(e),F(null==e?void 0:e.length),te.current=i.getRecordsByPage(1,h.resultConfig.pageSize),k(1),U(!1)):(U(!0),H(c("noResultReferent")))})).finally((()=>{}))})),config:h,id:f,intl:p,widgetId:f,onValidationChanged:ye,reset:K}),W&&(0,e.jsx)("div",{className:"toast-container px-3 w-100"},(0,e.jsx)(s.Alert,{className:"toast w-100",type:q,text:Q,closable:!0,withIcon:!0,open:W,onClose:()=>{J(!1),U(!1)}}))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-footer_action w-100",{"d-none":1===O,[s.FOCUSABLE_CONTAINER_CLASS]:1!==O})},(0,e.jsx)("div",{className:"search-by-route-footer d-flex"},(0,e.jsx)(s.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500)"},onClick:()=>{Y(!K),b(X)}},"Reset"),(0,e.jsx)(s.Tooltip,{title:Se},(0,e.jsx)("div",{className:"mt-auto ml-auto"},(0,e.jsx)(s.Button,{className:"active","aria-label":c("searchLabel"),size:"sm",disabled:!re,onClick:ve},c("searchLabel")))))),(0,e.jsx)("div",{className:(0,e.classNames)("search-by-route-task__content",{"d-none":1!==O,[s.FOCUSABLE_CONTAINER_CLASS]:1===O})},(0,e.jsx)(Ye,{widgetId:f,currentNetwork:y,selectedMethod:w,isPoint:A,resultCount:M,maxPerPage:null===(u=null==_?void 0:_.getMaxRecordCount)||void 0===u?void 0:u.call(_),records:te.current,routeRecords:ae.current,defaultPageSize:h.resultConfig.pageSize,outputDS:A?T:L,inputDS:_,jimuMapView:m,highlightStyle:h.highlightStyle,onNavBack:ge,intl:p})))}var ot=function(e,t,a,o){return new(a||(a=Promise))((function(n,i){function r(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(r,s)}l((o=o.apply(e,t||[])).next())}))};const nt=e.css`
  background-color: var(--ref-palette-white);
`;class it extends e.React.PureComponent{constructor(t){super(t),this.onActiveViewChange=e=>ot(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>ot(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const a=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==a?void 0:a.isDataSourceSet)&&!a.areChildDataSourcesCreated()?a.childDataSourcesReady().then((()=>a)).catch((e=>a)):Promise.resolve(a)})),this.state={coordinateGraphic:null,jimuMapView:void 0,hideTitle:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentDidMount(){const e=(0,t.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:e})}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,a){a.jimuMapView!==this.state.jimuMapView&&(0,t.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,t.isDefined)(this.state.coordinateGraphic)&&(this.state.coordinateGraphic.removeAll(),this.state.coordinateGraphic.destroy(),this.setState({coordinateGraphic:null}))}createGraphicLayers(){var e,a;if((0,t.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const t=new He.default({listMode:"hide"});null===(a=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===a||a.map.addMany([t]),this.setState({coordinateGraphic:t})}}render(){var t,o;const{config:n,id:i,intl:r}=this.props,l=this.props.intl.formatMessage({id:"_widgetLabel",defaultMessage:a._widgetLabel});return(null===(t=n.networkItems)||void 0===t?void 0:t.filter((e=>!e.referent)).length)?(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-search-by-route surface-1 border-0",css:nt},(0,e.jsx)(c.JimuMapViewComponent,{useMapWidgetId:null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(at,{widgetId:i,jimuMapView:this.state.jimuMapView,config:n,intl:r,hideTitle:this.state.hideTitle,coordinateGraphic:this.state.coordinateGraphic})):(0,e.jsx)(s.WidgetPlaceholder,{icon:u(),widgetId:i,message:l})}}function rt(e){f.p=e}})(),m})())}}}));