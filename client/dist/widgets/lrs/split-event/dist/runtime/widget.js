System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","jimu-core/react","calcite-components","esri/layers/GraphicsLayer"],(function(e,t){var n={},a={},o={},r={},i={},s={},c={};return{setters:[function(e){n.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceStatus=e.DataSourceStatus,n.Immutable=e.Immutable,n.MessageManager=e.MessageManager,n.React=e.React,n.RecordSetChangeType=e.RecordSetChangeType,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.css=e.css,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx},function(e){a.AttributeTable=e.AttributeTable,a.GetUnits=e.GetUnits,a.InlineEditableDropdown=e.InlineEditableDropdown,a.Intellisense=e.Intellisense,a.LockAction=e.LockAction,a.LockManagerComponent=e.LockManagerComponent,a.LrsLayerType=e.LrsLayerType,a.QueryMapPointWithMeasureOnRoute=e.QueryMapPointWithMeasureOnRoute,a.QueryMeasureOnRoute=e.QueryMeasureOnRoute,a.QueryRouteMeasures=e.QueryRouteMeasures,a.RoutePicker=e.RoutePicker,a.RoutePickerPopup=e.RoutePickerPopup,a.convertStationToNumber=e.convertStationToNumber,a.flash=e.flash,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateToUTC=e.getDateToUTC,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getDateWithoutTZOffset=e.getDateWithoutTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getInitialRouteInfoState=e.getInitialRouteInfoState,a.getIntialLocksInfo=e.getIntialLocksInfo,a.getNetworkOutFields=e.getNetworkOutFields,a.getRouteFromEndMeasures=e.getRouteFromEndMeasures,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.getSuggestions=e.getSuggestions,a.isDate=e.isDate,a.isDefined=e.isDefined,a.isInWidgetController=e.isInWidgetController,a.isNumber=e.isNumber,a.isWithinTolerance=e.isWithinTolerance,a.queryEventsByEventObjectIds=e.queryEventsByEventObjectIds,a.queryEventsByRouteIdOrEventObjectId=e.queryEventsByRouteIdOrEventObjectId,a.queryLineId=e.queryLineId,a.queryRouteIdOrName=e.queryRouteIdOrName,a.requestService=e.requestService,a.setRouteInfoByRouteIdOrName=e.setRouteInfoByRouteIdOrName,a.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,a.validateField=e.validateField,a.validateRangeDomain=e.validateRangeDomain},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Label=e.Label,o.Select=e.Select,o.TextInput=e.TextInput,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){r.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.useImperativeHandle=e.useImperativeHandle},function(e){s.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){c.default=e.default}],execute:function(){e((()=>{var e={19027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M9 1h1v1H9zm0 2H8V0h3v3h-1v14h1v3H8v-3h1zm0 15h1v1H9zM8 4H2a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h6v-1H2a1 1 0 0 1-1-1V6a1 1 0 0 1 1-1h6zm0 5.5H3.5v-2h-1v3H8zm9 6.5h-6v-1h6a1 1 0 0 0 1-1V6a1 1 0 0 0-1-1h-6V4h6a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2m-6-5.5h4.5v2h1v-3H11z" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=s},59620:e=>{"use strict";e.exports=c},62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o},47626:e=>{"use strict";e.exports=a}},t={};function l(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,l),o.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var n in t)l.o(t,n)&&!l.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>ba,default:()=>ha});var e=l(79244),t=l(47626);const n={_widgetLabel:"Split Event",routeIdLabel:"Route ID",eventOidLabel:"Event OID",routeNameLabel:"Route Name",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",measureWithUnits:"Measure ({units}) *",splitMeasureWithUnits:"Split Measure ({units}) *",selectRouteLabel:"Select Route",routePicker:"Route Picker",splitDateLabel:"Split Date *",useStartDateLabel:"Use route start date",attributeLabel:"Attribute",valueLabel:"Value",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message} ({event1or2})",eventSplit:"Event Split",splitLabel:"Split",routeNotFound:"Route not found",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",noResult:"No results",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Inches",event1Label:"Event 1",event2Label:"Event 2",noEventFound:"Event does not exist for the selected event layer in this location.",multipleEventsFound:"More than one event exists at the split location.",unableToSplitAtStartOrEnd:"Unable to split at the start or end of an event.",chooseEventLocationFromMap:"(Choose event location from map)"};var a=l(14321),o=l(19027),r=l.n(o),i=l(62686);function s(){const t=e.hooks.useTranslation(n);return(0,e.jsx)("div",{className:"split-event-form-header"},(0,e.jsx)("div",{className:"split-event-form-header__header pt-3 px-3 align-items-center"},(0,e.jsx)("div",{className:"split-event_title d-flex align-items-center text-truncate",css:e.css`font-weight: 500; font-size: 14px;`},(0,e.jsx)("div",{className:"text-truncate"},t("_widgetLabel")))))}const c=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const f=function(e,t){for(var n=e.length;n--;)if(d(e[n][0],t))return n;return-1};var v=Array.prototype.splice;const p=function(e){var t=this.__data__,n=f(t,e);return!(n<0)&&(n==t.length-1?t.pop():v.call(t,n,1),--this.size,!0)};const m=function(e){var t=this.__data__,n=f(t,e);return n<0?void 0:t[n][1]};const h=function(e){return f(this.__data__,e)>-1};const b=function(e,t){var n=this.__data__,a=f(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this};function y(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}y.prototype.clear=c,y.prototype.delete=p,y.prototype.get=m,y.prototype.has=h,y.prototype.set=b;const g=y;const D=function(){this.__data__=new g,this.size=0};const S=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const I=function(e){return this.__data__.get(e)};const j=function(e){return this.__data__.has(e)};const R="object"==typeof global&&global&&global.Object===Object&&global;var w="object"==typeof self&&self&&self.Object===Object&&self;const E=R||w||Function("return this")();const x=E.Symbol;var O=Object.prototype,k=O.hasOwnProperty,N=O.toString,A=x?x.toStringTag:void 0;const M=function(e){var t=k.call(e,A),n=e[A];try{e[A]=void 0;var a=!0}catch(e){}var o=N.call(e);return a&&(t?e[A]=n:delete e[A]),o};var L=Object.prototype.toString;const _=function(e){return L.call(e)};var T=x?x.toStringTag:void 0;const F=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":T&&T in Object(e)?M(e):_(e)};const C=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const P=function(e){if(!C(e))return!1;var t=F(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const G=E["__core-js_shared__"];var V,U=(V=/[^.]+$/.exec(G&&G.keys&&G.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";const W=function(e){return!!U&&U in e};var z=Function.prototype.toString;const B=function(e){if(null!=e){try{return z.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var q=/^\[object .+?Constructor\]$/,Q=Function.prototype,H=Object.prototype,$=Q.toString,Z=H.hasOwnProperty,J=RegExp("^"+$.call(Z).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const K=function(e){return!(!C(e)||W(e))&&(P(e)?J:q).test(B(e))};const Y=function(e,t){return null==e?void 0:e[t]};const X=function(e,t){var n=Y(e,t);return K(n)?n:void 0};const ee=X(E,"Map");const te=X(Object,"create");const ne=function(){this.__data__=te?te(null):{},this.size=0};const ae=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var oe=Object.prototype.hasOwnProperty;const re=function(e){var t=this.__data__;if(te){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return oe.call(t,e)?t[e]:void 0};var ie=Object.prototype.hasOwnProperty;const se=function(e){var t=this.__data__;return te?void 0!==t[e]:ie.call(t,e)};const ce=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=te&&void 0===t?"__lodash_hash_undefined__":t,this};function le(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}le.prototype.clear=ne,le.prototype.delete=ae,le.prototype.get=re,le.prototype.has=se,le.prototype.set=ce;const ue=le;const de=function(){this.size=0,this.__data__={hash:new ue,map:new(ee||g),string:new ue}};const fe=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ve=function(e,t){var n=e.__data__;return fe(t)?n["string"==typeof t?"string":"hash"]:n.map};const pe=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t};const me=function(e){return ve(this,e).get(e)};const he=function(e){return ve(this,e).has(e)};const be=function(e,t){var n=ve(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this};function ye(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}ye.prototype.clear=de,ye.prototype.delete=pe,ye.prototype.get=me,ye.prototype.has=he,ye.prototype.set=be;const ge=ye;const De=function(e,t){var n=this.__data__;if(n instanceof g){var a=n.__data__;if(!ee||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new ge(a)}return n.set(e,t),this.size=n.size,this};function Se(e){var t=this.__data__=new g(e);this.size=t.size}Se.prototype.clear=D,Se.prototype.delete=S,Se.prototype.get=I,Se.prototype.has=j,Se.prototype.set=De;const Ie=Se;const je=function(e,t){for(var n=-1,a=null==e?0:e.length;++n<a&&!1!==t(e[n],n,e););return e};const Re=function(){try{var e=X(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const we=function(e,t,n){"__proto__"==t&&Re?Re(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Ee=Object.prototype.hasOwnProperty;const xe=function(e,t,n){var a=e[t];Ee.call(e,t)&&d(a,n)&&(void 0!==n||t in e)||we(e,t,n)};const Oe=function(e,t,n,a){var o=!n;n||(n={});for(var r=-1,i=t.length;++r<i;){var s=t[r],c=a?a(n[s],e[s],s,n,e):void 0;void 0===c&&(c=e[s]),o?we(n,s,c):xe(n,s,c)}return n};const ke=function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a};const Ne=function(e){return null!=e&&"object"==typeof e};const Ae=function(e){return Ne(e)&&"[object Arguments]"==F(e)};var Me=Object.prototype,Le=Me.hasOwnProperty,_e=Me.propertyIsEnumerable,Te=Ae(function(){return arguments}())?Ae:function(e){return Ne(e)&&Le.call(e,"callee")&&!_e.call(e,"callee")};const Fe=Te;const Ce=Array.isArray;const Pe=function(){return!1};var Ge="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ve=Ge&&"object"==typeof module&&module&&!module.nodeType&&module,Ue=Ve&&Ve.exports===Ge?E.Buffer:void 0;const We=(Ue?Ue.isBuffer:void 0)||Pe;var ze=/^(?:0|[1-9]\d*)$/;const Be=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&ze.test(e))&&e>-1&&e%1==0&&e<t};const qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Qe={};Qe["[object Float32Array]"]=Qe["[object Float64Array]"]=Qe["[object Int8Array]"]=Qe["[object Int16Array]"]=Qe["[object Int32Array]"]=Qe["[object Uint8Array]"]=Qe["[object Uint8ClampedArray]"]=Qe["[object Uint16Array]"]=Qe["[object Uint32Array]"]=!0,Qe["[object Arguments]"]=Qe["[object Array]"]=Qe["[object ArrayBuffer]"]=Qe["[object Boolean]"]=Qe["[object DataView]"]=Qe["[object Date]"]=Qe["[object Error]"]=Qe["[object Function]"]=Qe["[object Map]"]=Qe["[object Number]"]=Qe["[object Object]"]=Qe["[object RegExp]"]=Qe["[object Set]"]=Qe["[object String]"]=Qe["[object WeakMap]"]=!1;const He=function(e){return Ne(e)&&qe(e.length)&&!!Qe[F(e)]};const $e=function(e){return function(t){return e(t)}};var Ze="object"==typeof exports&&exports&&!exports.nodeType&&exports,Je=Ze&&"object"==typeof module&&module&&!module.nodeType&&module,Ke=Je&&Je.exports===Ze&&R.process;const Ye=function(){try{var e=Je&&Je.require&&Je.require("util").types;return e||Ke&&Ke.binding&&Ke.binding("util")}catch(e){}}();var Xe=Ye&&Ye.isTypedArray;const et=Xe?$e(Xe):He;var tt=Object.prototype.hasOwnProperty;const nt=function(e,t){var n=Ce(e),a=!n&&Fe(e),o=!n&&!a&&We(e),r=!n&&!a&&!o&&et(e),i=n||a||o||r,s=i?ke(e.length,String):[],c=s.length;for(var l in e)!t&&!tt.call(e,l)||i&&("length"==l||o&&("offset"==l||"parent"==l)||r&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Be(l,c))||s.push(l);return s};var at=Object.prototype;const ot=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||at)};const rt=function(e,t){return function(n){return e(t(n))}};const it=rt(Object.keys,Object);var st=Object.prototype.hasOwnProperty;const ct=function(e){if(!ot(e))return it(e);var t=[];for(var n in Object(e))st.call(e,n)&&"constructor"!=n&&t.push(n);return t};const lt=function(e){return null!=e&&qe(e.length)&&!P(e)};const ut=function(e){return lt(e)?nt(e):ct(e)};const dt=function(e,t){return e&&Oe(t,ut(t),e)};const ft=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var vt=Object.prototype.hasOwnProperty;const pt=function(e){if(!C(e))return ft(e);var t=ot(e),n=[];for(var a in e)("constructor"!=a||!t&&vt.call(e,a))&&n.push(a);return n};const mt=function(e){return lt(e)?nt(e,!0):pt(e)};const ht=function(e,t){return e&&Oe(t,mt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,yt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,gt=yt&&yt.exports===bt?E.Buffer:void 0,Dt=gt?gt.allocUnsafe:void 0;const St=function(e,t){if(t)return e.slice();var n=e.length,a=Dt?Dt(n):new e.constructor(n);return e.copy(a),a};const It=function(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t};const jt=function(e,t){for(var n=-1,a=null==e?0:e.length,o=0,r=[];++n<a;){var i=e[n];t(i,n,e)&&(r[o++]=i)}return r};const Rt=function(){return[]};var wt=Object.prototype.propertyIsEnumerable,Et=Object.getOwnPropertySymbols;const xt=Et?function(e){return null==e?[]:(e=Object(e),jt(Et(e),(function(t){return wt.call(e,t)})))}:Rt;const Ot=function(e,t){return Oe(e,xt(e),t)};const kt=function(e,t){for(var n=-1,a=t.length,o=e.length;++n<a;)e[o+n]=t[n];return e};const Nt=rt(Object.getPrototypeOf,Object);const At=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)kt(t,xt(e)),e=Nt(e);return t}:Rt;const Mt=function(e,t){return Oe(e,At(e),t)};const Lt=function(e,t,n){var a=t(e);return Ce(e)?a:kt(a,n(e))};const _t=function(e){return Lt(e,ut,xt)};const Tt=function(e){return Lt(e,mt,At)};const Ft=X(E,"DataView");const Ct=X(E,"Promise");const Pt=X(E,"Set");const Gt=X(E,"WeakMap");var Vt="[object Map]",Ut="[object Promise]",Wt="[object Set]",zt="[object WeakMap]",Bt="[object DataView]",qt=B(Ft),Qt=B(ee),Ht=B(Ct),$t=B(Pt),Zt=B(Gt),Jt=F;(Ft&&Jt(new Ft(new ArrayBuffer(1)))!=Bt||ee&&Jt(new ee)!=Vt||Ct&&Jt(Ct.resolve())!=Ut||Pt&&Jt(new Pt)!=Wt||Gt&&Jt(new Gt)!=zt)&&(Jt=function(e){var t=F(e),n="[object Object]"==t?e.constructor:void 0,a=n?B(n):"";if(a)switch(a){case qt:return Bt;case Qt:return Vt;case Ht:return Ut;case $t:return Wt;case Zt:return zt}return t});const Kt=Jt;var Yt=Object.prototype.hasOwnProperty;const Xt=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Yt.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const en=E.Uint8Array;const tn=function(e){var t=new e.constructor(e.byteLength);return new en(t).set(new en(e)),t};const nn=function(e,t){var n=t?tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var an=/\w*$/;const on=function(e){var t=new e.constructor(e.source,an.exec(e));return t.lastIndex=e.lastIndex,t};var rn=x?x.prototype:void 0,sn=rn?rn.valueOf:void 0;const cn=function(e){return sn?Object(sn.call(e)):{}};const ln=function(e,t){var n=t?tn(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const un=function(e,t,n){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return tn(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return nn(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ln(e,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return on(e);case"[object Symbol]":return cn(e)}};var dn=Object.create;const fn=function(){function e(){}return function(t){if(!C(t))return{};if(dn)return dn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const vn=function(e){return"function"!=typeof e.constructor||ot(e)?{}:fn(Nt(e))};const pn=function(e){return Ne(e)&&"[object Map]"==Kt(e)};var mn=Ye&&Ye.isMap;const hn=mn?$e(mn):pn;const bn=function(e){return Ne(e)&&"[object Set]"==Kt(e)};var yn=Ye&&Ye.isSet;const gn=yn?$e(yn):bn;var Dn="[object Arguments]",Sn="[object Function]",In="[object Object]",jn={};jn[Dn]=jn["[object Array]"]=jn["[object ArrayBuffer]"]=jn["[object DataView]"]=jn["[object Boolean]"]=jn["[object Date]"]=jn["[object Float32Array]"]=jn["[object Float64Array]"]=jn["[object Int8Array]"]=jn["[object Int16Array]"]=jn["[object Int32Array]"]=jn["[object Map]"]=jn["[object Number]"]=jn[In]=jn["[object RegExp]"]=jn["[object Set]"]=jn["[object String]"]=jn["[object Symbol]"]=jn["[object Uint8Array]"]=jn["[object Uint8ClampedArray]"]=jn["[object Uint16Array]"]=jn["[object Uint32Array]"]=!0,jn["[object Error]"]=jn[Sn]=jn["[object WeakMap]"]=!1;const Rn=function e(t,n,a,o,r,i){var s,c=1&n,l=2&n,u=4&n;if(a&&(s=r?a(t,o,r,i):a(t)),void 0!==s)return s;if(!C(t))return t;var d=Ce(t);if(d){if(s=Xt(t),!c)return It(t,s)}else{var f=Kt(t),v=f==Sn||"[object GeneratorFunction]"==f;if(We(t))return St(t,c);if(f==In||f==Dn||v&&!r){if(s=l||v?{}:vn(t),!c)return l?Mt(t,ht(s,t)):Ot(t,dt(s,t))}else{if(!jn[f])return r?t:{};s=un(t,f,c)}}i||(i=new Ie);var p=i.get(t);if(p)return p;i.set(t,s),gn(t)?t.forEach((function(o){s.add(e(o,n,a,o,t,i))})):hn(t)&&t.forEach((function(o,r){s.set(r,e(o,n,a,r,t,i))}));var m=d?void 0:(u?l?Tt:_t:l?mt:ut)(t);return je(m||t,(function(o,r){m&&(o=t[r=o]),xe(s,r,e(o,n,a,r,t,i))})),s};const wn=function(e){return Rn(e,5)};var En=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))};const xn="#00FFFF",On="#008000";var kn=l(68972),Nn=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))};const An=e.React.forwardRef(((a,o)=>{const r=e.hooks.useTranslation(n),{widgetId:i,resetClick:s,networkDS:c,network:l,eventDS:u,eventLayer:d,routeInfo:f,table1Label:v,table2Label:p,onUpdateEventOid:m,networkLayer:h,onSubmit:b,flashGraphic:y,onUpdateToastMsgType:g,onUpdateToastMsg:D,onUpdateToastOpen:S,intl:I,selectedEventObjectId:j,lockAquired:R,conflictPreventionEnabled:w,onValidationChanged:E,revalidateRouteFromDataAction:x,routeInfoFromDataAction:O,resetEventOid:k,currentEventOid:N}=a,[A,M]=e.React.useState(),[L,_]=e.React.useState(),[T,F]=e.React.useState(!1),[C,P]=e.React.useState(""),[G,V]=e.React.useState(!0),[U,W]=e.React.useState(!1),[z,B]=e.React.useState(!1),[q,Q]=e.React.useState(null),[H,$]=e.React.useState(null),[Z,J]=e.React.useState();(0,kn.useImperativeHandle)(o,(()=>({onSubmitClicked:re}))),e.React.useEffect((()=>{x&&Y()}),[x]),e.React.useEffect((()=>{E(!T&&R)}),[T,R,E]),e.React.useEffect((()=>{(0,t.isDefined)(f)&&((0,t.isDefined)(f.selectedPoint)||j)&&Y()}),[f]),e.React.useEffect((()=>{K()}),[u,d]),e.React.useEffect((()=>{s&&K()}),[s]),e.React.useEffect((()=>{if(w){const e=Object.assign({},Z);(0,t.isDefined)(l)&&(e.networkId=[l.networkInfo.lrsNetworkId]),(0,t.isDefined)(d)&&(e.eventServiceLayerIds=[d.serviceId]),(0,t.isDefined)(f)&&(e.routeInfo=f),J(e)}}),[c,l,d,f]);const K=()=>{const e=X();M(e),_(e)},Y=()=>Nn(void 0,void 0,void 0,(function*(){let e=[];if((0,t.isDefined)(d)&&(0,t.isDefined)(u)&&(0,t.isDefined)(d.eventInfo)&&(0,t.isDefined)(d.eventInfo.attributeFields)&&((0,t.isDefined)(f)||(0,t.isDefined)(O))){const n=u,a=x?O:f,o=c,i=[];d.eventInfo.canSpanRoutes&&(yield(0,t.queryLineId)(o,h.networkInfo,a.lineId).then((e=>{e.forEach((e=>{const t=e.getFieldValue(h.networkInfo.routeIdFieldSchema.name);i.push(t)}))}))),(0,t.queryEventsByRouteIdOrEventObjectId)(h.networkInfo.xyTolerance,n,d,a,i,j).then((n=>{const o=u,i=(null==o?void 0:o.getLayerDefinition()).fields.find((e=>"esriFieldTypeOID"===e.type)).name;let s=!1,c=!1,l=!1;if(1===n.length){const r=n[0].attributes[i];P(r),m(r);const s=(null==o?void 0:o.layer).fields;d.eventInfo.attributeFields.forEach((o=>{if(o.enabled){const r=s.find((e=>e.name===o.field.name));if(r&&r.editable){let i,s=n[0].attributes[r.name];(0,t.isDate)(r.type)&&(0,t.isDefined)(s)?s=new Date(s):i=(0,t.isDate)(r.type)?(0,t.isDefined)(r.defaultValue)?new Date(r.defaultValue):null:r.defaultValue;const c={index:e.length,name:r.name,alias:r.alias,type:r.type,hasDomain:(0,t.isDefined)(r.domain),value:s,error:"",nullable:r.nullable,default:"number"==typeof i?Number(i).toString():i,length:r.length,editable:o.editable};e.push(c);const u=n[0].attributes[d.eventInfo.fromMeasureFieldName],f=n[0].attributes[d.eventInfo.toMeasureFieldName];if(d.eventInfo.canSpanRoutes){const e=n[0].attributes[d.eventInfo.routeIdFieldName],o=n[0].attributes[d.eventInfo.toRouteIdFieldName];a.routeId===e&&(0,t.isWithinTolerance)(a.selectedMeasure,u,h.networkInfo.mTolerance)||a.routeId===o&&(0,t.isWithinTolerance)(a.selectedMeasure,f,h.networkInfo.mTolerance)?(l=!0,B(!0)):(l=!1,B(!1))}else(0,t.isWithinTolerance)(a.selectedMeasure,u,h.networkInfo.mTolerance)||(0,t.isWithinTolerance)(a.selectedMeasure,f,h.networkInfo.mTolerance)?(l=!0,B(!0)):(l=!1,B(!1));Q(n[0].attributes[d.eventInfo.fromDateFieldName]),$(n[0].attributes[d.eventInfo.toDateFieldName])}}})),V(!1),c=!1,W(!1)}else if(n.length>1){for(let e=0;e<n.length;e++){const t=n[e].attributes[i];if(N===t){s=!0;break}}s||(e=X(),V(!1),c=!0,W(!0),P(null),k())}else a.isNearestCoordinate||(e=X(),V(!0),c=!1,W(!1),s=!1,P(null),k());if(s||a.isNearestCoordinate||(setTimeout((()=>{M(e)}),500),setTimeout((()=>{_(e)}),500)),c||l){const e=r(c?"multipleEventsFound":"unableToSplitAtStartOrEnd");g("error"),D(e),S(!0),setTimeout((()=>{S(!1)}),5e3)}}))}})),X=()=>{const e=[];if((0,t.isDefined)(d)&&(0,t.isDefined)(u)&&(0,t.isDefined)(d.eventInfo)&&(0,t.isDefined)(d.eventInfo.attributeFields)){const n=u,a=(null==n?void 0:n.layer).fields;d.eventInfo.attributeFields.forEach((n=>{if(n.enabled){const o=a.find((e=>e.name===n.field.name));if(o){let a;a=(0,t.isDate)(o.type)?(0,t.isDefined)(o.defaultValue)?new Date(o.defaultValue):null:o.defaultValue;const r={index:e.length,name:o.name,alias:o.alias,type:o.type,hasDomain:(0,t.isDefined)(o.domain),value:a,error:"",nullable:o.nullable,default:"number"==typeof a?Number(a).toString():a,length:o.length,editable:n.editable};e.push(r)}}}))}return e},ee=e=>e.findIndex((e=>e.error.length>0))>-1,te=e=>{const t=wn(e);M(t),F(ee(t))},ne=(e,n,a)=>{const o=wn(e);let i=!1;return o.forEach((e=>{let o;if(o=e.hasDomain?(0,t.validateRangeDomain)(e.value,e.name,u):((0,t.isDate)(e.type),(0,t.validateField)(e.value,e.name,u)),!n&&o.hasError){g("error");const n=d.useFieldAlias?e.alias:e.name;D((0,t.formatMessage)(I,"attributeError",{fieldValue:n,message:(0,t.formatMessage)(I,o.message),event1or2:r(a?"event1Label":"event2Label")})),S(!0),setTimeout((()=>{S(!1)}),5e3),i=!0,e.error=(0,t.formatMessage)(I,o.message)}})),i&&te(o),i},ae=()=>Nn(void 0,void 0,void 0,(function*(){var t;const n=u,a=n.getPopupInfo(),o=n.getLayerDefinition(),r=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter((e=>e.visible))),s=n.mergeQueryParams(null!==(t=n.getCurrentQueryParams())&&void 0!==t?t:{},{where:"1=1",sqlExpression:null}),c=Object.assign({returnGeometry:!0},s);yield n.load(c,{widgetId:i});const l=new e.DataRecordSetChangeMessage(i,e.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:n,name:n.id}]);e.MessageManager.getInstance().publishMessage(l)})),oe=n=>Nn(void 0,void 0,void 0,(function*(){const a={},o=ne(A,!1,!0),i=ne(A,o,!1);if(o||i)return;if(!(()=>{let e="";return(0,t.isDefined)(H)?e="Event must have null To Date.":(0,t.isDefined)(q)&&q>(0,t.getDateToUTC)(new Date(Date.now()))&&(e="Event must be active today."),!(e.length>0&&(g("error"),D(e),S(!0),setTimeout((()=>{S(!1)}),5e3),1))})())return;let s=!1;const l=f.selectedFromDate.getTime();if(s=!!((0,t.isDefined)(q)&&l<q||(0,t.isDefined)(H)&&l>H),G||U||z||s){const e=r(G||s?"noEventFound":U?"multipleEventsFound":"unableToSplitAtStartOrEnd");return g("error"),D(e),S(!0),void setTimeout((()=>{S(!1)}),5e3)}if((0,t.isDefined)(d)){const e={};A.forEach((n=>{const a=n.name;if((0,t.isDefined)(n.value)&&(0,t.isDate)(n.type)){const o=(0,t.getDateWithoutTZOffset)(n.value.valueOf(),u);e[a]=(0,t.getDateToUTC)(o)}else(0,t.isNumber)(n.type)?!(0,t.isDefined)(n.value)||isNaN(Number(n.value))?e[a]=null:e[a]=Number(n.value):e[a]=n.value}));const n={};if(L.forEach((a=>{const o=a.name;if((0,t.isDefined)(a.value)&&(0,t.isDate)(a.type)){const n=(0,t.getDateWithoutTZOffset)(a.value.valueOf(),u);e[o]=(0,t.getDateToUTC)(n)}else(0,t.isNumber)(a.type)?!(0,t.isDefined)(a.value)||isNaN(Number(a.value))?n[o]=null:n[o]=Number(a.value):n[o]=a.value})),a.attributes=e,a.attributes2=n,a.eventOid=C,a.routeId=f.routeId,a.measure=f.selectedMeasure,(0,t.isDefined)(f.selectedFromDate)){const e=(0,t.getDateWithoutTZOffset)(f.selectedFromDate.valueOf(),u);a.fromDate=e}else a.fromDate=f.selectedFromDate;a.measure=f.selectedMeasure}const v=u;yield function(n,a,o){return En(this,void 0,void 0,(function*(){const r=a.lrsUrl,i=`${r}/applyEdits`,s=yield e.SessionManager.getInstance().getSessionByUrl(r).getToken(r),c=[],l={id:a.serviceId,splitEvent:{objectId:o.eventOid,routeId:o.routeId,measure:o.measure,fromDate:o.fromDate?(0,t.getDateToUTC)(o.fromDate):null,attributes:o.attributes,attributes2:o.attributes2}};c.push(l);let u=n.getGDBVersion();u||(u="");const d={f:"json",token:s,gdbVersion:u,edits:c};return(0,t.requestService)({method:"GET",url:i,params:d}).then((e=>En(this,void 0,void 0,(function*(){const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))))}))}(v,d,a).then((e=>Nn(void 0,void 0,void 0,(function*(){if(e.success){if((0,t.isDefined)(d)&&(0,t.isDefined)(u)){const n=u;(0,t.queryEventsByEventObjectIds)(n,e.editResults[0].splitEventResult.objectIds).then((e=>{e.forEach(((e,n)=>Nn(void 0,void 0,void 0,(function*(){const a=e.geometry;(0,t.isDefined)(a)&&(0===n?(0,t.flash)(y,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(a),xn)):setTimeout((()=>Nn(void 0,void 0,void 0,(function*(){(0,t.flash)(y,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(a),xn))}))),5e3))}))))}))}g("success"),D(r("eventSplit")),S(!0),ae(),setTimeout((()=>Nn(void 0,void 0,void 0,(function*(){if(S(!1),w&&(0,t.isDefined)(n)){yield(0,t.tryReleaseLockOnDefault)(c,n);const e=Object.assign(Object.assign({},Z),{lockAction:t.LockAction.Clear});J(e)}else K(),b()}))),1e3)}else g("error"),D(e.message),S(!0),setTimeout((()=>{S(!1)}),5e3)}))))})),re=()=>{if(w){const e=Object.assign(Object.assign({},Z),{lockAction:t.LockAction.QueryAndAcquire});J(e)}else oe()};return(0,e.jsx)("div",{className:"split-event-edit-attributes__content",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .split-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-edit-attributes__action {
      height: 100%;
    }
  `},(0,e.jsx)("div",{className:"h-100"},w&&(0,e.jsx)(t.LockManagerComponent,{intl:I,featureDS:c,lockInfo:Z,showAlert:!1,conflictPreventionEnabled:w,onQueryAndAcquireComplete:(e,n,a)=>{const o=Object.assign(Object.assign({},e),{lockAction:t.LockAction.None});J(o),a&&oe(o)},onMessageClear:()=>{const e=Object.assign(Object.assign({},Z),{lockAction:t.LockAction.None});J(e),b()}}),(0,e.jsx)(t.AttributeTable,{tableIndex:0,collapable:!1,eventDS:u,eventLayer:d,fieldInfos:A,useAlias:!(0,t.isDefined)(d)||d.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=wn(A);a[n].value=e,a[n].error=t,M(a),F(ee(a))},onUpdateAll:te,tableLabel:v}),(0,e.jsx)(t.AttributeTable,{tableIndex:1,collapable:!1,eventDS:u,eventLayer:d,fieldInfos:L,useAlias:!(0,t.isDefined)(d)||d.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=wn(L);a[n].value=e,a[n].error=t,_(a)},onUpdateAll:e=>{const t=wn(e);_(t)},tableLabel:p})))}));function Mn(t){const{network:n,event:a,dataSourcesReady:o,onCreateNetworkDs:r,onCreateEventDs:i}=t,[s,c]=e.React.useState(null!=n?n:null),[l,u]=e.React.useState(null!=a?a:null),[d,f]=e.React.useState(!1),[v,p]=e.React.useState(!1);e.React.useEffect((()=>{n&&c(n)}),[n]),e.React.useEffect((()=>{a&&u(a)}),[a]),e.React.useEffect((()=>{o(d&&v)}),[o,v,d]);const m=e.React.useCallback((e=>{r(e)}),[r]),h=e.React.useCallback((e=>{i(e)}),[i]),b=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),y=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?p(!1):p(!0)}}),[p]),g=e.React.useCallback((()=>{f(!1)}),[f]),D=e.React.useCallback((()=>{p(!1)}),[p]);return(0,e.jsx)("div",null,s&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:s.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:g,onDataSourceCreated:m}),l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:l.useDataSource,onDataSourceInfoChange:y,onCreateDataSourceFailed:D,onDataSourceCreated:h}))}const Ln=function(){return E.Date.now()};var _n=/\s/;const Tn=function(e){for(var t=e.length;t--&&_n.test(e.charAt(t)););return t};var Fn=/^\s+/;const Cn=function(e){return e?e.slice(0,Tn(e)+1).replace(Fn,""):e};const Pn=function(e){return"symbol"==typeof e||Ne(e)&&"[object Symbol]"==F(e)};var Gn=/^[-+]0x[0-9a-f]+$/i,Vn=/^0b[01]+$/i,Un=/^0o[0-7]+$/i,Wn=parseInt;const zn=function(e){if("number"==typeof e)return e;if(Pn(e))return NaN;if(C(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=C(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Cn(e);var n=Vn.test(e);return n||Un.test(e)?Wn(e.slice(2),n?2:8):Gn.test(e)?NaN:+e};var Bn=Math.max,qn=Math.min;const Qn=function(e,t,n){var a,o,r,i,s,c,l=0,u=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function v(t){var n=a,r=o;return a=o=void 0,l=t,i=e.apply(r,n)}function p(e){var n=e-c;return void 0===c||n>=t||n<0||d&&e-l>=r}function m(){var e=Ln();if(p(e))return h(e);s=setTimeout(m,function(e){var n=t-(e-c);return d?qn(n,r-(e-l)):n}(e))}function h(e){return s=void 0,f&&a?v(e):(a=o=void 0,i)}function b(){var e=Ln(),n=p(e);if(a=arguments,o=this,c=e,n){if(void 0===s)return function(e){return l=e,s=setTimeout(m,t),u?v(e):i}(c);if(d)return clearTimeout(s),s=setTimeout(m,t),v(c)}return void 0===s&&(s=setTimeout(m,t)),i}return t=zn(t)||0,C(n)&&(u=!!n.leading,r=(d="maxWait"in n)?Bn(zn(n.maxWait)||0,t):r,f="trailing"in n?!!n.trailing:f),b.cancel=function(){void 0!==s&&clearTimeout(s),l=0,a=c=o=s=void 0},b.flush=function(){return void 0===s?i:h(Ln())},b};var Hn=1/0;const $n=function(e){return e?(e=zn(e))===Hn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Zn=function(e){var t=$n(e),n=t%1;return t==t?n?t-n:t:0};const Jn=function(e,t){for(var n=-1,a=null==e?0:e.length,o=Array(a);++n<a;)o[n]=t(e[n],n,e);return o};var Kn=x?x.prototype:void 0,Yn=Kn?Kn.toString:void 0;const Xn=function e(t){if("string"==typeof t)return t;if(Ce(t))return Jn(t,e)+"";if(Pn(t))return Yn?Yn.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};const ea=function(e){return null==e?"":Xn(e)};var ta=E.isFinite,na=Math.min;const aa=function(e){var t=Math[e];return function(e,n){if(e=zn(e),(n=null==n?0:na(Zn(n),292))&&ta(e)){var a=(ea(e)+"e").split("e"),o=t(a[0]+"e"+(+a[1]+n));return+((a=(ea(o)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var oa=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))};function ra(o){const r=e.hooks.useTranslation(n),{intl:i,widgetId:s,isReady:c,network:l,networkDS:u,routeInfo:d,jimuMapView:f,hoverGraphic:v,reset:p,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,clearPickedGraphic:y,onRouteInfoUpdated:g,measureLabelId:D}=o,[S,I]=e.React.useState(!1),[j,R]=e.React.useState(""),[w,E]=e.React.useState(!1),[x,O]=e.React.useState([]),[k,N]=e.React.useState(),A=e.React.useRef(null),M=e.React.useRef((e=>{})),L=e.React.useRef(null),_=e.React.useRef(null),T=e.React.useRef(null),F=e.React.useRef(null),C=e.React.useRef(null),P=e.React.useRef(!1),G=e.React.useRef(!1),[V,U]=e.React.useState(null),[W,z]=e.React.useState(!1),[B,q]=e.React.useState([]);e.React.useEffect((()=>{M.current=Qn(Q,400)}),[]),e.React.useEffect((()=>{p&&Y()}),[p]);const Q=e.hooks.useEventCallback((e=>{const n=l.useRouteName?l.routeNameFieldSchema.jimuName:l.routeIdFieldSchema.jimuName,a=(0,t.getSuggestions)(n,e,u);Promise.all([a]).then((e=>{const t=null==e?void 0:e[0];t&&q(t),L.current&&z(!0)})).catch((e=>{}))})),H=e=>{U(e),L.current=e},$=()=>{var e;null===(e=_.current)||void 0===e||e.focus(),Z(!0,!1)},Z=(e=!1,t=!0)=>{e||(G.current=!1)};e.React.useEffect((()=>{h&&(H(l.useRouteName?m.routeName:m.routeId),R(""),g(m),Y(),b())}),[h]),e.React.useEffect((()=>{(0,t.isDefined)(l)&&(U(""),R(""),I(!1),y())}),[l]),e.React.useEffect((()=>{(0,t.isDefined)(f)&&N(null==f?void 0:f.view.popupEnabled)}),[f]),e.React.useEffect((()=>{(0,t.isDefined)(l)&&l.useRouteName?U(d.routeName):U(d.routeId),isNaN(d.selectedMeasure)?R(""):R(d.selectedMeasure.toString())}),[l,d]),e.React.useEffect((()=>{isNaN(d.selectedMeasure)?R(""):R(d.selectedMeasure.toString())}),[l,d.selectedMeasure]);const J=(e,n)=>oa(this,void 0,void 0,(function*(){const n=(0,t.getNetworkOutFields)(l),a=l.useRouteName?e.attributes[n.routeNameFieldName]:"",o=e.attributes[n.routeIdFieldName],r=e.attributes[n.fromDateFieldName],i=e.attributes[n.toDateFieldName],s=e.geometry,c=(0,t.getRouteFromEndMeasures)(s),f=e.attributes[n.lineIdFieldName],v=e.attributes[n.lineNameFieldName];let p=new Date(Date.now());(0,t.isDefined)(i)&&p>i?p=(0,t.getDateWithTZOffset)(r,u):p.setHours(0,0,0,0);let m=new Date(Date.now());return(0,t.isDefined)(i)&&m>i?m=(0,t.getDateWithTZOffset)(i,u):m.setHours(0,0,0,0),(0,t.isDefined)(i)||(m=null),yield(0,t.QueryRouteMeasures)(u,l,c,r,o).then((e=>oa(this,void 0,void 0,(function*(){const n=Math.min(...e),c=Math.max(...e);return Object.assign(Object.assign({},d),{routeName:a,routeId:o,fromDate:(0,t.isDefined)(r)?(0,t.getDateWithTZOffset)(r,u):null,toDate:(0,t.isDefined)(i)?(0,t.getDateWithTZOffset)(i,u):null,selectedPolyline:s,fromMeasure:aa(n,l.measurePrecision),toMeasure:aa(c,l.measurePrecision),validRoute:!0,selectedFromDate:p,selectedToDate:m,lineName:v,lineId:f})}))))})),K=(e,n)=>(0,t.QueryMeasureOnRoute)(u,l,e.routeId,e.fromDate,j).then((t=>{if(t){return Object.assign(Object.assign({},e),{selectedPoint:t,selectedMeasure:parseFloat(n?e.selectedMeasure.toString():j)})}return Object.assign(Object.assign({},e),{selectedPoint:null})})),Y=()=>{setTimeout((()=>{_.current.select(),_.current.focus(),_.current.blur(),T.current.select(),T.current.focus(),T.current.blur()}),200)},X=e.React.useCallback(((e,t=!1)=>{g(e,t),C.current=null,Y()}),[g]),ee=e=>{R(e)},te=e.React.useCallback((e=>{e.length&&(E(!0),O(e))}),[]),ne=e.React.useCallback((e=>{(0,t.isDefined)(e)&&(g(e,!0),C.current=null,Y()),E(!1)}),[g]),ae=e.React.useCallback((()=>{E(!1)}),[]);return(0,e.jsx)("div",{className:"route-and-measure-form d-flex w-100 px-3"},l&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(a.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},l.useRouteName?(0,t.formatMessage)(i,"routeNameRequiredLabel"):(0,t.formatMessage)(i,"routeIdRequiredLabel")),(0,e.jsx)("div",{ref:A,className:"d-flex w-100"},(0,e.jsx)(a.TextInput,{"aria-label":l.useRouteName?(0,t.formatMessage)(i,"routeNameRequiredLabel"):(0,t.formatMessage)(i,"routeIdRequiredLabel"),type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!c,onBlur:()=>{F.current=setTimeout((()=>{P.current||z(!1),G.current||Z(!1)}),200)},value:V||"",ref:_,onChange:e=>{var t;C.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==n?void 0:n.length)>2;if(H(n),!a)return z(!1),!1;M.current(n)},checkValidityOnAccept:(e,n=!1)=>new Promise((a=>{setTimeout((()=>{C.current&&(e=C.current);const o=[],i=(0,t.queryRouteIdOrName)(e.trim(),l,u).then((a=>oa(this,void 0,void 0,(function*(){if((0,t.isDefined)(a)){if(!n&&(p||e===d.routeId||e===d.routeName))return{valid:!0};if(yield Promise.all(a.features.map((t=>oa(this,void 0,void 0,(function*(){const n=J(t,e);o.push(yield n)}))))),o.length>1&&!n)te(o);else{if(j.length>0||n&&!isNaN(d.selectedMeasure))return K(o[0],n).then((e=>(g(e,!0),{valid:!0})));g(o[0],!0)}return{valid:!0}}})))).catch((t=>{if(l.useRouteName){const t=Object.assign(Object.assign({},d),{routeName:e,validRoute:!1});g(t)}else{const t=Object.assign(Object.assign({},d),{routeId:e,validRoute:!1});g(t)}return e.length?{valid:!1,msg:r("routeNotFound")}:{valid:!0}}));a(i)}),200)}))}),V&&(0,e.jsx)(t.Intellisense,{isOpen:(W||(P.current=!1),W),reference:A,searchText:V,searchSuggestion:B,onRecordItemClick:(e,t)=>{if(t)return $(),!1;C.current=e,H(e)},id:s,searchInputRef:_}),(0,e.jsx)(t.RoutePicker,{type:"route-measure",active:S,networkDs:u,network:l,routeInfo:d,disabled:!c,jimuMapView:f,symbolColor:null,hoverGraphic:v,isFrom:!0,onActiveChange:()=>{const e=!S;I(e),e?f.view.popupEnabled=!1:setTimeout((()=>{f.view.popupEnabled=k}),800)},onRouteInfoUpdated:X,onMultiRouteSelect:te})),(0,e.jsx)(a.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},r(D||"measureWithUnits",{units:(0,t.GetUnits)(l.unitsOfMeasure,i)})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(a.TextInput,{ref:T,"aria-label":r("measureWithUnits",{units:(0,t.GetUnits)(l.unitsOfMeasure,i)}),className:"w-100",size:"sm",value:j,disabled:!c,onChange:e=>{ee(e.target.value)},checkValidityOnAccept:e=>oa(this,void 0,void 0,(function*(){let n=NaN;if(""===e){n=NaN;const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),ee(""),{valid:!0}}if(n=isNaN(Number(e))?(0,t.convertStationToNumber)(e):Number(e),isNaN(n)){y();const e=Object.assign(Object.assign({},d),{selectedMeasure:NaN,selectedPoint:null});return g(e),ee(""),{valid:!0}}if((0,t.isDefined)(d.selectedPolyline)){n=aa(n,l.measurePrecision);let e=Object.assign(Object.assign({},d),{selectedMeasure:n});if(n<d.fromMeasure)return g(e),{valid:!1,msg:r("measureLessError")};if(n>d.toMeasure)return g(e),{valid:!1,msg:r("measureGreaterError")};e.routeId.length?yield(0,t.QueryMapPointWithMeasureOnRoute)(u,l,e.routeId,e.fromDate,n.toString()).then((n=>{(0,t.isDefined)(n)&&(e=Object.assign(Object.assign({},e),{selectedPoint:n,isNearestCoordinate:!1}),g(e))})):g(e)}return{valid:!0}}))})),(0,e.jsx)(t.RoutePickerPopup,{isOpen:w,routeInfos:x,useRouteName:l.useRouteName,onRouteSelect:ne,onRouteSelectCancel:ae,measurePrecision:l.measurePrecision,isFrom:!0,jimuMapView:f,graphicLayer:v})))}var ia=l(99037);function sa(o){const r=e.hooks.useTranslation(n),{routeInfo:i,reset:s,onUpdateRouteInfo:c,hideDate:l,useRouteStartDate:u,revalidateRouteFromDataAction:d}=o,[f,v]=e.React.useState(!1),[p,m]=e.React.useState(!1),[h,b]=e.React.useState("idle"),[y,g]=e.React.useState("idle"),[D,S]=e.React.useState(""),[I,j]=e.React.useState("");e.React.useEffect((()=>{d&&(v(!1),m(!1),S(""),j(""))}),[d]),e.React.useEffect((()=>{v(u),m(u)}),[l]),e.React.useEffect((()=>{s&&(v(u),m(u),b("idle"),g("idle"),S(""),j(""))}),[s]),e.React.useEffect((()=>{let e=!1;const n=Object.assign({},i);"idle"===h&&S(""),"idle"===y&&j(""),(0,t.isDefined)(i.selectedFromDate)&&f&&i.selectedFromDate!==i.fromDate&&(n.selectedFromDate=i.fromDate,e=!0),p&&i.selectedToDate!==i.toDate&&(n.selectedToDate=i.toDate,e=!0),e&&c(n)}),[c,i,f,p]);const R=(e,n)=>{const a=e;if(!(0,t.isDefined)(a))return n?b("idle"):g("idle"),n?S(""):j(""),!0;let o=!0;return(0,t.isDefined)(i.fromDate)&&a<i.fromDate?(n?b("invalid"):g("invalid"),n?S(r("invalidFromDateBefore")):j(r("invalidToDateBefore")),o=!1,!1):(0,t.isDefined)(i.toDate)&&a>i.toDate?(n?b("invalid"):g("invalid"),n?S(r("invalidFromDateAfter")):j(r("invalidToDateAfter")),o=!1,!1):((0,t.isDefined)(i.selectedToDate)&&n&&(a>i.selectedToDate&&(b("invalid"),n?S(r("invalidDatesOrder")):j(r("invalidDatesOrder")),o=!1),I===r("invalidDatesOrder")?a<i.selectedToDate&&(g("idle"),j("")):I===r("invalidDatesSameDay")&&a!==i.selectedFromDate&&(g("idle"),j(""))),(0,t.isDefined)(i.selectedToDate)&&n&&a.getTime()===i.selectedToDate.getTime()&&(b("invalid"),n?S(r("invalidDatesSameDay")):j(r("invalidDatesSameDay")),o=!1),(0,t.isDefined)(i.selectedFromDate)&&(n||(a<i.selectedFromDate&&(g("invalid"),n?S(r("invalidDatesOrder")):j(r("invalidDatesOrder")),o=!1),D===r("invalidDatesOrder")?a>i.selectedFromDate&&(b("idle"),S("")):D===r("invalidDatesSameDay")&&a!==i.selectedFromDate&&(b("idle"),S("")))),(0,t.isDefined)(i.selectedFromDate)&&(n||a.getTime()!==i.selectedFromDate.getTime()||(g("invalid"),n?S(r("invalidDatesSameDay")):j(r("invalidDatesSameDay")),o=!1)),o&&(n?b("idle"):g("idle"),n?S(""):j("")),!0)};return(0,e.jsx)("div",{className:"split-event-date-form px-3 w-100",css:(0,t.getCalciteBasicTheme)()},!l&&(0,e.jsx)("div",null,(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},r("splitDateLabel")),(0,e.jsx)(a.Tooltip,{title:D},(0,e.jsx)(ia.CalciteInputDatePicker,{scale:"s",disabled:!!f||void 0,valueAsDate:i.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;R(n,!0);const a=Object.assign(Object.assign({},i),{selectedFromDate:n});c(a)}},status:h,placement:"top",overlayPositioning:"fixed"})),(0,e.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,e.jsx)(a.Checkbox,{checked:f,className:"mr-2",onChange:(e,t)=>{R(i.fromDate,!0),v(t)}}),r("useStartDateLabel"))))}var ca=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))};const la=()=>e.css`
    display: flex;
    flex-direction: column;

    .split-event-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event-route-selection-form__actions {
      height: 100%;
    }
  `;function ua(n){const{widgetId:a,network:o,networkDS:r,reset:i,jimuMapView:s,hoverGraphic:c,pickedGraphic:l,flashGraphic:u,onUpdateRouteInfo:d,intl:f,hideDate:v,useRouteStartDate:p,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,isReady:y,onValidationChanged:g}=n,[D,S]=e.React.useState((0,t.getInitialRouteInfoState)());e.React.useEffect((()=>{(0,t.isDefined)(o)&&!h&&(S((0,t.getInitialRouteInfoState)()),I())}),[o]),e.React.useEffect((()=>{i&&(S((0,t.getInitialRouteInfoState)()),I())}),[i]);const I=()=>{(0,t.isDefined)(l)&&l.removeAll()},j=(e,n)=>ca(this,void 0,void 0,(function*(){var a;(0,t.isDefined)(e.selectedPolyline)&&n&&(0,t.flash)(u,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(e.selectedPolyline),xn)),(0,t.isDefined)(e.selectedPoint)?(a=yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e.selectedPoint),On),(0,t.isDefined)(a)?(l.removeAll(),l.add(a)):I()):I()})),R=(e,t=!1)=>{S(e),d(e),j(e,t)},w=e.React.useCallback((()=>{var e;if(!D.validRoute)return!1;if(0===(null===(e=D.routeId)||void 0===e?void 0:e.length))return!1;if(isNaN(D.selectedMeasure))return!1;if(isNaN(D.fromMeasure))return!1;if(D.selectedMeasure<D.fromMeasure)return!1;if(!(0,t.isDefined)(D.selectedFromDate)&&!(0,t.isDefined)(D.selectedToDate))return!1;if((0,t.isDefined)(D.selectedFromDate)&&!(0,t.isDefined)(D.selectedToDate)){if((0,t.isDefined)(D.fromDate)&&D.selectedFromDate<D.fromDate)return!1;if((0,t.isDefined)(D.toDate)&&D.selectedFromDate>D.toDate)return!1}return!0}),[D]);return e.React.useEffect((()=>{g(w()&&y)}),[y,w,g]),(0,e.jsx)("div",{className:"split-event-route-selection-form__content d-flex",css:la()},(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(ra,{widgetId:a,isReady:y,network:o,networkDS:r,routeInfo:D,jimuMapView:s,hoverGraphic:c,reset:i,clearPickedGraphic:I,onRouteInfoUpdated:R,routeInfoFromDataAction:m,revalidateRouteFromDataAction:h,onResetDataAction:b,intl:f,measureLabelId:"splitMeasureWithUnits"})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(sa,{routeInfo:D,reset:i,onUpdateRouteInfo:R,hideDate:v,useRouteStartDate:p,revalidateRouteFromDataAction:h})))}function da(o){var r;const i=e.hooks.useTranslation(n),{widgetId:c,hideTitle:l,lrsLayers:u,eventLayers:d,networkLayers:f,defaultEvent:v,JimuMapView:p,hoverGraphic:m,pickedGraphic:h,flashGraphic:b,conflictPreventionEnabled:y,onClearGraphic:g,hideEvent:D,hideNetwork:S,hideDate:I,useRouteStartDate:j,intl:R,selectedEventLyr:w,selectedEventObjectId:E,routeInfoFromDataAction:x,onUpdateNetworkDS:O,onResetDataAction:k}=o,[N,A]=e.React.useState(null),[M,L]=e.React.useState(null),[_,T]=e.React.useState(null),[F,C]=e.React.useState(null),[P,G]=e.React.useState(!1),[V,U]=e.React.useState(!1),[W,z]=e.React.useState(null),[B,q]=e.React.useState(i("chooseEventLocationFromMap")),[Q,H]=e.React.useState(!1),[$,Z]=e.React.useState(),[J,K]=e.React.useState(""),[Y,X]=e.React.useState((0,t.getIntialLocksInfo)()),[ee,te]=e.React.useState(!y),[ne,ae]=e.React.useState(!0),[oe,re]=e.React.useState(!1),ie=e.React.useRef(null);e.React.useEffect((()=>{(0,t.isDefined)(E)&&(C(w),q(null==E?void 0:E.toString())),re((0,t.isDefined)(x))}),[x]),e.React.useEffect((()=>{(0,t.isDefined)(w)&&w.id!==(null==F?void 0:F.id)&&(0,t.isDefined)(w)&&pe(w.name)}),[w]);const se=e.React.useCallback((e=>{A(e),O(e)}),[A,O]),ce=e.React.useCallback((e=>{L(e)}),[L]),le=e.React.useCallback((()=>{G(!0)}),[G]),ue=e.React.useCallback((()=>{q(i("chooseEventLocationFromMap"))}),[i]),de=e.React.useCallback((()=>{g(),fe()}),[]),fe=e.React.useCallback((()=>{z((0,t.getInitialRouteInfoState)()),ve(t.LockAction.Clear,(0,t.getInitialRouteInfoState)()),ue(),U(!0),setTimeout((()=>{U(!1)}),800)}),[]);e.React.useEffect((()=>{if(F){const n=u.find((e=>e.serviceId===F.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&T((0,e.Immutable)(n))}else{const t=u.find((e=>e.name===v.name));C((0,e.Immutable)(t))}fe()}),[v,u,F,fe]),e.React.useEffect((()=>{ve(t.LockAction.None)}),[N,F,_]);const ve=(e=t.LockAction.None,n)=>{if(y){const a=Object.assign({},Y);(0,t.isDefined)(_)&&(a.networkId=[_.networkInfo.lrsNetworkId]),(0,t.isDefined)(F)&&(a.eventServiceLayerIds=[F.serviceId]),(0,t.isDefined)(n)&&(a.routeInfo=n),a.lockAction=e,X(a)}},pe=e.React.useCallback((n=>{const a=u.find((e=>e.name===n));if(a){const n=u.find((e=>e.serviceId===a.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&T((0,e.Immutable)(n)),C((0,e.Immutable)(a))}}),[u]),me=e.React.useCallback((n=>{const a=u.find((e=>e.name===n));(0,t.isDefined)(a)&&T((0,e.Immutable)(a))}),[u]),he=e.React.useMemo((()=>!!(P&&(0,t.isDefined)(p)&&(0,t.isDefined)(null==p?void 0:p.view))),[p,P]),be=e.React.useCallback(((e,t,n)=>{te(!!n),X(e)}),[]),ye=e.React.useCallback((e=>{ae(e)}),[]);return(0,e.jsx)("div",{className:"split-event h-100 d-flex",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;
    
    &.wrapped .split-event-form {
      height: 100%;
    }

    .split-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .split-event__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .split-event__toast {
      position: relative;
      top: 4%;
    }
    .split-event-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},!l&&(0,e.jsx)(s,null),(0,e.jsx)("div",{className:"split-event__content"},(0,e.jsx)(Mn,{network:_,event:F,dataSourcesReady:le,onCreateNetworkDs:se,onCreateEventDs:ce}),y&&(0,e.jsx)(t.LockManagerComponent,{intl:R,showAlert:!0,featureDS:N,lockInfo:Y,networkName:null===(r=null==_?void 0:_.networkInfo)||void 0===r?void 0:r.datasetName,conflictPreventionEnabled:y,onQueryAndAcquireComplete:be,onMessageClear:()=>{ve(t.LockAction.None)}}),!D&&(0,e.jsx)("div",null,(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},(0,t.formatMessage)(R,"eventRequiredLabel")),(0,e.jsx)(a.Select,{"aria-label":(0,t.formatMessage)(R,"eventRequiredLabel"),className:"w-100 px-3",size:"sm",value:F?F.name:"",disabled:1===d.length,onChange:e=>{pe(e.target.value)}},d.map(((t,n)=>(0,e.jsx)("options",{key:n,value:t},t))))),!S&&(0,e.jsx)("div",null,(0,e.jsx)(t.InlineEditableDropdown,{label:(0,t.formatMessage)(R,"networkRequiredLabel"),isDisabled:!0,defaultItem:(0,t.isDefined)(_)?_.name:"",listItems:f,onSelectionChanged:me})),(0,e.jsx)(ua,{widgetId:c,network:_?_.networkInfo:null,isReady:he&&(null==p?void 0:p.view.ready),reset:V,networkDS:N,jimuMapView:p,hoverGraphic:m,pickedGraphic:h,flashGraphic:b,onUpdateRouteInfo:e=>{z(e),ve(t.LockAction.QueryAndAcquire,e)},hideDate:I,useRouteStartDate:j,intl:R,routeInfoFromDataAction:x,revalidateRouteFromDataAction:oe,onResetDataAction:k,onValidationChanged:ye}),(0,e.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},i("eventOidLabel")+" *"),(0,e.jsx)("div",{className:"d-flex w-100 px-3"},(0,e.jsx)(a.Label,{size:"sm",className:"d-flex mb-0 w-100",style:{width:100,alignItems:"center"}},B)),(0,e.jsx)(An,{resetClick:V,ref:ie,intl:R,table1Label:i("event1Label"),table2Label:i("event2Label"),widgetId:c,networkDS:N,network:_,eventDS:M,eventLayer:F,routeInfo:W,onUpdateEventOid:e=>{q(e)},networkLayer:_,flashGraphic:b,onSubmit:de,onUpdateToastMsgType:Z,onUpdateToastMsg:K,onUpdateToastOpen:H,selectedEventObjectId:E,lockAquired:ee,conflictPreventionEnabled:y,onValidationChanged:ye,revalidateRouteFromDataAction:oe,routeInfoFromDataAction:x,resetEventOid:ue,currentEventOid:B})),(0,e.jsx)("div",{className:"split-event-footer w-100"},(0,e.jsx)("div",{className:"split-event-footer__action w-100 d-flex"},(0,e.jsx)(a.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500)"},onClick:fe},"Reset"),(0,e.jsx)(a.Tooltip,{title:i("splitLabel")},(0,e.jsx)("div",{className:"mt-auto ml-auto"},(0,e.jsx)(a.Button,{className:"active","aria-label":i("splitLabel"),size:"sm",disabled:!ne||!(0,t.isDefined)(B)||B===i("chooseEventLocationFromMap"),onClick:()=>{var e;null===(e=ie.current)||void 0===e||e.onSubmitClicked()}},i("splitLabel")))))),Q&&(0,e.jsx)("div",{className:"split-event__toast-container px-3 w-100"},(0,e.jsx)(a.Alert,{className:"split-event__toast w-100",type:$,text:J,closable:!0,withIcon:!0,open:Q,onClose:()=>{H(!1)}})))}var fa=l(59620),va=function(e,t,n,a){return new(n||(n=Promise))((function(o,r){function i(e){try{c(a.next(e))}catch(e){r(e)}}function s(e){try{c(a.throw(e))}catch(e){r(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}c((a=a.apply(e,t||[])).next())}))};const pa=e.css`
  background-color: var(--ref-palette-white);
`;class ma extends e.React.PureComponent{constructor(o){super(o),this.componentDidMount=()=>{var e,n,a,o;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedEventLyr)&&this.setState({selectedEventLyr:this.props.selectedEventLyr}),(null===(n=this.props.mutableStatePropsVersion)||void 0===n?void 0:n.selectedEventObjectId)&&this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),(null===(a=this.props.mutableStatePropsVersion)||void 0===a?void 0:a.selectedEventRouteId)&&this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),(null===(o=this.props.mutableStatePropsVersion)||void 0===o?void 0:o.selectedEventFromDate)&&this.setState({selectedEventFromDate:this.props.selectedEventFromDate});const r=(0,t.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:r})},this.onActiveViewChange=e=>va(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>va(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const n=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==n?void 0:n.isDataSourceSet)&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then((()=>n)).catch((e=>n)):Promise.resolve(n)})),this.getI18nMessage=(e,t)=>{const o=Object.assign({},n,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},t)},this.state={hideTitle:!1,jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(n,a){var o,r,i,s,c,l,u,d,f,v,p,m,h,b,y;a.jimuMapView!==this.state.jimuMapView&&(0,t.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const g=null===(i=null===(r=null===(o=(0,e.getAppStore)())||void 0===o?void 0:o.getState())||void 0===r?void 0:r.widgetsRuntimeInfo[this.props.id])||void 0===i?void 0:i.state;if(g===e.WidgetState.Opened||!g){let e=!1;(null===(s=this.props)||void 0===s?void 0:s.selectedEventLyr)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventLyr&&(null===(c=null==n?void 0:n.mutableStatePropsVersion)||void 0===c?void 0:c.selectedEventLyr)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedEventLyr)||(this.setState({selectedEventLyr:this.props.selectedEventLyr}),e=!0)),(null===(u=this.props)||void 0===u?void 0:u.selectedEventObjectId)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventObjectId&&(null===(d=null==n?void 0:n.mutableStatePropsVersion)||void 0===d?void 0:d.selectedEventObjectId)===(null===(f=this.props.mutableStatePropsVersion)||void 0===f?void 0:f.selectedEventObjectId)||(this.setState({selectedEventObjectId:this.props.selectedEventObjectId}),e=!0)),(null===(v=this.props)||void 0===v?void 0:v.selectedEventRouteId)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventRouteId&&(null===(p=null==n?void 0:n.mutableStatePropsVersion)||void 0===p?void 0:p.selectedEventRouteId)===(null===(m=this.props.mutableStatePropsVersion)||void 0===m?void 0:m.selectedEventRouteId)||(this.setState({selectedEventRouteId:this.props.selectedEventRouteId}),e=!0)),(null===(h=this.props)||void 0===h?void 0:h.selectedEventFromDate)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventFromDate&&(null===(b=null==n?void 0:n.mutableStatePropsVersion)||void 0===b?void 0:b.selectedEventRouteId)===(null===(y=this.props.mutableStatePropsVersion)||void 0===y?void 0:y.selectedEventRouteId)||(this.setState({selectedEventFromDate:this.props.selectedEventFromDate}),e=!0)),e&&this.setRouteInfoFromDataAction(this.props.selectedEventLyr,this.props.selectedEventRouteId,this.props.selectedEventFromDate)}}removeGraphicLayers(){(0,t.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,t.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,t.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,n;if((0,t.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const t=new fa.default({listMode:"hide"}),a=new fa.default({listMode:"hide"}),o=new fa.default({listMode:"hide"});null===(n=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===n||n.map.addMany([a,o,t]),this.setState({hoverGraphic:t}),this.setState({pickedGraphic:a}),this.setState({flashGraphic:o})}}clearGraphics(){(0,t.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,t.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,t.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}resetDataAction(){this.setState({selectedEventLyr:null,selectedEventObjectId:null,selectedEventRouteId:null,selectedEventFromDate:null,routeInfoFromDataAction:null})}setRouteInfoFromDataAction(n,a,o){if((0,t.isDefined)(n)&&(0,t.isDefined)(a)&&(0,t.isDefined)(o)){const r=this.props.config.lrsLayers.find((e=>e.serviceId===n.eventInfo.parentNetworkId));r&&r.layerType===t.LrsLayerType.network&&(0,t.queryRouteIdOrName)(a.trim(),(0,e.Immutable)(r.networkInfo),this.state.networkDataSourceFromDataAction,!1,!0,"",o,!0).then((e=>va(this,void 0,void 0,(function*(){(0,t.isDefined)(e)&&(yield Promise.all(e.features.map((e=>va(this,void 0,void 0,(function*(){const n=(0,t.getInitialRouteInfoState)(),a=yield(0,t.setRouteInfoByRouteIdOrName)(n,r.networkInfo,this.state.networkDataSourceFromDataAction,e);this.setState({routeInfoFromDataAction:a})}))))))}))))}}onUpdateNetworkDS(e){this.setState({networkDataSourceFromDataAction:e})}render(){var t;const{config:n,id:o}=this.props,{lrsLayers:s,networkLayers:c,eventLayers:l,defaultEvent:u,conflictPreventionEnabled:d,hideEvent:f,hideNetwork:v,hideDate:p,useRouteStartDate:m}=n,{jimuMapView:h}=this.state;return(null==c?void 0:c.length)&&(null==l?void 0:l.length)?(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-split-event surface-1 border-0",css:pa},(0,e.jsx)(i.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(da,{widgetId:o,hideTitle:this.state.hideTitle,lrsLayers:s,JimuMapView:h,eventLayers:l,networkLayers:c,defaultEvent:u,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:d,onClearGraphic:this.clearGraphics.bind(this),hideEvent:f,hideNetwork:v,hideDate:p,useRouteStartDate:m,intl:this.props.intl,selectedEventLyr:this.state.selectedEventLyr,selectedEventObjectId:this.state.selectedEventObjectId,selectedEventRouteId:this.state.selectedEventRouteId,selectedEventFromDate:this.state.selectedEventFromDate,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onUpdateNetworkDS:this.onUpdateNetworkDS.bind(this)})):(0,e.jsx)(a.WidgetPlaceholder,{icon:r(),widgetId:o,message:this.getI18nMessage("_widgetLabel")})}}ma.mapExtraStateProps=(e,t)=>{var n,a,o,r;return{selectedEventLyr:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedEventLyr,selectedEventObjectId:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedEventObjectId,selectedEventRouteId:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedEventRouteId,selectedEventFromDate:null===(r=null==t?void 0:t.mutableStateProps)||void 0===r?void 0:r.selectedEventFromDate}};const ha=ma;function ba(e){l.p=e}})(),u})())}}}));