System.register(["jimu-core","widgets/shared-code/lrs"],(function(e,t){var a={},r={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MutableStoreManager=e.MutableStoreManager,a.getAppStore=e.getAppStore},function(e){r.isDefined=e.isDefined}],execute:function(){e((()=>{"use strict";var e={79244:e=>{e.exports=a},47626:e=>{e.exports=r}},t={};function n(a){var r=t[a];if(void 0!==r)return r.exports;var o=t[a]={exports:{}};return e[a](o,o.exports,n),o.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{n.r(o),n.d(o,{default:()=>r});var e=n(79244),t=n(47626),a=function(e,t,a,r){return new(a||(a=Promise))((function(n,o){function i(e){try{d(r.next(e))}catch(e){o(e)}}function u(e){try{d(r.throw(e))}catch(e){o(e)}}function d(e){var t;e.done?n(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(i,u)}d((r=r.apply(e,t||[])).next())}))};class r extends e.AbstractDataAction{isSupported(r,n){return a(this,void 0,void 0,(function*(){var a;if(r.length>1)return!1;const o=r[0];if(1!==o.records.length)return!1;const{dataSource:u,records:d}=o,s=u.type===e.DataSourceTypes.FeatureLayer||u.type===e.DataSourceTypes.SceneLayer,c=u.isDataSourceSet,l=n!==e.DataLevel.Records,p=o.dataSource,f=(null==p?void 0:p.supportSpatialInfo)&&(null==p?void 0:p.supportSpatialInfo()),v=n===e.DataLevel.Records&&0===(null==d?void 0:d.length),S=!u.isInAppConfig()&&!s;if(c||l||v||S||!f)return!1;if(!u||u.getStatus()===e.DataSourceStatus.NotReady)return!1;const g=u;if(!(0,t.isDefined)(g))return!1;const y=i();let D,I;return(null===(a=null==y?void 0:y.widgets)||void 0===a?void 0:a[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===g.id&&(I=e,D=e.eventInfo)})),(!(0,t.isDefined)(I)||"NETWORK"!==I.layerType)&&!!D}))}onExecute(t,r){return a(this,void 0,void 0,(function*(){var a;const r=t[0],n=r.dataSource,o=i();let u;return(null===(a=null==o?void 0:o.widgets)||void 0===a?void 0:a[this.widgetId]).config.lrsLayers.forEach((e=>{e.id===n.id&&(u=e)})),setTimeout((()=>{e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventLyr",(0,e.Immutable)(u));const t=r.records[0].getData();e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventObjectId",t[r.dataSource.getSchema().idField]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventRouteId",t[u.eventInfo.routeIdFieldName]),e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"selectedEventFromDate",new Date(t[u.eventInfo.fromDateFieldName]))}),1e3),!0}))}}function i(){var t,a,r;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(r=(0,e.getAppStore)().getState())||void 0===r?void 0:r.appConfig}})(),o})())}}}));