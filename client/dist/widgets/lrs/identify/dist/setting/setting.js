System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/basic/list-tree","jimu-core/react","widgets/shared-code/lrs","jimu-ui/basic/color-picker"],(function(e,t){var i={},n={},o={},s={},a={},r={},l={};return{setters:[function(e){i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.ReactRedux=e.ReactRedux,i.SessionManager=e.SessionManager,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){n.Alert=e.Alert,n.Button=e.Button,n.Checkbox=e.Checkbox,n.NumericInput=e.NumericInput,n.Select=e.Select,n.Switch=e.Switch,n.TextInput=e.TextInput,n.defaultMessages=e.defaultMessages},function(e){o.MapWidgetSelector=e.MapWidgetSelector,o.SettingRow=e.SettingRow,o.SettingSection=e.SettingSection,o.SidePopper=e.SidePopper},function(e){s.List=e.List,s.TreeItemActionType=e.TreeItemActionType},function(e){a.Fragment=e.Fragment},function(e){r.errorMessageDelay=e.errorMessageDelay,r.formatMessage=e.formatMessage,r.getFeatureLayer=e.getFeatureLayer,r.isDefined=e.isDefined,r.requestService=e.requestService},function(e){l.ColorPicker=e.ColorPicker}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=a},14321:e=>{"use strict";e.exports=n},79298:e=>{"use strict";e.exports=o},54337:e=>{"use strict";e.exports=l},98640:e=>{"use strict";e.exports=s},47626:e=>{"use strict";e.exports=r}},t={};function d(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,d),o.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var u={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(u),d.d(u,{__set_webpack_public_path__:()=>F,default:()=>x});var e,t,i=d(79244),n=d(14321);!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(e||(e={})),function(e){e.measure="ROUTEANDMEASURE",e.coordinate="COORDINATE",e.locationOffset="LOCATIONOFFSET"}(t||(t={}));const o={blankStatus:"Select a map to import LRS networks",outputDsLabelPoint:"{label} point result",outputDsLabelLine:"{label} line result",layerConfig:"Layer configuration",importAll:"Import all",selectMap:"Select a Map widget",noNetworksTips:"The Map does not contain any LRS networks.",networkConfig:"Network configuration",networkLabel:"Label",routeIdentifier:"Identifier",routeId:"Route ID",routeName:"Route name",multiField:"Multi field",searchMethod:"Search methods",identifier:"Identifier",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",referent:"Referent",removeNetwork:"Remove",selectionHighlight:"Highlight",graphicWidth:"Width",resultSettings:"Result settings",resultsPageSize:"Page size",enablePoint:"Enable add point",enableLine:"Enable add line",routeFields:"Multi field route ID",routeFieldsConfig:"Route ID settings",selectionSettings:"Selection settings",results:"Results",sortResults:"Sort results by:",resultsAscending:"Ascending",resultsDescending:"Descending",noMapSelected:"Select Map",showEventInfo:"Show Event Information",eventAttrSet:"Event Attribute Set",configureFields:"Configure Fields",useFieldAlias:"Use Field Alias",loadLayers:"Load Layers",clearLayers:"Clear Layers",defaultNetwork:"Default Network",missingParentNetwork:"Missing Parent Network",lineAttributeToggle:"Show Line Events",lineAttributeSet:"Line Attribute Set",pointAttributeToggle:"Show Point Events",pointAttributeSet:"Point Attribute Set"};var s=d(79298),a=d(98640),r=d(68972),l=d(28996),c=d.n(l),p=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const g=e=>{const t=window.SVG,{className:n}=e,o=p(e,["className"]),s=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:s,src:c()},o)):i.React.createElement("svg",Object.assign({className:s},o))};var m=d(31027),h=d.n(m),f=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const v=e=>{const t=window.SVG,{className:n}=e,o=f(e,["className"]),s=(0,i.classNames)("jimu-icon jimu-icon-component",n);return t?i.React.createElement(t,Object.assign({className:s,src:h()},o)):i.React.createElement("svg",Object.assign({className:s},o))};function y(t){var r;const{widgetId:l,index:d,lrsLayer:u,onLayerChanged:c}=t,[p,g]=i.React.useState(null==u?void 0:u.name),m=function(e){const{widgetId:t,useDataSourceId:n}=e;return i.ReactRedux.useSelector((e=>{var i;let o;return o=window.jimuConfig.isBuilder?e.appStateInBuilder.appConfig:e.appConfig,(null!==(i=o.widgets[t].useDataSources)&&void 0!==i?i:[]).some((e=>e.dataSourceId===n))}))}({widgetId:l,useDataSourceId:null===(r=null==u?void 0:u.useDataSource)||void 0===r?void 0:r.dataSourceId}),h=i.hooks.useTranslation(o);i.React.useEffect((()=>{(null==u?void 0:u.name)&&p!==(null==u?void 0:u.name)&&g(null==u?void 0:u.name)}),[null==u?void 0:u.name]);const f=i.React.useCallback(((e,t,i=!1)=>{let n;n=null==t?u.without(e):u.set(e,t),c(d,n,i)}),[c,d,u]),v=i.React.useCallback(((e,t,i=!1)=>{const n=u.eventInfo.set(e,t),o=u.set("eventInfo",n);c(d,o,i)}),[c,d,u]),y=i.React.useCallback(((e,t,i=!1)=>{const n=u.networkInfo.set(e,t),o=u.set("networkInfo",n);c(d,o,i)}),[c,d,u]),S=i.React.useCallback((e=>{g(e.target.value)}),[]),b=i.React.useCallback((e=>{e.trim().length>0?f("name",e,!0):g(null==u?void 0:u.name)}),[null==u?void 0:u.name,f]),w=(t,i)=>{f("useFieldAlias",i,!1),u.layerType===e.network&&y("useFieldAlias",i)},I=t=>u.layerType===e.network?u.networkInfo.attributeFields[t].enabled:u.layerType===e.event?u.eventInfo.attributeFields[t].enabled:void 0,N=t=>{if(u.layerType===e.event){const e=u.eventInfo.attributeFields.asMutable({deep:!0});e[t].enabled=!e[t].enabled,v("attributeFields",e,!0)}else if(u.layerType===e.network){const e=u.networkInfo.attributeFields.asMutable({deep:!0});e[t].enabled=!e[t].enabled,y("attributeFields",e,!0)}},L={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:a.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:a.TreeItemActionType.RenderOverrideItemDragHandle},{name:a.TreeItemActionType.RenderOverrideItemDetailToggle},{name:a.TreeItemActionType.RenderOverrideItemTitle},{name:a.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},x=()=>(0,i.jsx)("div",{css:i.css`height: 100%; overflow:auto;`},u&&m&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(s.SettingSection,{role:"group"},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:S,onAcceptValue:b})),(0,i.jsx)(s.SettingRow,{flow:"no-wrap",label:h("useFieldAlias")},(0,i.jsx)(n.Switch,{"aria-label":h("useFieldAlias"),checked:u.networkInfo.useFieldAlias,onChange:w}))),(0,i.jsx)(s.SettingSection,{role:"group"},(0,i.jsx)(s.SettingRow,{flow:"wrap",label:h("configureFields")},(0,i.jsx)(a.List,Object.assign({className:"list-routeid-fields pt-2 w-100",itemsJson:Array.from(u.networkInfo.attributeFields).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:I(t),itemStateTitle:u.networkInfo.useFieldAlias?e.field.alias:e.field.name}))),renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:o,itemJsons:[{itemStateDetailVisible:s,itemStateDetailContent:a}]}=t.props,[r]=o,l=+r.itemKey;return a?(0,i.jsx)(n.Checkbox,{"aria-expanded":!!s,className:"jimu-tree-item__detail-toggle mr-2",checked:u.networkInfo.attributeFields[l].enabled,onClick:e=>{N(l)}}):null},dndEnabled:!0,onUpdateItem:(t,i)=>{const{itemJsons:n}=i.props,[,o]=n;var s;s=o.map((e=>e.itemStateDetailContent)),u.layerType===e.event?v("attributeFields",s,!0):u.layerType===e.network&&y("attributeFields",s,!0)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;N(+i.itemKey)}},L))))));return u.layerType===e.event?(0,i.jsx)("div",{className:"h-100"},(0,i.jsx)("div",{css:i.css`height: 100%; overflow:auto;`},u&&m&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(s.SettingSection,{role:"group"},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:p,onChange:S,onAcceptValue:b})))))):u.layerType===e.network?(0,i.jsx)("div",{className:"h-100"},x()):void 0}var S=d(47626),b=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const w=d(62838);function I(t){const{widgetId:l,layers:d=[],mapWidgetIds:u,portalUrl:c,theme:p,intl:m,onLayersAdded:h,onLayerRemoved:f,onClearAll:I,onLayerChanged:N,onLayerOrderChanged:L,onMapWidgetedChanged:x,updateAttributeSets:F}=t,j=i.hooks.useTranslation(o),C=i.React.useRef(null),[R,k]=i.React.useState(!1),[T,D]=i.React.useState(!1),[M,A]=i.React.useState(!1),[O,E]=i.React.useState(!1),[P,U]=i.React.useState(-1),B=()=>{const e=null==u?void 0:u[0],t=W(e),i=[];return t.forEach((e=>{var t;const n=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,o=K(n);i.includes(o)||i.push(o)})),i},W=e=>{var t,n,o,s,a;let r=[];if(!e)return r;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(n=(0,i.getAppStore)().getState())||void 0===n?void 0:n.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(s=(0,i.getAppStore)().getState())||void 0===s?void 0:s.appConfig;if(!l)return r;const d=null===(a=l.widgets[e])||void 0===a?void 0:a.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((e=>{const t=i.DataSourceManager.getInstance().getDataSource(e),n=null==t?void 0:t.getDataSourcesByType(i.DataSourceTypes.FeatureLayer);n&&(r=r.concat(n))}))}return r},_=(e,t)=>b(this,void 0,void 0,(function*(){let n=!1;const o=e[t];let s=null;const a=i.SessionManager.getInstance().getSessionByUrl(c),r=a&&a.token?a.token:"";return s=r?{f:"json",token:r}:{f:"json"},n=yield(0,S.requestService)({method:"GET",url:o,params:s}).then((e=>{if(e.hasOwnProperty("lrs")){const t=z(e);return J(o),t}return k(!0),setTimeout((()=>{k(!1)}),S.errorMessageDelay),!1})).catch((e=>!1)),n})),z=e=>{var t,i;const n=null==u?void 0:u[0],o=W(n),s=[],a=[],r=[],l=[],c=[],p=[];return o.forEach((e=>{p.push(e)})),p.forEach((e=>{})),null===(t=null==e?void 0:e.networkLayers)||void 0===t||t.forEach((e=>{p.forEach((t=>{var i;(null===(i=null==t?void 0:t.getLayerDefinition())||void 0===i?void 0:i.id)===e.id&&(r.push(e.id),a.push(e.id))}))})),null===(i=null==e?void 0:e.eventLayers)||void 0===i||i.forEach((e=>{p.forEach((t=>{var i;(null===(i=null==t?void 0:t.getLayerDefinition())||void 0===i?void 0:i.id)===e.id&&(l.push(e.id),a.push(e.id),"esriLRSPointEventLayer"===e.type&&c.push(e))}))})),o.forEach((e=>{var t,i;const n=null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url,o=null==e?void 0:e.getLayerDefinition(),r=-1===d.findIndex((t=>t.id===e.id)),l=a.findIndex((e=>e===o.id))>-1;n&&r&&l&&s.push({dataSourceId:e.id,mainDataSourceId:e.id,dataViewId:e.dataViewId,rootDataSourceId:null===(i=e.getRootDataSource())||void 0===i?void 0:i.id})})),0===a.length?(k(!0),setTimeout((()=>{k(!1)}),S.errorMessageDelay),!1):0===r.length?(D(!0),setTimeout((()=>{D(!1)}),S.errorMessageDelay),!1):s.length>0?(H(s,r,l),!0):0===s.length&&a.length>0||void 0},J=e=>b(this,void 0,void 0,(function*(){const t=e+"/attributeSets",n=i.SessionManager.getInstance().getSessionByUrl(c),o=n&&n.token?n.token:"";let s=null;s=o?{f:"json",token:o}:{f:"json"};const a={attributeSet:[]};yield(0,S.requestService)({method:"GET",url:t,params:s}).then((e=>{const t=null==e?void 0:e.attributeSets;(0,S.isDefined)(t)&&t.forEach((e=>{const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};a.attributeSet.push(t)})),F(a)}))})),H=(e,t,n)=>b(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const o=yield(()=>b(this,void 0,void 0,(function*(){let o=[];const s=[];return e.forEach((e=>{s.push(i.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,i.Immutable)(e)).then((s=>b(this,void 0,void 0,(function*(){const a=null==s?void 0:s.getLayerDefinition(),r=t.findIndex((e=>e===a.id))>-1,l=n.findIndex((e=>e===a.id))>-1,d=null==s?void 0:s.url,u=K(d);let c="";r?c=u+"/networkLayers/"+a.id:l&&(c=u+"/eventLayers/"+a.id),c.length>0&&(yield q(s,e,c,u,r,l).then((e=>(e&&(o=o.concat([(0,i.Immutable)(e)])),o))))})))))})),yield Promise.all(s),o})))();h(o)})),q=(t,n,o,s,a,r)=>(0,S.getFeatureLayer)(t).then((l=>{const d=i.SessionManager.getInstance().getSessionByUrl(c),u=d&&d.token?d.token:"";let p=null;return p=u?{f:"json",token:u}:{f:"json"},new Promise(((d,u)=>{(0,S.requestService)({method:"POST",url:o,params:p}).then((u=>{u||d(null);const c=u.type;if("esriLRSNetworkLayer"===c||"esriLRSPointEventLayer"===c||"esriLRSLinearEventLayer"===c){const c={},p={},g=null==t?void 0:t.getSchema(),m=(null==g?void 0:g.fields)?Object.values(null==g?void 0:g.fields):[],h=u.id;let f=e.nonLrs;if(a){f=e.network,c.networkUrl=o;const t=u.routeIdFieldName;c.routeIdFieldSchema=m.find((e=>t===e.name));const i=u.routeNameFieldName;c.routeNameFieldSchema=m.find((e=>i===e.name));const n=u.fromDateFieldName;c.fromDateFieldSchema=m.find((e=>n===e.name));const s=u.toDateFieldName;c.toDateFieldSchema=m.find((e=>s===e.name)),c.measurePrecision=u.measurePrecision,c.unitsOfMeasure=u.unitsOfMeasure,c.supportsLines=u.supportsLines,c.lineIdFieldName=u.lineIdFieldName,c.lineNameFieldName=u.lineNameFieldName,c.lineOrderFieldName=u.lineOrderFieldName;const a=null==l?void 0:l.objectIdField,r=null==l?void 0:l.globalIdField,d=null==l?void 0:l.editFieldsInfo,p=m.find((e=>"Shape__Length"===e.name)),g=[];m.forEach((e=>{var t,i,n,o,s,l;let u=!0;const c=null===(t=null==e?void 0:e.name)||void 0===t?void 0:t.toLocaleLowerCase();c!==(null==r?void 0:r.toLocaleLowerCase())&&c!==(null==a?void 0:a.toLocaleLowerCase())&&c!==(null===(i=d.creationDateField)||void 0===i?void 0:i.toLocaleLowerCase())&&c!==(null===(n=d.creatorField)||void 0===n?void 0:n.toLocaleLowerCase())&&c!==(null===(o=d.editDateField)||void 0===o?void 0:o.toLocaleLowerCase())&&c!==(null===(s=d.editorField)||void 0===s?void 0:s.toLocaleLowerCase())&&c!==(null===(l=null==p?void 0:p.name)||void 0===l?void 0:l.toLocaleLowerCase())||(u=!1);const m={field:e,enabled:u,editable:!0,description:""};g.push(m)})),c.attributeFields=g;const h=[],v=u.eventLayers;v.length>0&&v.forEach((e=>{h.push(e.name)})),c.eventLayers=h}else if(r){f=e.event,p.eventUrl=o,p.fromDateFieldName=u.fromDateFieldName,p.toDateFieldName=u.toDateFieldName,p.derivedFromMeasureFieldName=u.derivedFromMeasureFieldName,p.derivedRouteIdFieldName=u.derivedRouteIdFieldName,p.derivedRouteNameFieldName=u.derivedRouteNameFieldName,p.derivedToMeasureFieldName=u.derivedToMeasureFieldName,p.fromReferentLocationFieldName=u.fromReferentLocationFieldName,p.fromReferentMethodFieldName=u.fromReferentMethodFieldName,p.fromReferentOffsetFieldName=u.fromReferentOffsetFieldName,p.toReferentLocationFieldName=u.toReferentLocationFieldName,p.toReferentMethodFieldName=u.toReferentMethodFieldName,p.toReferentOffsetFieldName=u.toReferentOffsetFieldName,p.locErrorFieldName=u.locErrorFieldName,p.eventIdFieldName=u.eventIdFieldName,p.routeIdFieldName=u.routeIdFieldName,p.routeNameFieldName=u.routeNameFieldName,p.fromMeasureFieldName=u.fromMeasureFieldName,p.toRouteIdFieldName=u.toRouteIdFieldName,p.toRouteNameFieldName=u.toRouteNameFieldName,p.toMeasureFieldName=u.toMeasureFieldName,p.canSpanRoutes=u.canSpanRoutes;const t=[p.fromDateFieldName,p.toDateFieldName,p.derivedFromMeasureFieldName,p.derivedRouteIdFieldName,p.derivedRouteNameFieldName,p.derivedToMeasureFieldName,p.fromReferentLocationFieldName,p.fromReferentMethodFieldName,p.fromReferentOffsetFieldName,p.toReferentLocationFieldName,p.toReferentMethodFieldName,p.toReferentOffsetFieldName,p.locErrorFieldName,p.eventIdFieldName,p.routeIdFieldName,p.routeNameFieldName,p.fromMeasureFieldName,p.toRouteIdFieldName,p.toRouteNameFieldName,p.toMeasureFieldName],i=null==l?void 0:l.objectIdField,n=null==l?void 0:l.globalIdField,s=null==l?void 0:l.editFieldsInfo,a=[i,n];s&&(a.push(s.creationDateField),a.push(s.creatorField),a.push(s.editDateField),a.push(s.editorField));const r=t.map((e=>(0,S.isDefined)(e)?e.toLowerCase():e)),d=a.map((e=>(0,S.isDefined)(e)?e.toLowerCase():e));p.lrsFields=m.filter((e=>r.includes(e.name.toLowerCase())));const c=m.filter((e=>!r.includes(e.name.toLowerCase())&&!d.includes(e.name.toLowerCase()))),g=[];c.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};g.push(t)})),p.attributeFields=g,p.parentNetworkId=u.parentNetwork.id}const v={id:t.id,serviceId:h,name:t.getLabel(),lrsUrl:s,useDataSource:n,layerType:f,networkInfo:c||void 0,eventInfo:p||void 0,useFieldAlias:!0},y=(0,i.Immutable)(Object.assign({},v,{layerInfo:v}));d(y)}else d(null)}))}))})),K=e=>{let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"},V=i.React.useCallback((()=>{U(-1)}),[]),$=i.css`
    border-bottom: 1px 
    solid var(--ref-palette-neutral-700);
        
    &.h-100 > 
    .jimu-widget-setting--section {
      border-bottom: none;
    }

    .error-tips {
      font-style: italic;
      font-size: 12px;
      color: var(--ref-palette-neutral-1000);
      margin-top: 5px;
      .display-error-tips {
        width: calc(100% - 20px);
        margin: 0 4px;
        color: ${p.sys.color.error.main};
      }
    }

    .empty-placeholder {
      display: flex;
      flex-flow: column;
      justify-content: center;
      height: calc(100% - 255px);
      overflow: hidden;
      .empty-placeholder-inner {
        padding: 0px 20px;
        flex-direction: column;
        align-items: center;
        display: flex;

        .empty-placeholder-text {
          color: ${p.ref.palette.neutral[1e3]};
          font-size: ${i.polished.rem(14)};
          margin-top: 16px;
          text-align: center;
        }
        .empty-placeholder-icon {
          color: ${p.ref.palette.neutral[800]};
        }
      }
    }
  `,G={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:a.TreeItemActionType.RenderOverrideItem,children:[{name:a.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:a.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:a.TreeItemActionType.RenderOverrideItemBody,children:[{name:a.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:a.TreeItemActionType.RenderOverrideItemDragHandle},{name:a.TreeItemActionType.RenderOverrideItemTitle},{name:a.TreeItemActionType.RenderOverrideItemDetailToggle},{name:a.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,i.jsx)("div",{ref:C,css:$,className:(0,i.classNames)("d-flex flex-column",{"h-100":0===d.length})},(0,i.jsx)(s.SettingSection,{className:"border-0"},(0,i.jsx)(r.Fragment,null,(0,i.jsx)(s.SettingRow,{label:j("selectMap")}),(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(s.MapWidgetSelector,{onSelect:e=>{x(e)},useMapWidgetIds:u})),(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(n.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:()=>{if(k(!1),E(!1),D(!1),A(!1),void 0===(null==u?void 0:u[0]))A(!0),setTimeout((()=>{A(!1)}),S.errorMessageDelay);else{const e=B();e.length>1?(E(!0),setTimeout((()=>{E(!1)}),S.errorMessageDelay)):e.length>0?_(e,0).then((e=>{e||(k(!0),setTimeout((()=>{k(!1)}),S.errorMessageDelay))})):(k(!0),setTimeout((()=>{k(!1)}),S.errorMessageDelay))}},title:j("loadLayers"),"aria-label":j("loadLayers")},j("loadLayers"))),d&&d.length>0&&(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(n.Button,{role:"button",className:"w-100 text-dark",type:"primary",onClick:I,title:j("clearLayers"),"aria-label":j("clearLayers")},j("clearLayers"))),R&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(r.Fragment,null,(0,i.jsx)(g,{color:p.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(m,"noLrsLayersTips")))),M&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(r.Fragment,null,(0,i.jsx)(g,{color:p.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(m,"noMapSelectedTips")))),T&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(r.Fragment,null,(0,i.jsx)(g,{color:p.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(m,"noNetworkLayersTips")))),O&&(0,i.jsx)("div",{className:"text-break error-tips d-flex align-items-center"},(0,i.jsx)(r.Fragment,null,(0,i.jsx)(g,{color:p.sys.color.error.main}),(0,i.jsx)("div",{className:"display-error-tips"},(0,S.formatMessage)(m,"multipleServicesTips")))))),(0,i.jsx)(s.SettingSection,{className:(0,i.classNames)("pt-0 border-0",{"h-100":0===d.length})},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)("div",{className:"setting-ui-unit-list w-100"},(0,i.jsx)(a.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:d.map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:P===t,itemStateTitle:e.name,itemStateCommands:[{label:"remove",iconProps:()=>({icon:w,size:12}),action:({data:e})=>{const{itemJsons:[t]}=e,i=+t.itemKey;i===P&&V(),f(i)}}]}))),renderOverrideItemDetailToggle:(t,o)=>{const{itemJsons:s}=o.props,[a]=s;return(t=>{const i=d.at(t);return!(0,S.isDefined)(i)||!(0,S.isDefined)(i.eventInfo)||i.layerType!==e.event||d.findIndex((e=>e.serviceId===i.eventInfo.parentNetworkId))>-1})(+a.itemKey)?"":(0,i.jsx)(n.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:j("missingParentNetwork")})},dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[,n]=i;L(n.map((e=>e.itemStateDetailContent)))},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;var n;n=+i.itemKey,U(n===P?-1:n)}},G)),d.length===P&&(0,i.jsx)(a.List,Object.assign({className:"setting-ui-unit-list-new",css:i.css`.jimu-tree-item__detail-toggle { display: none !important; }`,itemsJson:[{name:"......"}].map((e=>({itemStateDetailContent:e,itemKey:`${P}`,itemStateChecked:!0,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1},G)))),0===d.length&&(0,i.jsx)("div",{className:"empty-placeholder w-100 h-100"},(0,i.jsx)("div",{className:"empty-placeholder-inner"},(0,i.jsx)("div",{className:"empty-placeholder-icon"},(0,i.jsx)(v,{size:48})),(0,i.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:j("blankStatus")}}))),(0,i.jsx)(s.SidePopper,{isOpen:P>=0&&!i.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:V,position:"right",trigger:null==C?void 0:C.current,title:j("layerConfig")},(0,i.jsx)(y,{widgetId:l,index:P,total:d.length,lrsLayer:d[P],onLayerChanged:N}))))}var N=d(54337);const L="#00FFFF";class x extends i.React.PureComponent{constructor(t){super(t),this.componentDidMount=()=>{const e=this.props.config.lrsLayers,t=this.getNetworkLayers(e);this.setState({defaultNetworkLayer:this.getDefaultNetwork(t)})},this.getDefaultNetwork=(e,t)=>{var i;let n=null===(i=e[0])||void 0===i?void 0:i.serviceId;return this.props.config.defaultNetworkLayer&&t&&(n=this.props.config.defaultNetworkLayer),setTimeout((()=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetworkLayer",n)})}),2e3),n},this.updateWidgetJson=(...e)=>{const[t,...i]=e,n=Object.assign(Object.assign({id:this.props.id},t));this.props.onSettingChange(n,...i)},this.updateConfigForOptions=(...t)=>{let i=null,n=t.reduce(((e,[t,n,o])=>("lrsLayers"===t&&(null==o?void 0:o.dsUpdateRequired)&&(i=this.getAllDataSources(n)),e.set(t,n))),this.props.config);const o=[],s=[];if(n.lrsLayers.forEach((t=>{t.layerType===e.network?o.push(t.name):t.layerType===e.event&&s.push(t.name)})),n=n.setIn(["networkLayers"],o),n=n.setIn(["eventLayers"],s),0===n.lrsLayers.length){const e={index:-1,name:""};n=n.setIn(["defaultEvent"],e)}i?this.updateWidgetJson({config:n,useDataSources:Object.values(i.useDataSourceMap)}):this.updateWidgetJson({config:n})},this.updateAttributeSets=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("attributeSets",e)})},this.getAllDataSources=e=>(0,i.Immutable)(e).asMutable({deep:!0}).reduce(((e,t)=>{const i=t.useDataSource,n=i.dataSourceId;return e.useDataSourceMap[n]=e.useDataSourceMap[n]||i,e.useDataSourceMap[n].fields=i.fields,e}),{useDataSourceMap:{}}),this.addLayers=(e,t=!0)=>{var n,o,s;let a=null!==(n=this.props.config.lrsLayers)&&void 0!==n?n:(0,i.Immutable)([]),r=null!==(s=null===(o=this.props.config.lrsLayers)||void 0===o?void 0:o.length)&&void 0!==s?s:0;e.forEach((e=>{a=i.Immutable.set(a,r,e),r++})),this.updateConfigForOptions(["lrsLayers",a,{dsUpdateRequired:t}])},this.updateLayerItem=(e,t,n=!1)=>{var o;let s=null!==(o=this.props.config.lrsLayers)&&void 0!==o?o:(0,i.Immutable)([]);s=i.Immutable.set(s,e,t),this.updateConfigForOptions(["lrsLayers",s,{dsUpdateRequired:n}])},this.reOrderLayers=e=>{this.updateConfigForOptions(["lrsLayers",e])},this.removeAllLayers=(e=!1)=>{const t={dsUpdateRequired:e};this.updateConfigForOptions(["lrsLayers",[],t])},this.removeLayer=(e,t=!1)=>{const i={dsUpdateRequired:t},n=this.props.config.lrsLayers.asMutable({deep:!0});n.splice(e,1),this.updateConfigForOptions(["lrsLayers",n,i]);const o=n.find((e=>(null==e?void 0:e.serviceId)===this.state.defaultNetworkLayer));let s=null;const a=this.getNetworkLayers(n);s=o?this.getDefaultNetwork(a):this.getDefaultNetwork(a,!1),o||this.setState({defaultNetworkLayer:s})},this.mapWidgetIdUpdated=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.removeAllLayers()},this.getI18nMessage=(e,t)=>{const i=Object.assign({},o,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.handleHighlishStyleChange=e=>{const t=this.props.config.highlightStyle.asMutable({deep:!0});"string"==typeof e&&(t.routeColor=e),"number"==typeof e&&(t.width=e),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",t)})},this.handleLineEventToggleChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("lineEventToggle",t)})},this.handlePointEventToggleChange=(e,t)=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("pointEventToggle",t)})},this.handleDefaultAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultAttributeSet",e)})},this.handleDefaultNetworkChange=e=>{this.setState({defaultNetworkLayer:e}),this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultNetworkLayer",e)})},this.handleDefaultLineAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultLineAttrbuteSet",e)})},this.handleDefaultPointAttributeSetChanged=e=>{this.props.onSettingChange({id:this.props.id,config:this.props.config.set("defaultPointAttributeSet",e)})},this.getDefaultLineAttributeSet=()=>{if(this.props.config.defaultLineAttrbuteSet)return this.props.config.defaultLineAttrbuteSet;{const e=this.getLineAttributeSet();return this.handleDefaultLineAttributeSetChanged(null==e?void 0:e[0].title),null==e?void 0:e[0].title}},this.getDefaultPointAttributeSet=()=>{if(this.props.config.defaultPointAttributeSet)return this.props.config.defaultPointAttributeSet;{const e=this.getPointAttributeSet();return this.handleDefaultPointAttributeSetChanged(null==e?void 0:e[0].title),null==e?void 0:e[0].title}},this.getNetworkLayers=e=>{const t=[];return e.forEach((e=>{var i;(null==e?void 0:e.networkInfo)&&(null===(i=null==e?void 0:e.networkInfo)||void 0===i?void 0:i.networkUrl)&&t.push(e)})),t},this.getLineAttributeSet=()=>{const e=this.props.config.attributeSets.attributeSet,t=[];return null==e||e.forEach((e=>{e.isPoint||t.push(e)})),t},this.getPointAttributeSet=()=>{const e=this.props.config.attributeSets.attributeSet,t=[];return null==e||e.forEach((e=>{e.isPoint&&t.push(e)})),t},this.state={showLayerPanel:!1,dsToRemove:null,defaultNetworkLayer:null}}componentDidUpdate(e,t,i){if(!this.state.defaultNetworkLayer){const e=this.props.config.lrsLayers,t=this.getNetworkLayers(e);this.setState({defaultNetworkLayer:this.getDefaultNetwork(t)})}}getHighlightStyleConfig(){if(this.props.config.highlightStyle)return this.props.config.highlightStyle;{const e=this.getDefaultStyleConfig();return this.props.onSettingChange({id:this.props.id,config:this.props.config.set("highlightStyle",e)}),e}}getDefaultStyleConfig(){return{routeColor:L,width:3}}render(){var e,t,o,a;const{config:r}=this.props,l=this.props.config.lrsLayers,d=this.getNetworkLayers(l),u=this.getLineAttributeSet(),c=this.getPointAttributeSet();return(0,i.jsx)("div",{className:"setting-add-point-event h-100"},(0,i.jsx)("div",{className:"jimu-widget-setting setting-add-point-event__setting-content h-100"},(0,i.jsx)(I,{intl:this.props.intl,widgetId:this.props.id,layers:this.props.config.lrsLayers,mapWidgetIds:this.props.useMapWidgetIds,portalUrl:this.props.portalUrl,theme:this.props.theme,onLayersAdded:this.addLayers,onLayerChanged:this.updateLayerItem,onClearAll:this.removeAllLayers,onLayerRemoved:this.removeLayer,onLayerOrderChanged:this.reOrderLayers,onMapWidgetedChanged:this.mapWidgetIdUpdated,updateAttributeSets:this.updateAttributeSets}),(null==d?void 0:d.length)>0&&(0,i.jsx)(s.SettingSection,{role:"group",title:this.getI18nMessage("defaultNetwork"),"aria-label":this.getI18nMessage("defaultNetwork")},(0,i.jsx)(n.Select,{defaultValue:this.state.defaultNetworkLayer,value:this.state.defaultNetworkLayer,onChange:e=>{this.handleDefaultNetworkChange(e.target.value)},"aria-label":this.getI18nMessage("defaultNetwork")},null==d?void 0:d.map((e=>(0,i.jsx)("option",{value:e.serviceId},e.name))))),(null===(e=null==r?void 0:r.lrsLayers)||void 0===e?void 0:e.length)>0&&(0,i.jsx)("div",null,(0,i.jsx)(s.SettingSection,{role:"group",title:this.getI18nMessage("selectionSettings"),"aria-label":this.getI18nMessage("selectionSettings")},(0,i.jsx)(s.SettingRow,{label:this.getI18nMessage("selectionHighlight")},(0,i.jsx)(N.ColorPicker,{color:(null===(o=null===(t=this.props.config)||void 0===t?void 0:t.highlightStyle)||void 0===o?void 0:o.routeColor)?this.props.config.highlightStyle.routeColor:L,value:this.getHighlightStyleConfig().routeColor||this.props.theme2.sys.color.surface.paper||"",onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("selectionHighlight")})),(0,i.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("graphicWidth")},(0,i.jsx)(n.NumericInput,{size:"sm",value:this.getHighlightStyleConfig().width||3,precision:1,min:0,max:15,step:.1,onChange:this.handleHighlishStyleChange,"aria-label":this.getI18nMessage("graphicWidth"),className:"w-100"}))),(null==r?void 0:r.eventLayers)&&(null===(a=null==r?void 0:r.eventLayers)||void 0===a?void 0:a.length)>0&&(0,i.jsx)(s.SettingSection,null,(0,i.jsx)(s.SettingRow,{flow:"no-wrap",label:this.getI18nMessage("lineAttributeToggle")},(0,i.jsx)(n.Switch,{"aria-label":this.getI18nMessage("lineAttributeToggle"),checked:this.props.config.lineEventToggle,onChange:this.handleLineEventToggleChange})),this.props.config.lineEventToggle&&(0,S.isDefined)(u)&&(0,i.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("lineAttributeSet")},(0,i.jsx)(n.Select,{"aria-label":this.getI18nMessage("lineAttributeSet"),size:"sm",value:this.getDefaultLineAttributeSet(),onChange:e=>{this.handleDefaultLineAttributeSetChanged(e.target.value)}},null==u?void 0:u.map(((e,t)=>(0,i.jsx)("option",{key:t,value:e.title},e.title))))),(0,i.jsx)(s.SettingRow,{flow:"no-wrap",label:this.getI18nMessage("pointAttributeToggle")},(0,i.jsx)(n.Switch,{"aria-label":this.getI18nMessage("pointAttributeToggle"),checked:this.props.config.pointEventToggle,onChange:this.handlePointEventToggleChange})),this.props.config.pointEventToggle&&(0,S.isDefined)(c)&&(0,i.jsx)(s.SettingRow,{flow:"wrap",label:this.getI18nMessage("pointAttributeSet")},(0,i.jsx)(n.Select,{"aria-label":this.getI18nMessage("pointAttributeSet"),size:"sm",value:this.getDefaultPointAttributeSet(),onChange:e=>{this.handleDefaultPointAttributeSetChanged(e.target.value)}},null==c?void 0:c.map(((e,t)=>(0,i.jsx)("option",{key:t,value:e.title},e.title)))))))))}}function F(e){d.p=e}})(),u})())}}}));