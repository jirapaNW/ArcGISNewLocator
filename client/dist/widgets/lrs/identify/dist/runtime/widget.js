System.register(["jimu-core","jimu-ui","jimu-arcgis","esri/layers/GraphicsLayer","widgets/shared-code/lrs","esri/TimeExtent","esri/geometry/geometryEngine","calcite-components"],(function(e,t){var i={},l={},o={},n={},a={},r={},d={},s={};return{setters:[function(e){i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceStatus=e.DataSourceStatus,i.React=e.React,i.css=e.css,i.hooks=e.hooks,i.jsx=e.jsx},function(e){l.Button=e.Button,l.CollapsablePanel=e.CollapsablePanel,l.FloatingPanel=e.FloatingPanel,l.Icon=e.Icon,l.Label=e.Label,l.Pagination=e.Pagination,l.Select=e.Select,l.WidgetPlaceholder=e.WidgetPlaceholder,l.defaultMessages=e.defaultMessages},function(e){o.JimuMapViewComponent=e.JimuMapViewComponent},function(e){n.default=e.default},function(e){a.GetUnits=e.GetUnits,a.QueryRouteMeasures=e.QueryRouteMeasures,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getHoverGraphic=e.getHoverGraphic,a.getRouteFromEndMeasures=e.getRouteFromEndMeasures,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.isDefined=e.isDefined},function(e){r.default=e.default},function(e){d.default=e.default},function(e){s.CalciteTable=e.CalciteTable,s.CalciteTableHeader=e.CalciteTableHeader,s.CalciteTableRow=e.CalciteTableRow}],execute:function(){e((()=>{var e={66454:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3.5 4.5H1v1h12.5V10h1V5.5H17v-1H4.5V0h-1zM6 11v-1H5v1zM6 14v-2H5v2H4v1h3v-1z"></path><path fill="#000" fill-rule="evenodd" d="M5 17.978A5.5 5.5 0 1 1 10.793 14H20v6H5zm5-5.478a4.5 4.5 0 1 1-9 0 4.5 4.5 0 0 1 9 0m.4 2.5a5.5 5.5 0 0 1-4.407 2.978H6V19h3.5v-1h1v1h2v-4zm6.1 2h-1v2h-2v-4H19v4h-2.5z" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=s},46678:e=>{"use strict";e.exports=r},77958:e=>{"use strict";e.exports=d},59620:e=>{"use strict";e.exports=n},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=l},47626:e=>{"use strict";e.exports=a}},t={};function u(i){var l=t[i];if(void 0!==l)return l.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,u),o.exports}u.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return u.d(t,{a:t}),t},u.d=(e,t)=>{for(var i in t)u.o(t,i)&&!u.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var v={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(v),u.d(v,{__set_webpack_public_path__:()=>se,default:()=>de});var e=u(79244);const t={_widgetLabel:"LRS Identify",method:"Method",measure:"Route and Measure",coordinate:"Coordinate",station:"Station",network:"Network",referent:"Referent",routeIdLabel:"Route Id",routeNameLabel:"Route Name",invalidMeasure:"Invalid measure value",invalidRouteField:"Route could not be found with provided value",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",backLabel:"Back",checkResult:"Check results",clearResult:"Clear results",resultsDisplay:"Results:",searchLabel:"Search",results:"Results",searchDisabled:"Provide route",typeStr:"Type:",routeStr:"Route",measureLabel:"Measure:",startMeasure:"Start Measure:",endMeasure:"End Measure:",dateStr:"Date:",networkLabel:"Network:",routeId:"Route ID:",routeName:"Route Name:",identifyResults:"Identify Routes",eventInformation:"Event Information",attr:"Attribute",val:"Value",toStr:"to",layerField:"{layerName}.{fieldName}",identifyWidget:"LRS Identify",routePicker:"Route Picker",nullStr:"null",lineEvent:"Line Events",pointEvent:"Point Events"};var i=u(14321),l=u(66454),o=u.n(l),n=u(62686),a=u(59620),r=u(47626);const d=[];function s(t){const{lrsLayers:i,dataSourcesReady:l,handleSetDataSources:o}=t,[n,a]=e.React.useState(null!=i?i:null),[s,u]=e.React.useState([]);e.React.useEffect((()=>{if(i){a(i);const e=Array(i.length).fill(!1);u(e)}}),[i]);const v=e.React.useCallback(((e,t)=>{const i=s;i[e]=t,u(i),i.every((e=>e))&&l(!0)}),[l,s]),c=e.React.useCallback(((e,t)=>{d.push(e),(null==i?void 0:i.length)===d.length&&o(d),v(t,!0)}),[null==i?void 0:i.length,o,v]),f=e.React.useCallback(((t,i)=>{if(t){const{status:l,instanceStatus:o}=t;o===e.DataSourceStatus.NotCreated||o===e.DataSourceStatus.CreateError||l===e.DataSourceStatus.LoadError||l===e.DataSourceStatus.NotReady?v(i,!1):v(i,!0)}}),[v]),h=e.React.useCallback((e=>{v(e,!1)}),[v]);return(0,e.jsx)("div",null,(0,r.isDefined)(n)&&n.map(((t,i)=>(0,e.jsx)(e.DataSourceComponent,{key:i,useDataSource:t.useDataSource,onDataSourceInfoChange:e=>{f(e,i)},onCreateDataSourceFailed:e=>{h(i)},onDataSourceCreated:e=>{c(e,i)}}))))}var c,f;!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(c||(c={})),function(e){e.measure="ROUTEANDMEASURE",e.coordinate="COORDINATE",e.locationOffset="LOCATIONOFFSET"}(f||(f={}));var h=u(46678),p=u(77958);const m="object"==typeof global&&global&&global.Object===Object&&global;var y="object"==typeof self&&self&&self.Object===Object&&self;const g=m||y||Function("return this")();var w=/\s/;const D=function(e){for(var t=e.length;t--&&w.test(e.charAt(t)););return t};var S=/^\s+/;const x=function(e){return e?e.slice(0,D(e)+1).replace(S,""):e};const b=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const I=g.Symbol;var j=Object.prototype,k=j.hasOwnProperty,R=j.toString,G=I?I.toStringTag:void 0;const L=function(e){var t=k.call(e,G),i=e[G];try{e[G]=void 0;var l=!0}catch(e){}var o=R.call(e);return l&&(t?e[G]=i:delete e[G]),o};var M=Object.prototype.toString;const F=function(e){return M.call(e)};var C=I?I.toStringTag:void 0;const P=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C&&C in Object(e)?L(e):F(e)};const N=function(e){return null!=e&&"object"==typeof e};const T=function(e){return"symbol"==typeof e||N(e)&&"[object Symbol]"==P(e)};var E=/^[-+]0x[0-9a-f]+$/i,O=/^0b[01]+$/i,A=/^0o[0-7]+$/i,V=parseInt;const W=function(e){if("number"==typeof e)return e;if(T(e))return NaN;if(b(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=b(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=x(e);var i=O.test(e);return i||A.test(e)?V(e.slice(2),i?2:8):E.test(e)?NaN:+e};var H=1/0;const U=function(e){return e?(e=W(e))===H||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const z=function(e){var t=U(e),i=t%1;return t==t?i?t-i:t:0};const Z=function(e,t){for(var i=-1,l=null==e?0:e.length,o=Array(l);++i<l;)o[i]=t(e[i],i,e);return o};const _=Array.isArray;var B=I?I.prototype:void 0,Q=B?B.toString:void 0;const K=function e(t){if("string"==typeof t)return t;if(_(t))return Z(t,e)+"";if(T(t))return Q?Q.call(t):"";var i=t+"";return"0"==i&&1/t==-Infinity?"-0":i};const $=function(e){return null==e?"":K(e)};var J=g.isFinite,q=Math.min;const Y=function(e){var t=Math[e];return function(e,i){if(e=W(e),(i=null==i?0:q(z(i),292))&&J(e)){var l=($(e)+"e").split("e"),o=t(l[0]+"e"+(+l[1]+i));return+((l=($(o)+"e").split("e"))[0]+"e"+(+l[1]-i))}return t(e)}}("round");var X=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}d((l=l.apply(e,t||[])).next())}))};const ee=e.css`
    .route-picker-btn {
      background-color: var(--primary);
      color: var(--light);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--light);
      }
    }
    .route-picker-btn-disabled {
      color: var(--dark);
      background-color: var(--light);
      width: 32px;
      height: 32px;
      border-radius: 0px;

      &:hover {
        color: var(--primary);
      }
    }
  `;function te(t){const{intl:l,isReady:n,active:a,jimuMapView:d,hoverGraphic:s,allDataSources:u,lrsLayers:v,config:f,onActiveChange:m,clearFlashGraphic:y,clearPickedGraphic:g,handleShowPp:w}=t;let{eventDataRecords:D}=t;const S=e.React.useRef(null),x=e.React.useRef(null),b=e.React.useRef(!1),I=e.React.useRef(!1),[j,k]=e.React.useState(!1);e.React.useEffect((()=>{a?R():G()}),[a]);const R=()=>{n&&(S.current=null==d?void 0:d.view.on("pointer-move",F),x.current=null==d?void 0:d.view.on("pointer-down",C))},G=()=>{(0,r.isDefined)(S.current)&&(S.current.remove(),S.current=null),(0,r.isDefined)(x.current)&&(x.current.remove(),x.current=null),I.current&&(I.current=!1),b.current&&(b.current=!1)},L=()=>{(0,r.isDefined)(s)&&s.removeAll()},M=e=>{L(),(0,r.isDefined)(e)&&s.add(e)},F=e=>X(this,void 0,void 0,(function*(){b.current||(yield Promise.all(u.map((t=>X(this,void 0,void 0,(function*(){const i=t,l=null==i?void 0:i.layer,o=v.find((e=>e.serviceId===l.layerId));if((0,r.isDefined)(o)&&o.layerType.toLocaleLowerCase()===c.network.toLocaleLowerCase()&&(0,r.isDefined)(l)){b.current=!0;const t=l.spatialReference,o=l.createQuery(),n=null==d?void 0:d.view.toMap(e),a="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);o.geometry=n,o.units="meters",o.returnM=!0,o.distance=(null==d?void 0:d.view.resolution)*a,o.spatialRelationship="intersects",o.returnGeometry=!0;const s=i.getCurrentQueryParams();(null==s?void 0:s.time)&&(o.timeExtent=new h.default({start:s.time[0],end:s.time[1]})),o.gdbVersion=s.gdbVersion,o.outFields=["*"],l.queryFeatures(o).then((e=>X(this,void 0,void 0,(function*(){if(e&&e.features.length>0&&b.current){const t=e.features[0].geometry,i=p.default.nearestCoordinate(t,n),l=p.default.nearestVertex(t,n);l.distance<3*o.distance&&(i.coordinate=l.coordinate),M(yield(0,r.getHoverGraphic)(yield(0,r.getSimplePointGraphic)(i.coordinate))),b.current=!1}else M(null),b.current=!1}))))}}))))))})),C=e=>X(this,void 0,void 0,(function*(){if(e.stopPropagation(),I.current)return;const i=[],o=[];let n;D=[],yield Promise.all(u.map((t=>X(this,void 0,void 0,(function*(){const a=t,s=null==a?void 0:a.layer,u=(e=>{const t={routeIdFieldName:null,routeNameFieldName:null,layer:null};for(let i=0;i<v.length;i++){const l=v[i];if((null==l?void 0:l.serviceId)===(null==e?void 0:e.layerId)){const e=null==l?void 0:l.layerType;if(e.toLocaleLowerCase()===c.event.toLocaleLowerCase()){const e=null==l?void 0:l.eventInfo;t.routeIdFieldName=e.routeIdFieldName,t.routeNameFieldName=null==e?void 0:e.routeNameFieldName,t.layer=l}else if(e.toLocaleLowerCase()===c.network.toLocaleLowerCase()){const e=null==l?void 0:l.networkInfo,i=null==e?void 0:e.routeIdFieldSchema;t.routeIdFieldName=null==i?void 0:i.jimuName,t.layer=l}break}}return t})(s);if((0,r.isDefined)(s)){const v=s.popupEnabled;s.popupEnabled=!1,I.current=!0;const m=s.spatialReference,y=s.createQuery(),g=null==d?void 0:d.view.toMap(e),w="degrees"===m.unit?4:Math.max(3*m.metersPerUnit,3);y.geometry=g,y.units="meters",y.distance=(null==d?void 0:d.view.resolution)*w,y.spatialRelationship="intersects",y.returnGeometry=!0,y.returnM=!0,y.returnZ=!0,y.outFields=["*"];const S=a.getCurrentQueryParams();(null==S?void 0:S.time)&&(y.timeExtent=new h.default({start:S.time[0],end:S.time[1]})),y.gdbVersion=S.gdbVersion;const x=[];yield s.queryFeatures(y).then((e=>X(this,void 0,void 0,(function*(){var d;yield Promise.all(null===(d=null==e?void 0:e.features)||void 0===d?void 0:d.map((e=>X(this,void 0,void 0,(function*(){var d,v,h,m,w,S,b,I,j,k,R,G,L,M,F,C,P,N;const T=(0,r.getRouteFromEndMeasures)(e.geometry),E=e.geometry,O=p.default.nearestCoordinate(E,g),A=p.default.nearestVertex(E,g);A.distance<3*y.distance&&(O.coordinate=A.coordinate),n||(n=O.coordinate,n.hasZ=!0);const V=null==e?void 0:e.attributes;if((null===(v=null===(d=null==u?void 0:u.layer)||void 0===d?void 0:d.layerType)||void 0===v?void 0:v.toLocaleLowerCase())===c.network.toLocaleLowerCase()){const d=null===(h=null==u?void 0:u.layer)||void 0===h?void 0:h.networkInfo;yield((e,t,i)=>{if(e)return new Promise(((l,o)=>{var n,a,r,d,s,u;const v=e.getCurrentQueryParams();if(!(null===(a=null===(n=null==i?void 0:i.layer)||void 0===n?void 0:n.networkInfo)||void 0===a?void 0:a.supportsLines))return l([]),[];{const o=null===(d=null===(r=null==i?void 0:i.layer)||void 0===r?void 0:r.networkInfo)||void 0===d?void 0:d.lineIdFieldName,n=null===(u=null===(s=null==i?void 0:i.layer)||void 0===s?void 0:s.networkInfo)||void 0===u?void 0:u.lineOrderFieldName,a={where:`${o} LIKE '%${t[o]}'`,outFields:["*"],orderByFields:[n]};(null==v?void 0:v.time)&&(a.time=[v.time[0],v.time[1]]),a.gdbVersion=v.gdbVersion,e.query(a).then((e=>(l(e),e)))}}))})(a,V,u).then((v=>X(this,void 0,void 0,(function*(){var c,f,h,p,m,y;yield(0,r.QueryRouteMeasures)(a,d,T,V[null===(h=null===(f=null===(c=null==u?void 0:u.layer)||void 0===c?void 0:c.networkInfo)||void 0===f?void 0:f.fromDateFieldSchema)||void 0===h?void 0:h.name],V[null===(y=null===(m=null===(p=null==u?void 0:u.layer)||void 0===p?void 0:p.networkInfo)||void 0===m?void 0:m.routeIdFieldSchema)||void 0===y?void 0:y.name]).then((c=>X(this,void 0,void 0,(function*(){var f,h,p,m,y,g;const w=Math.min(...c),D=Math.max(...c);yield(0,r.QueryRouteMeasures)(a,d,[O.coordinate],V[null===(p=null===(h=null===(f=null==u?void 0:u.layer)||void 0===f?void 0:f.networkInfo)||void 0===h?void 0:h.fromDateFieldSchema)||void 0===p?void 0:p.name],V[null===(g=null===(y=null===(m=null==u?void 0:u.layer)||void 0===m?void 0:m.networkInfo)||void 0===y?void 0:y.routeIdFieldSchema)||void 0===g?void 0:g.name]).then((a=>{var d,c,f,h,p,m,y,g,S,b,I,j,k,R,G,L,M,F,C,P,N,T,E,O,A,W,H,U,z,Z,_,B,Q,K,$,J,q,X,ee,te,ie,le,oe,ne,ae,re,de,se,ue,ve,ce,fe,he,pe,me,ye,ge,we,De,Se,xe,be,Ie,je;const ke=[];a.forEach((e=>{var t,i;ke.push(Y(e,null===(i=null===(t=null==u?void 0:u.layer)||void 0===t?void 0:t.networkInfo)||void 0===i?void 0:i.measurePrecision))}));let Re=new Date(Date.now());(0,r.isDefined)(V[null===(f=null===(c=null===(d=null==u?void 0:u.layer)||void 0===d?void 0:d.networkInfo)||void 0===c?void 0:c.toDateFieldSchema)||void 0===f?void 0:f.name])&&Re>V[null===(m=null===(p=null===(h=null==u?void 0:u.layer)||void 0===h?void 0:h.networkInfo)||void 0===p?void 0:p.toDateFieldSchema)||void 0===m?void 0:m.name]?Re=(0,r.getDateWithTZOffset)(V[null===(S=null===(g=null===(y=null==u?void 0:u.layer)||void 0===y?void 0:y.networkInfo)||void 0===g?void 0:g.fromDateFieldSchema)||void 0===S?void 0:S.name],t):Re.setHours(0,0,0,0);let Ge=new Date(Date.now());(0,r.isDefined)(V[null===(j=null===(I=null===(b=null==u?void 0:u.layer)||void 0===b?void 0:b.networkInfo)||void 0===I?void 0:I.toDateFieldSchema)||void 0===j?void 0:j.name])&&Ge>V[null===(G=null===(R=null===(k=null==u?void 0:u.layer)||void 0===k?void 0:k.networkInfo)||void 0===R?void 0:R.toDateFieldSchema)||void 0===G?void 0:G.name]?Ge=(0,r.getDateWithTZOffset)(V[null===(F=null===(M=null===(L=null==u?void 0:u.layer)||void 0===L?void 0:L.networkInfo)||void 0===M?void 0:M.toDateFieldSchema)||void 0===F?void 0:F.name],t):Ge.setHours(0,0,0,0),(0,r.isDefined)(V[null===(N=null===(P=null===(C=null==u?void 0:u.layer)||void 0===C?void 0:C.networkInfo)||void 0===P?void 0:P.toDateFieldSchema)||void 0===N?void 0:N.name])||(Ge=null);const Le={ds:t,records:v,supportsLines:null===(E=null===(T=null==u?void 0:u.layer)||void 0===T?void 0:T.networkInfo)||void 0===E?void 0:E.supportsLines,routeId:V[null===(W=null===(A=null===(O=null==u?void 0:u.layer)||void 0===O?void 0:O.networkInfo)||void 0===A?void 0:A.routeIdFieldSchema)||void 0===W?void 0:W.name],routeIdFieldName:null===(z=null===(U=null===(H=null==u?void 0:u.layer)||void 0===H?void 0:H.networkInfo)||void 0===U?void 0:U.routeIdFieldSchema)||void 0===z?void 0:z.name,routeName:V[null===(B=null===(_=null===(Z=null==u?void 0:u.layer)||void 0===Z?void 0:Z.networkInfo)||void 0===_?void 0:_.routeNameFieldSchema)||void 0===B?void 0:B.name],routeNameFieldName:null===($=null===(K=null===(Q=null==u?void 0:u.layer)||void 0===Q?void 0:Q.networkInfo)||void 0===K?void 0:K.routeNameFieldSchema)||void 0===$?void 0:$.name,lineOrderFieldName:null===(q=null===(J=null==u?void 0:u.layer)||void 0===J?void 0:J.networkInfo)||void 0===q?void 0:q.lineOrderFieldName,fromDate:V[null===(te=null===(ee=null===(X=null==u?void 0:u.layer)||void 0===X?void 0:X.networkInfo)||void 0===ee?void 0:ee.fromDateFieldSchema)||void 0===te?void 0:te.name],toDate:V[null===(oe=null===(le=null===(ie=null==u?void 0:u.layer)||void 0===ie?void 0:ie.networkInfo)||void 0===le?void 0:le.toDateFieldSchema)||void 0===oe?void 0:oe.name],selectedPoint:n,selectedPolyline:e.geometry,validRoute:!0,measureUnit:(0,r.GetUnits)(null===(ae=null===(ne=null==u?void 0:u.layer)||void 0===ne?void 0:ne.networkInfo)||void 0===ae?void 0:ae.unitsOfMeasure,l),timeDependedInfo:[{fromDate:V[null===(se=null===(de=null===(re=null==u?void 0:u.layer)||void 0===re?void 0:re.networkInfo)||void 0===de?void 0:de.fromDateFieldSchema)||void 0===se?void 0:se.name],toDate:V[null===(ce=null===(ve=null===(ue=null==u?void 0:u.layer)||void 0===ue?void 0:ue.networkInfo)||void 0===ve?void 0:ve.toDateFieldSchema)||void 0===ce?void 0:ce.name],fromMeasure:Y(w,null===(he=null===(fe=null==u?void 0:u.layer)||void 0===fe?void 0:fe.networkInfo)||void 0===he?void 0:he.measurePrecision),toMeasure:Y(D,null===(me=null===(pe=null==u?void 0:u.layer)||void 0===pe?void 0:pe.networkInfo)||void 0===me?void 0:me.measurePrecision),selectedMeasures:ke,attributes:V}],fieldInfos:null==s?void 0:s.fields};if(null==i?void 0:i.includes(null===(ye=null==u?void 0:u.layer)||void 0===ye?void 0:ye.serviceId)){const e=o.find((e=>{var t;return e.id===(null===(t=null==u?void 0:u.layer)||void 0===t?void 0:t.serviceId)})),t=null==e?void 0:e.routes;let i=!1;t.forEach((e=>{var t,l,o,n,a,r,d,s,v,c;if((null==e?void 0:e.routeId)===V[null==u?void 0:u.routeIdFieldName]){i=!0;const f=e;f.timeDependedInfo.push({fromMeasure:Y(w,null===(l=null===(t=null==u?void 0:u.layer)||void 0===t?void 0:t.networkInfo)||void 0===l?void 0:l.measurePrecision),toMeasure:Y(D,null===(n=null===(o=null==u?void 0:u.layer)||void 0===o?void 0:o.networkInfo)||void 0===n?void 0:n.measurePrecision),selectedMeasures:ke,fromDate:V[null===(d=null===(r=null===(a=null==u?void 0:u.layer)||void 0===a?void 0:a.networkInfo)||void 0===r?void 0:r.fromDateFieldSchema)||void 0===d?void 0:d.name],toDate:V[null===(c=null===(v=null===(s=null==u?void 0:u.layer)||void 0===s?void 0:s.networkInfo)||void 0===v?void 0:v.toDateFieldSchema)||void 0===c?void 0:c.name],attributes:V}),f.timeDependedInfo.sort(((e,t)=>e.fromDate-t.fromDate))}})),i||null===(ge=null==e?void 0:e.routes)||void 0===ge||ge.push(Le)}else{const e={id:null===(we=null==u?void 0:u.layer)||void 0===we?void 0:we.serviceId,layerName:null===(De=null==u?void 0:u.layer)||void 0===De?void 0:De.name,configFields:null===(xe=null===(Se=null==u?void 0:u.layer)||void 0===Se?void 0:Se.networkInfo)||void 0===xe?void 0:xe.attributeFields,useFieldAlias:null===(Ie=null===(be=null==u?void 0:u.layer)||void 0===be?void 0:be.networkInfo)||void 0===Ie?void 0:Ie.useFieldAlias,routes:[Le]};o.push(e),i.push(null===(je=null==u?void 0:u.layer)||void 0===je?void 0:je.serviceId)}x.push(Le)}))}))))}))))}else(null===(w=null===(m=null==u?void 0:u.layer)||void 0===m?void 0:m.layerType)||void 0===w?void 0:w.toLocaleLowerCase())===c.event.toLocaleLowerCase()&&D.push({parentNetworkId:null===(b=null===(S=null==u?void 0:u.layer)||void 0===S?void 0:S.eventInfo)||void 0===b?void 0:b.parentNetworkId,attributes:V,attributeSets:null==f?void 0:f.attributeSets,defaultLineAttributeSet:null==f?void 0:f.defaultLineAttrbuteSet,defaultPointAttributeSet:null==f?void 0:f.defaultPointAttributeSet,eventLayerId:null===(I=null==u?void 0:u.layer)||void 0===I?void 0:I.serviceId,fromDate:null===(k=null===(j=null==u?void 0:u.layer)||void 0===j?void 0:j.eventInfo)||void 0===k?void 0:k.fromDateFieldName,toDate:null===(G=null===(R=null==u?void 0:u.layer)||void 0===R?void 0:R.eventInfo)||void 0===G?void 0:G.toDateFieldName,fieldInfos:null==s?void 0:s.fields,routeIdFieldName:null===(M=null===(L=null==u?void 0:u.layer)||void 0===L?void 0:L.eventInfo)||void 0===M?void 0:M.routeIdFieldName,toRouteIdFieldName:null===(C=null===(F=null==u?void 0:u.layer)||void 0===F?void 0:F.eventInfo)||void 0===C?void 0:C.toRouteIdFieldName,canSpanRoutes:null===(N=null===(P=null==u?void 0:u.layer)||void 0===P?void 0:P.eventInfo)||void 0===N?void 0:N.canSpanRoutes})})))))})))).finally((()=>{v&&(s.popupEnabled=!1),I.current=!1})).catch((e=>{console.error(e)}))}}))))).then((()=>{t.setRouteDetails(o),t.setEventDetails(D)}))}));return(0,e.jsx)("div",{css:ee},(0,e.jsx)(i.Button,{className:a?"route-picker-btn":"route-picker-btn-disabled",size:"sm",tabIndex:-1,type:"tertiary",icon:!0,disabled:!n,onClick:()=>{m(),g(),y(),L(),w(!j),k(!j),j||(t.setRouteDetails([]),t.setEventDetails([]))}},(0,e.jsx)(i.Icon,{size:"m",icon:o(),className:"border-0"})))}const ie="#008000";var le=u(99037);function oe(l){var o;const{intl:n,config:a,routeDetails:d,eventDetails:s,jimuMapView:u,allDataSources:v,onRouteInfoUpdated:c,clearPickedGraphic:f}=l,h=e.React.useRef(null),[p,m]=e.React.useState(!0),[y,g]=e.React.useState({x:0,y:0}),[w,D]=e.React.useState({width:400,height:500}),[S,x]=e.React.useState(),[b,I]=e.React.useState(),[j,k]=e.React.useState(),[R,G]=e.React.useState(0),[L,M]=e.React.useState(0),F=b&&(null==b?void 0:b[L]),C=null==a?void 0:a.lineEventToggle,P=null==a?void 0:a.pointEventToggle,N=e.hooks.useTranslation(t);e.React.useEffect((()=>{var e,t,i,l;let o=d.find((e=>(null==a?void 0:a.defaultNetworkLayer)===(null==e?void 0:e.id)));o||(o=d[0]);let n=d.findIndex((e=>(null==a?void 0:a.defaultNetworkLayer)===(null==e?void 0:e.id)));if(n<0&&(n=0),d&&d.length>0){m(!0),h.current=o;const e=null==u?void 0:u.view.toScreen(o.routes[0].selectedPoint);if(e){const t=y;t.x=e.x+16,t.y=e.y+16;const i=T(e.x,e.y,null==u?void 0:u.view);i&&(t.x=i.x+16,t.y=i.y+16),g(t)}}M(0),x(o),G(n),I(null==o?void 0:o.routes),k(null===(i=null===(t=null===(e=null==o?void 0:o.routes)||void 0===e?void 0:e[0])||void 0===t?void 0:t.timeDependedInfo)||void 0===i?void 0:i[0]),c(null===(l=null==o?void 0:o.routes)||void 0===l?void 0:l[0],!0)}),[null==u?void 0:u.view,d]);const T=(e,t,i)=>{if(!i)return;const l=w.width,o=w.height;return e>=0&&t>=0&&e+l<=window.innerWidth&&t+o<=window.innerHeight?null:(e+l>window.innerWidth&&(e=window.innerWidth-l),t+o>window.innerHeight&&(t=window.innerHeight-o),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},E=e.React.useCallback((e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,l=null==i?void 0:i.id;null==d||d.forEach(((e,t)=>{var o,n,a,r;(null==e?void 0:e.id)===l&&(x(i),G(t),I(null==e?void 0:e.routes),k(null===(a=null===(n=null===(o=null==e?void 0:e.routes)||void 0===o?void 0:o[0])||void 0===n?void 0:n.timeDependedInfo)||void 0===a?void 0:a[0]),M(0),c(null===(r=null==e?void 0:e.routes)||void 0===r?void 0:r[0],!0))}))}),[d]),O=e.React.useCallback((e=>{g(e)}),[]),A=e.React.useCallback(((e,t)=>{D(e),g(t)}),[]),V=(e,t,i)=>{const l=null==i?void 0:i.find((t=>t.name===e));if((0,r.isDefined)(l)&&(0,r.isDefined)(l.domain)&&"coded-value"===l.domain.type){const e=l.domain.codedValues.find((e=>"string"==typeof e.code&&"string"==typeof t?e.code.toLowerCase()===t.toLowerCase():e.code===t));if(e)return`${e.code} - ${e.name}`}},W=e=>{const t=864e13,i=-864e13,l=[],o=null==S?void 0:S.id,n=null!==(null==j?void 0:j.fromDate)?null==j?void 0:j.fromDate:i,a=null!==(null==j?void 0:j.toDate)?null==j?void 0:j.toDate:t;return s.sort(((e,t)=>{const i=null==e?void 0:e.attributes,l=null==t?void 0:t.attributes;return i[e.fromDate]-l[t.fromDate]})),null==s||s.forEach((d=>{var s,u,c,f,h,p,m,y,g,w;const D=null==d?void 0:d.fieldInfos,x=null==d?void 0:d.attributes,I=null==d?void 0:d.fromDate,k=null==d?void 0:d.toDate,R=x[null==d?void 0:d.routeIdFieldName],G=x[I],M=G?(0,r.getDateWithTZOffset)(G,S.routes[L].ds).toLocaleDateString():N("nullStr"),F=x[k],C=F?(0,r.getDateWithTZOffset)(F,S.routes[L].ds).toLocaleDateString():N("nullStr");let P=null==d?void 0:d.defaultLineAttributeSet;"point"===e&&(P=null==d?void 0:d.defaultPointAttributeSet);let T=!1;if((null==d?void 0:d.parentNetworkId)===o)if("line"===e&&(null===(s=b[L])||void 0===s?void 0:s.supportsLines)&&(null==d?void 0:d.canSpanRoutes)){const e=null===(c=null===(u=null==S?void 0:S.routes)||void 0===u?void 0:u[L])||void 0===c?void 0:c.routeIdFieldName,t=d.routeIdFieldName,i=d.toRouteIdFieldName,l=null===(h=null===(f=null==S?void 0:S.routes)||void 0===f?void 0:f[L])||void 0===h?void 0:h.lineOrderFieldName,o=null===(y=null===(m=null===(p=null==S?void 0:S.routes)||void 0===p?void 0:p[L])||void 0===m?void 0:m.records)||void 0===y?void 0:y.records,n=null==j?void 0:j.attributes[l],a=o.find((i=>i.feature.attributes[e]===d.attributes[t]));o.find((t=>t.feature.attributes[e]===d.attributes[i])).feature.attributes[l]>=n&&n>=a.feature.attributes[l]&&(T=!0)}else(null==d?void 0:d.parentNetworkId)===o&&(null===(g=b[L])||void 0===g?void 0:g.routeId)===R&&(T=!0);if(T){const e=null===(w=d.attributeSets)||void 0===w?void 0:w.attributeSet.find((e=>e.title===P)),o=null==e?void 0:e.layers;null==o||o.forEach((e=>{const o=[],s=(e=>{const t=v.find((t=>{var i,l;return(null===(l=null===(i=null==t?void 0:t.getLayerDefinition)||void 0===i?void 0:i.call(t))||void 0===l?void 0:l.id)===(null==e?void 0:e.layerId)}));return t})(e);if(s){const u=(null==s?void 0:s.layer).fields,v=null!==x[I]?x[I]:i,c=null!==x[k]?x[k]:t;if((null==e?void 0:e.layerId)===d.eventLayerId&&(n<=v<=a||n<=c<=a)){(null==e?void 0:e.fields).forEach((t=>{const i=u.find((e=>e.name===t.name)),l=null==t?void 0:t.name,n=null==i?void 0:i.type,a=V(l,x[l],D);let d;a?d=a:(d=x[l],"date"===(null==n?void 0:n.toLowerCase())&&(d=d?(0,r.getDateWithTZOffset)(d,S.routes[L].ds).toLocaleDateString():null)),"date"===(null==n?void 0:n.toLowerCase())&&(d=d?(0,r.getDateWithTZOffset)(d,S.routes[L].ds).toLocaleDateString():null),o.push({name:l,val:d,layerName:null==e?void 0:e.layerName,fromDate:M,toDate:C})})),l.push(U(o)),l.push(H())}}else;}))}})),l},H=()=>(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}}),U=t=>{var l,o,a;const d=null===(l=null==t?void 0:t[0])||void 0===l?void 0:l.fromDate,s=null===(o=null==t?void 0:t[0])||void 0===o?void 0:o.toDate,u=(null===(a=null==t?void 0:t[0])||void 0===a?void 0:a.layerName)+" ("+d+" - "+s+")";return(0,e.jsx)(i.CollapsablePanel,{label:u,level:0,type:"default"},(0,e.jsx)(le.CalciteTable,{className:"w-100 h-100",caption:N("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)(le.CalciteTableRow,null,(0,e.jsx)(le.CalciteTableHeader,{heading:(0,r.formatMessage)(n,"attribute")}),(0,e.jsx)(le.CalciteTableHeader,{heading:(0,r.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(le.CalciteTableRow,null,(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))},z=()=>{var t;return(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("dateStr"))),(0,e.jsx)("div",null,(0,e.jsx)(i.Select,{size:"sm",value:j,onChange:e=>{(e=>{var t;const i=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;k(i)})(e)}},null===(t=null==F?void 0:F.timeDependedInfo)||void 0===t?void 0:t.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.fromDate,value:t,label:t.fromDate},(0,e.jsx)("span",null,t.fromDate?(0,r.getDateWithTZOffset)(t.fromDate,S.routes[L].ds).toLocaleDateString():N("nullStr")),(0,e.jsx)("span",{style:{paddingLeft:"0.3rem",paddingRight:"0.3rem"}},N("toStr")),(0,e.jsx)("span",null,t.toDate?(0,r.getDateWithTZOffset)(t.toDate,S.routes[L].ds).toLocaleDateString():N("nullStr"))))))))},Z=e=>W(e);return(0,e.jsx)("div",{style:{position:"relative"}},p&&d&&d.length>0&&(0,e.jsx)(i.FloatingPanel,{headerTitle:N("identifyResults"),size:w,defaultPosition:y,position:y,disableActivateOverlay:!1,dragBounds:"body",onDrag:O,onResize:A,onHeaderClose:()=>{f(),m(!1)}},(0,e.jsx)("div",{css:(0,r.getCalciteBasicTheme)()},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column",padding:"10px",overflowY:"scroll",height:"inherit"}},(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("networkLabel"))),(0,e.jsx)("div",{style:{width:"50%"}},(0,e.jsx)(i.Select,{size:"sm",value:S,onChange:E},d.map(((t,i)=>(0,e.jsx)(Option,{key:i,title:t.layerName,value:t,label:t.layerName},t.layerName)))))),F&&(t=>{var l,o;const a=((e,t,i)=>{const l=[null==i?void 0:i.routeIdFieldName,null==i?void 0:i.routeNameFieldName],o=S?S.configFields:null,n=S?S.useFieldAlias:null,a=[];return(null==o?void 0:o.length)>0&&e&&o.forEach((i=>{var o,d,s,u,v;const c=null==i?void 0:i.enabled;let f=null===(o=null==i?void 0:i.field)||void 0===o?void 0:o.name;if(c&&!l.includes(f)){const l=V(f,e[null===(d=null==i?void 0:i.field)||void 0===d?void 0:d.name],t);n&&(f=null===(s=null==i?void 0:i.field)||void 0===s?void 0:s.alias);const o=null===(u=null==i?void 0:i.field)||void 0===u?void 0:u.type;let c;l?c=l:(c=e[null===(v=null==i?void 0:i.field)||void 0===v?void 0:v.name],"date"===(null==o?void 0:o.toLowerCase())&&(c=c?(0,r.getDateWithTZOffset)(c,S.routes[L].ds).toLocaleDateString():null)),f&&a.push({name:f,val:c})}})),a})(null==j?void 0:j.attributes,null==t?void 0:t.fieldInfos,t),d=Z("line"),s=Z("point"),u=(0,e.jsx)("div",{style:{display:"flex",flexDirection:"column"}},t.routeId&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingTop:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%",flex:"none"}},(0,e.jsx)(i.Label,null,N("routeId"))),(0,e.jsx)("div",{title:t.routeId,style:{width:"fitContent",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}},t.routeId)),t.routeName&&(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("routeName"))),(0,e.jsx)("div",null,t.routeName)),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("measureLabel"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,null===(l=j.selectedMeasures)||void 0===l?void 0:l[0]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},b[L].measureUnit))),(null===(o=j.selectedMeasures)||void 0===o?void 0:o.length)>1&&(()=>{const t=null==j?void 0:j.selectedMeasures,i=[];for(let l=1;l<t.length;l++)i.push((0,e.jsx)("div",{style:{display:"flex",flexDirection:"row",paddingBottom:"0.5rem"}},(0,e.jsx)("div",{style:{width:"30%"}}),(0,e.jsx)("span",null,t[l]),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},b[L].measureUnit)));return i})(),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("startMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null,j.fromMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},j.measureUnit))),(0,e.jsx)("div",{style:{display:"flex",flexDirection:"row"}},(0,e.jsx)("div",{style:{width:"30%"}},(0,e.jsx)(i.Label,null,N("endMeasure"))),(0,e.jsx)("div",null,(0,e.jsx)("span",null," ",j.toMeasure),(0,e.jsx)("span",{style:{paddingLeft:"0.2rem"}},j.measureUnit))),z(),a&&(null==a?void 0:a.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},(t=>(0,e.jsx)(le.CalciteTable,{className:"w-100 h-100",caption:N("routePicker"),bordered:!0,scale:"s",layout:"fixed"},(0,e.jsx)("calcite-table-row",{slot:"table-header"},(0,e.jsx)("calcite-table-header",{heading:(0,r.formatMessage)(n,"attribute")}),(0,e.jsx)("calcite-table-header",{heading:(0,r.formatMessage)(n,"value")})),null==t?void 0:t.map(((t,i)=>(0,e.jsx)(le.CalciteTableRow,{key:i},(0,e.jsx)("calcite-table-cell",{itemKey:i},t.name),(0,e.jsx)("calcite-table-cell",{itemKey:i},t.val))))))(a)),C&&(null==d?void 0:d.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"1.5rem"}},N("lineEvent"),d),P&&(null==s?void 0:s.length)>0&&(0,e.jsx)("div",{style:{paddingTop:"0.5rem"}},N("pointEvent"),s));return u})(F)),(0,e.jsx)("div",{style:{display:"flex",justifyContent:"center",paddingBottom:"0.5rem",paddingTop:"0.5rem"}},(0,e.jsx)(i.Pagination,{current:L+1,onChangePage:e=>{(e=>{var t,i,l,o,n,a;f();const r=e-1;M(r),k(null===(o=null===(l=null===(i=null===(t=d[R])||void 0===t?void 0:t.routes)||void 0===i?void 0:i[r])||void 0===l?void 0:l.timeDependedInfo)||void 0===o?void 0:o[0]),c(null===(a=null===(n=d[R])||void 0===n?void 0:n.routes)||void 0===a?void 0:a[r],!0)})(e)},simple:!0,size:"sm",totalPage:null===(o=null==S?void 0:S.routes)||void 0===o?void 0:o.length})))))}var ne=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}d((l=l.apply(e,t||[])).next())}))};function ae(t){const{intl:i,lrsLayers:l,JimuMapView:o,defaultShowPp:n,hoverGraphic:a,config:d,onClearFlashGraphics:u,onClearPickedGraphics:v,onUpdateGraphics:c,flashSelectedGeometry:f}=t,[h,p]=e.React.useState(!1),[m,y]=e.React.useState(null),[g,w]=e.React.useState(null),[D,S]=e.React.useState(null),[x,b]=e.React.useState(!1),[I,j]=e.React.useState(!0),k=e.React.useCallback((e=>{p(e)}),[p]),R=e.React.useCallback((e=>{y(e)}),[y]),G=(e,...t)=>ne(this,[e,...t],void 0,(function*(e,t=!1){const i=d.highlightStyle.routeColor,l=d.highlightStyle.width;(0,r.isDefined)(e.selectedPolyline)&&t&&f(yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),i,l)),(0,r.isDefined)(e.selectedPoint)?c(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),ie)):v(),o.clearSelectedFeatures()}));return(0,e.jsx)("div",null,(0,e.jsx)(s,{lrsLayers:l,dataSourcesReady:k,handleSetDataSources:R}),(0,e.jsx)(te,{intl:i,isReady:h,active:x,allDataSources:m,lrsLayers:l,jimuMapView:o,symbolColor:null,hoverGraphic:a,onActiveChange:()=>{var e;const t=!x;b(t),t?((null===(e=null==o?void 0:o.view)||void 0===e?void 0:e.popupEnabled)&&(o.view.popupEnabled=!1),u(),v()):o.view.popupEnabled=n},onRouteInfoUpdated:G,clearPickedGraphic:v,clearFlashGraphic:u,setRouteDetails:e=>{w(e)},setEventDetails:e=>{S(e)},eventDataRecords:[],config:d,handleShowPp:e=>{j(e)}}),g&&(null==g?void 0:g.length)>0&&I&&(0,e.jsx)(oe,{intl:i,allDataSources:m,routeDetails:g,eventDetails:D,jimuMapView:o,onRouteInfoUpdated:G,clearPickedGraphic:v,config:d}))}var re=function(e,t,i,l){return new(i||(i=Promise))((function(o,n){function a(e){try{d(l.next(e))}catch(e){n(e)}}function r(e){try{d(l.throw(e))}catch(e){n(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}d((l=l.apply(e,t||[])).next())}))};class de extends e.React.PureComponent{constructor(l){super(l),this.clearPickedGraphics=()=>{(0,r.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll()},this.clearFlashGraphic=()=>{(0,r.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()},this.updatePickedGraphic=e=>{(0,r.isDefined)(e)?(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.add(e)):this.clearPickedGraphics()},this.flashSelectedGeometry=e=>{(0,r.isDefined)(e)&&(this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll(),setTimeout((()=>{this.state.flashGraphic.add(e),setTimeout((()=>{this.state.flashGraphic.removeAll()}),800)}),800)}),800)}),800)}),800))},this.updateGraphics=(e,t)=>re(this,void 0,void 0,(function*(){(0,r.isDefined)(e.selectedPolyline)&&t&&this.flashSelectedGeometry(yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),"#00FFFF")),(0,r.isDefined)(e.selectedPoint)?this.updatePickedGraphic(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),ie)):this.clearPickedGraphics()})),this.onActiveViewChange=e=>re(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=t=>re(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const i=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==i?void 0:i.isDataSourceSet)&&!i.areChildDataSourcesCreated()?i.childDataSourcesReady().then((()=>i)).catch((e=>i)):Promise.resolve(i)})),this.getI18nMessage=(e,l)=>{const o=Object.assign({},t,i.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:o[e]},l)},this.state={jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,t){t.jimuMapView!==this.state.jimuMapView&&(0,r.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers())}removeGraphicLayers(){(0,r.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,r.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,r.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,r.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const i=new a.default({listMode:"hide"}),l=new a.default({listMode:"hide"}),o=new a.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([l,o,i]),this.setState({hoverGraphic:i}),this.setState({pickedGraphic:l}),this.setState({flashGraphic:o})}}clearGraphics(){(0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,r.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,r.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}render(){var t,l;const{config:a,id:r}=this.props,{lrsLayers:d,networkLayers:s}=a,{jimuMapView:u}=this.state;return s&&0!==(null==s?void 0:s.length)?(0,e.jsx)("div",{css:e.css`
    min-width: 32px;
    min-height: 32px;
  `},(0,e.jsx)(n.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(ae,{intl:this.props.intl,widgetId:r,lrsLayers:d,config:a,JimuMapView:u,hoverGraphic:this.state.hoverGraphic,onClearPickedGraphics:this.clearPickedGraphics.bind(this),onClearFlashGraphics:this.clearFlashGraphic.bind(this),onUpdateGraphics:this.updatePickedGraphic.bind(this),flashSelectedGeometry:this.flashSelectedGeometry.bind(this),defaultShowPp:null===(l=null==u?void 0:u.view)||void 0===l?void 0:l.popupEnabled})):(0,e.jsx)(i.WidgetPlaceholder,{icon:o(),widgetId:r,message:this.getI18nMessage("_widgetLabel")})}}function se(e){u.p=e}})(),v})())}}}));