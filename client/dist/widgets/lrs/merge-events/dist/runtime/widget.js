System.register(["jimu-core","widgets/shared-code/lrs","jimu-ui","jimu-arcgis","jimu-core/react","jimu-ui/basic/list-tree","calcite-components","esri/layers/GraphicsLayer","esri/widgets/Sketch/SketchViewModel","esri/Graphic"],(function(e,t){var n={},a={},o={},s={},r={},i={},c={},l={},u={},d={};return{setters:[function(e){n.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,n.DataSourceComponent=e.DataSourceComponent,n.DataSourceManager=e.DataSourceManager,n.DataSourceSelectionMode=e.DataSourceSelectionMode,n.DataSourceStatus=e.DataSourceStatus,n.Immutable=e.Immutable,n.MessageManager=e.MessageManager,n.React=e.React,n.RecordSetChangeType=e.RecordSetChangeType,n.SessionManager=e.SessionManager,n.WidgetState=e.WidgetState,n.css=e.css,n.esri=e.esri,n.getAppStore=e.getAppStore,n.hooks=e.hooks,n.jsx=e.jsx},function(e){a.AttributeTable=e.AttributeTable,a.GetUnits=e.GetUnits,a.LockAction=e.LockAction,a.LockManagerComponent=e.LockManagerComponent,a.LrsLayerType=e.LrsLayerType,a.flash=e.flash,a.formatMessage=e.formatMessage,a.getCalciteBasicTheme=e.getCalciteBasicTheme,a.getDateToUTC=e.getDateToUTC,a.getDateWithTZOffset=e.getDateWithTZOffset,a.getDateWithoutTZOffset=e.getDateWithoutTZOffset,a.getGeometryGraphic=e.getGeometryGraphic,a.getInitialRouteInfoState=e.getInitialRouteInfoState,a.getIntialLocksInfo=e.getIntialLocksInfo,a.getNetworkOutFields=e.getNetworkOutFields,a.getSimpleLineGraphic=e.getSimpleLineGraphic,a.getSimplePointGraphic=e.getSimplePointGraphic,a.isDate=e.isDate,a.isDefined=e.isDefined,a.isInWidgetController=e.isInWidgetController,a.isNumber=e.isNumber,a.queryEventsByEventObjectIds=e.queryEventsByEventObjectIds,a.queryRouteId=e.queryRouteId,a.queryRouteIds=e.queryRouteIds,a.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,a.validateField=e.validateField,a.validateRangeDomain=e.validateRangeDomain},function(e){o.Alert=e.Alert,o.Button=e.Button,o.Checkbox=e.Checkbox,o.Label=e.Label,o.Select=e.Select,o.Tooltip=e.Tooltip,o.WidgetPlaceholder=e.WidgetPlaceholder,o.defaultMessages=e.defaultMessages},function(e){s.JimuMapViewComponent=e.JimuMapViewComponent,s.LayerTypes=e.LayerTypes,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){r.useImperativeHandle=e.useImperativeHandle},function(e){i.List=e.List,i.TreeItemActionType=e.TreeItemActionType},function(e){c.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){l.default=e.default},function(e){u.default=e.default},function(e){d.default=e.default}],execute:function(){e((()=>{var e={40828:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M2 1h8a1 1 0 0 1 1 1h1a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h4.5v-1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1M11 12h-1v3h7v2h1v-3h-7z"></path><path fill="#000" d="M7.5 6H9v2h1V5H7.5zM4.5 5H3V3H2v3h2.5zM5.5 2v7h1V2zM11 4.5h3A1.5 1.5 0 0 1 15.5 6v2.293l-1.646-1.647-.707.708L16 10.207l2.854-2.853-.707-.708L16.5 8.293V6A2.5 2.5 0 0 0 14 3.5h-3z"></path><path fill="#000" d="M19 11a1 1 0 0 0-.81-.982l.771-.772A2 2 0 0 1 20 11v7a2 2 0 0 1-2 2h-8a2 2 0 0 1-2-2v-7a2 2 0 0 1 2-2h3l1 1h-4a1 1 0 0 0-1 1v7a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1z"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},99037:e=>{"use strict";e.exports=c},22089:e=>{"use strict";e.exports=d},59620:e=>{"use strict";e.exports=l},10624:e=>{"use strict";e.exports=u},62686:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=n},68972:e=>{"use strict";e.exports=r},14321:e=>{"use strict";e.exports=o},98640:e=>{"use strict";e.exports=i},47626:e=>{"use strict";e.exports=a}},t={};function f(n){var a=t[n];if(void 0!==a)return a.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,f),o.exports}f.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return f.d(t,{a:t}),t},f.d=(e,t)=>{for(var n in t)f.o(t,n)&&!f.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},f.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),f.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},f.p="";var v={};return f.p=window.jimuConfig.baseUrl,(()=>{"use strict";f.r(v),f.d(v,{__set_webpack_public_path__:()=>ka,default:()=>ja});var e=f(79244),t=f(47626),n=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};function a(e,a,o,s,r,i,c,l,u,d){return n(this,void 0,void 0,(function*(){let n;if(1===a.length)n=o("selectAtLeastTwoEvents");else if(a.length>0)if(s.eventInfo.canSpanRoutes){const c=[];for(let e=0;e<a.length;e++){const t=a[e].attributes[s.eventInfo.routeIdFieldName];c.push(t);const n=a[e].attributes[s.eventInfo.toRouteIdFieldName];c.push(n)}const l={};yield(0,t.queryRouteIds)(c,r.networkInfo,i).then((i=>{if((0,t.isDefined)(i)){let c;const u=(0,t.getNetworkOutFields)(r.networkInfo);for(let e=0;e<i.features.length;e++){const a=i.features[e].attributes[u.lineIdFieldName],s=i.features[e].attributes[u.lineOrderFieldName],r=i.features[e].attributes[u.routeIdFieldName];if(l[r]=s,(0,t.isDefined)(c)){if(c!==a){n=o("eventsNotOnSameLine");break}}else c=a}e&&(a.forEach((e=>{e.attributes.fromLineOrder=l[e.attributes[s.eventInfo.routeIdFieldName]],e.attributes.toLineOrder=l[e.attributes[s.eventInfo.toRouteIdFieldName]]})),a.sort(((e,t)=>e.attributes.fromLineOrder-t.attributes.fromLineOrder||e.attributes.toLineOrder-t.attributes.toLineOrder||e.attributes[s.eventInfo.fromMeasureFieldName]-t.attributes[s.eventInfo.fromMeasureFieldName])))}}))}else{let r;for(let e=0;e<a.length;e++){const i=a[e].attributes[s.eventInfo.routeIdFieldName];if((0,t.isDefined)(r)){if(r!==i){n=o("eventsNotOnSameRoute");break}}else r=i}e&&a.sort(((e,t)=>e.attributes[s.eventInfo.fromMeasureFieldName]-t.attributes[s.eventInfo.fromMeasureFieldName]))}return!((0,t.isDefined)(n)&&n.length>0&&"success"!==c)||(l("error"),u(n),d(!0),setTimeout((()=>{d(!1)}),5e3),!1)}))}const o={_widgetLabel:"Merge Events",eventLabel:"Event",eventListLabel:"Events to Merge *",preserveLabel:" (preserve)",selectButtonLabel:"Change event selection",fromMeasureWithUnits:"From Measure ({units})",toMeasureWithUnits:"To Measure ({units})",startDateLabel:"Start Date",endDateLabel:"End Date",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",mergeLabel:"Merge",eventMerged:"Event Merged",invalidFromDateBefore:"From date is before route's from date",invalidFromDateAfter:"From date is after route's to date",invalidToDateBefore:"To date is before route's from date",invalidToDateAfter:"To date is after route's to date",invalidDatesOrder:"Selected from date is greater than selected to date",invalidDatesSameDay:"From and to dates cannot be the same",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",mergedEventAttributesLabel:"Merged Event Attributes",eventsNotCoincident:"Unable to merge non-coincident events.",eventNotOverlapMergeDates:"The following event object ID(s) must overlap between Merge Dates:\n{objectIds}",eventsNotOnSameRoute:"The selected events are not on the same route.",eventsNotOnSameLine:"The selected events are not on the same line.",selectAtLeastTwoEvents:"Select at least two events to merge.",eventsToDateNotNull:"The following event object ID(s) must have null in To Date:\n{objectIds}",eventsNotActiveToday:"The following event object ID(s) must be active today:\n{objectIds}",chooseEventsFromMap:"(Choose events from map)"};var s=f(14321),r=f(40828),i=f.n(r),c=f(62686);function l(){const t=e.hooks.useTranslation(o);return(0,e.jsx)("div",{className:"merge-events-form-header"},(0,e.jsx)("div",{className:"merge-events-form-header__header pt-3 px-3 align-items-center"},(0,e.jsx)("div",{className:"merge-events_title d-flex align-items-center text-truncate",css:e.css`font-weight: 500; font-size: 14px;`},(0,e.jsx)("div",{className:"text-truncate"},t("_widgetLabel")))))}const u=function(){this.__data__=[],this.size=0};const d=function(e,t){return e===t||e!=e&&t!=t};const h=function(e,t){for(var n=e.length;n--;)if(d(e[n][0],t))return n;return-1};var p=Array.prototype.splice;const m=function(e){var t=this.__data__,n=h(t,e);return!(n<0)&&(n==t.length-1?t.pop():p.call(t,n,1),--this.size,!0)};const y=function(e){var t=this.__data__,n=h(t,e);return n<0?void 0:t[n][1]};const g=function(e){return h(this.__data__,e)>-1};const b=function(e,t){var n=this.__data__,a=h(n,e);return a<0?(++this.size,n.push([e,t])):n[a][1]=t,this};function D(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}D.prototype.clear=u,D.prototype.delete=m,D.prototype.get=y,D.prototype.has=g,D.prototype.set=b;const I=D;const S=function(){this.__data__=new I,this.size=0};const w=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const j=function(e){return this.__data__.get(e)};const k=function(e){return this.__data__.has(e)};const x="object"==typeof global&&global&&global.Object===Object&&global;var T="object"==typeof self&&self&&self.Object===Object&&self;const F=x||T||Function("return this")();const L=F.Symbol;var M=Object.prototype,E=M.hasOwnProperty,N=M.toString,A=L?L.toStringTag:void 0;const R=function(e){var t=E.call(e,A),n=e[A];try{e[A]=void 0;var a=!0}catch(e){}var o=N.call(e);return a&&(t?e[A]=n:delete e[A]),o};var O=Object.prototype.toString;const _=function(e){return O.call(e)};var C=L?L.toStringTag:void 0;const P=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C&&C in Object(e)?R(e):_(e)};const G=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const U=function(e){if(!G(e))return!1;var t=P(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const V=F["__core-js_shared__"];var B,z=(B=/[^.]+$/.exec(V&&V.keys&&V.keys.IE_PROTO||""))?"Symbol(src)_1."+B:"";const W=function(e){return!!z&&z in e};var q=Function.prototype.toString;const J=function(e){if(null!=e){try{return q.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Q=/^\[object .+?Constructor\]$/,Z=Function.prototype,$=Object.prototype,H=Z.toString,K=$.hasOwnProperty,X=RegExp("^"+H.call(K).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!G(e)||W(e))&&(U(e)?X:Q).test(J(e))};const ee=function(e,t){return null==e?void 0:e[t]};const te=function(e,t){var n=ee(e,t);return Y(n)?n:void 0};const ne=te(F,"Map");const ae=te(Object,"create");const oe=function(){this.__data__=ae?ae(null):{},this.size=0};const se=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var re=Object.prototype.hasOwnProperty;const ie=function(e){var t=this.__data__;if(ae){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return re.call(t,e)?t[e]:void 0};var ce=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return ae?void 0!==t[e]:ce.call(t,e)};const ue=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ae&&void 0===t?"__lodash_hash_undefined__":t,this};function de(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}de.prototype.clear=oe,de.prototype.delete=se,de.prototype.get=ie,de.prototype.has=le,de.prototype.set=ue;const fe=de;const ve=function(){this.size=0,this.__data__={hash:new fe,map:new(ne||I),string:new fe}};const he=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const pe=function(e,t){var n=e.__data__;return he(t)?n["string"==typeof t?"string":"hash"]:n.map};const me=function(e){var t=pe(this,e).delete(e);return this.size-=t?1:0,t};const ye=function(e){return pe(this,e).get(e)};const ge=function(e){return pe(this,e).has(e)};const be=function(e,t){var n=pe(this,e),a=n.size;return n.set(e,t),this.size+=n.size==a?0:1,this};function De(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var a=e[t];this.set(a[0],a[1])}}De.prototype.clear=ve,De.prototype.delete=me,De.prototype.get=ye,De.prototype.has=ge,De.prototype.set=be;const Ie=De;const Se=function(e,t){var n=this.__data__;if(n instanceof I){var a=n.__data__;if(!ne||a.length<199)return a.push([e,t]),this.size=++n.size,this;n=this.__data__=new Ie(a)}return n.set(e,t),this.size=n.size,this};function we(e){var t=this.__data__=new I(e);this.size=t.size}we.prototype.clear=S,we.prototype.delete=w,we.prototype.get=j,we.prototype.has=k,we.prototype.set=Se;const je=we;const ke=function(e,t){for(var n=-1,a=null==e?0:e.length;++n<a&&!1!==t(e[n],n,e););return e};const xe=function(){try{var e=te(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const Te=function(e,t,n){"__proto__"==t&&xe?xe(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var Fe=Object.prototype.hasOwnProperty;const Le=function(e,t,n){var a=e[t];Fe.call(e,t)&&d(a,n)&&(void 0!==n||t in e)||Te(e,t,n)};const Me=function(e,t,n,a){var o=!n;n||(n={});for(var s=-1,r=t.length;++s<r;){var i=t[s],c=a?a(n[i],e[i],i,n,e):void 0;void 0===c&&(c=e[i]),o?Te(n,i,c):Le(n,i,c)}return n};const Ee=function(e,t){for(var n=-1,a=Array(e);++n<e;)a[n]=t(n);return a};const Ne=function(e){return null!=e&&"object"==typeof e};const Ae=function(e){return Ne(e)&&"[object Arguments]"==P(e)};var Re=Object.prototype,Oe=Re.hasOwnProperty,_e=Re.propertyIsEnumerable,Ce=Ae(function(){return arguments}())?Ae:function(e){return Ne(e)&&Oe.call(e,"callee")&&!_e.call(e,"callee")};const Pe=Ce;const Ge=Array.isArray;const Ue=function(){return!1};var Ve="object"==typeof exports&&exports&&!exports.nodeType&&exports,Be=Ve&&"object"==typeof module&&module&&!module.nodeType&&module,ze=Be&&Be.exports===Ve?F.Buffer:void 0;const We=(ze?ze.isBuffer:void 0)||Ue;var qe=/^(?:0|[1-9]\d*)$/;const Je=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&qe.test(e))&&e>-1&&e%1==0&&e<t};const Qe=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Ze={};Ze["[object Float32Array]"]=Ze["[object Float64Array]"]=Ze["[object Int8Array]"]=Ze["[object Int16Array]"]=Ze["[object Int32Array]"]=Ze["[object Uint8Array]"]=Ze["[object Uint8ClampedArray]"]=Ze["[object Uint16Array]"]=Ze["[object Uint32Array]"]=!0,Ze["[object Arguments]"]=Ze["[object Array]"]=Ze["[object ArrayBuffer]"]=Ze["[object Boolean]"]=Ze["[object DataView]"]=Ze["[object Date]"]=Ze["[object Error]"]=Ze["[object Function]"]=Ze["[object Map]"]=Ze["[object Number]"]=Ze["[object Object]"]=Ze["[object RegExp]"]=Ze["[object Set]"]=Ze["[object String]"]=Ze["[object WeakMap]"]=!1;const $e=function(e){return Ne(e)&&Qe(e.length)&&!!Ze[P(e)]};const He=function(e){return function(t){return e(t)}};var Ke="object"==typeof exports&&exports&&!exports.nodeType&&exports,Xe=Ke&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Xe&&Xe.exports===Ke&&x.process;const et=function(){try{var e=Xe&&Xe.require&&Xe.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var tt=et&&et.isTypedArray;const nt=tt?He(tt):$e;var at=Object.prototype.hasOwnProperty;const ot=function(e,t){var n=Ge(e),a=!n&&Pe(e),o=!n&&!a&&We(e),s=!n&&!a&&!o&&nt(e),r=n||a||o||s,i=r?Ee(e.length,String):[],c=i.length;for(var l in e)!t&&!at.call(e,l)||r&&("length"==l||o&&("offset"==l||"parent"==l)||s&&("buffer"==l||"byteLength"==l||"byteOffset"==l)||Je(l,c))||i.push(l);return i};var st=Object.prototype;const rt=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||st)};const it=function(e,t){return function(n){return e(t(n))}};const ct=it(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ut=function(e){if(!rt(e))return ct(e);var t=[];for(var n in Object(e))lt.call(e,n)&&"constructor"!=n&&t.push(n);return t};const dt=function(e){return null!=e&&Qe(e.length)&&!U(e)};const ft=function(e){return dt(e)?ot(e):ut(e)};const vt=function(e,t){return e&&Me(t,ft(t),e)};const ht=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var pt=Object.prototype.hasOwnProperty;const mt=function(e){if(!G(e))return ht(e);var t=rt(e),n=[];for(var a in e)("constructor"!=a||!t&&pt.call(e,a))&&n.push(a);return n};const yt=function(e){return dt(e)?ot(e,!0):mt(e)};const gt=function(e,t){return e&&Me(t,yt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,Dt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,It=Dt&&Dt.exports===bt?F.Buffer:void 0,St=It?It.allocUnsafe:void 0;const wt=function(e,t){if(t)return e.slice();var n=e.length,a=St?St(n):new e.constructor(n);return e.copy(a),a};const jt=function(e,t){var n=-1,a=e.length;for(t||(t=Array(a));++n<a;)t[n]=e[n];return t};const kt=function(e,t){for(var n=-1,a=null==e?0:e.length,o=0,s=[];++n<a;){var r=e[n];t(r,n,e)&&(s[o++]=r)}return s};const xt=function(){return[]};var Tt=Object.prototype.propertyIsEnumerable,Ft=Object.getOwnPropertySymbols;const Lt=Ft?function(e){return null==e?[]:(e=Object(e),kt(Ft(e),(function(t){return Tt.call(e,t)})))}:xt;const Mt=function(e,t){return Me(e,Lt(e),t)};const Et=function(e,t){for(var n=-1,a=t.length,o=e.length;++n<a;)e[o+n]=t[n];return e};const Nt=it(Object.getPrototypeOf,Object);const At=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Et(t,Lt(e)),e=Nt(e);return t}:xt;const Rt=function(e,t){return Me(e,At(e),t)};const Ot=function(e,t,n){var a=t(e);return Ge(e)?a:Et(a,n(e))};const _t=function(e){return Ot(e,ft,Lt)};const Ct=function(e){return Ot(e,yt,At)};const Pt=te(F,"DataView");const Gt=te(F,"Promise");const Ut=te(F,"Set");const Vt=te(F,"WeakMap");var Bt="[object Map]",zt="[object Promise]",Wt="[object Set]",qt="[object WeakMap]",Jt="[object DataView]",Qt=J(Pt),Zt=J(ne),$t=J(Gt),Ht=J(Ut),Kt=J(Vt),Xt=P;(Pt&&Xt(new Pt(new ArrayBuffer(1)))!=Jt||ne&&Xt(new ne)!=Bt||Gt&&Xt(Gt.resolve())!=zt||Ut&&Xt(new Ut)!=Wt||Vt&&Xt(new Vt)!=qt)&&(Xt=function(e){var t=P(e),n="[object Object]"==t?e.constructor:void 0,a=n?J(n):"";if(a)switch(a){case Qt:return Jt;case Zt:return Bt;case $t:return zt;case Ht:return Wt;case Kt:return qt}return t});const Yt=Xt;var en=Object.prototype.hasOwnProperty;const tn=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&en.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const nn=F.Uint8Array;const an=function(e){var t=new e.constructor(e.byteLength);return new nn(t).set(new nn(e)),t};const on=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var sn=/\w*$/;const rn=function(e){var t=new e.constructor(e.source,sn.exec(e));return t.lastIndex=e.lastIndex,t};var cn=L?L.prototype:void 0,ln=cn?cn.valueOf:void 0;const un=function(e){return ln?Object(ln.call(e)):{}};const dn=function(e,t){var n=t?an(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const fn=function(e,t,n){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return an(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return on(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return dn(e,n);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return rn(e);case"[object Symbol]":return un(e)}};var vn=Object.create;const hn=function(){function e(){}return function(t){if(!G(t))return{};if(vn)return vn(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const pn=function(e){return"function"!=typeof e.constructor||rt(e)?{}:hn(Nt(e))};const mn=function(e){return Ne(e)&&"[object Map]"==Yt(e)};var yn=et&&et.isMap;const gn=yn?He(yn):mn;const bn=function(e){return Ne(e)&&"[object Set]"==Yt(e)};var Dn=et&&et.isSet;const In=Dn?He(Dn):bn;var Sn="[object Arguments]",wn="[object Function]",jn="[object Object]",kn={};kn[Sn]=kn["[object Array]"]=kn["[object ArrayBuffer]"]=kn["[object DataView]"]=kn["[object Boolean]"]=kn["[object Date]"]=kn["[object Float32Array]"]=kn["[object Float64Array]"]=kn["[object Int8Array]"]=kn["[object Int16Array]"]=kn["[object Int32Array]"]=kn["[object Map]"]=kn["[object Number]"]=kn[jn]=kn["[object RegExp]"]=kn["[object Set]"]=kn["[object String]"]=kn["[object Symbol]"]=kn["[object Uint8Array]"]=kn["[object Uint8ClampedArray]"]=kn["[object Uint16Array]"]=kn["[object Uint32Array]"]=!0,kn["[object Error]"]=kn[wn]=kn["[object WeakMap]"]=!1;const xn=function e(t,n,a,o,s,r){var i,c=1&n,l=2&n,u=4&n;if(a&&(i=s?a(t,o,s,r):a(t)),void 0!==i)return i;if(!G(t))return t;var d=Ge(t);if(d){if(i=tn(t),!c)return jt(t,i)}else{var f=Yt(t),v=f==wn||"[object GeneratorFunction]"==f;if(We(t))return wt(t,c);if(f==jn||f==Sn||v&&!s){if(i=l||v?{}:pn(t),!c)return l?Rt(t,gt(i,t)):Mt(t,vt(i,t))}else{if(!kn[f])return s?t:{};i=fn(t,f,c)}}r||(r=new je);var h=r.get(t);if(h)return h;r.set(t,i),In(t)?t.forEach((function(o){i.add(e(o,n,a,o,t,r))})):gn(t)&&t.forEach((function(o,s){i.set(s,e(o,n,a,s,t,r))}));var p=d?void 0:(u?l?Ct:_t:l?yt:ft)(t);return ke(p||t,(function(o,s){p&&(o=t[s=o]),Le(i,s,e(o,n,a,s,t,r))})),i};const Tn=function(e){return xn(e,5)};var Fn=/\s/;const Ln=function(e){for(var t=e.length;t--&&Fn.test(e.charAt(t)););return t};var Mn=/^\s+/;const En=function(e){return e?e.slice(0,Ln(e)+1).replace(Mn,""):e};const Nn=function(e){return"symbol"==typeof e||Ne(e)&&"[object Symbol]"==P(e)};var An=/^[-+]0x[0-9a-f]+$/i,Rn=/^0b[01]+$/i,On=/^0o[0-7]+$/i,_n=parseInt;const Cn=function(e){if("number"==typeof e)return e;if(Nn(e))return NaN;if(G(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=G(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=En(e);var n=Rn.test(e);return n||On.test(e)?_n(e.slice(2),n?2:8):An.test(e)?NaN:+e};var Pn=1/0;const Gn=function(e){return e?(e=Cn(e))===Pn||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const Un=function(e){var t=Gn(e),n=t%1;return t==t?n?t-n:t:0};const Vn=function(e,t){for(var n=-1,a=null==e?0:e.length,o=Array(a);++n<a;)o[n]=t(e[n],n,e);return o};var Bn=L?L.prototype:void 0,zn=Bn?Bn.toString:void 0;const Wn=function e(t){if("string"==typeof t)return t;if(Ge(t))return Vn(t,e)+"";if(Nn(t))return zn?zn.call(t):"";var n=t+"";return"0"==n&&1/t==-Infinity?"-0":n};const qn=function(e){return null==e?"":Wn(e)};var Jn=F.isFinite,Qn=Math.min;const Zn=function(e){var t=Math[e];return function(e,n){if(e=Cn(e),(n=null==n?0:Qn(Un(n),292))&&Jn(e)){var a=(qn(e)+"e").split("e"),o=t(a[0]+"e"+(+a[1]+n));return+((a=(qn(o)+"e").split("e"))[0]+"e"+(+a[1]-n))}return t(e)}}("round");var $n=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};function Hn(n,a,o,s){return $n(this,void 0,void 0,(function*(){const s=a.lrsUrl,r=`${s}/applyEdits`,i=yield e.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[],l={id:a.serviceId,mergeEvents:{objectIds:o.objectIds,objectIdToPreserve:o.objectIdToPreserve,fromDate:o.fromDate?(0,t.getDateToUTC)(o.fromDate):null,toDate:o.toDate?(0,t.getDateToUTC)(o.toDate):null,attributes:o.attributes}};c.push(l);let u=n.getGDBVersion();u||(u="");return function(t){return $n(this,void 0,void 0,(function*(){return new Promise((function(n,a){const o={params:t.params,httpMethod:t.method};e.esri.restRequest.request(t.url,o).then((e=>{n(e)})).catch((e=>{n(e)}))}))}))}({method:"GET",url:r,params:{f:"json",token:i,gdbVersion:u,edits:c}}).then((e=>$n(this,void 0,void 0,(function*(){const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message),t}))))}))}const Kn="#00FFFF",Xn="#008000";var Yn=f(68972),ea=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};const ta=e.React.forwardRef(((n,s)=>{const r=e.hooks.useTranslation(o),{widgetId:i,jimuMapView:l,network:u,eventDS:d,networkDS:f,eventLayer:v,networkLayer:h,routeInfo:p,reset:m,eventFeatures:y,preservedEventIndex:g,flashGraphic:b,onSubmit:D,toastMsgType:I,onUpdateToastMsgType:S,onUpdateToastMsg:w,onUpdateToastOpen:j,onUpdateStopQuery:k,onValidationChanged:x,intl:T,lockAquired:F,conflictPreventionEnabled:L}=n,[M,E]=e.React.useState(),[N,A]=e.React.useState(!1),[R,O]=e.React.useState();(0,Yn.useImperativeHandle)(s,(()=>({onSubmitClicked:W}))),e.React.useEffect((()=>{g>-1&&y.length>0&&_()}),[g]),e.React.useEffect((()=>{(m||0===y.length)&&E(C())}),[m,y]),e.React.useEffect((()=>{E(C())}),[d,v]),e.React.useEffect((()=>{if(L){const e=Object.assign({},R);(0,t.isDefined)(u)&&(e.networkId=[u.networkInfo.lrsNetworkId]),(0,t.isDefined)(v)&&(e.eventServiceLayerIds=[v.serviceId]),(0,t.isDefined)(p)&&(e.routeInfo=p),O(e)}}),[f,u,v,p]);const _=()=>{const e=[];if((0,t.isDefined)(v)&&(0,t.isDefined)(d)&&(0,t.isDefined)(v.eventInfo)&&(0,t.isDefined)(v.eventInfo.attributeFields)){const n=d,a=(null==n?void 0:n.layer).fields;v.eventInfo.attributeFields.forEach((n=>{if(n.enabled){const o=a.find((e=>e.name===n.field.name));if(o&&o.editable){let a,s=y[g].attributes[o.name];(0,t.isDate)(o.type)&&(0,t.isDefined)(s)?s=new Date(s):a=(0,t.isDate)(o.type)?(0,t.isDefined)(o.defaultValue)?new Date(o.defaultValue):null:o.defaultValue;const r={index:e.length,name:o.name,alias:o.alias,type:o.type,hasDomain:(0,t.isDefined)(o.domain),value:s,error:"",nullable:o.nullable,default:"number"==typeof a?Number(a).toString():a,length:o.length,editable:n.editable};e.push(r)}}}))}setTimeout((()=>{E(e)}),500)},C=()=>{const e=[];if((0,t.isDefined)(v)&&(0,t.isDefined)(d)&&(0,t.isDefined)(v.eventInfo)&&(0,t.isDefined)(v.eventInfo.attributeFields)){const n=d,a=(null==n?void 0:n.layer).fields;v.eventInfo.attributeFields.forEach((n=>{if(n.enabled){const o=a.find((e=>e.name===n.field.name));if(o){let a;a=(0,t.isDate)(o.type)?(0,t.isDefined)(o.defaultValue)?new Date(o.defaultValue):null:o.defaultValue;const s={index:e.length,name:o.name,alias:o.alias,type:o.type,hasDomain:(0,t.isDefined)(o.domain),value:a,error:"",nullable:o.nullable,default:"number"==typeof a?Number(a).toString():a,length:o.length,editable:n.editable};e.push(s)}}}))}return e},P=e=>e.findIndex((e=>e.error.length>0))>-1,G=e=>{const t=Tn(e);E(t),A(P(t))},U=e=>{let n=!0;const a=e.attributes[v.eventInfo.fromDateFieldName],o=(0,t.getDateToUTC)(p.selectedFromDate),s=(0,t.getDateToUTC)(p.selectedToDate);return(0,t.isDefined)(p.selectedFromDate)&&!(0,t.isDefined)(p.selectedToDate)&&(0,t.isDefined)(a)&&(n=n&&o>=a),!(0,t.isDefined)(p.selectedFromDate)&&(0,t.isDefined)(p.selectedToDate)&&(0,t.isDefined)(a)&&(n=n&&s>a),(0,t.isDefined)(p.selectedFromDate)&&(0,t.isDefined)(p.selectedToDate)&&(n=n&&o<s,(0,t.isDefined)(a)&&(n=n&&(o>=a||s>a))),n},V=()=>ea(void 0,void 0,void 0,(function*(){var t;const n=d,a=n.getPopupInfo(),o=n.getLayerDefinition(),s=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==o?void 0:o.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter((e=>e.visible))),r=n.mergeQueryParams(null!==(t=n.getCurrentQueryParams())&&void 0!==t?t:{},{where:"1=1",sqlExpression:null}),c=Object.assign({returnGeometry:!0},r);yield n.load(c,{widgetId:i});const l=new e.DataRecordSetChangeMessage(i,e.RecordSetChangeType.CreateUpdate,[{records:n.getRecords(),fields:s.map((e=>e.fieldName)),dataSource:n,name:n.id}]);e.MessageManager.getInstance().publishMessage(l)})),B=e=>ea(void 0,void 0,void 0,(function*(){var n;if(!(yield a(!1,y,r,v,h,f,I,S,w,j)))return;if(!(yield ea(void 0,void 0,void 0,(function*(){let e=!0;return(0,c.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine"]).then((t=>{let n=null;[n]=t;for(let t=0;t<y.length;t++){for(let a=0;a<y.length;a++)if(a!==t){if(!n.disjoint(y[t].geometry,y[a].geometry)||y[t].attributes[v.eventInfo.routeIdFieldName]===y[a].attributes[v.eventInfo.routeIdFieldName]&&(y[t].attributes[v.eventInfo.fromMeasureFieldName]===y[a].attributes[v.eventInfo.toMeasureFieldName]||y[t].attributes[v.eventInfo.toMeasureFieldName]===y[a].attributes[v.eventInfo.fromMeasureFieldName]))break;a===y.length-1&&(e=!1)}if(!e){S("error"),w(r("eventsNotCoincident")),j(!0),setTimeout((()=>{j(!1)}),5e3);break}}return e}))}))))return;if((()=>{const e=Tn(M);let n=!1;return e.forEach((e=>{let a;if(a=e.hasDomain?(0,t.validateRangeDomain)(e.value,e.name,d):((0,t.isDate)(e.type),(0,t.validateField)(e.value,e.name,d)),a.hasError){S("error");const o=v.useFieldAlias?e.alias:e.name;w((0,t.formatMessage)(T,"attributeError",{fieldValue:o,message:(0,t.formatMessage)(T,a.message)})),j(!0),setTimeout((()=>{j(!1)}),5e3),n=!0,e.error=(0,t.formatMessage)(T,a.message)}})),n&&G(e),n})())return;if(!(()=>{let e="";const n=[],a=[],o=[];for(let e=0;e<y.length;e++){const s=y[e],r=s.attributes[d.getSchema().idField];null!=s.attributes[v.eventInfo.toDateFieldName]?n.push(r):null!=s.attributes[v.eventInfo.fromDateFieldName]&&s.attributes[v.eventInfo.fromDateFieldName]>(0,t.getDateToUTC)(new Date(Date.now()))?a.push(r):U(s)||o.push(r)}return n.length>0?e=r("eventsToDateNotNull",{objectIds:n.join(", ")}):a.length>0?e=r("eventsNotActiveToday",{objectIds:a.join(", ")}):o.length>0&&(e=r("eventNotOverlapMergeDates",{objectIds:o.join(", ")})),!(e.length>0&&(S("error"),w(e),j(!0),setTimeout((()=>{j(!1)}),5e3),1))})())return;const o={};if((0,t.isDefined)(v)&&g>-1&&y.length>0){const e={},a=v.eventInfo.eventIdFieldName;e[a]=y[g].attributes[v.eventInfo.eventIdFieldName];const s=y[0].attributes[v.eventInfo.routeIdFieldName],r=y[y.length-1].attributes[v.eventInfo.routeIdFieldName];let i=Zn(y[0].attributes[v.eventInfo.fromMeasureFieldName],u.networkInfo.measurePrecision);const c=Zn(y[y.length-1].attributes[v.eventInfo.fromMeasureFieldName],u.networkInfo.measurePrecision);s===r&&c<i&&(i=c);const l=v.eventInfo.fromMeasureFieldName;e[l]=i;const f=y[0].attributes[v.eventInfo.toRouteIdFieldName],h=y[y.length-1].attributes[v.eventInfo.toRouteIdFieldName],m=Zn(y[0].attributes[v.eventInfo.toMeasureFieldName],u.networkInfo.measurePrecision);let b=Zn(y[y.length-1].attributes[v.eventInfo.toMeasureFieldName],u.networkInfo.measurePrecision);f===h&&m>b&&(b=m);const D=v.eventInfo.toMeasureFieldName;e[D]=b,M.forEach((n=>{const a=n.name;if((0,t.isDefined)(n.value)&&(0,t.isDate)(n.type)){const o=(0,t.getDateWithoutTZOffset)(n.value.valueOf(),d);e[a]=(0,t.getDateToUTC)(o)}else(0,t.isNumber)(n.type)?!(0,t.isDefined)(n.value)||isNaN(Number(n.value))?e[a]=null:e[a]=Number(n.value):e[a]=n.value}));const I=null===(n=d.getSchema())||void 0===n?void 0:n.idField,S=[];if(y.forEach((e=>{S.push(e.attributes[I])})),o.attributes=e,o.objectIdToPreserve=y[g].attributes[I],o.objectIds=S,(0,t.isDefined)(p.selectedFromDate)){const e=(0,t.getDateWithoutTZOffset)(p.selectedFromDate.valueOf(),d);o.fromDate=e}else o.fromDate=p.selectedFromDate;if((0,t.isDefined)(p.selectedToDate)){const e=(0,t.getDateWithoutTZOffset)(p.selectedToDate.valueOf(),d);o.toDate=e}else o.toDate=p.selectedToDate}const s=d;yield Hn(s,v,o).then((n=>ea(void 0,void 0,void 0,(function*(){if(n.success){if((0,t.isDefined)(v)&&(0,t.isDefined)(d)){const e=d;(0,t.queryEventsByEventObjectIds)(e,n.editResults[0].mergeEventsResult.objectIds).then((e=>{e.forEach(((e,n)=>ea(void 0,void 0,void 0,(function*(){const n=e.geometry;(0,t.isDefined)(n)&&(0,t.flash)(b,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(n),Kn))}))))}))}S("success"),w(r("eventMerged")),j(!0),V(),setTimeout((()=>ea(void 0,void 0,void 0,(function*(){j(!1),S("error"),k(!1);const n=l.jimuLayerViews,a=Object.keys(n);for(let e=0;e<a.length;e++){const t=n[a[e]];t.layer.title===v.name&&t.selectFeaturesByIds([])}if(L&&(0,t.isDefined)(e)){yield(0,t.tryReleaseLockOnDefault)(f,e);const n=Object.assign(Object.assign({},R),{lockAction:t.LockAction.Clear});O(n)}else D()}))),5e3)}else S("error"),w(n.message),j(!0),setTimeout((()=>{j(!1)}),5e3)}))))})),z=e.React.useCallback((()=>{if(!(0,t.isDefined)(p.selectedFromDate)&&!(0,t.isDefined)(p.selectedToDate))return!1;if((0,t.isDefined)(p.selectedFromDate)&&!(0,t.isDefined)(p.selectedToDate)){if((0,t.isDefined)(p.fromDate)&&p.selectedFromDate<p.fromDate)return!1;if((0,t.isDefined)(p.toDate)&&p.selectedFromDate>p.toDate)return!1}if(!(0,t.isDefined)(p.selectedFromDate)&&(0,t.isDefined)(p.selectedToDate)){if((0,t.isDefined)(p.fromDate)&&p.selectedToDate<p.fromDate)return!1;if((0,t.isDefined)(p.toDate)&&p.selectedToDate>p.toDate)return!1}if((0,t.isDefined)(p.selectedFromDate)&&(0,t.isDefined)(p.selectedToDate)){if(p.selectedFromDate>p.selectedToDate)return!1;if((0,t.isDefined)(p.fromDate)&&p.selectedFromDate<p.fromDate)return!1;if((0,t.isDefined)(p.toDate)&&p.selectedToDate>p.toDate)return!1}return!N&&(0!==y.length&&(-1!==g&&!!F))}),[p]),W=()=>{if(L){const e=Object.assign(Object.assign({},R),{lockAction:t.LockAction.QueryAndAcquire});O(e)}else B()};return e.React.useEffect((()=>{x(z())}),[z,x]),(0,e.jsx)("div",{className:"merge-events-edit-attributes__content",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .merge-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events-edit-attributes__action {
      height: 100%;
    }
  `},(0,e.jsx)("div",{className:"h-100"},L&&(0,e.jsx)(t.LockManagerComponent,{intl:T,featureDS:f,lockInfo:R,showAlert:!1,conflictPreventionEnabled:L,onQueryAndAcquireComplete:(e,n,a)=>{const o=Object.assign(Object.assign({},e),{lockAction:t.LockAction.None});O(o),a&&B(o)},onMessageClear:()=>{const e=Object.assign(Object.assign({},R),{lockAction:t.LockAction.None});O(e),D()}}),(0,e.jsx)(t.AttributeTable,{tableIndex:0,collapable:!1,eventDS:d,eventLayer:v,fieldInfos:M,useAlias:!(0,t.isDefined)(v)||v.useFieldAlias,onUpdateItem:(e,t,n)=>{const a=Tn(M);a[n].value=e,a[n].error=t,E(a),A(P(a))},onUpdateAll:G,tableLabel:r("mergedEventAttributesLabel")})))}));function na(t){const{network:n,event:a,dataSourcesReady:o,onCreateNetworkDs:s,onCreateEventDs:r}=t,[i,c]=e.React.useState(null!=n?n:null),[l,u]=e.React.useState(null!=a?a:null),[d,f]=e.React.useState(!1),[v,h]=e.React.useState(!1);e.React.useEffect((()=>{n&&c(n)}),[n]),e.React.useEffect((()=>{a&&u(a)}),[a]),e.React.useEffect((()=>{o(d&&v)}),[o,v,d]);const p=e.React.useCallback((e=>{s(e)}),[s]),m=e.React.useCallback((e=>{r(e)}),[r]),y=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),g=e.React.useCallback((t=>{if(t){const{status:n,instanceStatus:a}=t;a===e.DataSourceStatus.NotCreated||a===e.DataSourceStatus.CreateError||n===e.DataSourceStatus.LoadError||n===e.DataSourceStatus.NotReady?h(!1):h(!0)}}),[h]),b=e.React.useCallback((()=>{f(!1)}),[f]),D=e.React.useCallback((()=>{h(!1)}),[h]);return(0,e.jsx)("div",null,i&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:i.useDataSource,onDataSourceInfoChange:y,onCreateDataSourceFailed:b,onDataSourceCreated:p}),l&&(0,e.jsx)(e.DataSourceComponent,{useDataSource:l.useDataSource,onDataSourceInfoChange:g,onCreateDataSourceFailed:D,onDataSourceCreated:m}))}var aa=f(98640),oa=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};const sa=f(62838);function ra(n){const a=e.hooks.useTranslation(o),{network:r,eventDS:i,eventLayer:c,clearPickedGraphic:l,eventFeatures:u,onEventRemoved:d,onPreservedEventIndexChanged:f,preservedEventIndex:v,flashGraphic:h}=n;e.React.useEffect((()=>{(0,t.isDefined)(r)&&l()}),[r]);const p={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:aa.TreeItemActionType.RenderOverrideItem,children:[{name:aa.TreeItemActionType.RenderOverrideItemDroppableContainer,withListGroupItemWrapper:!1,children:[{name:aa.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:aa.TreeItemActionType.RenderOverrideItemBody,children:[{name:aa.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:aa.TreeItemActionType.RenderOverrideItemDragHandle},{name:aa.TreeItemActionType.RenderOverrideItemTitle},{name:aa.TreeItemActionType.RenderOverrideItemDetailToggle},{name:aa.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},m=e=>{var n;if((0,t.isDefined)(c)&&(0,t.isDefined)(i)){const a=i,o=null===(n=i.getSchema())||void 0===n?void 0:n.idField;(0,t.queryEventsByEventObjectIds)(a,[u[e].attributes[o]]).then((e=>{e.forEach((e=>oa(this,void 0,void 0,(function*(){const n=e.geometry;(0,t.isDefined)(n)&&(0,t.flash)(h,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(n),Kn))}))))}))}};return(0,e.jsx)("div",{className:"merge-events-list-form d-flex w-100 pt-1 px-3"},r&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},a("eventListLabel")),(0,e.jsx)("div",{className:"setting-ui-unit-list w-100"},(0,e.jsx)(aa.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(u).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateChecked:v===t,itemStateTitle:e.attributes[i.getSchema().idField],itemStateCommands:[{label:a("remove"),iconProps:()=>({icon:sa,size:12}),action:({data:e})=>{d(t)}}]}))),renderOverrideItemDetailToggle:(t,n)=>n.props.itemJsons[0].itemStateChecked?(0,e.jsx)("div",{style:{fontWeight:500}},a("preserveLabel")):"",onClickItemBody:(e,t)=>{const{itemJsons:[n]}=t.props;f(+n.itemKey),m(+n.itemKey)}},p)))))}function ia(n){const a=e.hooks.useTranslation(o),{routeInfo:r,reset:i,onUpdateRouteInfo:c,currentSketchVM:l,isEventPickerActive:u,onUpdateIsEventPickerActive:d}=n,[f,v]=e.React.useState(!1),[h,p]=e.React.useState(!1),[m,y]=e.React.useState(!0);e.React.useEffect((()=>{i&&(v(!1),p(!1))}),[i]),e.React.useEffect((()=>{let e=!1;const n=Object.assign({},r);(0,t.isDefined)(r.selectedFromDate)&&f&&r.selectedFromDate!==r.fromDate&&(n.selectedFromDate=r.fromDate,e=!0),h&&r.selectedToDate!==r.toDate&&(n.selectedToDate=r.toDate,e=!0),e&&c(n)}),[c,r,f,h]);const g=()=>{l&&(m&&l.cancel(),l.create("rectangle"))};return(0,e.jsx)("div",{className:"merge-events-change-event-selection-form px-3 w-100 pt-3"},(0,e.jsx)(s.Button,{role:"button","aria-label":a("selectButtonLabel"),title:a("selectButtonLabel"),size:"sm",type:u?"primary":"secondary",className:"w-100 px-3",onClick:()=>{y(!0),g();d(!u)}},a("selectButtonLabel")))}var ca=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};const la=()=>e.css`
    display: flex;
    flex-direction: column;

    .merge-events-event-selection-form__content {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100%;
    flex: 1 1 auto;
    overflow: auto;
    }
    .merge-events-event-selection-form__actions {
    height: 100%;
    }
`;function ua(n){const{widgetId:a,network:o,networkDS:s,eventDS:r,eventLayer:i,reset:c,jimuMapView:l,hoverGraphic:u,pickedGraphic:d,flashGraphic:f,currentSketchVM:v,eventFeatures:h,onEventRemoved:p,onPreservedEventIndexChanged:m,preservedEventIndex:y,isEventPickerActive:g,onUpdateIsEventPickerActive:b}=n,[D,I]=e.React.useState((0,t.getInitialRouteInfoState)());e.React.useEffect((()=>{(0,t.isDefined)(o)&&(I((0,t.getInitialRouteInfoState)()),S())}),[o]),e.React.useEffect((()=>{c&&(I((0,t.getInitialRouteInfoState)()),S())}),[c]);const S=()=>{(0,t.isDefined)(d)&&d.removeAll()},w=(e,n)=>ca(this,void 0,void 0,(function*(){var a;(0,t.isDefined)(e.selectedPolyline)&&n&&(a=yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(e.selectedPolyline),Kn),(0,t.isDefined)(a)&&(f.add(a),setTimeout((()=>{f.removeAll(),setTimeout((()=>{f.add(a),setTimeout((()=>{f.removeAll(),setTimeout((()=>{f.add(a),setTimeout((()=>{f.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,t.isDefined)(e.selectedPoint)?(e=>{(0,t.isDefined)(e)?(d.removeAll(),d.add(e)):S()})(yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e.selectedPoint),Xn)):S()}));return(0,e.jsx)("div",{className:"merge-events-event-selection-form__content d-flex",css:la()},(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(ra,{widgetId:a,network:o,networkDS:s,eventDS:r,eventLayer:i,routeInfo:D,jimuMapView:l,hoverGraphic:u,reset:c,clearPickedGraphic:S,eventFeatures:h,onEventRemoved:p,onPreservedEventIndexChanged:m,preservedEventIndex:y,flashGraphic:f})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(ia,{routeInfo:D,reset:c,onUpdateRouteInfo:(e,t=!1)=>{I(e),w(e,t)},networkDS:s,jimuMapView:l,currentSketchVM:v,isEventPickerActive:g,onUpdateIsEventPickerActive:b})))}function da(n){const a=e.hooks.useTranslation(o),{network:r,reset:i,clearPickedGraphic:c,eventLayer:l,eventFeatures:u,intl:d,resetForDataAction:f}=n,[v,h]=e.React.useState(a("chooseEventsFromMap")),[p,m]=e.React.useState(a("chooseEventsFromMap"));return e.React.useEffect((()=>{(0,t.isDefined)(l)&&(h(a("chooseEventsFromMap")),m(a("chooseEventsFromMap")),c())}),[l]),e.React.useEffect((()=>{if(c(),(0,t.isDefined)(u)&&0!==u.length){if((0,t.isDefined)(r)){const e=u[0].attributes[l.eventInfo.routeIdFieldName],t=u[u.length-1].attributes[l.eventInfo.routeIdFieldName];let n=Zn(u[0].attributes[l.eventInfo.fromMeasureFieldName],r.measurePrecision);const a=Zn(u[u.length-1].attributes[l.eventInfo.fromMeasureFieldName],r.measurePrecision);e===t&&a<n&&(n=a);const o=u[0].attributes[l.eventInfo.toRouteIdFieldName],s=u[u.length-1].attributes[l.eventInfo.toRouteIdFieldName],i=Zn(u[0].attributes[l.eventInfo.toMeasureFieldName],r.measurePrecision);let c=Zn(u[u.length-1].attributes[l.eventInfo.toMeasureFieldName],r.measurePrecision);o===s&&i>c&&(c=i),h(n.toString()),m(c.toString())}}else h(a("chooseEventsFromMap")),m(a("chooseEventsFromMap"))}),[u]),e.React.useEffect((()=>{i&&!f&&(h(a("chooseEventsFromMap")),m(a("chooseEventsFromMap")))}),[i]),(0,e.jsx)("div",{className:"route-and-measure-form d-flex w-100 pt-1 px-3"},r&&(0,e.jsx)("div",{className:"w-100"},(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},a("fromMeasureWithUnits",{units:(0,t.GetUnits)(r.unitsOfMeasure,d)})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0",style:{width:100,alignItems:"center"}},v)),(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},a("toMeasureWithUnits",{units:(0,t.GetUnits)(r.unitsOfMeasure,d)})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(s.Label,{size:"sm",className:"w-100 mb-0",style:{width:100,alignItems:"center"}},p))))}var fa=f(99037);function va(n){const a=e.hooks.useTranslation(o),{routeInfo:r,reset:i,onUpdateRouteInfo:c,eventLayer:l,intl:u}=n,[d,f]=e.React.useState(!1),[v,h]=e.React.useState(!1),[p,m]=e.React.useState("idle"),[y,g]=e.React.useState("idle"),[b,D]=e.React.useState(""),[I,S]=e.React.useState(""),[w,j]=e.React.useState(!0);e.React.useEffect((()=>{i&&(f(!1),h(!1),m("idle"),g("idle"),D(""),S(""),j(!1))}),[i]),e.React.useEffect((()=>{let e=!1;const n=Object.assign({},r);"idle"===p&&D(""),"idle"===y&&S(""),(0,t.isDefined)(r.selectedFromDate)&&d&&r.selectedFromDate!==r.fromDate&&(n.selectedFromDate=r.fromDate,e=!0),v&&r.selectedToDate!==r.toDate&&(n.selectedToDate=r.toDate,e=!0),e&&c(n)}),[c,r,d,v]),e.React.useEffect((()=>{j(!(null==l?void 0:l.eventInfo.canSpanRoutes))}),[l]);const k=(e,n)=>{const o=e;if(!(0,t.isDefined)(o))return n?m("idle"):g("idle"),n?D(""):S(""),!0;let s=!0;return(0,t.isDefined)(r.fromDate)&&o<r.fromDate?(n?m("invalid"):g("invalid"),n?D(a("invalidFromDateBefore")):S(a("invalidToDateBefore")),s=!1,!1):(0,t.isDefined)(r.toDate)&&o>r.toDate?(n?m("invalid"):g("invalid"),n?D(a("invalidFromDateAfter")):S(a("invalidToDateAfter")),s=!1,!1):((0,t.isDefined)(r.selectedToDate)&&n&&(o>r.selectedToDate&&(m("invalid"),n?D(a("invalidDatesOrder")):S(a("invalidDatesOrder")),s=!1),I===a("invalidDatesOrder")?o<r.selectedToDate&&(g("idle"),S("")):I===a("invalidDatesSameDay")&&o!==r.selectedFromDate&&(g("idle"),S(""))),(0,t.isDefined)(r.selectedToDate)&&n&&o.getTime()===r.selectedToDate.getTime()&&(m("invalid"),n?D(a("invalidDatesSameDay")):S(a("invalidDatesSameDay")),s=!1),(0,t.isDefined)(r.selectedFromDate)&&(n||(o<r.selectedFromDate&&(g("invalid"),n?D(a("invalidDatesOrder")):S(a("invalidDatesOrder")),s=!1),b===a("invalidDatesOrder")?o>r.selectedFromDate&&(m("idle"),D("")):b===a("invalidDatesSameDay")&&o!==r.selectedFromDate&&(m("idle"),D("")))),(0,t.isDefined)(r.selectedFromDate)&&(n||o.getTime()!==r.selectedFromDate.getTime()||(g("invalid"),n?D(a("invalidDatesSameDay")):S(a("invalidDatesSameDay")),s=!1)),s&&(n?m("idle"):g("idle"),n?D(""):S("")),!0)};return(0,e.jsx)("div",{className:"merge-events-date-form px-3 w-100",css:(0,t.getCalciteBasicTheme)()},(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},(0,t.formatMessage)(u,"startDateRequiredLabel")),(0,e.jsx)(s.Tooltip,{title:b},(0,e.jsx)(fa.CalciteInputDatePicker,{scale:"s",disabled:!!d||void 0,valueAsDate:r.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(k(n,!0),n){const e=Object.assign(Object.assign({},r),{selectedFromDate:n});c(e)}else{const e=Object.assign(Object.assign({},r),{selectedFromDate:null});c(e)}}},status:p,placement:"top",overlayPositioning:"fixed"})),(0,e.jsx)(s.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,e.jsx)(s.Checkbox,{checked:d,className:"mr-2",disabled:!w,onChange:(e,t)=>{k(r.fromDate,!0),f(t)}}),a("useStartDateLabel")),(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-1",style:{width:100,alignItems:"center",fontWeight:500}},a("endDateLabel")),(0,e.jsx)(s.Tooltip,{title:I},(0,e.jsx)(fa.CalciteInputDatePicker,{scale:"s",disabled:!!v||void 0,valueAsDate:r.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const n=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(k(n,!1),n){const e=Object.assign(Object.assign({},r),{selectedToDate:n});c(e)}else{const e=Object.assign(Object.assign({},r),{selectedToDate:null});c(e)}}},status:y,placement:"top",overlayPositioning:"fixed"})),(0,e.jsx)(s.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,e.jsx)(s.Checkbox,{checked:v,className:"mr-2",disabled:!w,onChange:(e,t)=>{k(r.toDate,!1),h(t)}}),a("useEndDateLabel")))}var ha=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};const pa=()=>e.css`
    display: flex;
    flex-direction: column;

    .merge-events-route-selection-form__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events-route-selection-form__actions {
      height: 100%;
    }
  `;function ma(n){const{widgetId:a,network:o,networkDS:s,reset:r,jimuMapView:i,hoverGraphic:c,pickedGraphic:l,flashGraphic:u,eventLayer:d,eventFeatures:f,routeInfo:v,onUpdateRouteInfo:h,intl:p,resetForDataAction:m}=n;e.React.useEffect((()=>{(0,t.isDefined)(o)&&y()}),[o]),e.React.useEffect((()=>{r&&y()}),[r]);const y=()=>{(0,t.isDefined)(l)&&l.removeAll()},g=(e,n)=>ha(this,void 0,void 0,(function*(){var a;(0,t.isDefined)(e.selectedPolyline)&&n&&(0,t.flash)(u,yield(0,t.getGeometryGraphic)(yield(0,t.getSimpleLineGraphic)(e.selectedPolyline),Kn)),(0,t.isDefined)(e.selectedPoint)?(a=yield(0,t.getGeometryGraphic)(yield(0,t.getSimplePointGraphic)(e.selectedPoint),Xn),(0,t.isDefined)(a)?(l.removeAll(),l.add(a)):y()):y()})),b=(e,t=!1)=>{h(e),g(e,t)};return(0,e.jsx)("div",{className:"merge-events-route-selection-form__content d-flex",css:pa()},(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(da,{widgetId:a,network:o,networkDS:s,routeInfo:v,jimuMapView:i,hoverGraphic:c,reset:r,clearPickedGraphic:y,onRouteInfoUpdated:b,eventLayer:d,eventFeatures:f,intl:p,resetForDataAction:m})),(0,e.jsx)("div",{className:"d-flex w-100"},(0,e.jsx)(va,{routeInfo:v,reset:r,eventLayer:d,onUpdateRouteInfo:b,intl:p})))}function ya(n){var a;const{widgetId:r,lrsLayers:i,hideTitle:c,eventLayers:u,defaultEvent:d,JimuMapView:f,hoverGraphic:v,pickedGraphic:h,flashGraphic:p,conflictPreventionEnabled:m,onClearGraphic:y,displayConfig:g,currentSketchVM:b,onUpdateSelectedEventLayer:D,onUpdateSelectedNetworkLayer:I,eventFeatures:S,onEventRemoved:w,preservedEventIndex:j,onPreservedEventIndexChanged:k,onUpdateEventFeatures:x,routeInfo:T,onUpdateRouteInfo:F,eventDS:L,eventLayer:M,onUpdateEventDS:E,networkDS:N,onUpdateNetworkDS:A,intl:R,isEventPickerActive:O,onUpdateIsEventPickerActive:_,onUpdateToastMsgType:C,onUpdateToastMsg:P,onUpdateToastOpen:G,onUpdateStopQuery:U,toastMsgType:V,toastMsg:B,toastOpen:z,resetForDataAction:W,onUpdateResetForDataAction:q}=n,[J,Q]=e.React.useState(null),[Z,$]=e.React.useState(!1),[H,K]=e.React.useState(!1),[X,Y]=e.React.useState((0,t.getIntialLocksInfo)()),[ee,te]=e.React.useState(!m),[ne,ae]=e.React.useState(!0),oe=e.React.useRef(null),se=e.hooks.useTranslation(o);e.React.useEffect((()=>{(0,t.isDefined)(J)&&F((0,t.getInitialRouteInfoState)())}),[J]),e.React.useEffect((()=>{H&&(F((0,t.getInitialRouteInfoState)()),W?S.length>0&&k(0):x([]))}),[H]);const re=e.React.useCallback((()=>{$(!0)}),[$]);e.React.useEffect((()=>{if(M){const n=i.find((e=>e.serviceId===M.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&(Q((0,e.Immutable)(n)),I((0,e.Immutable)(n)))}else{const t=i.find((e=>e.name===d.name));D((0,e.Immutable)(t))}}),[d,i,M,D,I]),e.React.useEffect((()=>{ie(t.LockAction.QueryAndAcquire,T)}),[T]),e.React.useEffect((()=>{ie(t.LockAction.None)}),[N,M,J]);const ie=e.React.useCallback(((e=t.LockAction.None,n)=>{if(m){const a=Object.assign({},X);(0,t.isDefined)(J)&&(a.networkId=[J.networkInfo.lrsNetworkId]),(0,t.isDefined)(M)&&(a.eventServiceLayerIds=[M.serviceId]),(0,t.isDefined)(n)&&(a.routeInfo=n),a.lockAction=e,Y(a)}}),[m,M,X,J]),ce=e.React.useCallback((n=>{const a=i.find((e=>e.name===n));if(a){const n=i.find((e=>e.serviceId===a.eventInfo.parentNetworkId));n&&n.layerType===t.LrsLayerType.network&&(Q((0,e.Immutable)(n)),I((0,e.Immutable)(n))),D((0,e.Immutable)(a))}}),[i,D,I]),le=e.React.useCallback((e=>{F(e)}),[F]),ue=e.React.useCallback((()=>{F((0,t.getInitialRouteInfoState)()),ie(t.LockAction.Clear,(0,t.getInitialRouteInfoState)()),K(!0),setTimeout((()=>{K(!1)}),800)}),[ie,F]),de=e.React.useCallback((()=>{ue(),f.clearSelectedFeatures()}),[f,ue]);e.React.useEffect((()=>{W&&(k(-1),ue(),setTimeout((()=>{q(!1)}),100))}),[W,ue,q,k]);const fe=e.React.useMemo((()=>!!(Z&&(0,t.isDefined)(f)&&(0,t.isDefined)(null==f?void 0:f.view))),[f,Z]),ve=e.React.useCallback((()=>{y(),ue()}),[]),he=e.React.useCallback(((e,t,n)=>{te(!!n),Y(e)}),[]),pe=e.React.useCallback((e=>{ae(e)}),[]);return(0,e.jsx)("div",{className:"merge-events h-100 d-flex",css:e.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .merge-events-form {
      height: 100%;
    }

    .merge-events__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .merge-events__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .merge-events__toast {
      position: relative;
      top: 4%;
    }
    .merge-events-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},!c&&(0,e.jsx)(l,null),(0,e.jsx)("div",{className:"merge-events__content"},(0,e.jsx)(na,{network:J,event:M,dataSourcesReady:re,onCreateNetworkDs:A,onCreateEventDs:E}),m&&(0,e.jsx)(t.LockManagerComponent,{intl:R,featureDS:N,showAlert:!0,lockInfo:X,networkName:null===(a=null==J?void 0:J.networkInfo)||void 0===a?void 0:a.datasetName,conflictPreventionEnabled:m,onQueryAndAcquireComplete:he,onMessageClear:()=>{ie(t.LockAction.None)}}),!g.hideEvent&&(0,e.jsx)("div",null,(0,e.jsx)(s.Label,{size:"sm",className:"mb-0 pt-3 px-3 w-100",style:{fontWeight:500}},(0,t.formatMessage)(R,"eventRequiredLabel")),(0,e.jsx)(s.Select,{"aria-label":(0,t.formatMessage)(R,"eventRequiredLabel"),className:"w-100 px-3",size:"sm",value:M?M.name:"",disabled:1===u.length,onChange:e=>{ce(e.target.value)}},u.map(((t,n)=>(0,e.jsx)("options",{key:n,value:t},t))))),(0,e.jsx)(ua,{widgetId:r,network:J?J.networkInfo:null,isReady:fe&&(null==f?void 0:f.view.ready),networkDS:N,eventDS:L,eventLayer:M,reset:H,jimuMapView:f,hoverGraphic:v,pickedGraphic:h,flashGraphic:p,onsubmit:le,onReset:ue,currentSketchVM:b,eventFeatures:S,onEventRemoved:w,onPreservedEventIndexChanged:k,preservedEventIndex:j,isEventPickerActive:O,onUpdateIsEventPickerActive:_}),(0,e.jsx)(ma,{widgetId:r,network:J?J.networkInfo:null,isReady:fe&&(null==f?void 0:f.view.ready),networkDS:N,reset:H,jimuMapView:f,hoverGraphic:v,pickedGraphic:h,flashGraphic:p,onsubmit:le,onReset:ue,eventLayer:M,eventFeatures:S,routeInfo:T,onUpdateRouteInfo:F,intl:R,resetForDataAction:W}),(0,e.jsx)(ta,{ref:oe,widgetId:r,network:J,jimuMapView:f,eventDS:L,networkDS:N,eventLayer:M,networkLayer:J,routeInfo:T,reset:H,eventFeatures:S,preservedEventIndex:j,flashGraphic:p,onSubmit:ve,onUpdateToastMsgType:C,onUpdateToastMsg:P,onUpdateToastOpen:G,onUpdateStopQuery:U,onValidationChanged:pe,intl:R,lockAquired:ee,conflictPreventionEnabled:m,toastMsgType:V})),(0,e.jsx)("div",{className:"merge-events-footer w-100"},(0,e.jsx)("div",{className:"merge-events-edit-attributes__action w-100 d-flex"},(0,e.jsx)(s.Label,{size:"sm",className:" mt-auto mr-auto",style:{fontWeight:500,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500)"},onClick:de},"Reset"),(0,e.jsx)(s.Tooltip,{title:se("mergeLabel")},(0,e.jsx)("div",{className:"mt-auto ml-auto"},(0,e.jsx)(s.Button,{className:"active","aria-label":se("mergeLabel"),size:"sm",disabled:!ne,onClick:()=>{var e;null===(e=oe.current)||void 0===e||e.onSubmitClicked()}},se("mergeLabel")))))),z&&(0,e.jsx)("div",{className:"merge-events__toast-container px-3 w-100"},(0,e.jsx)(s.Alert,{className:"merge-events__toast w-100",type:V,text:B,closable:!0,withIcon:!0,open:z,onClose:()=>{G(!1)}})))}var ga=f(59620),ba=f(10624),Da=f(22089),Ia=function(e,t,n,a){return new(n||(n=Promise))((function(o,s){function r(e){try{c(a.next(e))}catch(e){s(e)}}function i(e){try{c(a.throw(e))}catch(e){s(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(r,i)}c((a=a.apply(e,t||[])).next())}))};const Sa=e.css`
  background-color: var(--ref-palette-white);
`;class wa extends e.React.PureComponent{constructor(n){super(n),this.componentDidMount=()=>{var e;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedEventLyr)&&this.setState({selectedEventLayer:this.props.selectedEventLyr,resetForDataAction:!0});const n=(0,t.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:n})},this.selectFeaturesByGraphic=(e,t,n,...a)=>Ia(this,[e,t,n,...a],void 0,(function*(e,t,n,a=!1){return(0,c.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine"]).then((o=>Ia(this,void 0,void 0,(function*(){const s=o[0];let r=e.geometry;if("point"===r.type||"polyline"===r.type){const e=2.54*this.state.jimuMapView.view.scale/9600;r=s.buffer(r,10*e,"meters")}const i={geometry:r,spatialRelationship:t,returnGeometry:!0,returnZ:!0};a&&(i.outFields=["*"]);const l=this.state.jimuMapView.jimuLayerViews,u=Object.keys(l),d=[];for(let e=0;e<u.length;e++){const t=l[u[e]];if((t.type===c.LayerTypes.FeatureLayer||t.type===c.LayerTypes.SceneLayer)&&t.layer.title===this.state.selectedEventLayer.name&&t.selectFeaturesByQuery){const e=t.selectFeaturesByQuery(i,n);d.push(e)}}return this.state.jimuMapView.onSelectByQueryProgressChange(),Promise.all(d)}))))})),this.onUpdateStopQuery=e=>{this.setState({stopQuery:e})},this.onJimuLayerViewSelectedFeaturesChange=e=>{this.state.stopQuery||e.layer.title===this.state.selectedEventLayer.name&&setTimeout((()=>{this.querySelectedFeatures(this.state.jimuMapView)}),100)},this.onActiveViewChange=e=>Ia(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.state.jimuMapView&&this.state.jimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),this.setState({jimuMapView:e}),e&&e.addJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),setTimeout((()=>{this.querySelectedFeatures(e)}),100)}))})),this.waitForChildDataSourcesReady=t=>Ia(this,void 0,void 0,(function*(){yield null==t?void 0:t.whenAllJimuLayerViewLoaded();const n=e.DataSourceManager.getInstance().getDataSource(null==t?void 0:t.dataSourceId);return(null==n?void 0:n.isDataSourceSet)&&!n.areChildDataSourcesCreated()?n.childDataSourcesReady().then((()=>n)).catch((e=>n)):Promise.resolve(n)})),this.getI18nMessage=(e,t)=>{const n=Object.assign({},o,s.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.handleSelectedEventLayerUpdate=e=>{this.setState({selectedEventLayer:e})},this.handleSelectedNetworkLayerUpdate=e=>{this.setState({selectedNetworkLayer:e})},this.removeEvent=e=>Ia(this,void 0,void 0,(function*(){var t;this.state.flashGraphic.removeAll();const n=[],a=[],o=null===(t=this.state.eventDS.getSchema())||void 0===t?void 0:t.idField;this.state.eventFeatures.forEach(((t,s)=>{s!==e&&(n.push(t),a.push(t.attributes[o]))})),this.setState({preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState()});const s=this.state.jimuMapView.jimuLayerViews,r=Object.keys(s);for(let e=0;e<r.length;e++){const t=s[r[e]];if(t.layer.title===this.state.selectedEventLayer.name){const e=a.map((e=>Number(e)));if(e.length>0){if(this.state.eventDS){const n=(yield this.state.eventDS.query({objectIds:e.slice().map((e=>e+"")),returnGeometry:!0,returnZ:!0})).records;n&&n.length>0&&t.selectFeaturesByIds(e,n)}}else t.selectFeaturesByIds([])}}})),this.onUpdateEventFeatures=e=>{this.setState({eventFeatures:e})},this.onPreservedEventIndexChanged=e=>{this.setState({preservedEventIndex:e})},this.onUpdateRouteInfo=e=>{this.setState({routeInfo:e})},this.queryEvents=e=>{const n=this.state.eventDS;(0,t.queryEventsByEventObjectIds)(n,e).then((e=>Ia(this,void 0,void 0,(function*(){if(this.state.flashGraphic.removeAll(),yield a(!0,e,this.getI18nMessage,this.state.selectedEventLayer,this.state.selectedNetworkLayer,this.state.networkDS,this.state.toastMsgType,this.onUpdateToastMsgType,this.onUpdateToastMsg,this.onUpdateToastOpen),e.length>0){this.setState({preservedEventIndex:0,eventFeatures:e});const n=e[0].attributes[this.state.selectedEventLayer.eventInfo.routeIdFieldName];(0,t.queryRouteId)(n.trim(),this.state.selectedNetworkLayer.networkInfo,this.state.networkDS).then((e=>{(0,t.isDefined)(e)&&e.features.map((e=>Ia(this,void 0,void 0,(function*(){const n=e.attributes[this.state.selectedNetworkLayer.networkInfo.routeIdFieldSchema.name],a=e.attributes[this.state.selectedNetworkLayer.networkInfo.fromDateFieldSchema.name],o=e.attributes[this.state.selectedNetworkLayer.networkInfo.toDateFieldSchema.name],s=this.state.selectedNetworkLayer.networkInfo.useRouteName?e.attributes[this.state.selectedNetworkLayer.networkInfo.routeNameFieldSchema.name]:"",r=this.state.selectedNetworkLayer.networkInfo.supportsLines?e.attributes[this.state.selectedNetworkLayer.networkInfo.lineIdFieldSchema.name]:"",i=this.state.selectedNetworkLayer.networkInfo.supportsLines?e.attributes[this.state.selectedNetworkLayer.networkInfo.lineNameFieldSchema.name]:"";let c=new Date(Date.now());(0,t.isDefined)(o)&&c>o?c=(0,t.getDateWithTZOffset)(a,this.state.networkDS):c.setHours(0,0,0,0);let l=new Date(Date.now());(0,t.isDefined)(o)&&l>o?l=(0,t.getDateWithTZOffset)(o,this.state.networkDS):l.setHours(0,0,0,0),(0,t.isDefined)(o)||(l=null);const u={routeId:n,fromDate:(0,t.isDefined)(a)?(0,t.getDateWithTZOffset)(a,this.state.networkDS):null,toDate:(0,t.isDefined)(o)?(0,t.getDateWithTZOffset)(o,this.state.networkDS):null,selectedFromDate:c,selectedToDate:l,routeName:s,fromMeasure:NaN,toMeasure:NaN,selectedMeasure:NaN,lineId:r,lineName:i};this.setState({routeInfo:u})}))))}))}else this.setState({eventFeatures:[]})}))))},this.querySelectedFeatures=e=>Ia(this,void 0,void 0,(function*(){var t;if(null==e?void 0:e.view){this.setState({preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState()});const n=yield this.getSelectedGraphics(e);if(n.length>0){const e=[],a=null===(t=this.state.eventDS.getSchema())||void 0===t?void 0:t.idField;n.forEach((t=>{var n,o;"polyline"===(null===(n=t.geometry)||void 0===n?void 0:n.type)&&(null===(o=t.layer)||void 0===o?void 0:o.layerId)===this.state.selectedEventLayer.serviceId&&e.push(t.attributes[a])})),this.queryEvents(e)}else"error"===this.state.toastMsgType&&this.onUpdateToastOpen(!1),this.setState({eventFeatures:[]})}})),this.onUpdateEventDS=e=>{this.setState({eventDS:e,preservedEventIndex:-1,eventFeatures:[],routeInfo:this.getInitialRouteInfoState()}),this.querySelectedFeatures(this.state.jimuMapView)},this.onUpdateNetworkDS=e=>{this.setState({networkDS:e})},this.onUpdateIsEventPickerActive=e=>{e||this.state.currentSketchVM.cancel(),this.setState({isEventPickerActive:e})},this.onUpdateToastMsgType=e=>{this.setState({toastMsgType:e})},this.onUpdateToastMsg=e=>{this.setState({toastMsg:e})},this.onUpdateToastOpen=e=>{this.setState({toastOpen:e})},this.onUpdateResetForDataAction=e=>{this.setState({resetForDataAction:e})},this.state={hideTitle:!1,jimuMapView:void 0,hoverGraphic:null,pickedGraphic:null,flashGraphic:null,initialStage:!0,resultStage:!1,selectModeActive:!0,addToSelectionTool:!1,drawModeActive:!1,onDrawingComplete:!1,currentSketchVM:null,noFeaturesError:!1,noGraphicAfterFirstSelection:!1,onWidgetLoadShowLoadingIndicator:!0,loadingIndicator:!1,nextPossibleloadingIndicator:!1,selectedFeatureRecord:null,selectedEventLayer:null,selectedNetworkLayer:null,eventFeatures:[],preservedEventIndex:-1,routeInfo:this.getInitialRouteInfoState(),eventDS:null,networkDS:null,isEventPickerActive:!1,featuresByLayer:null,toastOpen:!1,toastMsgType:"info",toastMsg:"",stopQuery:!1,resetForDataAction:!1},this.widgetOuterDivId="widget-outer-div-"+this.props.id}getInitialRouteInfoState(){return{routeId:"",routeName:"",fromMeasure:NaN,toMeasure:NaN,fromDate:null,toDate:null,selectedMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null}}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(n,a){var o,s,r,i,c,l;a.jimuMapView!==this.state.jimuMapView&&(0,t.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers(),this.createApiWidget(this.state.jimuMapView));const u=null===(r=null===(s=null===(o=(0,e.getAppStore)())||void 0===o?void 0:o.getState())||void 0===s?void 0:s.widgetsRuntimeInfo[this.props.id])||void 0===r?void 0:r.state;u!==e.WidgetState.Opened&&u||(null===(i=this.props)||void 0===i?void 0:i.selectedEventLyr)&&(n&&n.mutableStatePropsVersion&&n.mutableStatePropsVersion.selectedEventLyr&&(null===(c=null==n?void 0:n.mutableStatePropsVersion)||void 0===c?void 0:c.selectedEventLyr)===(null===(l=this.props.mutableStatePropsVersion)||void 0===l?void 0:l.selectedEventLyr)||this.setState({selectedEventLayer:this.props.selectedEventLyr,resetForDataAction:!0}))}removeGraphicLayers(){(0,t.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,t.isDefined)(this.state.pickedGraphic)&&(this.state.pickedGraphic.removeAll(),this.state.pickedGraphic.destroy(),this.setState({pickedGraphic:null})),(0,t.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,n;if((0,t.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const t=new ga.default({listMode:"hide"}),a=new ga.default({listMode:"hide"}),o=new ga.default({listMode:"hide"});null===(n=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===n||n.map.addMany([a,o,t]),this.setState({hoverGraphic:t}),this.setState({pickedGraphic:a}),this.setState({flashGraphic:o})}}clearGraphics(){(0,t.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,t.isDefined)(this.state.pickedGraphic)&&this.state.pickedGraphic.removeAll(),(0,t.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll()}queryForNewSelection(e,t){this.setState({featuresByLayer:e});let n=null;e.length>0&&e.forEach((e=>{var t,a,o,s,r;if(e.length>0&&"polyline"===(null===(t=e[0].geometry)||void 0===t?void 0:t.type)&&e[0].layer.layerId===this.state.selectedEventLayer.serviceId){this.setState({isEventPickerActive:!1});const t=null===(a=this.state.eventDS.getSchema())||void 0===a?void 0:a.idField,i=[];return e.forEach((e=>{i.push(e.attributes[t])})),this.queryEvents(i),n=new Da.default({geometry:null===(o=e[0])||void 0===o?void 0:o.geometry,attributes:(null===(s=e[0])||void 0===s?void 0:s.attributes)?null===(r=e[0])||void 0===r?void 0:r.attributes:{}}),!0}})),n||this.state.selectModeActive&&this.state.currentSketchVM.create("rectangle")}createApiWidget(t){var n;const a=new ba.default({view:t?t.view:null,layer:new ga.default,updateOnGraphicClick:!1,defaultCreateOptions:{mode:"hybrid",hasZ:"3d"===(null===(n=null==t?void 0:t.view)||void 0===n?void 0:n.type)},polylineSymbol:{type:"simple-line",width:5},defaultUpdateOptions:{toggleToolOnClick:!1}});a.on("create",(t=>{if("start"===t.state){const e={type:"simple-line",width:5};this.state.currentSketchVM.set("polylineSymbol",e)}else"complete"===t.state&&(this.setState({noFeaturesError:!1}),this.state.selectModeActive&&(this.setState({loadingIndicator:!0}),this.selectFeaturesByGraphic(t.graphic,"intersects",e.DataSourceSelectionMode.New).then((e=>{this.queryForNewSelection(e,!0)}),(e=>{}))))})),this.setState({currentSketchVM:a})}getSelectedGraphics(e){return Ia(this,void 0,void 0,(function*(){let t=[];return e&&(t=yield e.getSelectedFeatures()),t}))}render(){var t;const{config:n,id:a}=this.props,{lrsLayers:o,networkLayers:r,eventLayers:l,intersectionLayers:u,defaultEvent:d,displayConfig:f,conflictPreventionEnabled:v}=n,{jimuMapView:h}=this.state;return(null==r?void 0:r.length)&&(null==l?void 0:l.length)?(0,e.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-merge-events surface-1 border-0",css:Sa},(0,e.jsx)(c.JimuMapViewComponent,{useMapWidgetId:null===(t=this.props.useMapWidgetIds)||void 0===t?void 0:t[0],onActiveViewChange:this.onActiveViewChange}),(0,e.jsx)(ya,{widgetId:a,intl:this.props.intl,hideTitle:this.state.hideTitle,lrsLayers:o,JimuMapView:h,eventLayers:l,networkLayers:r,instersectionLayers:u,defaultEvent:d,hoverGraphic:this.state.hoverGraphic,pickedGraphic:this.state.pickedGraphic,flashGraphic:this.state.flashGraphic,conflictPreventionEnabled:v,onClearGraphic:this.clearGraphics.bind(this),displayConfig:f,currentSketchVM:this.state.currentSketchVM,onUpdateSelectedEventLayer:this.handleSelectedEventLayerUpdate,onUpdateSelectedNetworkLayer:this.handleSelectedNetworkLayerUpdate,eventFeatures:this.state.eventFeatures,preservedEventIndex:this.state.preservedEventIndex,onEventRemoved:this.removeEvent,onPreservedEventIndexChanged:this.onPreservedEventIndexChanged,onUpdateEventFeatures:this.onUpdateEventFeatures,routeInfo:this.state.routeInfo,onUpdateRouteInfo:this.onUpdateRouteInfo,eventDS:this.state.eventDS,eventLayer:this.state.selectedEventLayer,networkDS:this.state.networkDS,onUpdateEventDS:this.onUpdateEventDS,onUpdateNetworkDS:this.onUpdateNetworkDS,isEventPickerActive:this.state.isEventPickerActive,onUpdateIsEventPickerActive:this.onUpdateIsEventPickerActive,onUpdateToastMsgType:this.onUpdateToastMsgType,onUpdateToastMsg:this.onUpdateToastMsg,onUpdateToastOpen:this.onUpdateToastOpen,toastMsgType:this.state.toastMsgType,toastMsg:this.state.toastMsg,toastOpen:this.state.toastOpen,onUpdateStopQuery:this.onUpdateStopQuery,resetForDataAction:this.state.resetForDataAction,onUpdateResetForDataAction:this.onUpdateResetForDataAction})):(0,e.jsx)(s.WidgetPlaceholder,{icon:i(),widgetId:a,message:this.getI18nMessage("_widgetLabel")})}}wa.mapExtraStateProps=(e,t)=>{var n;return{selectedEventLyr:null===(n=null==t?void 0:t.mutableStateProps)||void 0===n?void 0:n.selectedEventLyr}};const ja=wa;function ka(e){f.p=e}})(),v})())}}}));