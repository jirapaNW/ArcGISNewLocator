System.register(["jimu-core","jimu-ui","jimu-arcgis","widgets/shared-code/lrs","calcite-components","esri/layers/GraphicsLayer"],(function(e,t){var o={},a={},n={},i={},s={},r={};return{setters:[function(e){o.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceStatus=e.DataSourceStatus,o.Immutable=e.Immutable,o.MessageManager=e.MessageManager,o.React=e.React,o.RecordSetChangeType=e.RecordSetChangeType,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.utils=e.utils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.FOCUSABLE_CONTAINER_CLASS=e.FOCUSABLE_CONTAINER_CLASS,a.Label=e.Label,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.WidgetPlaceholder=e.WidgetPlaceholder,a.defaultMessages=e.defaultMessages},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent},function(e){i.AttributeTable=e.AttributeTable,i.CopyAttributeTool=e.CopyAttributeTool,i.GetUnits=e.GetUnits,i.InlineEditableDropdown=e.InlineEditableDropdown,i.Intellisense=e.Intellisense,i.LockAction=e.LockAction,i.LockManagerComponent=e.LockManagerComponent,i.LrsApplyEdits=e.LrsApplyEdits,i.LrsLayerType=e.LrsLayerType,i.QueryMeasureOnRoute=e.QueryMeasureOnRoute,i.QueryPolylineOnRoute=e.QueryPolylineOnRoute,i.QueryRouteMeasures=e.QueryRouteMeasures,i.RoutePicker=e.RoutePicker,i.RoutePickerPopup=e.RoutePickerPopup,i.SearchMethod=e.SearchMethod,i.convertStationToNumber=e.convertStationToNumber,i.getCalciteBasicTheme=e.getCalciteBasicTheme,i.getDateToUTC=e.getDateToUTC,i.getDateWithTZOffset=e.getDateWithTZOffset,i.getDateWithoutTZOffset=e.getDateWithoutTZOffset,i.getGeometryGraphic=e.getGeometryGraphic,i.getInitialEventInfoState=e.getInitialEventInfoState,i.getInitialRouteInfoState=e.getInitialRouteInfoState,i.getInitialRouteMeasurePickerInfoState=e.getInitialRouteMeasurePickerInfoState,i.getIntialLocksInfo=e.getIntialLocksInfo,i.getNetworkOutFields=e.getNetworkOutFields,i.getRouteFromEndMeasures=e.getRouteFromEndMeasures,i.getSimpleLineGraphic=e.getSimpleLineGraphic,i.getSimplePointGraphic=e.getSimplePointGraphic,i.getSuggestions=e.getSuggestions,i.isDate=e.isDate,i.isDefined=e.isDefined,i.isInWidgetController=e.isInWidgetController,i.isNumber=e.isNumber,i.queryAllRoutesByLineId=e.queryAllRoutesByLineId,i.queryRouteIdOrName=e.queryRouteIdOrName,i.queryRoutesByLineId=e.queryRoutesByLineId,i.tryReleaseLockOnDefault=e.tryReleaseLockOnDefault,i.validateField=e.validateField,i.validateRangeDomain=e.validateRangeDomain},function(e){s.CalciteInputDatePicker=e.CalciteInputDatePicker},function(e){r.default=e.default}],execute:function(){e((()=>{var e={26623:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M17 3H2a1 1 0 0 0-1 1v10a1 1 0 0 0 1 1h9v1H2a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h15a2 2 0 0 1 2 2v6h-1V4a1 1 0 0 0-1-1"></path><path fill="#000" d="M5.5 6.5v-2h-1v2H3v1h10.5v2h1v-2H16v-1zM13 12.5H3v-1h10zM16 18v-3h-3v-1h3v-3h1v3h3v1h-3v3z"></path></svg>'},99037:e=>{"use strict";e.exports=s},59620:e=>{"use strict";e.exports=r},62686:e=>{"use strict";e.exports=n},79244:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=a},47626:e=>{"use strict";e.exports=i}},t={};function l(o){var a=t[o];if(void 0!==a)return a.exports;var n=t[o]={exports:{}};return e[o](n,n.exports,l),n.exports}l.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return l.d(t,{a:t}),t},l.d=(e,t)=>{for(var o in t)l.o(t,o)&&!l.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},l.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),l.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.p="";var u={};return l.p=window.jimuConfig.baseUrl,(()=>{"use strict";l.r(u),l.d(u,{__set_webpack_public_path__:()=>ja,default:()=>ka});var e,t=l(79244);!function(e){e.single="SINGLE",e.multiple="MULTIPLE"}(e||(e={}));const o={_widgetLabel:"Add Line Event",typeLabel:"Type",eventLayerLabel:"Event",networkLabel:"Network",fromMethodLabel:"From Method",toMethodLabel:"To Method",fromRouteIdLabel:"From Route ID *",toRouteIdLabel:"To Route ID *",fromRouteNameLabel:"From Route Name *",toRouteNameLabel:"To Route Name *",fromMeasureLabel:"From Measure *",fromMeasureWithUnits:"From Measure ({units}) *",toMeasureWithUnits:"To Measure ({units}) *",selectRouteLabel:"Select Route",toMeasureLabel:"To Measure *",startDateLabel:"Start Date *",endDateLabel:"End Date",fromDateLabel:"From Date",toDateLabel:"To Date",routeIdLabel:"Route ID",measureLabel:"Measure",routeNameLabel:"Route Name",datesLabel:"Dates",nextLabel:"Next",singleOperation:"Single Line",multipleOperation:"Multiple Line",useStartDateLabel:"Use route start date",useEndDateLabel:"Use route end date",useStartMeasureLabel:"Use route start measure",useEndMeasureLabel:"Use route end measure",routeAndMeasure:"Route and Measure",coordinate:"Coordinate",locationOffset:"Location Offset",backLabel:"Back",saveLabel:"Save",selectAllLabel:"Select All",useMergeEventsLabel:"Merge coincident events",useRetireEventsLabel:"Retire overlapping events",resetForm:"Reset",nullLabel:"null",trueLabel:"true",falseLabel:"false",attributeError:"{fieldValue}: {message}",eventCreated:"Event Created",routeNotFound:"Route not found",measureLessError:"Selected measure is less than route's from measure",measureGreaterError:"Selected measure is greater than route's to measure",invalidMeasureError:"Input measure is invalid",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Valid exceeds maximum length of field: {value}.",invalidDate:"Invalid date.",invalidFromDateBefore:"Start date is before route start date",invalidFromDateAfter:"Start date is after route end date",invalidToDateBefore:"End date is before route start date",invalidToDateAfter:"End date is after route end date",invalidDatesOrder:"Selected start date is greater than selected end date",invalidDatesSameDay:"Start and end dates cannot be the same",inches:"Inches",points:"Points",feet:"Feet",yards:"Yards",miles:"Miles",nauticalMiles:"Nautical miles",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal Degrees",decimeters:"Decimeters",intFeet:"International Feet",noResult:"No results",attributeSetLabel:"Attribute Set"};var a=l(14321),n=l(26623),i=l.n(n),s=l(62686),r=l(47626);function c(){const e=t.hooks.useTranslation(o);return(0,t.jsx)("div",{className:"add-line=event-form-header"},(0,t.jsx)("div",{className:"add-single-line-event-form__header pt-3 px-3 align-items-center"},(0,t.jsx)("div",{className:"add-single-line-event_title d-flex align-items-center text-truncate",css:t.css`
            font-weight: 500;
            font-size: 14px;
          `},(0,t.jsx)("div",{className:"text-truncate"},e("_widgetLabel")))))}const d=function(){this.__data__=[],this.size=0};const f=function(e,t){return e===t||e!=e&&t!=t};const m=function(e,t){for(var o=e.length;o--;)if(f(e[o][0],t))return o;return-1};var v=Array.prototype.splice;const h=function(e){var t=this.__data__,o=m(t,e);return!(o<0)&&(o==t.length-1?t.pop():v.call(t,o,1),--this.size,!0)};const p=function(e){var t=this.__data__,o=m(t,e);return o<0?void 0:t[o][1]};const D=function(e){return m(this.__data__,e)>-1};const b=function(e,t){var o=this.__data__,a=m(o,e);return a<0?(++this.size,o.push([e,t])):o[a][1]=t,this};function g(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}g.prototype.clear=d,g.prototype.delete=h,g.prototype.get=p,g.prototype.has=D,g.prototype.set=b;const R=g;const I=function(){this.__data__=new R,this.size=0};const y=function(e){var t=this.__data__,o=t.delete(e);return this.size=t.size,o};const S=function(e){return this.__data__.get(e)};const N=function(e){return this.__data__.has(e)};const k="object"==typeof global&&global&&global.Object===Object&&global;var j="object"==typeof self&&self&&self.Object===Object&&self;const M=k||j||Function("return this")();const w=M.Symbol;var T=Object.prototype,x=T.hasOwnProperty,A=T.toString,O=w?w.toStringTag:void 0;const F=function(e){var t=x.call(e,O),o=e[O];try{e[O]=void 0;var a=!0}catch(e){}var n=A.call(e);return a&&(t?e[O]=o:delete e[O]),n};var P=Object.prototype.toString;const L=function(e){return P.call(e)};var C=w?w.toStringTag:void 0;const E=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":C&&C in Object(e)?F(e):L(e)};const _=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const G=function(e){if(!_(e))return!1;var t=E(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const U=M["__core-js_shared__"];var V,B=(V=/[^.]+$/.exec(U&&U.keys&&U.keys.IE_PROTO||""))?"Symbol(src)_1."+V:"";const W=function(e){return!!B&&B in e};var z=Function.prototype.toString;const Q=function(e){if(null!=e){try{return z.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Z=/^\[object .+?Constructor\]$/,q=Function.prototype,H=Object.prototype,$=q.toString,J=H.hasOwnProperty,K=RegExp("^"+$.call(J).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Y=function(e){return!(!_(e)||W(e))&&(G(e)?K:Z).test(Q(e))};const X=function(e,t){return null==e?void 0:e[t]};const ee=function(e,t){var o=X(e,t);return Y(o)?o:void 0};const te=ee(M,"Map");const oe=ee(Object,"create");const ae=function(){this.__data__=oe?oe(null):{},this.size=0};const ne=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var ie=Object.prototype.hasOwnProperty;const se=function(e){var t=this.__data__;if(oe){var o=t[e];return"__lodash_hash_undefined__"===o?void 0:o}return ie.call(t,e)?t[e]:void 0};var re=Object.prototype.hasOwnProperty;const le=function(e){var t=this.__data__;return oe?void 0!==t[e]:re.call(t,e)};const ue=function(e,t){var o=this.__data__;return this.size+=this.has(e)?0:1,o[e]=oe&&void 0===t?"__lodash_hash_undefined__":t,this};function ce(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}ce.prototype.clear=ae,ce.prototype.delete=ne,ce.prototype.get=se,ce.prototype.has=le,ce.prototype.set=ue;const de=ce;const fe=function(){this.size=0,this.__data__={hash:new de,map:new(te||R),string:new de}};const me=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const ve=function(e,t){var o=e.__data__;return me(t)?o["string"==typeof t?"string":"hash"]:o.map};const he=function(e){var t=ve(this,e).delete(e);return this.size-=t?1:0,t};const pe=function(e){return ve(this,e).get(e)};const De=function(e){return ve(this,e).has(e)};const be=function(e,t){var o=ve(this,e),a=o.size;return o.set(e,t),this.size+=o.size==a?0:1,this};function ge(e){var t=-1,o=null==e?0:e.length;for(this.clear();++t<o;){var a=e[t];this.set(a[0],a[1])}}ge.prototype.clear=fe,ge.prototype.delete=he,ge.prototype.get=pe,ge.prototype.has=De,ge.prototype.set=be;const Re=ge;const Ie=function(e,t){var o=this.__data__;if(o instanceof R){var a=o.__data__;if(!te||a.length<199)return a.push([e,t]),this.size=++o.size,this;o=this.__data__=new Re(a)}return o.set(e,t),this.size=o.size,this};function ye(e){var t=this.__data__=new R(e);this.size=t.size}ye.prototype.clear=I,ye.prototype.delete=y,ye.prototype.get=S,ye.prototype.has=N,ye.prototype.set=Ie;const Se=ye;const Ne=function(e,t){for(var o=-1,a=null==e?0:e.length;++o<a&&!1!==t(e[o],o,e););return e};const ke=function(){try{var e=ee(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const je=function(e,t,o){"__proto__"==t&&ke?ke(e,t,{configurable:!0,enumerable:!0,value:o,writable:!0}):e[t]=o};var Me=Object.prototype.hasOwnProperty;const we=function(e,t,o){var a=e[t];Me.call(e,t)&&f(a,o)&&(void 0!==o||t in e)||je(e,t,o)};const Te=function(e,t,o,a){var n=!o;o||(o={});for(var i=-1,s=t.length;++i<s;){var r=t[i],l=a?a(o[r],e[r],r,o,e):void 0;void 0===l&&(l=e[r]),n?je(o,r,l):we(o,r,l)}return o};const xe=function(e,t){for(var o=-1,a=Array(e);++o<e;)a[o]=t(o);return a};const Ae=function(e){return null!=e&&"object"==typeof e};const Oe=function(e){return Ae(e)&&"[object Arguments]"==E(e)};var Fe=Object.prototype,Pe=Fe.hasOwnProperty,Le=Fe.propertyIsEnumerable,Ce=Oe(function(){return arguments}())?Oe:function(e){return Ae(e)&&Pe.call(e,"callee")&&!Le.call(e,"callee")};const Ee=Ce;const _e=Array.isArray;const Ge=function(){return!1};var Ue="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ve=Ue&&"object"==typeof module&&module&&!module.nodeType&&module,Be=Ve&&Ve.exports===Ue?M.Buffer:void 0;const We=(Be?Be.isBuffer:void 0)||Ge;var ze=/^(?:0|[1-9]\d*)$/;const Qe=function(e,t){var o=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==o||"symbol"!=o&&ze.test(e))&&e>-1&&e%1==0&&e<t};const Ze=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var qe={};qe["[object Float32Array]"]=qe["[object Float64Array]"]=qe["[object Int8Array]"]=qe["[object Int16Array]"]=qe["[object Int32Array]"]=qe["[object Uint8Array]"]=qe["[object Uint8ClampedArray]"]=qe["[object Uint16Array]"]=qe["[object Uint32Array]"]=!0,qe["[object Arguments]"]=qe["[object Array]"]=qe["[object ArrayBuffer]"]=qe["[object Boolean]"]=qe["[object DataView]"]=qe["[object Date]"]=qe["[object Error]"]=qe["[object Function]"]=qe["[object Map]"]=qe["[object Number]"]=qe["[object Object]"]=qe["[object RegExp]"]=qe["[object Set]"]=qe["[object String]"]=qe["[object WeakMap]"]=!1;const He=function(e){return Ae(e)&&Ze(e.length)&&!!qe[E(e)]};const $e=function(e){return function(t){return e(t)}};var Je="object"==typeof exports&&exports&&!exports.nodeType&&exports,Ke=Je&&"object"==typeof module&&module&&!module.nodeType&&module,Ye=Ke&&Ke.exports===Je&&k.process;const Xe=function(){try{var e=Ke&&Ke.require&&Ke.require("util").types;return e||Ye&&Ye.binding&&Ye.binding("util")}catch(e){}}();var et=Xe&&Xe.isTypedArray;const tt=et?$e(et):He;var ot=Object.prototype.hasOwnProperty;const at=function(e,t){var o=_e(e),a=!o&&Ee(e),n=!o&&!a&&We(e),i=!o&&!a&&!n&&tt(e),s=o||a||n||i,r=s?xe(e.length,String):[],l=r.length;for(var u in e)!t&&!ot.call(e,u)||s&&("length"==u||n&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Qe(u,l))||r.push(u);return r};var nt=Object.prototype;const it=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||nt)};const st=function(e,t){return function(o){return e(t(o))}};const rt=st(Object.keys,Object);var lt=Object.prototype.hasOwnProperty;const ut=function(e){if(!it(e))return rt(e);var t=[];for(var o in Object(e))lt.call(e,o)&&"constructor"!=o&&t.push(o);return t};const ct=function(e){return null!=e&&Ze(e.length)&&!G(e)};const dt=function(e){return ct(e)?at(e):ut(e)};const ft=function(e,t){return e&&Te(t,dt(t),e)};const mt=function(e){var t=[];if(null!=e)for(var o in Object(e))t.push(o);return t};var vt=Object.prototype.hasOwnProperty;const ht=function(e){if(!_(e))return mt(e);var t=it(e),o=[];for(var a in e)("constructor"!=a||!t&&vt.call(e,a))&&o.push(a);return o};const pt=function(e){return ct(e)?at(e,!0):ht(e)};const Dt=function(e,t){return e&&Te(t,pt(t),e)};var bt="object"==typeof exports&&exports&&!exports.nodeType&&exports,gt=bt&&"object"==typeof module&&module&&!module.nodeType&&module,Rt=gt&&gt.exports===bt?M.Buffer:void 0,It=Rt?Rt.allocUnsafe:void 0;const yt=function(e,t){if(t)return e.slice();var o=e.length,a=It?It(o):new e.constructor(o);return e.copy(a),a};const St=function(e,t){var o=-1,a=e.length;for(t||(t=Array(a));++o<a;)t[o]=e[o];return t};const Nt=function(e,t){for(var o=-1,a=null==e?0:e.length,n=0,i=[];++o<a;){var s=e[o];t(s,o,e)&&(i[n++]=s)}return i};const kt=function(){return[]};var jt=Object.prototype.propertyIsEnumerable,Mt=Object.getOwnPropertySymbols;const wt=Mt?function(e){return null==e?[]:(e=Object(e),Nt(Mt(e),(function(t){return jt.call(e,t)})))}:kt;const Tt=function(e,t){return Te(e,wt(e),t)};const xt=function(e,t){for(var o=-1,a=t.length,n=e.length;++o<a;)e[n+o]=t[o];return e};const At=st(Object.getPrototypeOf,Object);const Ot=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)xt(t,wt(e)),e=At(e);return t}:kt;const Ft=function(e,t){return Te(e,Ot(e),t)};const Pt=function(e,t,o){var a=t(e);return _e(e)?a:xt(a,o(e))};const Lt=function(e){return Pt(e,dt,wt)};const Ct=function(e){return Pt(e,pt,Ot)};const Et=ee(M,"DataView");const _t=ee(M,"Promise");const Gt=ee(M,"Set");const Ut=ee(M,"WeakMap");var Vt="[object Map]",Bt="[object Promise]",Wt="[object Set]",zt="[object WeakMap]",Qt="[object DataView]",Zt=Q(Et),qt=Q(te),Ht=Q(_t),$t=Q(Gt),Jt=Q(Ut),Kt=E;(Et&&Kt(new Et(new ArrayBuffer(1)))!=Qt||te&&Kt(new te)!=Vt||_t&&Kt(_t.resolve())!=Bt||Gt&&Kt(new Gt)!=Wt||Ut&&Kt(new Ut)!=zt)&&(Kt=function(e){var t=E(e),o="[object Object]"==t?e.constructor:void 0,a=o?Q(o):"";if(a)switch(a){case Zt:return Qt;case qt:return Vt;case Ht:return Bt;case $t:return Wt;case Jt:return zt}return t});const Yt=Kt;var Xt=Object.prototype.hasOwnProperty;const eo=function(e){var t=e.length,o=new e.constructor(t);return t&&"string"==typeof e[0]&&Xt.call(e,"index")&&(o.index=e.index,o.input=e.input),o};const to=M.Uint8Array;const oo=function(e){var t=new e.constructor(e.byteLength);return new to(t).set(new to(e)),t};const ao=function(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.byteLength)};var no=/\w*$/;const io=function(e){var t=new e.constructor(e.source,no.exec(e));return t.lastIndex=e.lastIndex,t};var so=w?w.prototype:void 0,ro=so?so.valueOf:void 0;const lo=function(e){return ro?Object(ro.call(e)):{}};const uo=function(e,t){var o=t?oo(e.buffer):e.buffer;return new e.constructor(o,e.byteOffset,e.length)};const co=function(e,t,o){var a=e.constructor;switch(t){case"[object ArrayBuffer]":return oo(e);case"[object Boolean]":case"[object Date]":return new a(+e);case"[object DataView]":return ao(e,o);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return uo(e,o);case"[object Map]":case"[object Set]":return new a;case"[object Number]":case"[object String]":return new a(e);case"[object RegExp]":return io(e);case"[object Symbol]":return lo(e)}};var fo=Object.create;const mo=function(){function e(){}return function(t){if(!_(t))return{};if(fo)return fo(t);e.prototype=t;var o=new e;return e.prototype=void 0,o}}();const vo=function(e){return"function"!=typeof e.constructor||it(e)?{}:mo(At(e))};const ho=function(e){return Ae(e)&&"[object Map]"==Yt(e)};var po=Xe&&Xe.isMap;const Do=po?$e(po):ho;const bo=function(e){return Ae(e)&&"[object Set]"==Yt(e)};var go=Xe&&Xe.isSet;const Ro=go?$e(go):bo;var Io="[object Arguments]",yo="[object Function]",So="[object Object]",No={};No[Io]=No["[object Array]"]=No["[object ArrayBuffer]"]=No["[object DataView]"]=No["[object Boolean]"]=No["[object Date]"]=No["[object Float32Array]"]=No["[object Float64Array]"]=No["[object Int8Array]"]=No["[object Int16Array]"]=No["[object Int32Array]"]=No["[object Map]"]=No["[object Number]"]=No[So]=No["[object RegExp]"]=No["[object Set]"]=No["[object String]"]=No["[object Symbol]"]=No["[object Uint8Array]"]=No["[object Uint8ClampedArray]"]=No["[object Uint16Array]"]=No["[object Uint32Array]"]=!0,No["[object Error]"]=No[yo]=No["[object WeakMap]"]=!1;const ko=function e(t,o,a,n,i,s){var r,l=1&o,u=2&o,c=4&o;if(a&&(r=i?a(t,n,i,s):a(t)),void 0!==r)return r;if(!_(t))return t;var d=_e(t);if(d){if(r=eo(t),!l)return St(t,r)}else{var f=Yt(t),m=f==yo||"[object GeneratorFunction]"==f;if(We(t))return yt(t,l);if(f==So||f==Io||m&&!i){if(r=u||m?{}:vo(t),!l)return u?Ft(t,Dt(r,t)):Tt(t,ft(r,t))}else{if(!No[f])return i?t:{};r=co(t,f,l)}}s||(s=new Se);var v=s.get(t);if(v)return v;s.set(t,r),Ro(t)?t.forEach((function(n){r.add(e(n,o,a,n,t,s))})):Do(t)&&t.forEach((function(n,i){r.set(i,e(n,o,a,i,t,s))}));var h=d?void 0:(c?u?Ct:Lt:u?pt:dt)(t);return Ne(h||t,(function(n,i){h&&(n=t[i=n]),we(r,i,e(n,o,a,i,t,s))})),r};const jo=function(e){return ko(e,5)};var Mo=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};const wo=()=>t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-line=event-edit-attributes__action {
      height: auto;
    }
    .add-line-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `;function To(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,networkDS:u,network:c,eventDS:d,eventLayer:f,routeInfo:m,eventInfo:v,reset:h,jimuMapView:p,hoverGraphic:D,conflictPreventionEnabled:b,onNavBack:g}=e,[R,I]=t.React.useState(),[y,S]=t.React.useState(!1),[N,k]=t.React.useState(),[j,M]=t.React.useState(""),[w,T]=t.React.useState((0,r.getIntialLocksInfo)());t.React.useEffect((()=>{I(x())}),[d,f]),t.React.useEffect((()=>{h&&I(x())}),[h]),t.React.useEffect((()=>{if(b){const e=Object.assign({},w);(0,r.isDefined)(c)&&(e.networkId=[c.networkInfo.lrsNetworkId]),(0,r.isDefined)(f)&&(e.eventServiceLayerIds=[f.serviceId]),(0,r.isDefined)(m)&&(e.routeInfo=m),T(e)}}),[u,c,f,m]);const x=()=>{const e=[];if((0,r.isDefined)(f)&&(0,r.isDefined)(d)&&(0,r.isDefined)(f.eventInfo)&&(0,r.isDefined)(f.eventInfo.attributeFields)){const t=d,o=(null==t?void 0:t.layer).fields;f.eventInfo.attributeFields.forEach((t=>{if(t.enabled){const a=o.find((e=>e.name===t.field.name));if(a){let o;o=(0,r.isDate)(a.type)?(0,r.isDefined)(a.defaultValue)?new Date(a.defaultValue):null:a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,r.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}}}))}return e},A=e=>{const t=jo(e);I(t)},O=e=>{g(e)},F=()=>{const e=[];if((0,r.isDefined)(f)&&(0,r.isDefined)(d)){const t=d,o=(null==t?void 0:t.layer).fields;f.eventInfo.attributeFields.forEach((t=>{const a=o.find((e=>e.name===t.field.name));if(a){let o;if("date"===a.type&&(0,r.isDefined)(a.defaultValue)){const e=new Date(a.defaultValue);(0,r.isDefined)(e)&&(o=e.toISOString().substring(0,10))}else o=a.defaultValue;const n={index:e.length,name:a.name,alias:a.alias,type:a.type,hasDomain:(0,r.isDefined)(a.domain),value:o,error:"",nullable:a.nullable,default:"number"==typeof o?Number(o).toString():o,length:a.length,editable:t.editable};e.push(n)}})),I(e)}},P=e=>Mo(this,void 0,void 0,(function*(){const o={edits:[]};if((()=>{const e=jo(R);let t=!1;return e.forEach((e=>{let o;if(o=e.hasDomain?(0,r.validateRangeDomain)(e.value,e.name,d):(0,r.validateField)(e.value,e.name,d),o.hasError){k("error");const a=f.useFieldAlias?e.alias:e.name;M(i("attributeError",{fieldValue:a,message:i(o.message)})),S(!0),setTimeout((()=>{S(!1)}),5e3),t=!0,e.error=i(o.message)}})),t&&A(e),t})())return;let a=d.getGDBVersion();if(a||(a=""),(0,r.isDefined)(f)){const e={};let a=!1,n=!1;f.eventInfo.canSpanRoutes?m.routeLineOrder>m.toRouteLineOrder?a=!0:m.routeId===m.toRouteId&&m.selectedMeasure>m.selectedToMeasure&&(n=!0):m.selectedMeasure>m.selectedToMeasure&&(n=!0);const i=f.eventInfo.eventIdFieldName;e[i]="{"+t.utils.getUUID()+"}";const s=f.eventInfo.routeIdFieldName;e[s]=m.routeId;const l=f.eventInfo.fromMeasureFieldName;e[l]=m.selectedMeasure;const c=f.eventInfo.fromDateFieldName;if(m.selectedFromDate){const t=(0,r.isDefined)(m.selectedFromDate)?(0,r.getDateWithoutTZOffset)(m.selectedFromDate.valueOf(),u):null;e[c]=(0,r.getDateToUTC)(t)}else e[c]=m.selectedFromDate;const d=f.eventInfo.toDateFieldName;if(m.selectedToDate){const t=(0,r.isDefined)(m.selectedToDate)?(0,r.getDateWithoutTZOffset)(m.selectedToDate.valueOf(),u):null;e[d]=(0,r.getDateToUTC)(t)}else e[d]=m.selectedToDate;if(f.eventInfo.routeNameFieldName&&f.eventInfo.routeNameFieldName.length>0){const t=f.eventInfo.routeNameFieldName;e[t]=m.routeName}if(f.eventInfo.toRouteIdFieldName&&f.eventInfo.toRouteIdFieldName.length>0){const t=f.eventInfo.toRouteIdFieldName;e[t]=m.toRouteId,a&&(e[s]=m.toRouteId,e[t]=m.routeId)}if(f.eventInfo.toRouteNameFieldName&&f.eventInfo.toRouteNameFieldName.length>0){const t=f.eventInfo.toRouteNameFieldName;if(e[t]=m.toRouteName,a){const o=f.eventInfo.routeNameFieldName;e[o]=m.toRouteName,e[t]=m.routeName}}if(f.eventInfo.toMeasureFieldName&&f.eventInfo.toMeasureFieldName.length>0){const t=f.eventInfo.toMeasureFieldName;e[t]=m.selectedToMeasure,(a||n)&&(e[l]=m.selectedToMeasure,e[t]=m.selectedMeasure)}R.forEach((t=>{const o=t.name;if((0,r.isDefined)(t.value)&&(0,r.isDate)(t.type)){const a=(0,r.getDateWithoutTZOffset)(t.value.valueOf(),u);e[o]=(0,r.getDateToUTC)(a)}else(0,r.isNumber)(t.type)?!(0,r.isDefined)(t.value)||""===t.value||isNaN(Number(t.value))?e[o]=null:e[o]=Number(t.value):e[o]=t.value}));const h=[],p={attributes:e,geometry:m.selectedPolyline};h.push(p);const D={id:f.serviceId,adds:h,allowMerge:v.mergeCoincident,retireMeasureOverlap:v.retireOverlapping,retireByEventId:!1};o.edits.push(D)}yield(0,r.LrsApplyEdits)(f.lrsUrl,o,a).then((t=>Mo(this,void 0,void 0,(function*(){t.success?(k("success"),M(i("eventCreated")),S(!0),L(o),setTimeout((()=>Mo(this,void 0,void 0,(function*(){if(S(!1),b&&(0,r.isDefined)(e)){yield(0,r.tryReleaseLockOnDefault)(u,e);const t=Object.assign(Object.assign({},w),{lockAction:r.LockAction.Clear});T(t)}else O(!0),F()}))),1e3)):(k("error"),M(`${t.message} \n ${t.details}`),S(!0),setTimeout((()=>{S(!1)}),5e3))}))))})),L=e=>Mo(this,void 0,void 0,(function*(){const o=d,a=o.getPopupInfo(),n=o.getLayerDefinition(),i=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==n?void 0:n.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==a?void 0:a.fieldInfos)||[]).filter((e=>e.visible)));let s=null;yield(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then((e=>{[s]=e})).then((()=>{const t=new s({geometry:e.edits[0].adds[0].geometry,attributes:e.edits[0].adds[0].attributes}),a=o.buildRecord(t);o.afterAddRecord(a)})),o.updateQueryParams({returnGeometry:!0},l);const r=new t.DataRecordSetChangeMessage(l,t.RecordSetChangeType.CreateUpdate,[{records:o.getRecords(),fields:i.map((e=>e.fieldName)),dataSource:o,name:o.id}]);t.MessageManager.getInstance().publishMessage(r)}));return(0,t.jsx)("div",{className:"h-100",css:wo()},(0,t.jsx)("div",{className:"add-line-event-edit-attributes__content"},b&&(0,t.jsx)(r.LockManagerComponent,{intl:s,featureDS:u,lockInfo:w,showAlert:!0,networkName:null===(n=null==c?void 0:c.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{T(e),o&&P(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},w),{lockAction:r.LockAction.None});T(e),O(!0),F()}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:u,eventDataSources:[d],jimuMapView:p,hoverGraphic:D,onAttributesCopied:e=>{const t=jo(R);e.forEach((e=>{e.layerId===f.serviceId.toString()&&e.fieldValuePair.forEach((e=>{const o=t.findIndex((t=>t.name===e.name));if(o>-1){let a=e.value;(0,r.isDate)(t[o].type)&&(a=new Date(e.value)),t[o].value=a}}))})),I(t)}}))),(0,t.jsx)("div",{className:"h-100"},(0,t.jsx)(r.AttributeTable,{tableIndex:0,eventDS:d,eventLayer:f,fieldInfos:R,collapable:!1,useAlias:!(0,r.isDefined)(f)||f.useFieldAlias,onUpdateItem:(e,t,o)=>{const a=jo(R);a[o].value=e,a[o].error=t,I(a)},onUpdateAll:A,isReset:h})),y&&(0,t.jsx)("div",{className:"add-line-event-edit-attributes__toast-container w-100 p-3"},(0,t.jsx)(a.Alert,{className:"add-line-event-edit-attributes__toast w-100",type:N,text:j,closable:!0,withIcon:!0,open:y,onClose:()=>{S(!1)}}))),(0,t.jsx)("div",{className:"add-line-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-line=event-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(a.Button,{"aria-label":i("backLabel"),size:"sm",type:"secondary",onClick:()=>{O(!1)}},i("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{className:"active","aria-label":i("saveLabel"),size:"sm",disabled:!1,onClick:()=>{if(b){const e=Object.assign(Object.assign({},w),{lockAction:r.LockAction.QueryAndAcquire});T(e)}else P()}},i("saveLabel"))))))}function xo(e){const{network:o,event:a,dataSourcesReady:n,onCreateNetworkDs:i,onCreateEventDs:s}=e,[r,l]=t.React.useState(null!=o?o:null),[u,c]=t.React.useState(null!=a?a:null),[d,f]=t.React.useState(!1),[m,v]=t.React.useState(!1);t.React.useEffect((()=>{o&&l(o)}),[o]),t.React.useEffect((()=>{a&&c(a)}),[a]),t.React.useEffect((()=>{n(d&&m)}),[n,m,d]);const h=t.React.useCallback((e=>{i(e)}),[i]),p=t.React.useCallback((e=>{s(e)}),[s]),D=t.React.useCallback((e=>{if(e){const{status:o,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||o===t.DataSourceStatus.LoadError||o===t.DataSourceStatus.NotReady?f(!1):f(!0)}}),[f]),b=t.React.useCallback((e=>{if(e){const{status:o,instanceStatus:a}=e;a===t.DataSourceStatus.NotCreated||a===t.DataSourceStatus.CreateError||o===t.DataSourceStatus.LoadError||o===t.DataSourceStatus.NotReady?v(!1):v(!0)}}),[v]),g=t.React.useCallback((()=>{f(!1)}),[f]),R=t.React.useCallback((()=>{v(!1)}),[v]);return(0,t.jsx)("div",null,r&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:r.useDataSource,onDataSourceInfoChange:D,onCreateDataSourceFailed:g,onDataSourceCreated:h}),u&&(0,t.jsx)(t.DataSourceComponent,{useDataSource:u.useDataSource,onDataSourceInfoChange:b,onCreateDataSourceFailed:R,onDataSourceCreated:p}))}const Ao=function(){return M.Date.now()};var Oo=/\s/;const Fo=function(e){for(var t=e.length;t--&&Oo.test(e.charAt(t)););return t};var Po=/^\s+/;const Lo=function(e){return e?e.slice(0,Fo(e)+1).replace(Po,""):e};const Co=function(e){return"symbol"==typeof e||Ae(e)&&"[object Symbol]"==E(e)};var Eo=/^[-+]0x[0-9a-f]+$/i,_o=/^0b[01]+$/i,Go=/^0o[0-7]+$/i,Uo=parseInt;const Vo=function(e){if("number"==typeof e)return e;if(Co(e))return NaN;if(_(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=_(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=Lo(e);var o=_o.test(e);return o||Go.test(e)?Uo(e.slice(2),o?2:8):Eo.test(e)?NaN:+e};var Bo=Math.max,Wo=Math.min;const zo=function(e,t,o){var a,n,i,s,r,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var o=a,i=n;return a=n=void 0,u=t,s=e.apply(i,o)}function v(e){var o=e-l;return void 0===l||o>=t||o<0||d&&e-u>=i}function h(){var e=Ao();if(v(e))return p(e);r=setTimeout(h,function(e){var o=t-(e-l);return d?Wo(o,i-(e-u)):o}(e))}function p(e){return r=void 0,f&&a?m(e):(a=n=void 0,s)}function D(){var e=Ao(),o=v(e);if(a=arguments,n=this,l=e,o){if(void 0===r)return function(e){return u=e,r=setTimeout(h,t),c?m(e):s}(l);if(d)return clearTimeout(r),r=setTimeout(h,t),m(l)}return void 0===r&&(r=setTimeout(h,t)),s}return t=Vo(t)||0,_(o)&&(c=!!o.leading,i=(d="maxWait"in o)?Bo(Vo(o.maxWait)||0,t):i,f="trailing"in o?!!o.trailing:f),D.cancel=function(){void 0!==r&&clearTimeout(r),u=0,a=l=n=r=void 0},D.flush=function(){return void 0===r?s:p(Ao())},D};var Qo=1/0;const Zo=function(e){return e?(e=Vo(e))===Qo||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const qo=function(e){var t=Zo(e),o=t%1;return t==t?o?t-o:t:0};const Ho=function(e,t){for(var o=-1,a=null==e?0:e.length,n=Array(a);++o<a;)n[o]=t(e[o],o,e);return n};var $o=w?w.prototype:void 0,Jo=$o?$o.toString:void 0;const Ko=function e(t){if("string"==typeof t)return t;if(_e(t))return Ho(t,e)+"";if(Co(t))return Jo?Jo.call(t):"";var o=t+"";return"0"==o&&1/t==-Infinity?"-0":o};const Yo=function(e){return null==e?"":Ko(e)};var Xo=M.isFinite,ea=Math.min;const ta=function(e){var t=Math[e];return function(e,o){if(e=Vo(e),(o=null==o?0:ea(qo(o),292))&&Xo(e)){var a=(Yo(e)+"e").split("e"),n=t(a[0]+"e"+(+a[1]+o));return+((a=(Yo(n)+"e").split("e"))[0]+"e"+(+a[1]-o))}return t(e)}}("round");var oa=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function aa(e){var n,i,s,l,u,c;const d=t.hooks.useTranslation(o),{intl:f,widgetId:m,network:v,event:h,networkDS:p,routeInfo:D,jimuMapView:b,hoverGraphic:g,clearPickedGraphic:R,clearHoverGraphic:I,onRouteInfoUpdated:y,onRouteMeasurePickerInfoUpdated:S,routeMeasurePickerInfo:N,isFrom:k,canSpanRoutes:j,reset:M,revalidateRouteFromDataAction:w,onResetDataAction:T,hideMeasures:x,useStartMeasure:A,useEndMeasure:O}=e,[F,P]=t.React.useState(!1),[L,C]=t.React.useState(!1),[E,_]=t.React.useState(!1),[G,U]=t.React.useState(!1),[V,B]=t.React.useState(""),[W,z]=t.React.useState(""),[Q,Z]=t.React.useState(!1),[q,H]=t.React.useState([]),[$,J]=t.React.useState(),K=t.React.useRef(null),Y=t.React.useRef((e=>{})),X=t.React.useRef(null),ee=t.React.useRef(null),te=t.React.useRef(null),oe=t.React.useRef(null),ae=t.React.useRef(null),ne=t.React.useRef(!1),ie=t.React.useRef(!1),[se,re]=t.React.useState(null),[le,ue]=t.React.useState(null),[ce,de]=t.React.useState(!1),[fe,me]=t.React.useState([]);t.React.useEffect((()=>{Y.current=zo(he,400)}),[]),t.React.useEffect((()=>{if(w){const e=k?v.useRouteName?D.routeName:D.routeId:v.useRouteName?D.toRouteName:D.toRouteId;pe(e),k?((()=>{oa(this,void 0,void 0,(function*(){yield ge(e,!0),isNaN(D.selectedMeasure)||B(D.selectedMeasure.toString())}))})(),D.selectedToMeasure||T()):(()=>{oa(this,void 0,void 0,(function*(){yield ge(e,!0),D.selectedToMeasure&&z(D.selectedToMeasure.toString()),T()}))})()}}),[w]),t.React.useEffect((()=>{M&&(B(""),z(""),ae.current=null,Ne())}),[M]),t.React.useEffect((()=>{k?v&&v.useRouteName?re(D.routeName):v&&!v.useRouteName&&re(D.routeId):v&&v.useRouteName?ue(D.toRouteName):v&&!v.useRouteName&&ue(D.toRouteId)}),[v,D.routeId,D.toRouteId,D.routeName,D.toRouteName]);const ve=t.React.useCallback(((e,t=!1)=>{y(e,t),ae.current=null}),[y]);t.React.useEffect((()=>{k&&(isNaN(D.selectedMeasure)?B(""):B(D.selectedMeasure.toString()),Ne(!1,!0))}),[v,D.selectedMeasure]),t.React.useEffect((()=>{k&&A&&Ne(!1,!0)}),[D.selectedPoint]),t.React.useEffect((()=>{k||O&&Ne(!1,!0)}),[D.selectedToPoint]),t.React.useEffect((()=>{k||(isNaN(D.selectedToMeasure)?z(""):z(D.selectedToMeasure.toString()),Ne(!1,!0))}),[v,D.selectedToMeasure]),t.React.useEffect((()=>{if(!k&&j&&D.validRoute&&(v.useRouteName?ue(D.toRouteName):ue(D.toRouteId)),!k&&!j&&D.validRoute&&(v.useRouteName?ue(D.routeName):ue(D.routeId),D.routeId!==D.toRouteId||D.routeName!==D.toRouteName)){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName});y(e)}k&&Ne()}),[D.routeName,D.routeId]),t.React.useEffect((()=>{k||Ne()}),[D.toRouteName,D.toRouteId]),t.React.useEffect((()=>{D.routeName&&D.routeId&&D.routeName.length<1&&D.routeId.length<1&&pe("")}),[h,v]);const he=t.hooks.useEventCallback((e=>{const t=v.useRouteName?v.routeNameFieldSchema.jimuName:v.routeIdFieldSchema.jimuName,o=(0,r.getSuggestions)(t,e,p);Promise.all([o]).then((e=>oa(this,void 0,void 0,(function*(){const o=null==e?void 0:e[0];if(!k&&D.lineId){const e=[];o.forEach((t=>{t.suggestionItem.forEach((t=>{e.push(t.suggestion)}))}));const a=[],n=(0,r.queryRoutesByLineId)(e,D.lineId,v,p);yield Promise.all([n]).then((e=>{const n=null==e?void 0:e[0];if((0,r.isDefined)(n)){for(let e=0;e<n.features.length;e++){const o=n.features[e].attributes[t];a.push(o)}a.length>0?o.forEach((e=>{const t=e.suggestionItem.filter((e=>a.includes(e.suggestion)));e.suggestionItem=t})):o.forEach((e=>{e.suggestionItem=[]}))}})).catch((e=>{o.forEach((e=>{e.suggestionItem=[]}))}))}o&&me(o),X.current&&de(!0)})))).catch((e=>{}))})),pe=e=>{k?re(e):ue(e),X.current=e,ae.current=e},De=()=>{var e;null===(e=ee.current)||void 0===e||e.focus(),be(!0,!1)},be=(e=!1,t=!0)=>{e||(ie.current=!1)};t.React.useEffect((()=>{(0,r.isDefined)(v)&&((0,r.isDefined)(w)||(re(""),ue("")),B(""),z(""),P(!1),C(!1),_(!1),U(!1),R(),I())}),[v]),t.React.useEffect((()=>{(0,r.isDefined)(b)&&b.view&&J(b.view.popupEnabled)}),[b]);const ge=(e,t=!1)=>new Promise((o=>{setTimeout((()=>{ae.current&&!t&&(e=ae.current),ae.current=null;const a=[],n=(0,r.isDefined)(D.lineId)?k?"":D.lineId:"",i=(0,r.queryRouteIdOrName)(e.trim(),v,p,j,k,n).then((o=>oa(this,void 0,void 0,(function*(){if((0,r.isDefined)(o)){if(!t&&(M||k&&(e===D.routeId||e===D.routeName)||!k&&(e===D.toRouteId||e===D.toRouteName)))return{valid:!0};if(yield Promise.all(o.features.map((t=>oa(this,void 0,void 0,(function*(){const o=k?yield Re(t,e):yield Ie(t,e);a.push(o)}))))),a.length>1&&!t)ke(a);else if(a.length>0){let o=a[0];if(t&&(o=a.find((e=>e.fromDate.getTime()===D.fromDate.getTime()))),k){if(V.length>0||t&&!isNaN(D.selectedMeasure))return ye(o,t).then((t=>(j||e===D.toRouteId||e===D.toRouteName||A||(t.selectedToMeasure=NaN),y(t,!0),{valid:!0})));j||e===D.toRouteId||e===D.toRouteName||O||(o.selectedToMeasure=NaN),y(o,!0)}else{if(W.length>0||t&&!isNaN(D.selectedToMeasure))return Se(o,t).then((e=>(y(e,!0),{valid:!0})));y(o,!0)}}return{valid:!0}}})))).catch((t=>{if(M)return pe(""),{valid:!0};{const t=j?D.toRouteId:"",o=j||""===e?NaN:D.selectedToMeasure,a=isNaN(o)?null:D.selectedToPoint,n=j?D.selectedToPolyline:null;if((0,r.isDefined)(v)&&v.useRouteName)if(k){const i=j?D.toRouteName:""===e?"":D.toRouteName,s=Object.assign(Object.assign({},D),{routeName:e,toRouteName:i,routeId:"",toRouteId:t,selectedMeasure:NaN,selectedToMeasure:o,selectedPolyline:null,selectedToPolyline:n,selectedPoint:null,selectedToPoint:a,validRoute:!1});y(s)}else{const t=Object.assign(Object.assign({},D),{toRouteName:e,toRouteId:"",selectedToPolyline:null,selectedToMeasure:NaN,selectedToPoint:null,validToRoute:!1});y(t)}else if(k){const i=Object.assign(Object.assign({},D),{routeId:e,toRouteId:t,selectedMeasure:NaN,selectedToMeasure:o,selectedPolyline:null,selectedToPolyline:n,selectedPoint:null,selectedToPoint:a,validRoute:!1});y(i)}else{const t=Object.assign(Object.assign({},D),{toRouteId:e,selectedToMeasure:NaN,selectedToPolyline:null,selectedToPoint:null,validToRoute:!1});y(t)}return e.length>0?{valid:!1,msg:d("routeNotFound")}:(pe(""),{valid:!0})}}));o(i)}),200)})),Re=(e,t)=>oa(this,void 0,void 0,(function*(){const t=(0,r.getNetworkOutFields)(v),o=v.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.routeIdFieldName],n=e.attributes[t.fromDateFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,l=(0,r.getRouteFromEndMeasures)(e.geometry),u=e.attributes[t.lineIdFieldName],c=e.attributes[t.lineOrderFieldName],d=e.attributes[t.lineNameFieldName];let f=w?D.fromDate:new Date(Date.now());(0,r.isDefined)(f)&&(0,r.isDefined)(i)&&f>i&&(f=(0,r.getDateWithTZOffset)(n,p));let m=w?D.toDate:new Date(Date.now());(0,r.isDefined)(m)&&(0,r.isDefined)(i)&&m>i&&(m=(0,r.getDateWithTZOffset)(i,p)),(0,r.isDefined)(i)||w||(m=null);let h=!1;return j&&!D.validToRoute||u&&D.toLineId!==u?h=!0:j||(h=!0),yield(0,r.QueryRouteMeasures)(p,v,l,n,a).then((e=>oa(this,void 0,void 0,(function*(){const t=Math.min(...e),l=Math.max(...e),b=Object.assign(Object.assign({},D),{routeId:a,toRouteId:h?a:D.toRouteId,routeName:o,toRouteName:h?o:D.toRouteName,routeLineOrder:c,toRouteLineOrder:h?c:D.toRouteLineOrder,lineId:u,toLineId:u,lineName:d,toLineName:d,fromMeasure:ta(t,v.measurePrecision),toMeasure:ta(l,v.measurePrecision),toRouteFromMeasure:h?ta(t,v.measurePrecision):D.toRouteFromMeasure,toRouteToMeasure:h?ta(l,v.measurePrecision):D.toRouteToMeasure,selectedToMeasure:h?NaN:D.selectedToMeasure,fromDate:(0,r.isDefined)(n)?(0,r.getDateWithTZOffset)(n,p):null,toDate:(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,p):null,toRouteFromDate:h?(0,r.isDefined)(n)?(0,r.getDateWithTZOffset)(n,p):null:D.toRouteFromDate,toRouteToDate:h?(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,p):null:D.toRouteToDate,selectedToPoint:h?null:D.selectedToPoint,selectedPolyline:s,selectedToPolyline:h?s:D.selectedToPolyline,selectedFromDate:f,selectedToDate:m,validRoute:!0,validToRoute:!0});return A&&(b.selectedMeasure=D.fromMeasure),b}))))})),Ie=(e,t)=>oa(this,void 0,void 0,(function*(){const t=(0,r.getNetworkOutFields)(v),o=v.useRouteName?e.attributes[t.routeNameFieldName]:"",a=e.attributes[t.fromDateFieldName],n=e.attributes[t.routeIdFieldName],i=e.attributes[t.toDateFieldName],s=e.geometry,l=(0,r.getRouteFromEndMeasures)(e.geometry),u=e.attributes[t.lineOrderFieldName];let c=w?D.fromDate:new Date(Date.now());(0,r.isDefined)(i)&&(0,r.isDefined)(c)&&c>i?c=(0,r.getDateWithTZOffset)(a,p):(0,r.isDefined)(c)||c.setHours(0,0,0,0);let d=w?D.toDate:new Date(Date.now());return(0,r.isDefined)(i)&&(0,r.isDefined)(d)&&d>i?d=(0,r.getDateWithTZOffset)(i,p):(0,r.isDefined)(d)&&d.setHours(0,0,0,0),(0,r.isDefined)(i)||w||(d=null),yield(0,r.QueryRouteMeasures)(p,v,l,a,n).then((e=>oa(this,void 0,void 0,(function*(){const t=Math.min(...e),l=Math.max(...e),c=Object.assign(Object.assign({},D),{toRouteName:j?o:D.routeName,toRouteId:j?n:D.routeId,toRouteFromDate:j?(0,r.isDefined)(a)?(0,r.getDateWithTZOffset)(a,p):null:D.toRouteFromDate,toRouteToDate:j?(0,r.isDefined)(i)?(0,r.getDateWithTZOffset)(i,p):null:D.toRouteToDate,selectedToPolyline:j?s:D.selectedToPolyline,toRouteFromMeasure:j?ta(t,v.measurePrecision):D.toRouteFromMeasure,toRouteToMeasure:j?ta(l,v.measurePrecision):D.toRouteToMeasure,toRouteLineOrder:j?u:D.toRouteLineOrder,validToRoute:!0});return O&&(c.selectedToMeasure=D.toRouteToMeasure),c}))))})),ye=(e,t)=>(0,r.QueryMeasureOnRoute)(p,v,e.routeId,e.fromDate,t?e.selectedMeasure.toString():V).then((o=>{if(o){return Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t?e.selectedMeasure.toString():V)})}return Object.assign(Object.assign({},e),{selectedPoint:null,selectedMeasure:NaN})})),Se=(e,t)=>(0,r.QueryMeasureOnRoute)(p,v,e.toRouteId,e.toRouteFromDate,t?e.selectedToMeasure.toString():W).then((o=>{if(o){return Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t?e.selectedToMeasure.toString():W)})}return Object.assign(Object.assign({},e),{selectedToPoint:null,selectedToMeasure:NaN})}));t.React.useEffect((()=>{if(k&&j&&D.toRouteId.length<1&&D.toRouteName.length<1&&D.validRoute){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName});y(e)}k||j||v&&!v.useRouteName&&!D.routeId.length&&D.validToRoute&&ue(D.routeId)}),[D.routeId,D.routeName]),t.React.useEffect((()=>{if(j&&!w&&!O)if(k){const e=Object.assign(Object.assign({},D),{toRouteId:D.routeId,toRouteName:D.routeName,selectedToMeasure:NaN,selectedToPoint:null});y(e)}else R()}),[D.lineId]);const Ne=(e=!0,t=!0)=>{w||setTimeout((()=>{if(M&&(ee.current.disabled=!1,x||(te.current.disabled=!1)),e&&(ee.current.select(),ee.current.focus(),ee.current.blur()),t&&!x){const e=te.current.disabled;te.current.disabled=!1,te.current.focus(),te.current.blur(),te.current.disabled=e}M&&(ee.current.disabled=!k,x||(te.current.disabled=!0))}),600)},ke=t.React.useCallback((e=>{e.length&&(Z(!0),H(e))}),[]),je=t.React.useCallback((e=>{(0,r.isDefined)(e)&&y(e,!0),Z(!1)}),[y]),Me=t.React.useCallback((()=>{Z(!1)}),[]);return(0,t.jsx)("div",{className:"route-and-measure-form d-flex w-100 pt-1 px-3"},v&&(0,t.jsx)("div",{className:"w-100"},(0,t.jsx)(a.Label,{size:"sm",className:"w-100",style:{padding:0,paddingTop:5,width:100,alignItems:"center",fontWeight:500}},k?v.useRouteName?d("fromRouteNameLabel"):d("fromRouteIdLabel"):v.useRouteName?d("toRouteNameLabel"):d("toRouteIdLabel")),(0,t.jsx)("div",{ref:K,className:"d-flex w-100",style:{paddingBottom:3}},(0,t.jsx)(a.TextInput,{type:"text",className:"w-100",size:"sm",allowClear:!0,disabled:!(0,r.isDefined)(p)||!k&&(!j||D.routeId.length<1&&D.routeName.length<1&&D.toRouteId.length<1&&D.toRouteName.length<1),onBlur:()=>{oe.current=setTimeout((()=>{ne.current||de(!1),ie.current||be(!1)}),200)},value:k?se||"":le||"",ref:ee,onChange:e=>{var t;ae.current=null;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,a=(null==o?void 0:o.length)>2;if(pe(o),!a)return de(!1),!1;Y.current(o)},checkValidityOnAccept:ge}),(k?se:le)&&(0,t.jsx)(r.Intellisense,{isOpen:(ce||(ne.current=!1),ce),reference:K,searchText:k?se:le,searchSuggestion:fe,onRecordItemClick:(e,t)=>{if(t)return De(),!1;ae.current=e,pe(e)},id:m,searchInputRef:ee}),(0,t.jsx)(r.RoutePicker,{type:"route-measure",active:k?N.fromRoutePickerActive:N.toRoutePickerActive,networkDs:p,network:v,routeInfo:D,disabled:!(0,r.isDefined)(p)||!k&&(!j||(null===(n=D.routeId)||void 0===n?void 0:n.length)<1&&(null===(i=D.routeName)||void 0===i?void 0:i.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:g,onActiveChange:k?()=>{const e=!N.fromRoutePickerActive;if(P(e),e){_(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!0,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!L&&!E&&!G}),800)}}:()=>{const e=!N.toRoutePickerActive;if(C(e),e){U(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!0,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!F&&!E&&!G}),800)}},onRouteInfoUpdated:ve,onMultiRouteSelect:ke,isFrom:k,canSpanRoutes:j,useRouteStartMeasure:A,useRouteEndMeasure:O})),!x&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"w-100",style:{padding:0,paddingTop:5,width:100,alignItems:"center",fontWeight:500}},d(k?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,r.GetUnits)(v.unitsOfMeasure,f)})),(0,t.jsx)("div",{className:"d-flex w-100"},(0,t.jsx)(a.TextInput,{ref:te,"aria-label":d(k?"fromMeasureWithUnits":"toMeasureWithUnits",{units:(0,r.GetUnits)(v.unitsOfMeasure,f)}),className:"w-100",size:"sm",value:k?V:W,disabled:!(0,r.isDefined)(p)||(k?A:O)||(k?D.routeId.length<1&&(null===(s=D.routeName)||void 0===s?void 0:s.length)<1:D.toRouteId.length<1&&(null===(l=D.toRouteName)||void 0===l?void 0:l.length)<1),onChange:e=>{var t;t=e.target.value,k?B(t):z(t)},checkValidityOnAccept:e=>oa(this,void 0,void 0,(function*(){let t=NaN;if(""===e){t=NaN;const e=Object.assign({},D);return k?(e.selectedMeasure=NaN,e.selectedPoint=null):(e.selectedToMeasure=NaN,e.selectedToPoint=null),y(e),{valid:!0}}if(t=isNaN(Number(e))?(0,r.convertStationToNumber)(e):Number(e),isNaN(t)){R();const e=Object.assign({},D);return k?(e.selectedMeasure=NaN,e.selectedPoint=null,B("")):(e.selectedToMeasure=NaN,e.selectedToPoint=null,z("")),y(e),{valid:!0}}{const e=!j&&(0,r.isDefined)(D.selectedPolyline)||j&&D.routeId===D.toRouteId&&(0,r.isDefined)(D.selectedPolyline)||j&&D.routeId!==D.toRouteId&&(0,r.isDefined)(D.selectedToPolyline);if(k&&(0,r.isDefined)(D.selectedPolyline)||!k&&e){if(k){if(t<D.fromMeasure)return{valid:!1,msg:d("measureLessError")};if(t>D.toMeasure)return{valid:!1,msg:d("measureGreaterError")}}else{const e=j?D.routeId===D.toRouteId?D.fromMeasure:D.toRouteFromMeasure:D.fromMeasure,o=j?D.routeId===D.toRouteId?D.toMeasure:D.toRouteToMeasure:D.toMeasure;if(t<e)return{valid:!1,msg:d("measureLessError")};if(t>o)return{valid:!1,msg:d("measureGreaterError")}}t=ta(t,v.measurePrecision);let e=Object.assign({},D);k?e.routeId.length?yield(0,r.QueryMeasureOnRoute)(p,v,e.routeId,e.fromDate,t.toString()).then((o=>{(0,r.isDefined)(o)&&(!(0,r.isDefined)(e.selectedPoint)||o.x!==e.selectedPoint.x&&o.y!==e.selectedPoint.y)&&(e=Object.assign(Object.assign({},e),{selectedPoint:o,selectedMeasure:parseFloat(t.toString())}),y(e))})):y(e):e.toRouteId.length?yield(0,r.QueryMeasureOnRoute)(p,v,e.toRouteId,e.toRouteFromDate,t.toString()).then((o=>{(!(0,r.isDefined)(e.selectedToPoint)||o.x!==e.selectedToPoint.x&&o.y!==e.selectedToPoint.y)&&(e=Object.assign(Object.assign({},e),{selectedToPoint:o,selectedToMeasure:parseFloat(t.toString())}),y(e))})):y(e)}return{valid:!0}}}))}),(0,t.jsx)(r.RoutePicker,{type:"measure",active:k?N.fromMeasurePickerActive:N.toMeasurePickerActive,networkDs:p,network:v,routeInfo:D,disabled:!(0,r.isDefined)(p)||(k?A:O)||(k?D.routeId.length<1&&(null===(u=D.routeName)||void 0===u?void 0:u.length)<1:D.toRouteId.length<1&&(null===(c=D.toRouteName)||void 0===c?void 0:c.length)<1),jimuMapView:b,symbolColor:null,hoverGraphic:g,onActiveChange:k?()=>{const e=!N.fromMeasurePickerActive;if(_(e),e){P(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!0,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!F&&!L&&!G}),800)}}:()=>{const e=!N.toMeasurePickerActive;if(U(e),e){C(!1);const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!0});S(e),b.view.popupEnabled=!1}else{const e=Object.assign(Object.assign({},N),{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1});S(e),I(),setTimeout((()=>{b.view.popupEnabled=$&&!F&&!L&&!E}),800)}},onRouteInfoUpdated:ve,onMultiRouteSelect:ke,isFrom:k,canSpanRoutes:j}))),(0,t.jsx)(r.RoutePickerPopup,{isOpen:Q,routeInfos:q,useRouteName:v.useRouteName,onRouteSelect:je,onRouteSelectCancel:Me,isFrom:k,measurePrecision:v.measurePrecision,jimuMapView:b,graphicLayer:g})))}const na=()=>t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-line-event-route-selection-form {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
      fontWeight: 500;
    }
  `;function ia(e){const{intl:o,widgetId:a,network:n,event:i,networkDS:s,method:l,jimuMapView:u,hoverGraphic:c,pickedGraphic:d,isFrom:f,routeInfo:m,routeMeasurePickerInfo:v,reset:h,revalidateRouteFromDataAction:p,canSpanRoutes:D,onResetDataAction:b,useStartMeasure:g,useEndMeasure:R,hideMeasures:I,onUpdateRouteInfo:y,onUpdateRouteMeasurePickerInfo:S}=e;return(0,t.jsx)("div",{className:"add-line-event-route-selection-form d-flex",css:na()},(0,t.jsx)("div",{className:"d-flex w-100"},l===r.SearchMethod.Measure&&(0,t.jsx)(aa,{intl:o,widgetId:a,network:n,event:i,networkDS:s,routeInfo:m,jimuMapView:u,hoverGraphic:c,clearPickedGraphic:()=>{(0,r.isDefined)(d)&&d.removeAll()},clearHoverGraphic:()=>{(0,r.isDefined)(c)&&c.removeAll()},onRouteInfoUpdated:(e,t=!1)=>{y(e,t)},onRouteMeasurePickerInfoUpdated:e=>{S(e)},routeMeasurePickerInfo:v,isFrom:f,canSpanRoutes:D,reset:h,revalidateRouteFromDataAction:p,onResetDataAction:b,useStartMeasure:g,useEndMeasure:R,hideMeasures:I}),l===r.SearchMethod.Coordinate&&(0,t.jsx)("div",null),l===r.SearchMethod.LocationOffset&&(0,t.jsx)("div",null)))}var sa=l(99037);function ra(e){const n=t.hooks.useTranslation(o),{routeInfo:i,eventInfo:s,network:l,revalidateRouteFromDataAction:u,hideDates:c,useRouteStartEndDate:d,onUpdateRouteInfo:f}=e,[m,v]=t.React.useState(!1),[h,p]=t.React.useState(!1),[D,b]=t.React.useState("idle"),[g,R]=t.React.useState("idle"),[I,y]=t.React.useState(""),[S,N]=t.React.useState(""),[k,j]=t.React.useState(!1);t.React.useEffect((()=>{u&&(v(!1),p(!1),y(""),N(""))}),[u]),t.React.useEffect((()=>{v(d),p(d)}),[c]),t.React.useEffect((()=>{let e=!1;const t=Object.assign({},i);if(u||("idle"===D&&y(""),"idle"===g&&N("")),!(0,r.isDefined)(s)&&(0,r.isDefined)(null==l?void 0:l.lineIdFieldSchema)||(null==s?void 0:s.canSpanRoutes)||""===i.routeId&&""===i.routeName?j(!1):j(!0),""===i.routeId&&""===i.toRouteId&&""===i.routeName&&""===i.toRouteName)return v(!1),p(!1),b("idle"),R("idle"),y(""),void N("");(0,r.isDefined)(s)&&s.canSpanRoutes&&(v(!1),p(!1)),(0,r.isDefined)(i.selectedFromDate)&&m&&i.selectedFromDate!==i.fromDate&&(t.selectedFromDate=i.fromDate,e=!0),h&&i.selectedToDate!==i.toDate&&(t.selectedToDate=i.toDate,e=!0);M(i.selectedFromDate,!0)&&M(i.selectedToDate,!1),e&&f(t)}),[f,i,s,m,h]);const M=(e,t)=>{const o=e;if(!(0,r.isDefined)(o))return t?b("idle"):R("idle"),t?y(""):N(""),!0;let a=!0;return(0,r.isDefined)(i.fromDate)&&o<i.fromDate||(0,r.isDefined)(i.toRouteFromDate)&&o<i.toRouteFromDate?(t?b("invalid"):R("invalid"),t?y(n("invalidFromDateBefore")):N(n("invalidToDateBefore")),a=!1,!1):(0,r.isDefined)(i.toDate)&&o>i.toDate||(0,r.isDefined)(i.toRouteToDate)&&o>i.toRouteToDate?(t?b("invalid"):R("invalid"),t?y(n("invalidFromDateAfter")):N(n("invalidToDateAfter")),a=!1,!1):((0,r.isDefined)(i.selectedToDate)&&t&&(o>i.selectedToDate&&(b("invalid"),t?y(n("invalidDatesOrder")):N(n("invalidDatesOrder")),a=!1),S===n("invalidDatesOrder")?o<i.selectedToDate&&(R("idle"),N("")):S===n("invalidDatesSameDay")&&o!==i.selectedFromDate&&(R("idle"),N(""))),(0,r.isDefined)(i.selectedToDate)&&t&&o.getTime()===i.selectedToDate.getTime()&&(b("invalid"),t?y(n("invalidDatesSameDay")):N(n("invalidDatesSameDay")),a=!1),(0,r.isDefined)(i.selectedFromDate)&&(t||(o<i.selectedFromDate&&(R("invalid"),t?y(n("invalidDatesOrder")):N(n("invalidDatesOrder")),a=!1),I===n("invalidDatesOrder")?o>i.selectedFromDate&&(b("idle"),y("")):I===n("invalidDatesSameDay")&&o!==i.selectedFromDate&&(b("idle"),y("")))),(0,r.isDefined)(i.selectedFromDate)&&(t||o.getTime()!==i.selectedFromDate.getTime()||(R("invalid"),t?y(n("invalidDatesSameDay")):N(n("invalidDatesSameDay")),a=!1)),a&&(t?b("idle"):R("idle"),t?y(""):N("")),a)};return(0,t.jsx)("div",{className:"add-line=event-form-header px-3",css:(0,r.getCalciteBasicTheme)()},!c&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"mb-0 pt-3",style:{width:100,alignItems:"center",fontWeight:500}},n("startDateLabel")),(0,t.jsx)(a.Tooltip,{title:I},(0,t.jsx)(sa.CalciteInputDatePicker,{scale:"s",disabled:!!m||void 0,valueAsDate:i.selectedFromDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(M(o,!0),o){const e=Object.assign(Object.assign({},i),{selectedFromDate:o});f(e)}else{const e=Object.assign(Object.assign({},i),{selectedFromDate:null});f(e)}}},status:D,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:m,className:"mr-2",disabled:!k,onChange:(e,t)=>{M(i.fromDate,!0),v(t)}}),n("useStartDateLabel")),(0,t.jsx)(a.Label,{size:"sm",className:"mb-0 pt-1",style:{width:100,alignItems:"center",fontWeight:500}},n("endDateLabel")),(0,t.jsx)(a.Tooltip,{title:S},(0,t.jsx)(sa.CalciteInputDatePicker,{scale:"s",disabled:!!h||void 0,valueAsDate:i.selectedToDate,onCalciteInputDatePickerChange:e=>{var t;if(e){const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(M(o,!1),o){const e=Object.assign(Object.assign({},i),{selectedToDate:o});f(e)}else{const e=Object.assign(Object.assign({},i),{selectedToDate:null});f(e)}}},status:g,placement:"top",overlayPositioning:"fixed"})),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-2",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:h,className:"mr-2",disabled:!k,onChange:(e,t)=>{M(i.toDate,!1),p(t)}}),n("useEndDateLabel"))))}const la="#00FFFF",ua="#008000",ca="#FF0000";function da(e){const n=t.hooks.useTranslation(o),{eventInfo:i,onUpdateEventInfo:s}=e,[r,l]=t.React.useState(!1),[u,c]=t.React.useState(!1);t.React.useEffect((()=>{const e=Object.assign(Object.assign({},i),{mergeCoincident:!1,retireOverlapping:!1});s(e)}),[]),t.React.useEffect((()=>{l(i.mergeCoincident),c(i.retireOverlapping)}),[i]);return(0,t.jsx)("div",{className:"merge-retire-form px-3 h-100"},(0,t.jsx)("hr",{css:t.css`
            border: none;
            height: 1px;
            background-color: var(--ref-palette-neutral-400);
          `}),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-1",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:r,className:"mr-2",onChange:(e,t)=>{l(t);const o=Object.assign(Object.assign({},i),{mergeCoincident:t});s(o)}}),n("useMergeEventsLabel")),(0,t.jsx)(a.Label,{size:"sm",className:"w-100 pt-0",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:u,className:"mr-2",onChange:(e,t)=>{c(t);const o=Object.assign(Object.assign({},i),{retireOverlapping:t});s(o)}}),n("useRetireEventsLabel")))}function fa(n){const i=t.hooks.useTranslation(o),{operationType:s,onOperationTypeChanged:r}=n,l=t.React.useMemo((()=>s),[s]);return(0,t.jsx)("div",{className:"add-line-event-operation-type"},(0,t.jsx)(a.Label,{size:"default",className:"pt-2 mb-0 px-3",style:{fontWeight:500,width:100,alignItems:"center"}},i("typeLabel")),(0,t.jsx)(a.Select,{"aria-label":i("typeLabel"),className:"w-100 px-3",size:"sm",value:l,onChange:e=>{r(e.target.value)}},(0,t.jsx)("option",{value:e.single}," ",i("singleOperation")),(0,t.jsx)("option",{value:e.multiple}," ",i("multipleOperation"))))}var ma=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function va(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,lrsLayers:u,lineEventLayers:d,networkLayers:f,defaultEvent:m,defaultFromMethod:v,defaultToMethod:h,JimuMapView:p,operationType:D,hoverGraphic:b,pickedFromGraphic:g,pickedToGraphic:R,flashGraphic:I,hideEvent:y,hideNetwork:S,hideType:N,hideMethod:k,hideMeasures:j,hideDates:M,hideTitle:w,useRouteStartEndDate:T,conflictPreventionEnabled:x,networkDataSourceFromDataAction:A,routeInfoFromDataAction:O,onResetDataAction:F,onClearGraphics:P,onClearHoverGraphic:L,onOperationTypeChanged:C}=e,[E,_]=t.React.useState(0),[G,U]=t.React.useState(null),[V,B]=t.React.useState(null),[W,z]=t.React.useState(null),[Q,Z]=t.React.useState(null),[q,H]=t.React.useState(!1),[$,J]=t.React.useState(v),[K,Y]=t.React.useState(h),[X,ee]=t.React.useState(!1),[te,oe]=t.React.useState((0,r.getInitialRouteInfoState)()),[ae,ne]=t.React.useState(!1),[ie,se]=t.React.useState(!1),[re,le]=t.React.useState(!1),[ue,ce]=t.React.useState((0,r.getIntialLocksInfo)()),[de,fe]=t.React.useState(!x),me=t.React.useRef(null),[ve,he]=t.React.useState(!1),pe=t.React.useCallback((e=>{U(e)}),[U]),De=t.React.useCallback((e=>{B(e)}),[B]),be=t.React.useCallback((()=>{H(!0)}),[H]);t.React.useEffect((()=>{var e;null===(e=me.current)||void 0===e||e.focus()}),[]),t.React.useEffect((()=>{if(Q){const e=u.find((e=>e.serviceId===Q.eventInfo.parentNetworkId));e&&e.layerType===r.LrsLayerType.network&&z((0,t.Immutable)(e))}else{const e=u.find((e=>e.name===m.name));Z((0,t.Immutable)(e))}}),[m,u,Q]),t.React.useEffect((()=>{const e=(0,r.isDefined)(A)||(0,r.isDefined)(O);e&&ke(),e&&setTimeout((()=>{if((0,r.isDefined)(A)&&A.id!==(null==W?void 0:W.id)){U(A);const e=A.getLayerDefinition().id,t=u.find((t=>t.eventInfo.parentNetworkId===e&&!t.eventInfo.isPointEvent));(0,r.isDefined)(t)&&Re(t.name)}(0,r.isDefined)(O)&&(Q.eventInfo.canSpanRoutes||O.routeId===O.toRouteId||(O.toRouteId=O.routeId,O.toRouteName=O.routeName,O.toRouteFromMeasure=O.fromMeasure,O.toRouteToMeasure=O.toMeasure,O.selectedToPolyline=O.selectedPolyline,O.toRouteFromDate=O.fromDate,O.toRouteToDate=O.toDate),Me(O),ne(!0))}),2e3)}),[A,O]),t.React.useEffect((()=>{x&&ge()}),[Q,W]);const ge=(e=r.LockAction.None,t)=>{const o=Object.assign({},ue);(0,r.isDefined)(W)&&(o.networkId=[W.networkInfo.lrsNetworkId]),(0,r.isDefined)(Q)&&(o.eventServiceLayerIds=[Q.serviceId]),(0,r.isDefined)(t)&&(o.routeInfo=t),o.lockAction=e,ce(o)},Re=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));if(o){const e=u.find((e=>e.serviceId===o.eventInfo.parentNetworkId)),a=(0,r.getInitialRouteMeasurePickerInfoState)();if(Fe(a),e&&e.layerType===r.LrsLayerType.network&&Q&&(Q.eventInfo.parentNetworkId!==o.eventInfo.parentNetworkId||o.eventInfo.canSpanRoutes||Q.eventInfo.canSpanRoutes&&!o.eventInfo.canSpanRoutes)){if(z((0,t.Immutable)(e)),!(0,r.isDefined)(O)){const e=(0,r.getInitialRouteInfoState)();Me(e)}j||(se(!1),le(!1))}he(!0),Z((0,t.Immutable)(o)),L()}}),[u,Q,W,O]),Ie=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));(0,r.isDefined)(o)&&z((0,t.Immutable)(o))}),[u]),ye=t.React.useCallback((e=>{J(e)}),[]),Se=t.React.useCallback((e=>{Y(e)}),[]),Ne=t.React.useCallback((e=>{e&&ke(),_(0),me.current&&me.current.focus()}),[]);t.React.useEffect((()=>{se(j),le(j)}),[j]),t.React.useEffect((()=>{j&&(se(j),le(j))}),[]);const ke=()=>{P();const e=(0,r.getInitialRouteInfoState)();Me(e,!1,!0);const t=(0,r.getInitialEventInfoState)();xe(t);const o=(0,r.getInitialRouteMeasurePickerInfoState)();Fe(o),j||(se(!1),le(!1)),ee(!0),setTimeout((()=>{ee(!1)}),800)},je=()=>{ne(!1),F()},Me=(e,t=!1,o=!1)=>{if(oe(e),Ce(e,t),x){const t=o?r.LockAction.Clear:r.LockAction.QueryAndAcquire;ge(t,e)}},[we,Te]=t.React.useState((0,r.getInitialEventInfoState)()),xe=e=>{Te(e)},[Ae,Oe]=t.React.useState((0,r.getInitialRouteMeasurePickerInfoState)()),Fe=e=>{Oe(e)};t.React.useEffect((()=>{(0,r.isDefined)(W)&&!(0,r.isDefined)(A)&&(oe((0,r.getInitialRouteInfoState)()),Te((0,r.getInitialEventInfoState)()))}),[W]);const Pe=()=>{(0,r.isDefined)(g)&&g.removeAll()},Le=()=>{(0,r.isDefined)(R)&&R.removeAll()},Ce=(e,t)=>ma(this,void 0,void 0,(function*(){var o;(0,r.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),la),(0,r.isDefined)(o)&&(I.add(o),setTimeout((()=>{I.removeAll(),setTimeout((()=>{I.add(o),setTimeout((()=>{I.removeAll(),setTimeout((()=>{I.add(o),setTimeout((()=>{I.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,r.isDefined)(e.selectedPoint)?(e=>{(0,r.isDefined)(e)?(g.removeAll(),g.add(e)):Pe()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),ua)):Pe(),(0,r.isDefined)(e.selectedToPoint)?(e=>{(0,r.isDefined)(e)?(R.removeAll(),R.add(e)):Le()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedToPoint),ca)):Le(),(0,r.isDefined)(p)&&p.clearSelectedFeatures()})),Ee=t.React.useCallback((()=>{var e,t,o;let a=!0;if(a=a&&(null===(e=te.routeId)||void 0===e?void 0:e.length)>0,a=a&&(null===(t=te.toRouteId)||void 0===t?void 0:t.length)>0,!de)return!1;if(!(0,r.isDefined)(W)||!(0,r.isDefined)(W.networkInfo))return!1;const n=ta(te.fromMeasure,W.networkInfo.measurePrecision),i=ta(te.toMeasure,W.networkInfo.measurePrecision),s=ta(te.selectedMeasure,W.networkInfo.measurePrecision),l=ta(te.selectedToMeasure,W.networkInfo.measurePrecision);if(isNaN(n)||isNaN(s))return!1;if(a=a&&s>=n,null===(o=Q.eventInfo)||void 0===o?void 0:o.canSpanRoutes){const e=ta(te.toRouteFromMeasure,W.networkInfo.measurePrecision),t=ta(te.toRouteToMeasure,W.networkInfo.measurePrecision);if(isNaN(e)||isNaN(l))return!1;if(a=a&&l>=e,isNaN(t)||isNaN(l))return!1;a=a&&l<=t}else{if(isNaN(i)||isNaN(l))return!1;a=a&&l<=i}return(0,r.isDefined)(te.selectedFromDate)&&!(0,r.isDefined)(te.selectedToDate)&&((0,r.isDefined)(te.fromDate)&&(a=a&&te.selectedFromDate>=te.fromDate),(0,r.isDefined)(te.toDate)&&(a=a&&te.selectedFromDate<te.toDate)),!(0,r.isDefined)(te.selectedFromDate)&&(0,r.isDefined)(te.selectedToDate)&&((0,r.isDefined)(te.fromDate)&&(a=a&&te.selectedToDate>=te.fromDate),(0,r.isDefined)(te.toDate)&&(a=a&&te.selectedToDate<te.toDate)),(0,r.isDefined)(te.selectedFromDate)&&(0,r.isDefined)(te.selectedToDate)&&(a=a&&te.selectedFromDate<te.selectedToDate,(0,r.isDefined)(te.fromDate)&&(a=a&&te.selectedFromDate>=te.fromDate),(0,r.isDefined)(te.toDate)&&(a=a&&te.selectedToDate<=te.toDate)),!(!(0,r.isDefined)(te.selectedFromDate)&&!(0,r.isDefined)(te.selectedToDate))&&(!(te.routeId!==te.toRouteId&&(0,r.isDefined)(te.fromDate)&&(0,r.isDefined)(te.toRouteFromDate)&&(te.selectedFromDate<te.fromDate||(0,r.isDefined)(te.toDate)&&te.selectedFromDate>te.toDate||te.selectedFromDate<te.toRouteFromDate||(0,r.isDefined)(te.toRouteToDate)&&te.selectedFromDate>te.toRouteToDate))&&a)}),[te,de]),_e=t.React.useCallback(((e,t,o)=>{fe(!!o),ce(e)}),[]);return(0,t.jsx)("div",{className:"add-single-line-event h-100 d-flex",ref:me,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-single-line-event-form {
      height: 100%;
    }
    .add-single-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-single-line-event__actions {
      height: 100%;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(xo,{network:W,event:Q,dataSourcesReady:be,onCreateNetworkDs:pe,onCreateEventDs:De}),!w&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-line-event__content",{"d-none":1===E,[a.FOCUSABLE_CONTAINER_CLASS]:1!==E})},x&&(0,t.jsx)(r.LockManagerComponent,{intl:s,showAlert:!0,featureDS:G,lockInfo:ue,networkName:null===(n=null==W?void 0:W.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:x,onQueryAndAcquireComplete:_e,onMessageClear:()=>{ge(r.LockAction.None)}}),!N&&(0,t.jsx)(fa,{operationType:D,onOperationTypeChanged:C}),!y&&(0,t.jsx)("div",null,(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",style:{fontWeight:500}},i("eventLayerLabel")),(0,t.jsx)(a.Select,{"aria-label":i("eventLayerLabel"),className:"w-100 px-3",size:"sm",value:Q?Q.name:"",disabled:1===d.length,onChange:e=>{Re(e.target.value)}},d.map(((e,o)=>(0,t.jsx)("options",{key:o,value:e},e))))),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:!0,defaultItem:(0,r.isDefined)(W)?W.name:"",listItems:f,onSelectionChanged:Ie}),!k&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("fromMethodLabel"),defaultItem:$,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:ye}),(0,t.jsx)(ia,{intl:s,widgetId:l,network:W?W.networkInfo:null,event:Q,dsReady:!q,networkDS:G,method:$,jimuMapView:p,hoverGraphic:b,pickedGraphic:g,isFrom:!0,routeInfo:te,routeMeasurePickerInfo:Ae,reset:X,hideMeasures:j,revalidateRouteFromDataAction:ae,onResetDataAction:je,canSpanRoutes:!(!(0,r.isDefined)(Q)||!(0,r.isDefined)(Q.eventInfo))&&Q.eventInfo.canSpanRoutes,onUpdateRouteInfo:Me,onUpdateRouteMeasurePickerInfo:Fe,useStartMeasure:ie,useEndMeasure:re}),!j&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:ie,className:"mr-2",disabled:!(0,r.isDefined)(te)||isNaN(te.fromMeasure),onChange:(e,t)=>{if(t){const e=te;e.selectedMeasure=e.fromMeasure,e.selectedPoint=null,Me(e)}se(t)}}),i("useStartMeasureLabel")),!k&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("toMethodLabel"),defaultItem:K,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Se}),(0,t.jsx)(ia,{intl:s,widgetId:l,network:W?W.networkInfo:null,event:Q,dsReady:!q,networkDS:G,method:K,jimuMapView:p,hoverGraphic:b,pickedGraphic:R,isFrom:!1,routeInfo:te,routeMeasurePickerInfo:Ae,reset:X,hideMeasures:j,revalidateRouteFromDataAction:ae,onResetDataAction:je,canSpanRoutes:!(!(0,r.isDefined)(Q)||!(0,r.isDefined)(Q.eventInfo))&&Q.eventInfo.canSpanRoutes,onUpdateRouteInfo:Me,onUpdateRouteMeasurePickerInfo:Fe,useStartMeasure:ie,useEndMeasure:re}),!j&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:re,className:"mr-2",disabled:!(0,r.isDefined)(null==te?void 0:te.toRouteToMeasure)||isNaN(te.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=te;e.selectedToMeasure=e.toRouteToMeasure,e.selectedToPoint=null,Me(e)}le(t)}}),i("useEndMeasureLabel")),(0,t.jsx)(ra,{hideDates:M,useRouteStartEndDate:T,routeInfo:te,eventInfo:Q?Q.eventInfo:null,network:W?W.networkInfo:null,revalidateRouteFromDataAction:ae,onUpdateRouteInfo:Me}),(0,t.jsx)(da,{eventInfo:we,onUpdateEventInfo:xe})),(0,t.jsx)("div",{className:(0,t.classNames)("add-line-footer w-100",{"d-none":1===E,[a.FOCUSABLE_CONTAINER_CLASS]:1!==E})},(0,t.jsx)(a.Label,{size:"sm",className:"mt-auto mr-auto",style:{fontWeight:500,width:100,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500"},onClick:ke},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!Ee()&&q,onClick:()=>{he(!1),_(1)}},i("nextLabel")))),(0,t.jsx)("div",{className:(0,t.classNames)("add-single-line-event__content",{"d-none":1!==E,[a.FOCUSABLE_CONTAINER_CLASS]:1===E})},(0,t.jsx)(To,{intl:s,widgetId:l,networkDS:G,network:W,eventDS:V,eventLayer:Q,routeInfo:te,eventInfo:we,reset:X||ve,jimuMapView:p,hoverGraphic:b,conflictPreventionEnabled:x,onNavBack:Ne})))}var ha=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};const pa=()=>t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .add-multiple-line-events-edit-attributes__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-multiple-line-event-edit-attributes__toast-container {
      position: absolute;
      background-color: rgba(255, 255, 255, 0.7);
      height: 100%;
    }
    .add-multiple-line-event-edit-attributes__toast {
      position: relative;
      top: 4%;
    }
    .add-multiple-line-events-edit-attributes__action {
      height: auto;
    }
    .add-multiline-attributes-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `;function Da(e){const n=t.hooks.useTranslation(o),{intl:i,widgetId:s,networkDS:l,network:u,eventLayers:c,routeInfo:d,eventInfo:f,attributeSet:m,reset:v,isReady:h,jimuMapView:p,hoverGraphic:D,conflictPreventionEnabled:b,onNavBack:g}=e,[R,I]=t.React.useState([]),[y,S]=t.React.useState([]),[N,k]=t.React.useState([]),[j,M]=t.React.useState([]),[w,T]=t.React.useState(!1),[x,A]=t.React.useState(),[O,F]=t.React.useState(""),[P,L]=t.React.useState(!1),[C,E]=t.React.useState(!1),[_,G]=t.React.useState((0,r.getIntialLocksInfo)()),[U,V]=t.React.useState(!0),[B,W]=t.React.useState(!1);t.React.useEffect((()=>{v&&Q(c)}),[v]),t.React.useEffect((()=>{(0,r.isDefined)(m)&&(0,r.isDefined)(c)&&h&&Q(c)}),[m,c,h]),t.React.useEffect((()=>{z()}),[l,u,c,d]);const z=(e=r.LockAction.None,t,o)=>{if(b){const a=Object.assign({},_);if((0,r.isDefined)(u)&&(a.networkId=[u.lrsNetworkId]),(0,r.isDefined)(c)){const e=(0,r.isDefined)(o)?o:j,t=[];N.forEach(((o,a)=>{e[a]&&t.push(o.serviceId)})),a.eventServiceLayerIds=t}(0,r.isDefined)(t)&&(a.routeInfo=t),a.lockAction=e,G(a)}},Q=e=>{if((0,r.isDefined)(e)){const t=[],o=[],a=[],n=[];e.forEach((e=>{const i=Z(e),s=q(e,i);t.push(i),o.push(s),a.push(e.asMutable({deep:!0})),n.push(!0)})),I(t),S(o),k(a),E(0===a.length),M(n),z(r.LockAction.None,d,n),V(!0)}},Z=e=>{if((0,r.isDefined)(e)&&(0,r.isDefined)(e.useDataSource)){const o=t.DataSourceManager.getInstance().getDataSource(e.useDataSource.dataSourceId);if((0,r.isDefined)(o))return o}},q=(e,t)=>{const o=[];if((0,r.isDefined)(t)){const a=t,n=(null==a?void 0:a.layer).fields,i=m.layers.find((t=>t.layerId===e.serviceId));(0,r.isDefined)(i)&&i.fields.forEach((e=>{const t=n.find((t=>t.name===e.name));if(t){let a;""!==e.value&&(a=(0,r.isDate)(t.type)?(0,r.isDefined)(e.value)?new Date(e.value):null:(0,r.isNumber)(t.type)?Number(e.value):e.value);const n={index:o.length,name:t.name,alias:t.alias,type:t.type,hasDomain:(0,r.isDefined)(t.domain),value:a,error:"",nullable:t.nullable,default:"number"==typeof a?Number(a).toString():a,length:t.length,editable:t.editable};o.push(n)}}))}return o},H=e=>e.findIndex((e=>e.error.length>0))>-1,$=(e,t,o,a)=>{const n=jo(y),i=jo(n[a]);i[o].value=e,i[o].error=t,n[a]=i,S(n),L(H(n[a]))},J=(e,t)=>{const o=jo(y);o[t]=e,S(o),L(H(e))},K=(e,t)=>{const o=j;o[t]=e,M(o),z(r.LockAction.None,d,o),o.every((e=>!e))?E(!0):E(!1)},Y=e=>{b?(W(!1),z(r.LockAction.Clear)):g(e)},X=()=>ha(this,void 0,void 0,(function*(){R.forEach((e=>ha(this,void 0,void 0,(function*(){var o;const a=e,n=a.getPopupInfo(),i=a.getLayerDefinition(),r=(e=>e.length?e:(()=>{var e;return[{fieldName:null!==(e=null==i?void 0:i.objectIdField)&&void 0!==e?e:"objectid",label:"OBJECTID",tooltip:"",visible:!0}]})())(((null==n?void 0:n.fieldInfos)||[]).filter((e=>e.visible))),l=a.mergeQueryParams(null!==(o=a.getCurrentQueryParams())&&void 0!==o?o:{},{where:"1=1",sqlExpression:null}),u=Object.assign({returnGeometry:!0},l);yield a.load(u,{widgetId:s});const c=new t.DataRecordSetChangeMessage(s,t.RecordSetChangeType.CreateUpdate,[{records:a.getRecords(),fields:r.map((e=>e.fieldName)),dataSource:a,name:a.id}]);t.MessageManager.getInstance().publishMessage(c)}))))})),ee=e=>ha(this,void 0,void 0,(function*(){if((()=>{const e=jo(y);let t=!1;return e.forEach(((o,a)=>{if(j[a]){const i=jo(o);i.forEach((o=>{let s;if(s=o.hasDomain?(0,r.validateRangeDomain)(o.value,o.name,R[a]):((0,r.isDate)(o.type),(0,r.validateField)(o.value,o.name,R[a])),s.hasError){A("error");const r=N[a].useFieldAlias?o.alias:o.name;F(n("attributeError",{fieldValue:r,message:n(s.message)})),T(!0),setTimeout((()=>{T(!1)}),5e3),t=!0,o.error=n(s.message),e[a]=i}}))}})),t&&S(e),t})())return;let o=R[0].getGDBVersion();o||(o="");const a=N[0].lrsUrl,i={edits:[]};yield Promise.all(N.map(((e,o)=>ha(this,void 0,void 0,(function*(){if(j[o]&&(0,r.isDefined)(e)){const a={};let n=!1,s=!1;e.eventInfo.canSpanRoutes?d.routeLineOrder>d.toRouteLineOrder?n=!0:d.routeId===d.toRouteId&&d.selectedMeasure>d.selectedToMeasure&&(s=!0):d.selectedMeasure>d.selectedToMeasure&&(s=!0);const c=e.eventInfo.eventIdFieldName;a[c]="{"+t.utils.getUUID()+"}";const m=e.eventInfo.routeIdFieldName;a[m]=d.routeId;const v=e.eventInfo.fromMeasureFieldName;a[v]=d.selectedMeasure;const h=e.eventInfo.fromDateFieldName;if(d.selectedFromDate){const e=(0,r.isDefined)(d.selectedFromDate)?(0,r.getDateWithoutTZOffset)(d.selectedFromDate.valueOf(),l):null;a[h]=(0,r.getDateToUTC)(e)}else a[h]=d.selectedFromDate;const p=e.eventInfo.toDateFieldName;if(d.selectedToDate){const e=(0,r.isDefined)(d.selectedToDate)?(0,r.getDateWithoutTZOffset)(d.selectedToDate.valueOf(),l):null;a[p]=(0,r.getDateToUTC)(e)}else a[p]=d.selectedToDate;if(e.eventInfo.routeNameFieldName&&e.eventInfo.routeNameFieldName.length>0){const t=e.eventInfo.routeNameFieldName;a[t]=d.routeName}if(e.eventInfo.toRouteIdFieldName&&e.eventInfo.toRouteIdFieldName.length>0){const t=e.eventInfo.toRouteIdFieldName;a[t]=d.toRouteId,n&&(a[m]=d.toRouteId,a[t]=d.routeId)}if(e.eventInfo.toRouteNameFieldName&&e.eventInfo.toRouteNameFieldName.length>0){const t=e.eventInfo.toRouteNameFieldName;if(a[t]=d.toRouteName,n){const o=e.eventInfo.routeNameFieldName;a[o]=d.toRouteName,a[t]=d.routeName}}if(e.eventInfo.toMeasureFieldName&&e.eventInfo.toMeasureFieldName.length>0){const t=e.eventInfo.toMeasureFieldName;a[t]=d.selectedToMeasure,(n||s)&&(a[v]=d.selectedToMeasure,a[t]=d.selectedMeasure)}y[o].forEach((e=>{const t=e.name;if((0,r.isDefined)(e.value)&&(0,r.isDate)(e.type)){const o=(0,r.getDateWithoutTZOffset)(e.value.valueOf(),l);a[t]=(0,r.getDateToUTC)(o)}else(0,r.isNumber)(e.type)?!(0,r.isDefined)(e.value)||""===e.value||isNaN(Number(e.value))?a[t]=null:a[t]=Number(e.value):a[t]=e.value}));const D={};if(e.eventInfo.canSpanRoutes||d.routeId===d.toRouteId){const t=[],o={attributes:a,geometry:d.selectedPolyline};t.push(o);const n={id:e.serviceId,adds:t,allowMerge:f.mergeCoincident,retireMeasureOverlap:f.retireOverlapping,retireByEventId:!1};i.edits.push(n)}else{const o=u.routeIdFieldSchema.jimuName,n=u.routeNameFieldSchema.jimuName,s=u.lineOrderFieldSchema.jimuName,h=u.fromDateFieldSchema.jimuName,p=yield(0,r.queryAllRoutesByLineId)(d.lineId,u,l);if((0,r.isDefined)(p)&&(yield Promise.all(p.features.map((e=>{const t=e.attributes[o],a={routeId:"",routeName:"",fromMeasure:0,toMeasure:0,fromDate:void 0,toDate:void 0,selectedMeasure:0,selectedFromDate:void 0,selectedToDate:void 0,routeLineOrder:0,selectedPolyline:null};return a.routeId=t,a.routeName=e.attributes[n],a.routeLineOrder=e.attributes[s],a.fromDate=e.attributes[h],a.selectedPolyline=e.geometry,D[t]=a,D})))),Object.keys(D).length){const o=Object.keys(D).sort(((e,t)=>D[e].routeLineOrder-D[t].routeLineOrder)),n=Object.fromEntries(o.map((e=>[e,D[e]]))),s=e.eventInfo.toMeasureFieldName;for(const[o,h]of Object.entries(n)){const n=structuredClone(a),p=h.routeLineOrder;if(p<d.routeLineOrder)continue;let D=!1,b=null,g=!1,R=NaN,I=NaN,y="",S="";if(o===d.routeId)y=o,S=d.routeName,R=d.selectedMeasure,I=d.toMeasure,b=yield(0,r.QueryPolylineOnRoute)(l,u,y,o,d.fromDate,R.toString(),I.toString()),D=!0;else if(p>d.routeLineOrder&&p<d.toRouteLineOrder){b=h.selectedPolyline;const e=(0,r.getRouteFromEndMeasures)(b),t=yield(0,r.QueryRouteMeasures)(l,u,e,h.fromDate,o);R=ta(Math.min(...t),u.measurePrecision),I=ta(Math.max(...t),u.measurePrecision),y=o,D=!0}else o===d.toRouteId&&(y=o,S=d.toRouteName,R=d.toRouteFromMeasure,I=d.selectedToMeasure,b=yield(0,r.QueryPolylineOnRoute)(l,u,o,o,d.fromDate,R.toString(),I.toString()),D=!0,g=!0);if(D){if(n[c]="{"+t.utils.getUUID()+"}",n[m]=y,n[v]=R,n[s]=I,e.eventInfo.routeNameFieldName&&e.eventInfo.routeNameFieldName.length>0){n[e.eventInfo.routeNameFieldName]=S}const o={attributes:n,geometry:b},a={id:e.serviceId,adds:[o],allowMerge:f.mergeCoincident,retireMeasureOverlap:f.retireOverlapping,retireByEventId:!1};if(i.edits.push(a),g)break}}}}}return i}))))),yield(0,r.LrsApplyEdits)(a,i,o).then((t=>ha(this,void 0,void 0,(function*(){t.success?(A("success"),F(n("eventCreated")),T(!0),X(),setTimeout((()=>ha(this,void 0,void 0,(function*(){if(T(!1),b){W(!0),yield(0,r.tryReleaseLockOnDefault)(l,e);const t=Object.assign(Object.assign({},e),{lockAction:r.LockAction.Clear});G(t)}else Y(!0)}))),1e3)):(A("error"),F(`${t.message} \n ${t.details}`),T(!0),setTimeout((()=>{T(!1)}),5e3))}))))})),te=e=>{e.every((e=>e))?V(!0):(e.every((e=>!e)),V(!1))};return(0,t.jsx)("div",{className:"h-100",css:pa()},(0,t.jsx)("div",{className:"add-multiple-line-events-edit-attributes__content"},b&&(0,t.jsx)(r.LockManagerComponent,{intl:i,featureDS:l,lockInfo:_,showAlert:!0,networkName:null==u?void 0:u.datasetName,conflictPreventionEnabled:b,onQueryAndAcquireComplete:(e,t,o)=>{G(e),o&&ee(e)},onMessageClear:()=>{const e=Object.assign(Object.assign({},_),{lockAction:r.LockAction.None});G(e),g(B),W(!1)}}),(0,t.jsx)("div",{className:"attribute-picker d-flex w-100 px-3"},(0,t.jsx)("div",{className:"mr-auto"},(0,t.jsx)(a.Label,{size:"sm",className:"text-truncate w-100 pt-2",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,t.jsx)(a.Checkbox,{checked:U,className:"mr-2",onChange:e=>{const t=e.target.checked,o=j;o.forEach(((e,a)=>{o[a]=t})),M(o),te(o),o.every((e=>!e))?E(!0):E(!1)}}),n("selectAllLabel"))),(0,t.jsx)("div",{className:"ml-auto"},(0,t.jsx)(r.CopyAttributeTool,{disabled:!1,networkDs:l,eventDataSources:R,jimuMapView:p,hoverGraphic:D,onAttributesCopied:e=>{const t=jo(y);e.forEach((e=>{const o=c.findIndex((t=>t.serviceId.toString()===e.layerId));if(o>-1){const a=jo(t[o]);e.fieldValuePair.forEach((e=>{const t=a.findIndex((t=>t.name===e.name));if(t>-1){let o=e.value;(0,r.isDate)(a[t].type)&&(o=(0,r.isDefined)(e.value)?new Date(e.value):null),a[t].value=o}})),t[o]=a}})),S(t)}}))),(0,r.isDefined)(y)&&y.map(((e,o)=>(0,t.jsx)(r.AttributeTable,{key:o,tableIndex:o,eventDS:R[o],eventLayer:(0,t.Immutable)(N[o]),fieldInfos:e,useAlias:!0,collapable:!0,isExpanded:j[o],onItemChecked:K,onUpdateItem:$,onUpdateAll:J}))),w&&(0,t.jsx)("div",{className:"add-multiple-line-event-edit-attributes__toast-container w-100 p-3"},(0,t.jsx)(a.Alert,{className:"add-multiple-line-event-edit-attributes__toast w-100",type:x,text:O,closable:!0,withIcon:!0,open:w,onClose:()=>{T(!1)}}))),(0,t.jsx)("div",{className:"add-multiline-attributes-footer w-100"},(0,t.jsx)("div",{className:"add-multiple-line-events-edit-attributes__action w-100 d-flex"},(0,t.jsx)("div",{className:"mt-auto mr-auto"},(0,t.jsx)(a.Button,{"aria-label":n("backLabel"),size:"sm",type:"secondary",onClick:()=>{Y(!1)}},n("backLabel"))),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{className:"active","aria-label":n("saveLabel"),size:"sm",disabled:P||C,onClick:()=>{b?z(r.LockAction.QueryAndAcquire,d,j):ee()}},n("saveLabel"))))))}function ba(e){const{events:o,dataSourcesReady:a}=e,[n,i]=t.React.useState(null!=o?o:null),[s,l]=t.React.useState([]);t.React.useEffect((()=>{if(o){i(o);const e=Array(o.length).fill(!1);l(e)}}),[o]),t.React.useEffect((()=>{a((e=>e.every(Boolean)))}),[a,s]);const u=t.React.useCallback(((e,t)=>{const o=Object.assign({},s);o[e]=t,l(o)}),[s]),c=t.React.useCallback(((e,t)=>{u(t,!0)}),[u]),d=t.React.useCallback(((e,o)=>{if(e){const{status:a,instanceStatus:n}=e;n===t.DataSourceStatus.NotCreated||n===t.DataSourceStatus.CreateError||a===t.DataSourceStatus.LoadError||a===t.DataSourceStatus.NotReady?u(o,!1):u(o,!0)}}),[u]),f=t.React.useCallback((e=>{u(e,!1)}),[u]);return(0,t.jsx)("div",null,(0,r.isDefined)(n)&&n.map(((e,o)=>(0,t.jsx)(t.DataSourceComponent,{useDataSource:e.useDataSource,onDataSourceInfoChange:e=>{d(e,o)},onCreateDataSourceFailed:e=>{f(o)},onDataSourceCreated:e=>{c(e,o)}}))))}var ga=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};function Ra(e){var n;const i=t.hooks.useTranslation(o),{intl:s,widgetId:l,lrsLayers:u,jimuMapView:d,operationType:f,networkLayers:m,defaultNetwork:v,defaultFromMethod:h,defaultToMethod:p,defaultAttributeSet:D,attributeSets:b,hoverGraphic:g,pickedFromGraphic:R,pickedToGraphic:I,flashGraphic:y,hideMethod:S,hideNetwork:N,hideType:k,hideAttributeSet:j,hideMeasures:M,hideDates:w,hideTitle:T,useRouteStartEndDate:x,conflictPreventionEnabled:A,networkDataSourceFromDataAction:O,routeInfoFromDataAction:F,onResetDataAction:P,onClearGraphics:L,onClearHoverGraphic:C,onOperationTypeChanged:E}=e,[_,G]=t.React.useState(0),[U,V]=t.React.useState(null),[B,W]=t.React.useState(null),[z,Q]=t.React.useState(null),[Z,q]=t.React.useState(!1),[H,$]=t.React.useState(!1),[J,K]=t.React.useState(h),[Y,X]=t.React.useState(p),[ee,te]=t.React.useState(D),[oe,ae]=t.React.useState(null),[ne,ie]=t.React.useState(!1),[se,re]=t.React.useState((0,r.getInitialRouteInfoState)()),[le,ue]=t.React.useState(!1),[ce,de]=t.React.useState((0,r.getIntialLocksInfo)()),[fe,me]=t.React.useState(!1),[ve,he]=t.React.useState(!1),pe=t.React.useRef(null),De=t.React.useCallback((e=>{V(e)}),[V]),be=t.React.useCallback((()=>{q(!0)}),[q]),ge=t.React.useCallback((()=>{$(!0)}),[$]),Re=t.React.useCallback((e=>{const o=u.find((t=>t.name===e));(0,r.isDefined)(o)&&W((0,t.Immutable)(o)),M||(me(!1),he(!1))}),[u]);t.React.useEffect((()=>{var e;null===(e=pe.current)||void 0===e||e.focus()}),[]),t.React.useEffect((()=>{if(!(0,r.isDefined)(B))if((0,r.isDefined)(v)){const e=u.find((e=>e.name===v.name));W((0,t.Immutable)(e))}else{const e=u.find((e=>e.layerType===r.LrsLayerType.network));e&&W((0,t.Immutable)(e))}if(!(0,r.isDefined)(oe)){const e=b.attributeSet.find((e=>e.title===ee));e&&ae(e)}}),[u,v]),t.React.useEffect((()=>{const e=(0,r.isDefined)(O)||(0,r.isDefined)(F);e&&Me(),e&&setTimeout((()=>{if((0,r.isDefined)(O)&&O.id!==(null==B?void 0:B.id)){V(O);const e=O.getLayerDefinition().name;Re(e)}(0,r.isDefined)(F)&&(xe.canSpanRoutes||F.routeId===F.toRouteId||(F.toRouteId=F.routeId,F.toRouteName=F.routeName,F.toRouteFromMeasure=F.fromMeasure,F.toRouteToMeasure=F.toMeasure,F.selectedToPolyline=F.selectedPolyline,F.toRouteFromDate=F.fromDate,F.toRouteToDate=F.toDate),Te(F),ue(!0))}),2e3)}),[O,F]),t.React.useEffect((()=>{A&&Ie()}),[U,oe,B]);const Ie=(e=r.LockAction.None,t)=>{const o=Object.assign({},ce);if((0,r.isDefined)(B)&&(o.networkId=[B.networkInfo.lrsNetworkId]),(0,r.isDefined)(oe)){const e=oe.layers.map((e=>e.layerId));o.eventServiceLayerIds=e}(0,r.isDefined)(t)&&(o.routeInfo=t),o.lockAction=e,de(o)};t.React.useEffect((()=>{if((0,r.isDefined)(oe)&&(0,r.isDefined)(B)){const e=[];oe.layers.forEach((t=>{const o=u.find((e=>e.serviceId===t.layerId));o&&B.serviceId===o.eventInfo.parentNetworkId&&e.push(o)})),Q((0,t.Immutable)(e))}}),[oe,B]),t.React.useEffect((()=>{me(M),he(M)}),[M]),t.React.useEffect((()=>{M&&(me(M),he(M))}),[]);const ye=t.React.useCallback((e=>{const t=b.attributeSet.find((t=>t.title===e));t&&ae(t),te(e)}),[]),Se=t.React.useCallback((e=>{K(e)}),[]),Ne=t.React.useCallback((e=>{X(e)}),[]),ke=t.React.useMemo((()=>!!(Z&&H&&(0,r.isDefined)(d)&&(0,r.isDefined)(null==d?void 0:d.view)&&(null==d?void 0:d.view.ready))),[Z,H,d]),je=t.React.useCallback((e=>{e&&Me(),G(0),pe.current&&pe.current.focus()}),[]),Me=()=>{let e=!1;(0,r.isDefined)(B)&&(0,r.isDefined)(B.networkInfo)&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema)&&(e=!0),L();const t=(0,r.getInitialRouteInfoState)();Te(t,!1,!0);const o=(0,r.getInitialEventInfoState)();o.canSpanRoutes=e,Oe(o);const a=(0,r.getInitialRouteMeasurePickerInfoState)();Le(a),M||(me(!1),he(!1)),C(),ie(!0),setTimeout((()=>{ie(!1)}),800)},we=()=>{ue(!1),P()},Te=(e,t=!1,o=!1)=>{if(re(e),_e(e,t),A){const t=o?r.LockAction.Clear:r.LockAction.Release;Ie(t,e)}},[xe,Ae]=t.React.useState((0,r.getInitialEventInfoState)()),Oe=e=>{Ae(e)},[Fe,Pe]=t.React.useState((0,r.getInitialRouteMeasurePickerInfoState)()),Le=e=>{Pe(e)};t.React.useEffect((()=>{if((0,r.isDefined)(B)){re((0,r.getInitialRouteInfoState)());const e=(0,r.getInitialEventInfoState)();(0,r.isDefined)(B.networkInfo)&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema)&&(e.canSpanRoutes=!0),Oe(e)}}),[B,ne]);const Ce=()=>{(0,r.isDefined)(R)&&R.removeAll()},Ee=()=>{(0,r.isDefined)(I)&&I.removeAll()},_e=(e,t)=>ga(this,void 0,void 0,(function*(){var o;(0,r.isDefined)(e.selectedPolyline)&&t&&(o=yield(0,r.getGeometryGraphic)(yield(0,r.getSimpleLineGraphic)(e.selectedPolyline),la),(0,r.isDefined)(o)&&(y.add(o),setTimeout((()=>{y.removeAll(),setTimeout((()=>{y.add(o),setTimeout((()=>{y.removeAll(),setTimeout((()=>{y.add(o),setTimeout((()=>{y.removeAll()}),800)}),800)}),800)}),800)}),800))),(0,r.isDefined)(e.selectedPoint)?(e=>{(0,r.isDefined)(e)?(R.removeAll(),R.add(e)):Ce()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedPoint),ua)):Ce(),(0,r.isDefined)(e.selectedToPoint)?(e=>{(0,r.isDefined)(e)?(I.removeAll(),I.add(e)):Ee()})(yield(0,r.getGeometryGraphic)(yield(0,r.getSimplePointGraphic)(e.selectedToPoint),ca)):Ee(),(0,r.isDefined)(d)&&d.clearSelectedFeatures()})),Ge=t.React.useCallback((()=>{var e,t;let o=!0;if(o=o&&(null===(e=se.routeId)||void 0===e?void 0:e.length)>0,o=o&&(null===(t=se.toRouteId)||void 0===t?void 0:t.length)>0,!(0,r.isDefined)(B)||!(0,r.isDefined)(B.networkInfo))return!1;const a=ta(se.fromMeasure,B.networkInfo.measurePrecision),n=ta(se.toMeasure,B.networkInfo.measurePrecision),i=ta(se.selectedMeasure,B.networkInfo.measurePrecision),s=ta(se.selectedToMeasure,B.networkInfo.measurePrecision);if(isNaN(a)||isNaN(i))return!1;if(o=o&&i>=a,xe.canSpanRoutes){const e=ta(se.toRouteFromMeasure,B.networkInfo.measurePrecision),t=ta(se.toRouteToMeasure,B.networkInfo.measurePrecision);if(isNaN(e)||isNaN(s))return!1;if(o=o&&s>=e,isNaN(t)||isNaN(s))return!1;o=o&&s<=t}else{if(isNaN(n)||isNaN(s))return!1;o=o&&s<=n}return(0,r.isDefined)(se.selectedFromDate)&&!(0,r.isDefined)(se.selectedToDate)&&((0,r.isDefined)(se.fromDate)&&(o=o&&se.selectedFromDate>=se.fromDate),(0,r.isDefined)(se.toDate)&&(o=o&&se.selectedFromDate<se.toDate)),!(0,r.isDefined)(se.selectedFromDate)&&(0,r.isDefined)(se.selectedToDate)&&((0,r.isDefined)(se.fromDate)&&(o=o&&se.selectedToDate>=se.fromDate),(0,r.isDefined)(se.toDate)&&(o=o&&se.selectedToDate<se.toDate)),(0,r.isDefined)(se.selectedFromDate)&&(0,r.isDefined)(se.selectedToDate)&&(o=o&&se.selectedFromDate<se.selectedToDate,(0,r.isDefined)(se.fromDate)&&(o=o&&se.selectedFromDate>=se.fromDate),(0,r.isDefined)(se.toDate)&&(o=o&&se.selectedToDate<=se.toDate)),!(!(0,r.isDefined)(se.selectedFromDate)&&!(0,r.isDefined)(se.selectedToDate))&&o}),[se]),Ue=t.React.useCallback(((e,t)=>{de(e)}),[]);return(0,t.jsx)("div",{className:"add-multiple-line-event h-100 d-flex",ref:pe,tabIndex:-1,css:t.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    &.wrapped .add-multiple-line-event-form {
      height: 100%;
    }
    .add-multiple-line-event__content {
      display: flex;
      flex-direction: column;
      width: 100%;
      height: 100%;
      flex: 1 1 auto;
      overflow: auto;
    }
    .add-line-footer {
      display: flex;
      height: auto;
      padding: 12px;
    }
  `},(0,t.jsx)(xo,{network:B,dataSourcesReady:be,onCreateNetworkDs:De}),(0,t.jsx)(ba,{events:z,dataSourcesReady:ge}),!T&&(0,t.jsx)(c,null),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-line-event__content",{"d-none":1===_,[a.FOCUSABLE_CONTAINER_CLASS]:1!==_})},A&&(0,t.jsx)(r.LockManagerComponent,{intl:s,showAlert:!1,featureDS:U,lockInfo:ce,networkName:null===(n=null==B?void 0:B.networkInfo)||void 0===n?void 0:n.datasetName,conflictPreventionEnabled:A,onQueryAndReleaseComplete:Ue,onMessageClear:()=>{Ie(r.LockAction.None)}}),!k&&(0,t.jsx)(fa,{operationType:f,onOperationTypeChanged:E}),!N&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("networkLabel"),isDisabled:1===m.length,defaultItem:(0,r.isDefined)(B)?B.name:"",listItems:m,onSelectionChanged:Re}),!j&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("attributeSetLabel"),isDisabled:1===b.attributeSet.length,defaultItem:ee,listItems:(()=>{const e=[];return b.attributeSet.forEach((t=>{e.push(t.title)})),e})(),onSelectionChanged:ye}),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("fromMethodLabel"),defaultItem:J,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Se}),(0,t.jsx)(ia,{intl:s,widgetId:l,network:B?B.networkInfo:null,dsReady:ke,networkDS:U,method:J,jimuMapView:d,hoverGraphic:g,pickedGraphic:R,isFrom:!0,routeInfo:se,routeMeasurePickerInfo:Fe,reset:ne,hideMeasures:M,revalidateRouteFromDataAction:le,onResetDataAction:we,canSpanRoutes:!!B&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:Te,onUpdateRouteMeasurePickerInfo:Le,useStartMeasure:fe,useEndMeasure:ve}),!M&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:fe,className:"mr-2",disabled:!(0,r.isDefined)(se)||isNaN(se.fromMeasure),onChange:(e,t)=>{if(t){const e=se;e.selectedMeasure=e.fromMeasure,e.selectedPoint=null,Te(e)}me(t)}}),i("useStartMeasureLabel")),!S&&(0,t.jsx)(r.InlineEditableDropdown,{label:i("toMethodLabel"),defaultItem:Y,isDisabled:!0,listItems:[r.SearchMethod.Measure],altItemDescriptions:[i("routeAndMeasure")],onSelectionChanged:Ne}),(0,t.jsx)(ia,{intl:s,widgetId:l,network:B?B.networkInfo:null,dsReady:ke,networkDS:U,method:Y,jimuMapView:d,hoverGraphic:g,pickedGraphic:I,isFrom:!1,routeInfo:se,routeMeasurePickerInfo:Fe,reset:ne,hideMeasures:M,revalidateRouteFromDataAction:le,onResetDataAction:we,canSpanRoutes:!!B&&(0,r.isDefined)(B.networkInfo.lineIdFieldSchema),onUpdateRouteInfo:Te,onUpdateRouteMeasurePickerInfo:Le,useStartMeasure:fe,useEndMeasure:ve}),!M&&(0,t.jsx)(a.Label,{size:"sm",className:"pt-2 mb-0 px-3 w-100",centric:!0,check:!0},(0,t.jsx)(a.Checkbox,{checked:ve,className:"mr-2",disabled:!(0,r.isDefined)(null==se?void 0:se.toRouteToMeasure)||isNaN(se.toRouteToMeasure),onChange:(e,t)=>{if(t){const e=se;e.selectedToMeasure=e.toRouteToMeasure,e.selectedToPoint=null,Te(e)}he(t)}}),i("useEndMeasureLabel")),(0,t.jsx)(ra,{hideDates:w,useRouteStartEndDate:x,routeInfo:se,network:B?B.networkInfo:null,revalidateRouteFromDataAction:le,onUpdateRouteInfo:Te}),(0,t.jsx)(da,{eventInfo:xe,onUpdateEventInfo:Oe})),(0,t.jsx)("div",{className:(0,t.classNames)("add-line-footer w-100",{"d-none":1===_,[a.FOCUSABLE_CONTAINER_CLASS]:1!==_})},(0,t.jsx)(a.Label,{size:"sm",className:"mt-auto mr-auto",style:{fontWeight:500,width:100,marginBottom:0,alignItems:"center",textAlign:"left",color:"var(--primary-500"},onClick:Me},i("resetForm")),(0,t.jsx)("div",{className:"mt-auto ml-auto"},(0,t.jsx)(a.Button,{className:"active","aria-label":i("nextLabel"),size:"sm",disabled:!Ge()&&ke,onClick:()=>{G(1)}},i("nextLabel")))),(0,t.jsx)("div",{className:(0,t.classNames)("add-multiple-line-event__content",{"d-none":1!==_,[a.FOCUSABLE_CONTAINER_CLASS]:1===_})},(0,t.jsx)(Da,{intl:s,widgetId:l,networkDS:U,network:B?B.networkInfo:null,eventLayers:z,attributeSet:oe,routeInfo:se,eventInfo:xe,reset:ne,isReady:ke,jimuMapView:d,hoverGraphic:g,conflictPreventionEnabled:A,onNavBack:je})))}var Ia=l(59620),ya=function(e,t,o,a){return new(o||(o=Promise))((function(n,i){function s(e){try{l(a.next(e))}catch(e){i(e)}}function r(e){try{l(a.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof o?t:new o((function(e){e(t)}))).then(s,r)}l((a=a.apply(e,t||[])).next())}))};const Sa=t.css`
  background-color: var(--ref-palette-white);
`;class Na extends t.React.PureComponent{constructor(n){super(n),this.componentDidMount=()=>{var e,t;(null===(e=this.props.mutableStatePropsVersion)||void 0===e?void 0:e.selectedDataSource)?this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource}):(null===(t=this.props.mutableStatePropsVersion)||void 0===t?void 0:t.selectedRouteInfo)&&this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo});const o=(0,r.isInWidgetController)(this.widgetOuterDivId);this.setState({hideTitle:o}),this.setState({operationType:this.props.config.defaultType})},this.onActiveViewChange=e=>ya(this,void 0,void 0,(function*(){e&&e.view&&this.waitForChildDataSourcesReady(e).finally((()=>{this.setState({jimuMapView:e})}))})),this.waitForChildDataSourcesReady=e=>ya(this,void 0,void 0,(function*(){yield null==e?void 0:e.whenAllJimuLayerViewLoaded();const o=t.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId);return(null==o?void 0:o.isDataSourceSet)&&!o.areChildDataSourcesCreated()?o.childDataSourcesReady().then((()=>o)).catch((e=>o)):Promise.resolve(o)})),this.handleOperationTypeChange=e=>{this.setState({operationType:e}),this.clearGraphics()},this.getI18nMessage=(e,t)=>{const n=Object.assign({},o,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:n[e]},t)},this.state={hideTitle:!1,jimuMapView:void 0,operationType:e.single,hoverGraphic:null,pickedFromGraphic:null,pickedToGraphic:null,flashGraphic:null,routeInfoFromDataAction:null,networkDataSourceFromDataAction:null},this.widgetOuterDivId="widget-outer-div-"+this.props.id}componentWillUnmount(){this.removeGraphicLayers()}componentDidUpdate(e,o){var a,n,i,s,l,u,c,d,f,m;o.jimuMapView!==this.state.jimuMapView&&(0,r.isDefined)(this.state.jimuMapView)&&(this.removeGraphicLayers(),this.createGraphicLayers());const v=null===(i=null===(n=null===(a=(0,t.getAppStore)())||void 0===a?void 0:a.getState())||void 0===n?void 0:n.widgetsRuntimeInfo[this.props.id])||void 0===i?void 0:i.state;if((v===t.WidgetState.Opened||!v)&&((null===(s=this.props)||void 0===s?void 0:s.selectedNetworkDataSource)&&(e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedNetworkDataSource&&(null===(l=null==e?void 0:e.mutableStatePropsVersion)||void 0===l?void 0:l.selectedNetworkDataSource)===(null===(u=this.props.mutableStatePropsVersion)||void 0===u?void 0:u.selectedNetworkDataSource)||this.setState({networkDataSourceFromDataAction:this.props.selectedNetworkDataSource})),null===(c=this.props)||void 0===c?void 0:c.selectedRouteInfo)){!(null===(d=this.props)||void 0===d?void 0:d.selectedRouteInfo)||e&&e.mutableStatePropsVersion&&e.mutableStatePropsVersion.selectedRouteInfo&&(null===(f=null==e?void 0:e.mutableStatePropsVersion)||void 0===f?void 0:f.selectedRouteInfo)===(null===(m=this.props.mutableStatePropsVersion)||void 0===m?void 0:m.selectedRouteInfo)||this.setState({routeInfoFromDataAction:this.props.selectedRouteInfo})}}removeGraphicLayers(){(0,r.isDefined)(this.state.hoverGraphic)&&(this.state.hoverGraphic.removeAll(),this.state.hoverGraphic.destroy(),this.setState({hoverGraphic:null})),(0,r.isDefined)(this.state.pickedFromGraphic)&&(this.state.pickedFromGraphic.removeAll(),this.state.pickedFromGraphic.destroy(),this.setState({pickedFromGraphic:null})),(0,r.isDefined)(this.state.pickedToGraphic)&&(this.state.pickedToGraphic.removeAll(),this.state.pickedToGraphic.destroy(),this.setState({pickedToGraphic:null})),(0,r.isDefined)(this.state.flashGraphic)&&(this.state.flashGraphic.removeAll(),this.state.flashGraphic.destroy(),this.setState({flashGraphic:null}))}createGraphicLayers(){var e,t;if((0,r.isDefined)(this.state.jimuMapView)){this.removeGraphicLayers();const o=new Ia.default({listMode:"hide"}),a=new Ia.default({listMode:"hide"}),n=new Ia.default({listMode:"hide"}),i=new Ia.default({listMode:"hide"});null===(t=null===(e=this.state.jimuMapView)||void 0===e?void 0:e.view)||void 0===t||t.map.addMany([a,n,i,o]),this.setState({hoverGraphic:o}),this.setState({pickedFromGraphic:a}),this.setState({pickedToGraphic:n}),this.setState({flashGraphic:i})}}resetDataAction(){this.setState({routeInfoFromDataAction:null}),this.setState({networkDataSourceFromDataAction:null})}clearGraphics(){this&&this.state&&((0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll(),(0,r.isDefined)(this.state.pickedFromGraphic)&&this.state.pickedFromGraphic.removeAll(),(0,r.isDefined)(this.state.pickedToGraphic)&&this.state.pickedToGraphic.removeAll(),(0,r.isDefined)(this.state.flashGraphic)&&this.state.flashGraphic.removeAll())}clearHoverGraphic(){this&&this.state&&(0,r.isDefined)(this.state.hoverGraphic)&&this.state.hoverGraphic.removeAll()}render(){var o;const{config:n,id:r,intl:l}=this.props,{lrsLayers:u,networkLayers:c,lineEventLayers:d,intersectionLayers:f,defaultEvent:m,defaultNetwork:v,defaultFromMethod:h,defaultToMethod:p,attributeSets:D,defaultAttributeSet:b,hideType:g,hideMethod:R,hideEvent:I,hideNetwork:y,hideAttributeSet:S,hideMeasures:N,hideDates:k,useRouteStartEndDate:j,conflictPreventionEnabled:M}=n,{jimuMapView:w,operationType:T}=this.state;return(null==c?void 0:c.length)&&(null==d?void 0:d.length)?(0,t.jsx)("div",{id:this.widgetOuterDivId,className:"jimu-widget runtime-add-line-event surface-1 border-0",css:Sa},(0,t.jsx)(s.JimuMapViewComponent,{useMapWidgetId:null===(o=this.props.useMapWidgetIds)||void 0===o?void 0:o[0],onActiveViewChange:this.onActiveViewChange}),T===e.single&&(0,t.jsx)(va,{intl:l,widgetId:r,lrsLayers:u,JimuMapView:w,operationType:T,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:d,networkLayers:c,instersectionLayers:f,defaultEvent:m,defaultFromMethod:h,defaultToMethod:p,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,flashGraphic:this.state.flashGraphic,hideEvent:I,hideNetwork:y,hideType:g,hideMethod:R,hideMeasures:N,hideDates:k,hideTitle:this.state.hideTitle,useRouteStartEndDate:j,conflictPreventionEnabled:M,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this)}),T===e.multiple&&(0,t.jsx)(Ra,{intl:l,widgetId:r,lrsLayers:u,jimuMapView:w,operationType:T,onOperationTypeChanged:this.handleOperationTypeChange,lineEventLayers:d,networkLayers:c,instersectionLayers:f,defaultEvent:m,defaultNetwork:v,defaultFromMethod:h,defaultToMethod:p,defaultAttributeSet:b,attributeSets:D,hoverGraphic:this.state.hoverGraphic,pickedFromGraphic:this.state.pickedFromGraphic,pickedToGraphic:this.state.pickedToGraphic,flashGraphic:this.state.flashGraphic,hideNetwork:y,hideMethod:R,hideType:g,hideAttributeSet:S,hideMeasures:N,hideDates:k,hideTitle:this.state.hideTitle,useRouteStartEndDate:j,conflictPreventionEnabled:M,networkDataSourceFromDataAction:this.state.networkDataSourceFromDataAction,routeInfoFromDataAction:this.state.routeInfoFromDataAction,onResetDataAction:this.resetDataAction.bind(this),onClearGraphics:this.clearGraphics.bind(this),onClearHoverGraphic:this.clearHoverGraphic.bind(this)})):(0,t.jsx)(a.WidgetPlaceholder,{icon:i(),widgetId:r,message:this.getI18nMessage("_widgetLabel")})}}Na.mapExtraStateProps=(e,t)=>{var o,a;return{selectedRouteInfo:null===(o=null==t?void 0:t.mutableStateProps)||void 0===o?void 0:o.selectedRouteInfo,selectedNetworkDataSource:null===(a=null==t?void 0:t.mutableStateProps)||void 0===a?void 0:a.selectedNetworkDataSource}};const ka=Na;function ja(e){l.p=e}})(),u})())}}}));