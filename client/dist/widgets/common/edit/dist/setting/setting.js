System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/basic/list-tree","jimu-core/react","jimu-for-builder","jimu-arcgis"],(function(e,t){var i={},a={},s={},o={},n={},r={},l={},d={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.Immutable=e.Immutable,i.React=e.React,i.SupportedJSAPILayerTypes=e.SupportedJSAPILayerTypes,i.SupportedLayerServiceTypes=e.SupportedLayerServiceTypes,i.classNames=e.classNames,i.css=e.css,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){a.AdvancedSelect=e.AdvancedSelect,a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.ConfirmDialog=e.ConfirmDialog,a.Label=e.Label,a.PanelHeader=e.PanelHeader,a.Popper=e.Popper,a.Radio=e.Radio,a.Select=e.Select,a.Switch=e.Switch,a.TextArea=e.TextArea,a.TextInput=e.TextInput,a.defaultMessages=e.defaultMessages},function(e){s.MapWidgetSelector=e.MapWidgetSelector,s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){o.DataSourceSelector=e.DataSourceSelector,o.FieldSelector=e.FieldSelector,o.dataComponentsUtils=e.dataComponentsUtils},function(e){n.List=e.List,n.Tree=e.Tree,n.TreeAlignmentType=e.TreeAlignmentType,n.TreeCollapseStyle=e.TreeCollapseStyle,n.TreeItemActionType=e.TreeItemActionType},function(e){r.Fragment=e.Fragment},function(e){l.builderAppSync=e.builderAppSync},function(e){d.JimuMapViewComponent=e.JimuMapViewComponent}],execute:function(){e((()=>{var e={31027:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 1 0-6.586 4.533l-.077-1.008A5.5 5.5 0 1 1 12 6.5m-9 0a3.5 3.5 0 0 0 2.88 3.445L5.8 8.901a2.501 2.501 0 1 1 3.194-2.224l.949.456A3.5 3.5 0 1 0 3 6.5M15.5 11l-5 1-3 4-1-9.5zm-5.57.094-1.702 2.269-.542-5.152 4.76 2.38z" clip-rule="evenodd"></path></svg>'},19556:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1 2h4a1 1 0 0 1 1 1v1h8a1 1 0 0 1 1 1v9a1 1 0 0 1-1 1H1a1 1 0 0 1-1-1V3a1 1 0 0 1 1-1m0 1v11h13V4.913H5V3zm6 3h1v3h3v1H8v3H7v-3H4V9h3z" clip-rule="evenodd"></path></svg>'},62838:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m8.745 8 6.1 6.1a.527.527 0 1 1-.745.746L8 8.746l-6.1 6.1a.527.527 0 1 1-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 0 1 .746-.746l6.1 6.1 6.1-6.1a.527.527 0 0 1 .746.746z"></path></svg>'},53921:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8.027.516A.52.52 0 0 0 7.5 0a.52.52 0 0 0-.527.516v9.508L4.4 7.527a.535.535 0 0 0-.746 0 .51.51 0 0 0 0 .73L7.5 12l3.846-3.743a.51.51 0 0 0 0-.73.535.535 0 0 0-.746 0l-2.573 2.497zM1 8v7h13V8h1v8H0V8z" clip-rule="evenodd"></path></svg>'},23662:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},45508:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M8 5.5a1 1 0 1 0 0-2 1 1 0 0 0 0 2M6.5 7.5A.5.5 0 0 1 7 7h1.5v4.5h1a.5.5 0 0 1 0 1h-3a.5.5 0 0 1 0-1h1V8H7a.5.5 0 0 1-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M8 16A8 8 0 1 1 8 0a8 8 0 0 1 0 16m0-1A7 7 0 1 0 8 1a7 7 0 0 0 0 14" clip-rule="evenodd"></path></svg>'},62686:e=>{"use strict";e.exports=d},79244:e=>{"use strict";e.exports=i},68972:e=>{"use strict";e.exports=r},4108:e=>{"use strict";e.exports=l},14321:e=>{"use strict";e.exports=a},13089:e=>{"use strict";e.exports=o},79298:e=>{"use strict";e.exports=s},98640:e=>{"use strict";e.exports=n}},t={};function c(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,c),s.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var p={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(p),c.d(p,{__set_webpack_public_path__:()=>Y,default:()=>q});var e,t,i,a,s,o=c(79244),n=c(14321),r=c(79298),l=c(13089);!function(e){e.Attribute="ATTRIBUTE",e.Geometry="GEOMETRY"}(e||(e={})),function(e){e.Webmap="WEBMAP",e.Custom="CUSTOM"}(t||(t={})),function(e){e.Added="Added",e.Updated="Updated",e.Deleted="Deleted"}(i||(i={})),function(e){e.NoMap="NOMAP",e.NoLayer="NOEDITABLE"}(a||(a={})),function(e){e.Prescriptive="PRESCRIPTIVE",e.Flexible="FLEXIBLE"}(s||(s={}));const d={newEdit:"New editable source",newEditGeo:"New editable layer",newEditTips:"Support selected features view only",newMapEditTips:"Add layers from the map",attrMode:"Attribute only",geoMode:"Geometry and attribute",layerConfig:"Layer configuration",capability:"Capability",addRecords:"Add records",deleteRecords:"Delete records",updateRecords:"Update records",snappingSettings:"Snapping settings",selfSnapping:"Geometry guides",featureSnapping:"Feature to feature",configFields:"Configure fields",configFieldsTip:"Select fields to show",importAll:"Import all",addGroup:"Add a group",group:"Group",checkAll:"Check all",uncheckAll:"Uncheck all",removeGroupConfirmTitle:"Are you sure you want to remove the group?",removeGroupConfirmTips:"The fields included in the group will also be removed.",noDataMessage:"No data message",noDeataMessageDefaultText:"No valid record is selected, select one or add one.",editBlankStatus:'Click the "{EditString}" button to add and configure {ModeString}',editableSource:"editable data sources",editableLayer:"editable layers",changeModeConfirmTitle:"Are you sure you want to switch the mode?",changeModeConfirmTips:"You will lose the settings configured.",editable:"Editable",editFieldDescription:"Please input the description.",editableCount:"{count} Editable",layerHonorSetting:"Use webmap settings",layerCustomize:"Customize",noLayerTips:"The Map does not contain any editable data.",noMapTips:"Please establish a connection with a Map widget.",defaultEnabled:"Enable by default",chooseDefault:"Choose default snapping layers",uneditableTips:"The layer is in a read-only state.",prescriptiveMode:"Prescriptive mode",flexibleMode:"Flexible mode",templateFilter:"Template filter",relatedRecords:"Related records",runtimeDataEditing:"Runtime data editing"};var u=c(98640),h=c(19556),m=c.n(h),g=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const f=e=>{const t=window.SVG,{className:i}=e,a=g(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:m()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var y=c(9044),v=c.n(y),S=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const b=e=>{const t=window.SVG,{className:i}=e,a=S(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:v()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var x=c(45508),C=c.n(x),j=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const w=e=>{const t=window.SVG,{className:i}=e,a=j(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:C()},a)):o.React.createElement("svg",Object.assign({className:s},a))},M=["CreationDate","Creator","EditDate","Editor","GlobalID"];var D=c(68972);const T="root item for tree data entry";class I extends o.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.OrientedImageryLayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[])=>e.some((e=>!e.editAuthority&&e.editable)),this.getIndeterminate=(e=[])=>{const t=e.some((e=>e.editAuthority&&e.editable)),i=e.some((e=>!e.editAuthority&&e.editable));return t&&i},this.onLayerModeChange=e=>{this.props.optionChange("layerHonorMode",e)},this.handleSwitchChange=(e,t)=>{const i=e.currentTarget;i&&this.props.optionChange(t,i.checked)},this.handleUpdateRecordsChange=(e,t)=>{const i=e.currentTarget;if(!i)return;const a=i.checked;this.props.multiOptionsChange({updateRecords:a,updateAttributes:a,updateGeometries:t&&a})},this.handleUpdateAttrOrGeoChange=(e,t)=>{const i=e.currentTarget;if(!i)return;const a=i.checked,{updateAttributes:s,updateGeometries:o}=this.props;"updateAttributes"===t&&!a&&!o||"updateGeometries"===t&&!a&&!s?this.props.multiOptionsChange({updateRecords:!1,updateAttributes:!1,updateGeometries:!1}):this.props.optionChange(t,a)},this.findEditingIndex=e=>{const{groupedFields:t}=this.props;let i;return t.forEach(((t,a)=>{if(t.jimuName===e)i=[a];else if(null==t?void 0:t.children){const s=t.children.findIndex((t=>t.jimuName===e));s>-1&&(i=[a,s])}})),i},this.handleTreeBoxChange=e=>{const t=e.currentTarget;if(!t)return;const{groupedFields:i}=this.props,a=this.findEditingIndex(t.id);if(2===a.length){const[e,s]=a;i[e][s].editAuthority=t.checked}else if(1===a.length){const[e]=a;i[e].editAuthority=t.checked}this.props.optionChange("groupedFields",i);const s=this.constructTreeItem(i);this.setState({rootItemJson:s})},this.handleTreeDescChange=(e,t)=>{const{groupedFields:i}=this.props,a=this.findEditingIndex(e);if(2===a.length){const[e,s]=a;i[e].children[s].subDescription=t}else if(1===a.length){const[e]=a;i[e].subDescription=t}this.props.optionChange("groupedFields",i);const s=this.constructTreeItem(i);this.setState({rootItemJson:s,isOpenDetailPopper:!1})},this.formatMessage=(e,t)=>{const i=Object.assign({},d,n.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.minusArray=(e,t,i)=>{const a=i||"jimuName",s=e.length>t.length,o=s?t:e;return(s?e:t).filter((e=>!o.some((t=>(null==t?void 0:t[a])===(null==e?void 0:e[a])))))},this.onFieldChange=e=>{if(!e)return;const{dataSource:t}=this.state,{showFields:i,groupedFields:a}=this.props,s=e.filter((e=>e));if(0===e.length)a.length=0;else{const s=this.minusArray(e,i),o=null==s?void 0:s[0];let n;if(a.forEach(((e,t)=>{if(null==e?void 0:e.children){const i=e.children.findIndex((e=>e.jimuName===(null==o?void 0:o.jimuName)));i>-1&&(n=[t,i])}else e.jimuName===(null==o?void 0:o.jimuName)&&(n=[t])})),n){if(2===n.length){const[e,t]=n;a[e].children.splice(t,1)}else if(1===n.length){const[e]=n;a.splice(e,1)}}else{const e=null==t?void 0:t.getLayerDefinition(),i=((null==e?void 0:e.fields)||[]).find((e=>e.name===o.jimuName)),s=null==i?void 0:i.editable;a.push(Object.assign(Object.assign({},o),{editAuthority:s,subDescription:(null==o?void 0:o.description)||"",editable:s}))}}this.props.multiOptionsChange({showFields:s,groupedFields:a});const o=this.constructTreeItem(a),n=this.getUncheckState(a),r=this.getIndeterminate(a);this.setState({rootItemJson:o,hasUncheck:n,indeterminate:r})},this.onDataSourceCreated=e=>{this.setState({dataSource:e},(()=>{const{groupedFields:e}=this.props,t=this.constructTreeItem(e);this.setState({rootItemJson:t})}))},this.getFieldsFromDatasource=()=>{const{useDataSource:e}=this.props,t=o.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),i=null==t?void 0:t.getSchema();return(null==i?void 0:i.fields)?Object.values(null==i?void 0:i.fields):[]},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.getSelectorFields=e=>{const t=[];return e&&e.length>0&&e.forEach((e=>{t.push(e.jimuName)})),t},this.handleTreeBoxAll=e=>{const{groupedFields:t}=this.props,i=t.map((t=>(null==t?void 0:t.children)?Object.assign(Object.assign({},t),{editAuthority:e,children:t.children.map((t=>Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})))}):Object.assign(Object.assign({},t),t.editable?{editAuthority:e}:{})));this.props.optionChange("groupedFields",i);const a=this.constructTreeItem(i);this.setState({rootItemJson:a,hasUncheck:!e,indeterminate:!1})},this.addGroupForFields=()=>{this.setState({groupUpdating:!0},(()=>{setTimeout((()=>{this.setState({groupUpdating:!1})}),1e3)}));const{groupedFields:e}=this.props,t=this.getGroupMaxId(e)+1,i={jimuName:`${this.formatMessage("group")}-${t}`,name:`${this.formatMessage("group")}-${t}`,alias:`${this.formatMessage("group")}-${t}`,subDescription:"",editAuthority:!1,editable:!0,children:[],groupKey:t};e.unshift(i),this.props.optionChange("groupedFields",e);const a=this.constructTreeItem(e);this.setState({rootItemJson:a})},this.removeGroup=e=>{var t;const{curEditField:i}=this.state,{groupedFields:a}=this.props,s=a.findIndex((t=>t.jimuName===e));a.splice(s,1,...null===(t=a[s])||void 0===t?void 0:t.children),this.props.optionChange("groupedFields",a);const o=this.constructTreeItem(a);this.setState({rootItemJson:o}),(null==i?void 0:i.jimuName)===e&&this.setState({isOpenDetailPopper:!1})},this.constructTreeItem=(e=[])=>{const{theme:t,layerEditingEnabled:i}=this.props,a=this.getFieldsFromDatasource(),s=e=>Array.from(e).map(((e,n)=>Object.assign({itemKey:`${o.utils.getUUID()}_${n}`,itemStateChecked:!!i&&(null==e?void 0:e.editAuthority),itemStateTitle:e.alias||e.jimuName||e.name,itemStateIcon:l.dataComponentsUtils.getIconFromFieldType(e.type,t),itemStateDetailContent:e,itemStateDisabled:!(null==e?void 0:e.groupKey)&&!this.checkFieldsExist(a,e),itemStateCommands:[],isCheckboxDisabled:!i||!e.editable},e.children?{itemChildren:s(e.children)}:{}))),n=s(e);return{itemKey:T,itemStateTitle:T,itemChildren:n}},this.setRootItemJson=e=>{this.setState({rootItemJson:e})},this.showDetailPopper=(e,t)=>{const{isOpenDetailPopper:i}=this.state;this.setState({isOpenDetailPopper:!i,popperRef:e,curEditField:t})},this.getCurrentEditField=e=>{const{groupedFields:t}=this.props,i=this.findEditingIndex(e);let a={jimuName:"",groupKey:"",editAuthority:!1,children:[],subDescription:"",description:"",name:""};if(2===(null==i?void 0:i.length)){const[e,s]=i;a=t[e].children[s]}else if(1===(null==i?void 0:i.length)){const[e]=i;a=t[e]}return a},this.state={dataSource:void 0,rootItemJson:this.constructTreeItem(e.groupedFields),itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.groupedFields),indeterminate:this.getIndeterminate(e.groupedFields),isOpenDetailPopper:!1,popperRef:void 0,curEditField:void 0,groupUpdating:!1},this.colRef=o.React.createRef()}componentDidUpdate(e,t){this.props.name!==e.name&&this.setState({itemLabel:this.props.name||""}),this.props.id!==e.id&&this.setState({rootItemJson:this.constructTreeItem(this.props.groupedFields)})}getGroupMaxId(e=[]){const t=[];return e.forEach((e=>{(null==e?void 0:e.groupKey)&&t.push(null==e?void 0:e.groupKey)})),t.length>0?Math.max.apply(null,t):0}getStyle(e){return o.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: calc(100% - ${o.polished.rem(58)});
          overflow: auto;
          .layer-mode {
            .layer-mode-item {
              display: flex;
              margin-bottom: 8px;
            }
          }
          .fields-list-header {
            background: ${e.ref.palette.neutral[300]};
            border-bottom: 1px solid ${e.ref.palette.neutral[600]};
            height: 34px;
            width: 100%;
            flex-wrap: nowrap;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 300px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.ref.palette.neutral[300]};
              border-bottom: 1px solid ${e.ref.palette.neutral[400]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.ref.palette.neutral[300]};
                  .jimu-tree-item__title{
                    .jimu-input{
                      width: 125px;
                    }
                  }
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
          .capability-item{
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
          }
          .disabled-label{
            color: ${e.ref.palette.neutral[700]};
          }
        }
      }
    `}render(){var i;const{onClose:a,optionChange:s,dataSourceChange:d,filterDs:c,id:p,useDataSource:h,theme:m,showFields:g,editorConfig:y,addRecords:v,deleteRecords:S,updateRecords:x,updateAttributes:C,updateGeometries:j,groupedFields:I,layerHonorMode:O,layerEditingEnabled:N}=this.props,{rootItemJson:A,itemLabel:R,dataSource:k,hasUncheck:L,indeterminate:E,isOpenDetailPopper:P,popperRef:F,curEditField:H,groupUpdating:U}=this.state,B=y.editMode===e.Geometry,V=this.getSelectorFields(g),G=k||o.DataSourceManager.getInstance().getDataSource(p),J=null==G?void 0:G.getLayerDefinition(),$=null==J?void 0:J.allowGeometryUpdates,z=(null==J?void 0:J.type)===o.SupportedLayerServiceTypes.Table,_=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),W=null==J?void 0:J.capabilities,K=_(W,"create"),q=_(W,"update"),Y=_(W,"delete"),X={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:u.TreeItemActionType.RenderOverrideItem,children:[{name:u.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemContent,children:[{name:u.TreeItemActionType.RenderOverrideItemBody,children:[{name:u.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:u.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemDragHandle},{name:u.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:u.TreeItemActionType.RenderOverrideItemIcon},{name:u.TreeItemActionType.RenderOverrideItemTitle},{name:u.TreeItemActionType.RenderOverrideItemCommands},{name:u.TreeItemActionType.RenderOverrideItemDetailToggle}]}]},{name:u.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]},{name:u.TreeItemActionType.RenderOverrideItemSubitems}]})};let Q=0;null==I||I.forEach((e=>{(null==e?void 0:e.children)?null==e||e.children.forEach((e=>{(null==e?void 0:e.editAuthority)&&Q++})):(null==e?void 0:e.editAuthority)&&Q++}));const Z=!!(null===(i=null==G?void 0:G.getRootDataSource())||void 0===i?void 0:i.map);return(0,o.jsx)("div",{className:"w-100 h-100",css:this.getStyle(m)},(0,o.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,o.jsx)("div",{className:"w-100 d-flex px-4 py-0"},(0,o.jsx)(n.PanelHeader,{level:1,className:"py-4 panel-inner",showClose:!!a,onClose:a,title:this.formatMessage("layerConfig")})),(0,o.jsx)("div",{className:"setting-container"},(0,o.jsx)(r.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(l.DataSourceSelector,{types:this.supportedDsTypes,hideDataView:!0,disableRemove:()=>!0,useDataSources:h?(0,o.Immutable)([h]):(0,o.Immutable)([]),mustUseDataSource:!0,onChange:d,closeDataSourceListOnChange:!0,hideDs:c,hideTabs:(0,o.Immutable)(["OUTPUT"])}))),h&&(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingSection,{title:this.formatMessage("label")},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.TextInput,{size:"sm",type:"text",className:"w-100",value:R,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,o.jsx)(r.SettingSection,{title:this.formatMessage("capability")},N?(0,o.jsx)(D.Fragment,null,(!B&&z||B)&&(0,o.jsx)("div",{className:"capability-item",key:"addRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("addRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("addRecords"),className:"can-x-switch",checked:v,onChange:e=>{this.handleSwitchChange(e,"addRecords")},disabled:!K})),(0,o.jsx)("div",{className:"capability-item",key:"deleteRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("deleteRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("deleteRecords"),className:"can-x-switch",checked:S,onChange:e=>{this.handleSwitchChange(e,"deleteRecords")},disabled:!Y})),(0,o.jsx)("div",{className:"capability-item",key:"updateRecords"},(0,o.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("updateRecords")),(0,o.jsx)(n.Switch,{"aria-label":this.formatMessage("updateRecords"),className:"can-x-switch",checked:x,onChange:e=>{this.handleUpdateRecordsChange(e,$)},disabled:!q})),B&&x&&(0,o.jsx)("div",{className:"ml-4"},(0,o.jsx)(n.Label,{className:"w-100 d-flex"},(0,o.jsx)(n.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:C,"aria-label":this.formatMessage("attribute"),onChange:e=>{this.handleUpdateAttrOrGeoChange(e,"updateAttributes")}}),(0,o.jsx)("div",{className:"m-0 ml-2 flex-grow-1 omit-label"},this.formatMessage("attribute"))),(0,o.jsx)(n.Label,{className:"w-100 d-flex"},(0,o.jsx)(n.Checkbox,{style:{cursor:"pointer",marginTop:"2px"},checked:j,"aria-label":this.formatMessage("geometry"),onChange:e=>{this.handleUpdateAttrOrGeoChange(e,"updateGeometries")},disabled:!$}),(0,o.jsx)("div",{className:`m-0 ml-2 flex-grow-1 omit-label ${!$&&"disabled-label"}`},this.formatMessage("geometry"))))):this.formatMessage("uneditableTips")),(0,o.jsx)(r.SettingSection,{title:this.formatMessage("configFields")},Z&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Select,{size:"sm",className:"w-100",value:O,onChange:e=>{s("layerHonorMode",e.target.value)}},(0,o.jsx)("option",{value:t.Webmap},this.formatMessage("layerHonorSetting")),(0,o.jsx)("option",{value:t.Custom},this.formatMessage("layerCustomize")))),O===t.Custom&&(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("configFieldsTip")},(0,o.jsx)(l.FieldSelector,{useDataSources:h?(0,o.Immutable)([h]):(0,o.Immutable)([]),onChange:this.onFieldChange,selectedFields:(0,o.Immutable)(V),isMultiple:!0,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,hiddenFields:(0,o.Immutable)(M)})),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:N&&this.formatMessage("editableCount",{count:Q})},(0,o.jsx)("div",{className:"fields-list-header form-inline"},(0,o.jsx)("div",{className:"d-flex w-100 ml-5 fields-list-check"},N&&(0,o.jsx)(n.Checkbox,{id:"editAll","data-field":"editAll",onClick:()=>{this.handleTreeBoxAll(L)},checked:!L,indeterminate:E,title:L?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,o.jsx)(n.Label,{for:"editAll",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))),(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"tertiary",onClick:this.addGroupForFields,title:this.formatMessage("addGroup"),"aria-label":this.formatMessage("addGroup"),disabled:U},(0,o.jsx)(f,null)))),(0,o.jsx)(r.SettingRow,{className:"selected-fields-con"},(0,o.jsx)(u.Tree,Object.assign({className:"selected-fields-list",rootItemJson:A,treeAlignmentType:u.TreeAlignmentType.Intact,dndEnabled:!0,checkboxLinkage:N,collapseStyle:u.TreeCollapseStyle.Arrow,renderOverrideItemCommands:(e,t)=>{const{itemJsons:i}=t.props,[a]=i,{jimuName:s}=null==a?void 0:a.itemStateDetailContent,r=this.getCurrentEditField(s),{jimuName:l,groupKey:d}=r;return d?(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"tertiary",onClick:e=>{null==e||e.stopPropagation(),this.removeGroup(l)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||this.removeGroup(l)},title:this.formatMessage("remove"),"aria-label":this.formatMessage("remove")},(0,o.jsx)(b,null)):""},renderOverrideItemDetailToggle:(e,t)=>{const{itemJsons:i,itemJsons:[{itemStateDetailVisible:a,itemStateDetailContent:s,itemStateDisabled:r}]}=t.props,[l]=i,{jimuName:d}=null==l?void 0:l.itemStateDetailContent,c=this.getCurrentEditField(d);return s?(0,o.jsx)(n.Button,{icon:!0,type:"tertiary",title:this.formatMessage("description"),"aria-label":this.formatMessage("description"),disabled:!!r,"aria-expanded":!!a,className:"jimu-tree-item__detail-toggle",onClick:e=>{e.stopPropagation(),this.showDetailPopper(t.dragRef,c)},onKeyUp:e=>{" "!==e.key&&"Enter"!==e.key||(e.stopPropagation(),this.showDetailPopper(t.dragRef,c))},css:()=>o.css`
                                &.jimu-tree-item__detail-toggle {
                                  display: flex;
                                  align-items: center;
                                  cursor: pointer;

                                  .icon-btn-sizer {
                                    margin: 0;
                                    min-width: 0.5rem;
                                    min-height: 0.5rem;
                                  }
                                }
                              `},(0,o.jsx)(w,{autoFlip:!a})):null},isItemDroppable:(e,t)=>{var i,a,s,o;const{draggingItemJsons:n,targetItemJsons:r}=e,l=(null===(i=r[1])||void 0===i?void 0:i.itemKey)!==T&&!!(null===(a=r[1])||void 0===a?void 0:a.itemChildren);return!(!(null===(s=r[0])||void 0===s?void 0:s.itemChildren)||(null===(o=n[0])||void 0===o?void 0:o.itemChildren)||l)},isFolder:(e,t)=>{const{targetItemJsons:i}=e,[a]=i,{groupKey:s}=null==a?void 0:a.itemStateDetailContent;return!!s},onUpdateItem:(e,t)=>{var i;const{itemJsons:a,updateType:o}=e,n=a[a.length-1],[r]=a,{jimuName:l}=null==r?void 0:r.itemStateDetailContent,d=this.getCurrentEditField(l),{groupKey:c}=d;if(!c&&o===u.TreeItemActionType.HandleStartEditing)return;const p=null===(i=n.itemChildren)||void 0===i?void 0:i.map(((e,t)=>{var i,a,s,o,r;return(null==e?void 0:e.itemChildren)?(e.itemStateTitle||(n.itemChildren[t].itemStateTitle=null===(i=e.itemStateDetailContent)||void 0===i?void 0:i.jimuName),Object.assign(Object.assign(Object.assign(Object.assign({},e.itemStateDetailContent),{children:e.itemChildren.map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})))}),e.itemStateTitle?{name:e.itemStateTitle,alias:e.itemStateTitle}:{name:null===(a=e.itemStateDetailContent)||void 0===a?void 0:a.jimuName,alias:null===(s=e.itemStateDetailContent)||void 0===s?void 0:s.jimuName}),{editAuthority:(null===(o=e.itemChildren)||void 0===o?void 0:o.length)>0&&!(null===(r=e.itemChildren)||void 0===r?void 0:r.some((e=>!1===e.isCheckboxDisabled&&!1===e.itemStateChecked)))})):Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})}));s("groupedFields",p);const h=this.getUncheckState(p),m=this.getIndeterminate(p);this.setState({rootItemJson:n,hasUncheck:h,indeterminate:m})}},X)),(0,o.jsx)(n.Popper,{placement:"bottom-start",disableResize:!0,reference:F,offset:[-27,3],open:P,showArrow:!1,toggle:e=>{this.setState({isOpenDetailPopper:!P})}},(0,o.jsx)("div",{style:{width:228,height:132},className:"p-4"},(0,o.jsx)(n.TextArea,{ref:e=>{this.popperTextRef=e},id:null==H?void 0:H.jimuName,className:"w-100",height:60,placeholder:this.formatMessage("editFieldDescription"),defaultValue:(null==H?void 0:H.subDescription)||(null==H?void 0:H.description)}),(0,o.jsx)("div",{className:"mt-4 float-right"},(0,o.jsx)(n.Button,{size:"sm",type:"primary",onClick:()=>{this.handleTreeDescChange(null==H?void 0:H.jimuName,this.popperTextRef.value)}},this.formatMessage("commonModalOk")),(0,o.jsx)(n.Button,{size:"sm",className:"ml-1",onClick:()=>{this.setState({isOpenDetailPopper:!1})}},this.formatMessage("commonModalCancel")))))))),(0,o.jsx)("div",{className:"ds-container"},(0,o.jsx)(o.DataSourceComponent,{useDataSource:(0,o.Immutable)(h),onDataSourceCreated:this.onDataSourceCreated}))))))}}var O=c(4108);class N extends o.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,o.jsx)(o.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var A=c(53921),R=c.n(A),k=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const L=e=>{const t=window.SVG,{className:i}=e,a=k(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:R()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var E=c(23662),P=c.n(E),F=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const H=e=>{const t=window.SVG,{className:i}=e,a=F(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:P()},a)):o.React.createElement("svg",Object.assign({className:s},a))};var U=c(31027),B=c.n(U),V=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i};const G=e=>{const t=window.SVG,{className:i}=e,a=V(e,["className"]),s=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:s,src:B()},a)):o.React.createElement("svg",Object.assign({className:s},a))};function J(e){var t,i,a,s,n;let r=[];if(!e)return r;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(a=null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(s=(0,o.getAppStore)().getState())||void 0===s?void 0:s.appConfig;if(!l)return r;const d=null===(n=l.widgets[e])||void 0===n?void 0:n.useDataSources;if(void 0!==d){d.map((e=>e.dataSourceId)).forEach((e=>{const t=o.DataSourceManager.getInstance().getDataSource(e),i=(null==t?void 0:t.getDataSourcesByType(o.DataSourceTypes.FeatureLayer))||[],a=(null==t?void 0:t.getDataSourcesByType(o.DataSourceTypes.OrientedImageryLayer))||[],s=i.concat(a);if(s){const e=s.filter((e=>!function(e){const t=e=>{var i,a;let s=!1;const n=null==e?void 0:e.parentDataSource,r=null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.isTable;if(((null===(a=null==n?void 0:n.layer)||void 0===a?void 0:a.type)===o.SupportedJSAPILayerTypes.MapImageLayer||r)&&(s=!0),s||!n)return s;t(n)};return t(e)}(e)));r=r.concat(e)}}))}return r}var $=c(62686),z=function(e,t,i,a){return new(i||(i=Promise))((function(s,o){function n(e){try{l(a.next(e))}catch(e){o(e)}}function r(e){try{l(a.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((a=a.apply(e,t||[])).next())}))};const _=c(62838),W=Object.assign({},d,n.defaultMessages);class K extends o.React.PureComponent{constructor(i){super(i),this.supportedDsTypes=(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.OrientedImageryLayer]),this.sidePopperTrigger=o.React.createRef(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{this.dsHash[t]=e.useDataSource,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.dataSourceChangeSave=i=>{if(!i)return;const{config:a}=this.props,{editMode:s}=a,n=s===e.Attribute,r=a.editMode===e.Geometry,l=(0,o.Immutable)(i[0]);this.dsManager.createDataSourceByUseDataSource(l).then((e=>{var i,a,s,d,c,p;const u=null==e?void 0:e.getLayerDefinition(),h=null==u?void 0:u.allowGeometryUpdates,m=null==u?void 0:u.capabilities,g=(null==u?void 0:u.type)===o.SupportedLayerServiceTypes.Table,f=!r&&g||r,y=this.getDsCap(m,"create")&&f,v=this.getDsCap(m,"update"),S=this.getDsCap(m,"delete"),b=null==e?void 0:e.getSchema();let x=(null==b?void 0:b.fields)?Object.values(null==b?void 0:b.fields):[];const C=(null==u?void 0:u.fields)||[];x=x.filter((e=>!M.includes(e.name)));const j=null===(a=null===(i=null==e?void 0:e.layer)||void 0===i?void 0:i.formTemplate)||void 0===a?void 0:a.elements;if(j){const e=[];j.forEach((t=>{var i;const a=t;(null===(i=null==a?void 0:a.elements)||void 0===i?void 0:i.length)>0?null==a||a.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):a.fieldName&&e.push(a.fieldName)})),x=x.filter((t=>e.includes(t.name)))}(null==x?void 0:x.length)>50&&(x=x.slice(0,50));const w=x.map((e=>{const t=C.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),D=!!(null===(s=e.getRootDataSource())||void 0===s?void 0:s.map),T=Object.assign({id:e.id,name:e.getLabel(),layerId:null==e?void 0:e.jimuChildId,useDataSource:l,addRecords:y,deleteRecords:S,updateRecords:v,updateAttributes:v,updateGeometries:h&&v,featureSnapping:!1,showFields:x,groupedFields:w,layerHonorMode:D?t.Webmap:t.Custom},n?{layerEditingEnabled:null===(p=null===(c=null===(d=null==e?void 0:e.getMainDataSource())||void 0===d?void 0:d.layer)||void 0===c?void 0:c.editingEnabled)||void 0===p||p,isTable:g}:{});let I;if(this.props.config.layersConfig[this.index]){const e=this.props.config.layersConfig.asMutable({deep:!0});e.splice(this.index,1,T),I=(0,o.Immutable)(e)}else I=this.props.config.layersConfig.concat([(0,o.Immutable)(T)]);this.dsHash[this.index]=l,this.updateDsHash(I);const O={id:this.props.id,config:this.props.config.set("layersConfig",I),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(O)})).catch((e=>{console.error(e)}))},this.importAllLayersConfigSave=e=>z(this,void 0,void 0,(function*(){if(0===(null==e?void 0:e.length))return;const i=yield(()=>z(this,void 0,void 0,(function*(){let i=this.props.config.layersConfig;const s=[];e.forEach((e=>{e.dataSourceId.startsWith("add-data")||s.push(this.dsManager.createDataSourceByUseDataSource((0,o.Immutable)(e)))}));const n=yield Promise.all(s);return e.forEach(((s,r)=>{var l,d,c,p,u;const h=n[r];if(!this.supportedDsTypes.includes(null==h?void 0:h.type))return;const m=(null==h?void 0:h.getLayerDefinition)?h.getLayerDefinition():{};if((null===(l=null==h?void 0:h.layer)||void 0===l?void 0:l.isTable)||(null==m?void 0:m.type)===o.SupportedLayerServiceTypes.Table||(null===(d=null==h?void 0:h.getDataSourceJson())||void 0===d?void 0:d.isHidden))return;const g=(0,o.Immutable)(s),f=(null==m?void 0:m.fields)||[],y=null==h?void 0:h.getSchema();let v=(null==y?void 0:y.fields)?Object.values(null==y?void 0:y.fields):[];v=v.filter((e=>!M.includes(e.jimuName)));const S=null===(p=null===(c=null==h?void 0:h.layer)||void 0===c?void 0:c.formTemplate)||void 0===p?void 0:p.elements;if(S){const e=[];S.forEach((t=>{var i;const a=t;(null===(i=null==a?void 0:a.elements)||void 0===i?void 0:i.length)>0?null==a||a.elements.forEach((t=>{t.fieldName&&e.push(t.fieldName)})):a.fieldName&&e.push(a.fieldName)})),v=v.filter((t=>e.includes(t.name)))}(null==v?void 0:v.length)>50&&(v=v.slice(0,50));const b=v.map((e=>{const t=f.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,subDescription:(null==e?void 0:e.description)||"",editable:i})})),x=null==m?void 0:m.allowGeometryUpdates,C=null==m?void 0:m.capabilities,j=this.getDsCap(C,"create"),w=this.getDsCap(C,"update"),D=this.getDsCap(C,"delete"),T=!!(null===(u=h.getRootDataSource())||void 0===u?void 0:u.map),I={id:h.id,name:h.getLabel(),layerId:null==h?void 0:h.jimuChildId,useDataSource:g,addRecords:j,deleteRecords:D,updateRecords:w,updateAttributes:w,updateGeometries:x&&w,featureSnapping:!1,showFields:v,groupedFields:b,layerHonorMode:T?t.Webmap:t.Custom};i=i.concat([(0,o.Immutable)(I)]),this.dsHash[this.index]=g,e.length===r+1&&0===i.length&&this.setState({importHintType:a.NoLayer},(()=>{setTimeout((()=>{this.setState({importHintType:void 0})}),3e3)}))})),i})))();this.updateDsHash(i.asMutable({deep:!0}));const s={id:this.props.id,config:this.props.config.set("layersConfig",i),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(s)})),this.onViewsCreate=e=>{this.setState({allLayerLoaded:!1});const t=Object.keys(e),i=t.length,a={};let s=0;t.forEach((t=>z(this,void 0,void 0,(function*(){a[t]=!1;const o=e[t];if(yield o.whenJimuMapViewLoaded(),yield o.whenAllJimuLayerViewLoaded(),a[t]=!0,s++,s===i){Object.values(a).every((e=>e))&&this.setState({jimuMapViews:e,allLayerLoaded:!0})}}))))},this.getDsCap=(e,t)=>!!e&&(Array.isArray(e)?null==e?void 0:e.join().toLowerCase().includes(t):null==e?void 0:e.toLowerCase().includes(t)),this.onFilterDs=t=>{var i,a;if(!(null==t?void 0:t.url)||(null==t?void 0:t.isOutputFromWidget))return!0;const{useMapWidgetIds:s,config:n}=this.props,{layersConfig:r,editMode:l}=n,d=r.map((e=>e.id));let c=!1;if(l===e.Geometry){const e=null==s?void 0:s[0];if(!e)return!0;const n=this.dsManager.getDataSource(t.id),r=null==n?void 0:n.getLayerDefinition();if((null===(i=null==n?void 0:n.layer)||void 0===i?void 0:i.isTable)||(null==r?void 0:r.type)===o.SupportedLayerServiceTypes.Table)return!0;const l=(null===(a=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===a?void 0:a.useDataSources).map((e=>e.dataSourceId)),p=t.id.split("-")[0];c=!l.includes(p)||l.includes(p)&&d.includes(t.id)}else c=d.includes(t.id);return c},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>{const i=e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t}));return i},this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((t=>{const i=this.dsHash[t].dataSourceId;let a;a=e[i]?(0,o.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[i].fields,this.dsHash[t].fields)}):this.dsHash[t],e[i]=a}));const t=[];return Object.keys(e).forEach((i=>{t.push(e[i])})),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);let i=this.props.config.set("layersConfig",t);0===(null==t?void 0:t.length)&&(i=i.set("description","")),delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,O.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.getStyle=e=>o.css`
      .widget-setting-edit {
        .layerlist-tools{
          .layerlist-tools-item{
            display: flex;
            margin-bottom: 8px;
          }
        }

        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.sys.color.secondary.main};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .edit-tips{
          font-style: italic;
          font-size: 12px;
          color: ${e.ref.palette.neutral[1e3]};
        }
        .filter-item-active {
          border-left: 2px solid ${e.sys.color.primary.main};
        }
        .capability-header{
          margin-bottom: 12px;
        }
        .capability-item{
          display: flex;
          justify-content: space-between;
          margin-bottom: 12px;
        }
        .empty-placeholder {
          display: flex;
          flex-flow: column;
          justify-content: center;
          height: calc(100% - 379px);
          overflow: hidden;
          .empty-placeholder-inner {
            padding: 0px 20px;
            flex-direction: column;
            align-items: center;
            display: flex;

            .empty-placeholder-text {
              color: ${e.ref.palette.neutral[1e3]};
              font-size: ${o.polished.rem(14)};
              margin-top: 16px;
              text-align: center;
            }
            .empty-placeholder-icon {
              color: ${e.ref.palette.neutral[800]};
            }
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${o.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${o.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:W[e]},t),this.onMapWidgetSelected=e=>{this.props.onSettingChange({id:this.props.id,useMapWidgetIds:e}),this.onPropertyChange("layersConfig",[])},this.onShowLayerPanel=(e,t=!1)=>{const{showLayerPanel:i}=this.state;this.settSidePopperAnchor(e,t),e===this.index?this.setState({showLayerPanel:!i}):(this.setState({showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.settSidePopperAnchor=(e,t=!1)=>{let i;i=t?this.sidePopperTrigger.current.getElementsByClassName("add-edit-btn")[0]:this.sidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map((e=>e.itemStateDetailContent)),o={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.importAll=()=>{const{useMapWidgetIds:e,config:t}=this.props,{layersConfig:i}=t;if(!(null==e?void 0:e[0]))return void this.setState({importHintType:a.NoMap},(()=>{setTimeout((()=>{this.setState({importHintType:void 0})}),3e3)}));const s=[],{jimuMapViews:o}=this.state;Object.keys(o).forEach((e=>{var t,a,n;const r=o[e].jimuLayerViews;for(const e in r){const o=null===(t=r[e])||void 0===t?void 0:t.getLayerDataSource();(null===(a=null==o?void 0:o.getDataSourceJson())||void 0===a?void 0:a.url)&&-1===i.findIndex((e=>e.id===o.id))&&s.push({dataSourceId:o.id,mainDataSourceId:o.id,dataViewId:o.dataViewId,rootDataSourceId:null===(n=o.getRootDataSource())||void 0===n?void 0:n.id})}})),s.length>0?this.importAllLayersConfigSave(s):0===i.length&&0===s.length&&this.setState({importHintType:a.NoLayer},(()=>{setTimeout((()=>{this.setState({importHintType:void 0})}),3e3)}))},this.onEditModeChange=e=>{this.toBeChangedMode=e;const{config:t}=this.props,{editMode:i,layersConfig:a}=t;if(0===a.length)return this.onPropertyChange("editMode",this.toBeChangedMode),void this.setState({showLayerPanel:!1});e!==i&&this.setState({changeModeConfirmOpen:!0})},this.handleChangeModeOk=()=>{const e=[{name:"editMode",value:this.toBeChangedMode},{name:"layersConfig",value:[]}];this.onMultiplePropertyChange(e),this.setState({changeModeConfirmOpen:!1,showLayerPanel:!1})},this.handleChangeModeClose=()=>{this.setState({changeModeConfirmOpen:!1})},this.onPropertyChange=(e,t)=>{const{config:i}=this.props;if(t===i[e])return;const a=i.set(e,t),s={id:this.props.id,config:a};this.props.onSettingChange(s)},this.onMultiplePropertyChange=e=>{const{config:t}=this.props;let i=t;e.forEach((e=>{e.value!==t[e.name]&&(i=i.set(e.name,e.value))}));const a={id:this.props.id,config:i};this.props.onSettingChange(a)},this.getAllLayersOptions=()=>{const e=[],{jimuMapViews:t,allLayerLoaded:i}=this.state;return i?(Object.keys(t).forEach((i=>{var a,s;const o=t[i].jimuLayerViews;for(const t in o){const i=null===(s=null===(a=o[t])||void 0===a?void 0:a.getLayerDataSource())||void 0===s?void 0:s.getDataSourceJson();i&&e.push({value:i.id,label:i.sourceLabel})}})),e):e},this.getSnapLayers=e=>{const t=[],{jimuMapViews:i}=this.state;return Object.keys(i).forEach((a=>{var s,o;const n=i[a].jimuLayerViews;for(const i in n){const a=null===(o=null===(s=n[i])||void 0===s?void 0:s.getLayerDataSource())||void 0===o?void 0:o.getDataSourceJson();a&&(null==e?void 0:e.includes(a.id))&&t.push({value:a.id,label:a.sourceLabel})}})),t},this.onSnapLayersChange=e=>{e||(e=[]);const t=e.map((e=>e.value));this.onPropertyChange("defaultSnapLayers",t)},this.displaySelectedLayers=e=>this.formatMessage("numSelected",{number:e.length}),this.index=0,this.dsManager=o.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={showLayerPanel:!1,refreshPanel:!1,dataSources:{},changeModeConfirmOpen:!1,importHintType:void 0,popperFocusNode:null,jimuMapViews:{},allLayerLoaded:!1}}componentDidUpdate(e){const{useMapWidgetIds:t}=this.props,{useMapWidgetIds:i}=e;(null==t?void 0:t[0])!==(null==i?void 0:i[0])&&this.onPropertyChange("defaultSnapLayers",[])}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var t,i,l,d,c,p,h,m;const{showLayerPanel:g,changeModeConfirmOpen:f,importHintType:y,allLayerLoaded:v}=this.state,{theme:S,config:b,useMapWidgetIds:x}=this.props,{layersConfig:C,editMode:j,selfSnapping:w,featureSnapping:M,defaultSelfEnabled:T,defaultFeatureEnabled:O,defaultSnapLayers:A,snapSettingMode:R,tooltip:k,templateFilter:E,relatedRecords:P,liveDataEditing:F}=b,U=j===e.Attribute,B=j===e.Geometry,V=U?this.formatMessage("newEdit"):this.formatMessage("newEditGeo"),z=U?this.formatMessage("editableSource"):this.formatMessage("editableLayer"),W=C.length,K=(0,o.getAppStore)().getState().appStateInBuilder.appConfig,q=null==x?void 0:x[0],Y=B&&(!x||0===(null==x?void 0:x.length)||!(null===(t=K.widgets)||void 0===t?void 0:t[q])),X={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:u.TreeItemActionType.RenderOverrideItem,children:[{name:u.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:u.TreeItemActionType.RenderOverrideItemBody,children:[{name:u.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:u.TreeItemActionType.RenderOverrideItemDragHandle},{name:u.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:u.TreeItemActionType.RenderOverrideItemTitle},{name:u.TreeItemActionType.RenderOverrideItemDetailToggle},{name:u.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},Q=J(q).find((e=>{var t;return(null===(t=C[this.index])||void 0===t?void 0:t.id)===e.id})),Z=B?null===(d=null===(l=null===(i=null==Q?void 0:Q.getMainDataSource())||void 0===i?void 0:i.layer)||void 0===l?void 0:l.editingEnabled)||void 0===d||d:null===(c=C[this.index])||void 0===c?void 0:c.layerEditingEnabled;return(0,o.jsx)("div",{css:this.getStyle(S),className:"h-100"},(0,o.jsx)("div",{className:"jimu-widget-setting widget-setting-edit h-100"},null===(p=this.props.useDataSources)||void 0===p?void 0:p.map(((e,t)=>(0,o.jsx)(N,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,o.jsx)(r.SettingSection,{className:"p-0 m-0 "+(W>0?"":"border-0"),role:"group"},(0,o.jsx)("div",{ref:this.sidePopperTrigger},(0,o.jsx)(r.SettingSection,{className:"border-0"},(0,o.jsx)("div",{role:"radiogroup",className:"mb-4"},(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:U,onChange:()=>{this.onEditModeChange(e.Attribute)}}),this.formatMessage("attrMode")),(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Radio,{style:{cursor:"pointer"},name:"editModeType",className:"mr-2",checked:B,onChange:()=>{this.onEditModeChange(e.Geometry)}}),this.formatMessage("geoMode"))),B&&(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,{label:this.formatMessage("selectMapWidget")}),(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(r.MapWidgetSelector,{onSelect:this.onMapWidgetSelected,useMapWidgetIds:x}),(0,o.jsx)(n.Button,{icon:!0,size:"sm",type:"default",onClick:this.importAll,className:"ml-1",title:this.formatMessage("importAll"),"aria-label":this.formatMessage("importAll"),disabled:!v},(0,o.jsx)(L,null))),y&&(0,o.jsx)(n.Alert,{withIcon:!0,tabIndex:0,className:"w-100 mt-2 mb-2",open:!0,closable:!0,onClose:()=>{this.setState({importHintType:void 0})},text:y===a.NoLayer?this.formatMessage("noLayerTips"):this.formatMessage("selectMapTip"),type:"warning"})),(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Button,{className:"w-100 add-edit-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(W,!0)},disabled:Y,title:V,"aria-label":V,"aria-describedby":"edit-blank-msg"},(0,o.jsx)("div",{className:"w-100 px-2 text-truncate"},(0,o.jsx)(H,{className:"mr-1 mb-1"}),V))),(0,o.jsx)(r.SettingRow,null,(0,o.jsx)("div",{className:"text-break edit-tips"},B?this.formatMessage("newMapEditTips"):this.formatMessage("newEditTips")))),(0,o.jsx)(r.SettingSection,{className:"pt-0 border-0"},(0,o.jsx)("div",{className:"setting-ui-unit-list"},!!W&&(0,o.jsx)(u.List,Object.assign({className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(b.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:e.name,itemStateChecked:g&&t===this.index,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:_,size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var i,a;const{itemJsons:s}=t.props,[r]=s,l=null===(a=null===(i=null==r?void 0:r.itemStateDetailContent)||void 0===i?void 0:i.useDataSource)||void 0===a?void 0:a.dataSourceId;return this.isDataSourceAccessible(l)?"":(0,o.jsx)(n.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;this.onShowLayerPanel(+i.itemKey)}},X)),W===this.index&&g&&(0,o.jsx)(u.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateTitle:e.name,itemStateChecked:!0,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},X)))),B&&(0,o.jsx)(r.SettingSection,{role:"group",title:this.formatMessage("snappingSettings"),"aria-label":this.formatMessage("snappingSettings")},(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Select,{size:"sm",className:"w-100",value:R,onChange:e=>{this.onPropertyChange("snapSettingMode",e.target.value)}},(0,o.jsx)("option",{value:s.Prescriptive},this.formatMessage("prescriptiveMode")),(0,o.jsx)("option",{value:s.Flexible},this.formatMessage("flexibleMode")))),R===s.Prescriptive?(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:T,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultSelfEnabled",e.target.checked)}}),this.formatMessage("selfSnapping"))),(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:O,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultFeatureEnabled",e.target.checked)}}),this.formatMessage("featureSnapping")))):(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,{label:this.formatMessage("selfSnapping")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:w,"data-key":"selfSnapping",onChange:e=>{this.onPropertyChange("selfSnapping",e.target.checked)},"aria-label":this.formatMessage("selfSnapping")})),w&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:T,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultSelfEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled"))),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("featureSnapping")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:M,"data-key":"featureSnapping",onChange:e=>{this.onPropertyChange("featureSnapping",e.target.checked)},"aria-label":this.formatMessage("featureSnapping")})),M&&(0,o.jsx)(r.SettingRow,null,(0,o.jsx)(n.Label,{className:"d-flex align-items-center"},(0,o.jsx)(n.Checkbox,{checked:O,className:"mr-1",onChange:e=>{this.onPropertyChange("defaultFeatureEnabled",e.target.checked)}}),this.formatMessage("defaultEnabled")))),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("chooseDefault"),className:"select-option"},(0,o.jsx)(n.AdvancedSelect,{size:"sm",title:this.formatMessage("chooseDefault"),fluid:!0,hideCheckAll:!1,hideBottomTools:!0,hideSearchInput:!0,staticValues:this.getAllLayersOptions(),sortValuesByLabel:!1,isMultiple:!0,selectedValues:this.getSnapLayers(A),onChange:this.onSnapLayersChange,"aria-label":this.formatMessage("chooseDefault"),buttonProps:{disabled:!v}}))))),0===W&&!g&&(0,o.jsx)("div",{className:"empty-placeholder w-100"},(0,o.jsx)("div",{className:"empty-placeholder-inner"},(0,o.jsx)("div",{className:"empty-placeholder-icon"},(0,o.jsx)(G,{size:48})),(0,o.jsx)("div",{className:"empty-placeholder-text",id:"edit-blank-msg",dangerouslySetInnerHTML:{__html:this.formatMessage("editBlankStatus",{EditString:V,ModeString:z})}}))),W>0&&(0,o.jsx)(r.SettingSection,{role:"group","aria-label":this.formatMessage("iconGroup_general"),title:this.formatMessage("iconGroup_general")},B&&(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,{label:this.formatMessage("tooltip")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:k,"data-key":"tooltip",onChange:e=>{this.onPropertyChange("tooltip",e.target.checked)},"aria-label":this.formatMessage("tooltip")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("templateFilter")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:E,"data-key":"templateFilter",onChange:e=>{this.onPropertyChange("templateFilter",e.target.checked)},"aria-label":this.formatMessage("templateFilter")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("relatedRecords")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:P,"data-key":"relatedRecords",onChange:e=>{this.onPropertyChange("relatedRecords",e.target.checked)},"aria-label":this.formatMessage("relatedRecords")})),(0,o.jsx)(r.SettingRow,{label:this.formatMessage("runtimeDataEditing")},(0,o.jsx)(n.Switch,{className:"can-x-switch",checked:F,"data-key":"liveDataEditing",onChange:e=>{this.onPropertyChange("liveDataEditing",e.target.checked)},"aria-label":this.formatMessage("runtimeDataEditing")}))),U&&(0,o.jsx)(D.Fragment,null,(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("description")},(0,o.jsx)(n.TextArea,{className:"w-100",height:90,"aria-label":this.formatMessage("description"),placeholder:this.formatMessage("editFieldDescription"),defaultValue:null!==(h=b.description)&&void 0!==h?h:"",onBlur:e=>{this.onPropertyChange("description",e.target.value)}})),(0,o.jsx)(r.SettingRow,{flow:"wrap",label:this.formatMessage("noDataMessage")},(0,o.jsx)(n.TextArea,{className:"w-100",height:75,"aria-label":this.formatMessage("noDataMessage"),placeholder:this.formatMessage("noDeataMessageDefaultText"),defaultValue:b.noDataMessage,onBlur:e=>{this.onPropertyChange("noDataMessage",e.target.value)}})))),(0,o.jsx)($.JimuMapViewComponent,{useMapWidgetId:null==x?void 0:x[0],onViewsCreate:this.onViewsCreate}),(0,o.jsx)(r.SidePopper,{isOpen:g&&!o.urlUtils.getAppIdPageIdFromUrl().pageId,position:"right",toggle:this.onCloseLayerPanel,trigger:null===(m=this.sidePopperTrigger)||void 0===m?void 0:m.current,backToFocusNode:this.state.popperFocusNode},(0,o.jsx)(I,Object.assign({},b.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:S,editorConfig:this.props.config,layerEditingEnabled:Z,dataSourceChange:this.dataSourceChangeSave,filterDs:this.onFilterDs,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onClose:this.onCloseLayerPanel}))),f&&(0,o.jsx)(n.ConfirmDialog,{level:"warning",title:this.formatMessage("changeModeConfirmTitle"),hasNotShowAgainOption:!1,content:this.formatMessage("changeModeConfirmTips"),onConfirm:this.handleChangeModeOk,onClose:this.handleChangeModeClose})))}}K.mapExtraStateProps=(e,t)=>{var i,a;return{activeTabId:null===(a=null===(i=null==e?void 0:e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId}};const q=K;function Y(e){c.p=e}})(),p})())}}}));