define(["exports","./index-4ba3e564","./index2-929c934e","./set-a91da829","./primitiveFactory-0fd83857","./utils-170619d9","./analysis-attribute-expression2-2e4fa6e5","./analysis-boolean-input2-4cca07bb","./analysis-chip-group2-66b37993","./analysis-data-file-input2-e099b4c1","./analysis-dataset-input2-719df5b8","./analysis-dataset-input-popover2-4ec0074d","./analysis-date-input2-8c5d70f6","./analysis-expression-group2-727233ea","./analysis-field-input2-2985824f","./analysis-field-select2-d1dcbfea","./analysis-folder-input2-614117c4","./analysis-geoenrichment-databrowser2-64112bc3","./analysis-geoenrichment-input2-d0af3a75","./analysis-item-browser2-90d48785","./analysis-item-input2-199dd569","./analysis-label2-d915c3e1","./analysis-layer-input2-10805c18","./analysis-layer-input-popover2-047da354","./analysis-linear-unit-input2-cb0fc12a","./analysis-multiple-input2-632fb56d","./analysis-number-input2-cd69beec","./analysis-query-builder2-359d95da","./analysis-query-entry2-476b236a","./analysis-query-input2-ca2ddf00","./analysis-query-modal2-bc4a8674","./analysis-query-target-select2-26718e9d","./analysis-sketch2-5affb5dd","./analysis-spatial-expression2-57c2b017","./analysis-spatial-reference-input2-471e95f0","./analysis-spatial-reference-selector2-746a6bb2","./analysis-string-input2-7799d6f1","./analysis-summary-fields2-53d7ea42","./analysis-summary-fields-popover2-5b8e537a","./analysis-traffic-time-input2-e4f68e21","./analysis-tree2-f394ec74","./analysis-unsupported-input2-c5738ad3","./analysis-workflow-select2-4c58c8d7","./analysis-workflow-select-popover2-1eb81a2c"],(function(e,t,a,s,i,n,r,l,o,u,m,c,d,p,y,h,f,g,v,b,E,k,C,P,I,V,w,S,x,T,L,_,M,A,q,D,U,R,G,K,W,N,$,H){"use strict";const B="esriGPParameterTypeRequired";function z(e){const t=e.indexOf(".");let a=e,s="";return t>0&&(a=e.substring(0,t),s=e.substring(t+1)),[a,s]}function O(e){const t=new Map;for(const a of e){const e=Array.isArray(a.destination)?a.destination:[a.destination];for(const s of e){const[e]=z(s);t.has(e)?t.get(e).push(a):t.set(e,[a])}}return t}function F(e,t,i){let n={...e};for(const e of i)for(const[i,r]of Object.entries(t)){const t=""===e?i:`${e}.${i}`;t.includes("UIparameterInfos")?n=a.setImmutableValue(n,t,r):s.set(n,t,r)}return n}async function j(e){const{param:t,data:s,rules:i,renderedParameters:n,currentTool:r}=e,l=t.name;if(void 0===l)return[t,s];let o={...t};for(const e of i){const t=await a.processRule({rule:e,data:s,renderedParams:n??{},currentTool:r});if(void 0===t)continue;const i=(Array.isArray(e.destination)?e.destination:[e.destination]).map(z).filter((([e])=>e===l));"value"in t&&(s[l]=t.value),o=F(o,t,i.map((([,e])=>e))),o.value=s[l]}return[o,s]}function J(e){let t;return e.impedanceAttributeName===e.timeAttributeName?t="time":e.impedanceAttributeName===e.distanceAttributeName&&(t="distance"),t}function X(e){const{param:t,data:s,travelModeInfo:i,straightLineLabel:n}=e,r=t.name;if(void 0===r)return[t,s];const l=s[r],o="defaultValue"in t?t.defaultValue:void 0,u=[],m={},c={};let d;if(void 0!==i){const e=i?.travelModes?.filter((e=>void 0===t.filterTravelModeType||J(e)===t.filterTravelModeType));d=i?.defaultTravelMode??void 0,void 0!==t.filterTravelModeType&&J(d)!==t.filterTravelModeType&&(d=e?.[0]??void 0),(a.isEmptyDataItem(l)||l===o&&l!==a.StraightLineParameterValue)&&(s[r]=d),e?.forEach((e=>{const t=J(e);u.push(e.id),m[e.id]=e.name,c[e.id]=function(e,t){let a;switch(e.type.toLowerCase()){case"automobile":const e={time:"driving-time",distance:"driving-distance",other:"car"};a=e[t??"other"]??e.other;break;case"walk":const s={time:"walking-time",distance:"walking-distance",other:"walk"};a=s[t??"other"]??s.other;break;case"truck":const i={time:"trucking-time",distance:"trucking-distance",other:"dashboard"};a=i[t??"other "]??i.other;break;default:const n={time:"edit-attributes",distance:"edit-attributes",other:"dashboard"};a=n[t??"other "]??n.other}return a}(e,t)}))}o!==a.StraightLineParameterValue&&!0!==t.includeStraightLine||!1!==u.includes(a.StraightLineParameterValue)||(u.push(a.StraightLineParameterValue),m[a.StraightLineParameterValue]=n??a.StraightLineParameterValue,c[a.StraightLineParameterValue]="line-straight");let p=o===a.StraightLineParameterValue?a.StraightLineParameterValue:d?.id??"";return a.isEmptyDataItem(l)||(p=l===a.StraightLineParameterValue?a.StraightLineParameterValue:l?.id??""),[{...t,choiceListLabels:m,choiceList:u,choiceListIcons:c,value:p},s]}function Q(e){const{param:t,data:a,renderedParameters:s}=e,i=t.name;if(void 0===i)return[t,a];const n=s?.[i],r=void 0===n&&!0===t.visible,l=void 0!==n&&!1===t.visible,o=void 0!==n&&!0===t.visible&&!1===t.readOnly&&void 0===t.value&&void 0!==t.defaultValue;return r||o?(a[i]??(a[i]=t.defaultValue),t.value=a[i]):l&&(a[i]=void 0,t.value=a[i]),[t,a]}const Y=e=>void 0===e.visible||!0===e.visible,Z="value-table",ee={groupContainer:`${Z}__group-container`,groupAction:`${Z}__group-action`,groupAction1:`${Z}__group-action-1`,label:`${Z}__label`,groupHorizontal:`${Z}__horizontal-layout`,groupHorizontalRtl:`${Z}__horizontal-layout-rtl`,analysisInput:`${Z}__analysis-input`,errorMessage:`${Z}__error-message`},te=new Set([i.AnalysisToolParamDataType.GPFeatureRecordSetLayer,i.AnalysisToolParamDataType.GPRecordSet]),ae=({direction:e,entryIndex:a,values:s,parameterInfos:n,valueWithoutKey:r,removeLabel:l,onEntryDeleted:o,onValueChange:u,onSetRef:m,props:c})=>{const d=n[0],p=d?.label;return r?t.h("div",{class:`${ee.groupHorizontal} ${"rtl"===e?ee.groupHorizontal:""}`,key:a},Boolean(p)&&t.h("analysis-label",{label:p,hideHelp:!0,required:!0===d.required||d.parameterType===B}),t.h(i.AnalysisPrimitiveParameter,{...d,label:"",onValueChange:e=>u(a,n[0].name,e),onSetRef:e=>m(a,n[0].name,e),value:s[n[0].name]}),t.h("calcite-button",{kind:"neutral","icon-start":"x",appearance:"transparent",scale:"s",class:ee.groupAction1,onClick:()=>o(a),label:l})):t.h("div",{class:ee.groupContainer,key:a},t.h("calcite-button",{"icon-end":"trash",appearance:"transparent",kind:"neutral",scale:"s",class:ee.groupAction,onClick:()=>o(a),label:l}),n.filter((e=>!("visible"in e&&!1===e.visible))).map((e=>{const n="required"in e&&!0===e.required||e.parameterType===B;return t.h(i.AnalysisPrimitiveParameter,{...e,...c,class:ee.analysisInput,required:n,label:e.label??e.displayName,onValueChange:t=>u(a,e.name,t),onSetRef:t=>m(a,e.name,t),value:s?.[e.name],hideHelp:!0})})))};function se(e){return void 0!==e.name}const ie=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisValueTableChange=t.createEvent(this,"analysisValueTableChange",7),this.analysisHelpClick=t.createEvent(this,"analysisHelpClick",7),this.direction="ltr",this.entryInputElements=new Map,this.onAddButtonClick=()=>{this.value=this.valueWithoutKey?[...this.value,void 0]:[...this.value,this.getDefaultEntry()],this.analysisValueTableChange.emit()},this.onEntryDeleted=e=>{this.value.splice(e,1),this.removeAndUpdateEntryInputElements(e),this.value=[...this.value],this.analysisValueTableChange.emit()},this.onValueChange=async(e,t,a)=>{const s=a.target.value;this.valueWithoutKey?this.value[e]=s:this.value[e][t]=s;const[,i]=await this.applyRulesToEntry(e);this.value[e]=i,this.analysisValueTableChange.emit()},this.onSetRef=(e,t,a)=>{const s=this.entryInputElements.get(e);if(a)if(this.valueWithoutKey)this.entryInputElements.set(e,a);else{const i={[t]:a};this.entryInputElements.set(e,{...s??{},...i})}else if(this.valueWithoutKey)this.entryInputElements.delete(e),this.value.splice(e,1);else{delete s?.[t];const a=this.value[e];a&&delete a[t]}},this.validateSelection=async()=>{let e=!0;this.errorMessage=void 0;const t=!1===a.isEmptyDataItem(this.value)&&!0===a.isEmptyDataItem(this.value.every((e=>void 0!==e))),s=a.formatValidationParamsMessage(a.getValidationParamsMessageFromErrorKey(this.strings,this.validationParams)),i=this.value.flat(2).some((e=>!a.isEmptyDataItem(e))),n=!1===t&&!1===i,r=void 0!==this.minGroupCount&&(!0===this.required||!1===n)&&this.value.length<this.minGroupCount,l=void 0!==this.maxGroupCount&&this.value.length>this.maxGroupCount;!0===this.required&&n?(e=!1,this.errorMessage=void 0!==this.validationParams?.message?s:this.strings.requiredMessage):(r||l)&&(e=!1,this.errorMessage=void 0!==this.validationParams?.message?s:a.formatMessage(r?this.strings.minGroupsMessage:this.strings.maxGroupsMessage,{minCount:`${this.minGroupCount??0}`,maxCount:`${this.maxGroupCount??Number.MAX_SAFE_INTEGER}`}));const o=(await this.checkEntriesValidity()).every((e=>!0===e));return e&&o},this.checkEntriesValidity=async()=>{const e=Array.from(this.entryInputElements.keys()).map((e=>{const t=this.entryInputElements.get(e);return(this.valueWithoutKey?[t]:Object.values(t)).map(this.checkEntryValidity)}));return Promise.all(e.flat())},this.checkEntryValidity=e=>!1===a.isEmptyDataItem(e)&&"checkValidity"in e&&"function"==typeof e.checkValidity?e.checkValidity():Promise.resolve(!0),this.getDefaultEntry=()=>{const e=this.combinedParameterInfos.filter((e=>void 0!==e.defaultValue)).map((e=>[e.name,e.defaultValue]));return Object.fromEntries(e)},this.required=!1,this.value=[],this.label=void 0,this.maxGroupCount=void 0,this.minGroupCount=void 0,this.parameterInfos=void 0,this.UIparameterInfos=void 0,this.UIparameterInfosRules=void 0,this.valueWithoutKey=!1,this.user=void 0,this.portal=void 0,this.mapLayers=void 0,this.mapView=void 0,this.supportsUpload=!1,this.serviceUrl=void 0,this.validationParams=void 0,this.errorMessage=void 0,this.entryElements=void 0}async checkValidity(){const e=await this.validateSelection(),{message:t,type:a}=this.validationParams||{},s=!1==(void 0!==t)||!0==("informative"===a);return!0===e&&void 0===this.errorMessage&&!0===s}get combinedParameterInfos(){let e=this.parameterInfos??[];return void 0!==this.UIparameterInfos&&(e=this.UIparameterInfos.filter(se).map((e=>{const t=this.parameterInfos?.find((t=>t.name===e.name));return{...t,...e}}))),e}get rulesByDestination(){return O(this.UIparameterInfosRules??[])}async componentWillLoad(){if(({strings:this.strings,dir:this.direction}=await a.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath("."))),void 0===this.value||0===this.value.length){const e=this.valueWithoutKey?void 0:this.getDefaultEntry();this.value=[e],!1===a.isEmptyDataItem(e)&&this.analysisValueTableChange.emit()}}async componentWillRender(){this.entryElements=await Promise.all(this.value.map((async(e,a)=>{const[s,i]=await this.applyRulesToEntry(a);let n={};return this.valueWithoutKey?n[s[0].name]=i:n=i,t.h(ae,{direction:this.direction,entryIndex:a,values:n,valueWithoutKey:this.valueWithoutKey,parameterInfos:s,removeLabel:this.strings.removeEntryButtonLabel,onEntryDeleted:this.onEntryDeleted,onValueChange:this.onValueChange,onSetRef:this.onSetRef,props:{user:this.user,portal:this.portal,mapLayers:this.mapLayers,mapView:this.mapView,supportsUpload:this.supportsUpload,serviceUrl:this.serviceUrl}})})))}render(){return t.h(t.Host,{key:"eefa2d3a05b220eaad890292f9aecc3cc2ab5e5e"},t.h("analysis-label",{key:"017b3c20378f0c46615eb2ed5d238d03dd084ce6",label:this.label,required:this.required,onAnalysisLabelHelpActionClick:()=>this.analysisHelpClick.emit()}),this.entryElements,t.h("calcite-button",{key:"ede333b0a3d265498d39bf7cebee04e996ba00b7",style:this.valueWithoutKey?{marginTop:"var(--analysis-half-spacing)"}:{},appearance:"outline",kind:"neutral","icon-start":"plus",width:"full",scale:n.UIDefaults.Scale,onClick:this.onAddButtonClick},this.strings.addEntryButtonLabel),this.renderErrorMessage())}renderErrorMessage(){const e=!1===a.isEmptyDataItem(this.validationParams?.message)||void 0!==this.errorMessage,s=a.formatValidationParamsMessage(a.getValidationParamsMessageFromErrorKey(this.strings,this.validationParams)),i=void 0!==this.validationParams?a.getUIInputStatusFromMessageType(this.validationParams.type):a.UIInputStatus.INVALID;return t.h("calcite-input-message",{class:ee.errorMessage,hidden:!e,icon:"exclamationMarkTriangle",scale:n.UIDefaults.Scale,status:i},s??this.errorMessage)}removeAndUpdateEntryInputElements(e){const t=this.entryInputElements.size;if(e>=0&&e<t){const t=new Map;for(const[a,s]of this.entryInputElements){const i=a>e?a-1:a;a!==e&&t.set(i,s)}this.entryInputElements=t}}getSelectedLayersForParameter(e,t){const s=t?.[e.name];let i;if("dataType"in e&&"string"==typeof e?.dataType&&te.has(e?.dataType)&&void 0!==s){const e=s;i=a.findExistingLayer(e?.url??e?.layerDefinition?.name,this.mapLayers??[])}return i}async applyRulesToEntry(e){if(this.valueWithoutKey)return[this.combinedParameterInfos,this.value[e]];const t=this.rulesByDestination,a=this.value[e],s=this.entryInputElements.get(e);let i;i=void 0===s?{}:s;const n=Object.entries(i).reduce(((e,[t,a])=>(void 0!==a&&(e[t]=a),e)),{});return[await Promise.all(this.combinedParameterInfos.map((async e=>{const s={selectedLayers:this.getSelectedLayersForParameter(e,a),...e};let[i]=await j({param:s,data:a,rules:t.get(e.name)??[],renderedParameters:n});return[i]=Q({param:i,data:a,renderedParameters:n}),i}))),a]}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:block;margin-bottom:var(--analysis-half-spacing)}.value-table__group-container{display:flex;flex-direction:column;border:1px var(--calcite-color-border-1) solid;border-radius:var(--calcite-border-radius);padding:var(--analysis-half-spacing) var(--analysis-half-spacing) 0 var(--analysis-half-spacing);margin-bottom:var(--analysis-half-spacing)}.value-table__group-action{align-self:flex-end}.value-table__group-action-1{align-self:flex-start}.value-table__label{margin:var(--analysis-half-spacing) 0}.value-table__horizontal-layout{display:flex;border:1px var(--calcite-color-border-1) solid;width:calc(100% - var(--analysis-half-spacing) - 1px);margin-top:-1px;padding-top:var(--analysis-half-spacing);padding-left:var(--analysis-half-spacing)}.value-table__horizontal-layout-rtl{padding-left:unset;padding-right:var(--analysis-half-spacing)}.value-table__analysis-input{margin-bottom:var(--analysis-half-spacing)}.value-table__error-message{margin-top:var(--analysis-quarter-spacing)}"}},[1,"analysis-value-table",{required:[516],value:[1040],label:[513],maxGroupCount:[2,"max-group-count"],minGroupCount:[2,"min-group-count"],parameterInfos:[16],UIparameterInfos:[16],UIparameterInfosRules:[16],valueWithoutKey:[516,"value-without-key"],user:[16],portal:[16],mapLayers:[16],mapView:[16],supportsUpload:[4,"supports-upload"],serviceUrl:[1,"service-url"],validationParams:[16],errorMessage:[32],entryElements:[32],checkValidity:[64]}]);function ne(){"undefined"!=typeof customElements&&["analysis-value-table","analysis-attribute-expression","analysis-boolean-input","analysis-chip-group","analysis-data-file-input","analysis-dataset-input","analysis-dataset-input-popover","analysis-date-input","analysis-expression-group","analysis-field-input","analysis-field-select","analysis-folder-input","analysis-geoenrichment-databrowser","analysis-geoenrichment-input","analysis-item-browser","analysis-item-input","analysis-label","analysis-layer-input","analysis-layer-input-popover","analysis-linear-unit-input","analysis-multiple-input","analysis-number-input","analysis-query-builder","analysis-query-entry","analysis-query-input","analysis-query-modal","analysis-query-target-select","analysis-sketch","analysis-spatial-expression","analysis-spatial-reference-input","analysis-spatial-reference-selector","analysis-string-input","analysis-summary-fields","analysis-summary-fields-popover","analysis-traffic-time-input","analysis-tree","analysis-unsupported-input","analysis-workflow-select","analysis-workflow-select-popover"].forEach((e=>{switch(e){case"analysis-value-table":customElements.get(e)||customElements.define(e,ie);break;case"analysis-attribute-expression":customElements.get(e)||r.defineCustomElement();break;case"analysis-boolean-input":customElements.get(e)||l.defineCustomElement();break;case"analysis-chip-group":customElements.get(e)||o.defineCustomElement();break;case"analysis-data-file-input":customElements.get(e)||u.defineCustomElement();break;case"analysis-dataset-input":customElements.get(e)||m.defineCustomElement();break;case"analysis-dataset-input-popover":customElements.get(e)||c.defineCustomElement();break;case"analysis-date-input":customElements.get(e)||d.defineCustomElement();break;case"analysis-expression-group":customElements.get(e)||p.defineCustomElement();break;case"analysis-field-input":customElements.get(e)||y.defineCustomElement();break;case"analysis-field-select":customElements.get(e)||h.defineCustomElement();break;case"analysis-folder-input":customElements.get(e)||f.defineCustomElement();break;case"analysis-geoenrichment-databrowser":customElements.get(e)||g.defineCustomElement();break;case"analysis-geoenrichment-input":customElements.get(e)||v.defineCustomElement();break;case"analysis-item-browser":customElements.get(e)||b.defineCustomElement();break;case"analysis-item-input":customElements.get(e)||E.defineCustomElement();break;case"analysis-label":customElements.get(e)||k.defineCustomElement();break;case"analysis-layer-input":customElements.get(e)||C.defineCustomElement();break;case"analysis-layer-input-popover":customElements.get(e)||P.defineCustomElement();break;case"analysis-linear-unit-input":customElements.get(e)||I.defineCustomElement();break;case"analysis-multiple-input":customElements.get(e)||V.defineCustomElement();break;case"analysis-number-input":customElements.get(e)||w.defineCustomElement();break;case"analysis-query-builder":customElements.get(e)||S.defineCustomElement();break;case"analysis-query-entry":customElements.get(e)||x.defineCustomElement();break;case"analysis-query-input":customElements.get(e)||T.defineCustomElement();break;case"analysis-query-modal":customElements.get(e)||L.defineCustomElement();break;case"analysis-query-target-select":customElements.get(e)||_.defineCustomElement();break;case"analysis-sketch":customElements.get(e)||M.defineCustomElement();break;case"analysis-spatial-expression":customElements.get(e)||A.defineCustomElement();break;case"analysis-spatial-reference-input":customElements.get(e)||q.defineCustomElement();break;case"analysis-spatial-reference-selector":customElements.get(e)||D.defineCustomElement();break;case"analysis-string-input":customElements.get(e)||U.defineCustomElement();break;case"analysis-summary-fields":customElements.get(e)||R.defineCustomElement();break;case"analysis-summary-fields-popover":customElements.get(e)||G.defineCustomElement();break;case"analysis-traffic-time-input":customElements.get(e)||K.defineCustomElement();break;case"analysis-tree":customElements.get(e)||W.defineCustomElement();break;case"analysis-unsupported-input":customElements.get(e)||N.defineCustomElement();break;case"analysis-workflow-select":customElements.get(e)||$.defineCustomElement();break;case"analysis-workflow-select-popover":customElements.get(e)||H.defineCustomElement()}}))}ne(),e.AnalysisValueTable=ie,e.adaptForTravelModes=X,e.applyRules=j,e.applyToolParameterDefaults=function(e){const{defaultValues:t,toolJsonParameters:a,toolUIJsonParametersByName:s}=e;return a?.forEach((e=>{const a=s?.[e.name];"esriGPParameterDirectionOutput"===e.direction||void 0!==t[e.name]||void 0!==a?.visible&&!0!==a?.visible||(t[e.name]=e.defaultValue)})),t},e.applyToolUIJsonParameterDefaults=function(e){let{defaultValues:t}=e;const{toolName:s,toolUIJsonParametersByName:i,travelModeInfo:n}=e;return Object.keys(i??{}).forEach((e=>{const r=i?.[e];void 0!==r?.name&&!0===Y(r)?void 0!==n&&void 0!==s&&!0===a.isTravelModeParameter(r.name,s)?(t[r.name]=r.defaultValue,[,t]=X({param:r,data:t,travelModeInfo:n})):t[r.name]=r.defaultValue:void 0!==r?.name&&!1===r.visible&&(t[r.name]=void 0)})),t},e.applyUserSettings=function(e){const{defaultValues:t,user:s,hasAdvancedLicense:i}=e;return t.userSettings={unitSystem:s?.units,hasNAPrivilege:a.hasNAPrivilege(s),hasGEPrivilege:a.hasGeoEnrichmentPrivilege(s),hasAdvancedLicense:i},t},e.applyUserSettingsRules=async function(e){const{defaultValues:t,toolUIJsonParametersByName:a,rules:s}=e,i=O(function(e){const t=e?.filter((e=>(e=>{switch(e.ruleType){case"expression":return e.expression?.includes("userSettings");case"equals":return!0===e.valueA?.toString().includes("userSettings")||!0===e.valueB?.toString().includes("userSettings");default:return!1}})(e)&&(e=>"effectParams"in e&&"defaultValue"in e.effectParams)(e)));return t??[]}(s));for(const e of Object.keys(a??{})){const s=a?.[e];if(void 0!==s?.name&&!0===Y(s)){const a=i.get(e);if(void 0!==a){const[e]=await j({param:s,data:t,rules:a,renderedParameters:{}});t[s.name]=e.defaultValue}}}return t},e.applyVisibilityRules=Q,e.defineCustomElement=ne,e.getRulesByDestination=O,e.joinParams=function(e,t){return e.filter((e=>"esriGPParameterDirectionOutput"!==e.direction))?.map((e=>({...t.find((t=>t.name===e.name)),...e})))}}));