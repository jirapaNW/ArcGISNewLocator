define(["exports","./index-4ba3e564","./index2-929c934e","./analysis-item-browser2-90d48785","./_Uint8Array-2357716e","./_baseIsEqual-b038bd4f","./isObject-a5254a4d","./get-ead8032d","./_baseGet-1781da83","./_MapCache-d92ee307","./identity-47e9f05a"],(function(e,t,s,i,r,a,n,o,l,h,c){"use strict";var d=1,m=2;function p(e){return e==e&&!n.isObject(e)}function u(e,t){return function(s){return null!=s&&s[e]===t&&(void 0!==t||e in Object(s))}}function y(e,t){return null!=e&&t in Object(e)}function f(e,t){return null!=e&&function(e,t,s){for(var i=-1,a=(t=l.castPath(t,e)).length,n=!1;++i<a;){var o=l.toKey(t[i]);if(!(n=null!=e&&s(e,o)))break;e=e[o]}return n||++i!=a?n:!!(a=null==e?0:e.length)&&r.isLength(a)&&r.isIndex(o,a)&&(h.isArray$1(e)||r.isArguments$1(e))}(e,t,y)}function v(e){return"function"==typeof e?e:null==e?c.identity:"object"==typeof e?h.isArray$1(e)?(i=e[0],n=e[1],l.isKey(i)&&p(n)?u(l.toKey(i),n):function(e){var t=o.get(e,i);return void 0===t&&t===n?f(e,i):a.baseIsEqual(n,t,3)}):(s=function(e){for(var t=r.keys(e),s=t.length;s--;){var i=t[s],a=e[i];t[s]=[i,a,p(a)]}return t}(t=e),1==s.length&&s[0][2]?u(s[0][0],s[0][1]):function(e){return e===t||function(e,t,s,i){var n=s.length,o=n;if(null==e)return!o;for(e=Object(e);n--;){var l=s[n];if(l[2]?l[1]!==e[l[0]]:!(l[0]in e))return!1}for(;++n<o;){var h=(l=s[n])[0],c=e[h],p=l[1];if(l[2]){if(void 0===c&&!(h in e))return!1}else{var u,y=new r.Stack;if(!(void 0===u?a.baseIsEqual(p,c,d|m,i,y):u))return!1}}return!0}(e,0,s)}):function(e){return l.isKey(e)?(t=l.toKey(e),function(e){return null==e?void 0:e[t]}):function(e){return function(t){return l.baseGet(t,e)}}(e);var t}(e);var t,s,i,n}function g(e,t,s,i){for(var r=-1,a=null==e?0:e.length;++r<a;){var n=e[r];t(i,n,s(n),e)}return i}const w=function(e,t,s){for(var i=-1,r=Object(e),a=s(e),n=a.length;n--;){var o=a[++i];if(!1===t(r[o],o,r))break}return e};var b=function(e,t){if(null==e)return e;if(!r.isArrayLike(e))return function(e,t){return e&&w(e,t,r.keys)}(e,t);for(var s=e.length,i=-1,a=Object(e);++i<s&&!1!==t(a[i],i,a););return e};const L=b;function E(e,t,s,i){return L(e,(function(e,r,a){t(i,e,s(e),a)})),i}var B,I;const M=(B=function(e,t,s){e[s?0:1].push(t)},I=function(){return[[],[]]},function(e,t){var s=h.isArray$1(e)?g:E,i=I?[[],[]]:{};return s(e,B,v(t),i)}),T="list-message",S=t.proxyCustomElement(class extends t.H{constructor(){super(),this.__registerHost(),this.__attachShadow(),this.analysisLayerInputPopoverClose=t.createEvent(this,"analysisLayerInputPopoverClose",7),this.analysisLayerInputPopoverSelectionChange=t.createEvent(this,"analysisLayerInputPopoverSelectionChange",7),this.analysisLayerInputPopoverLayerBrowsed=t.createEvent(this,"analysisLayerInputPopoverLayerBrowsed",7),this.checkForMatchingLayer=()=>{this.calciteFilterSearchTerm=this.listElement?.filterText,this.noSearchedLayersMessageActive=0===this.listElement?.filteredItems?.length&&0!==this.listElement?.filterText.length},this.buildListItem=e=>t.h("calcite-list-item",{key:e.id,value:e.id,label:s.getLayerLabel(e),description:s.isFeatureLayer(e)?s.isTableLayer(e)?this.strings.table:this.strings[e.geometryType]:"",selected:void 0!==this.selectedLayerIds&&this.selectedLayerIds.includes(e.id),onClick:this.onListChange,"data-layer-title":e.title}),this.openItemBrowser=()=>{this.itemBrowserElement?.remove(),this.itemBrowserElement=document.createElement("analysis-item-browser"),this.itemBrowserElement.header=this.strings.heading,this.itemBrowserElement.hideAddToMap=this.hideAddToMap,this.itemBrowserElement.filter=this.itemBrowserFilter,this.itemBrowserElement.q=this.itemBrowserQ,this.itemBrowserElement.allowedGeometries=this.itemBrowserAllowedGeometries,this.itemBrowserElement.layerFilterType=this.layerFilterType,this.itemBrowserElement.portal=this.portal,this.itemBrowserElement.bucketOptions=this.bucketOptions,this.itemBrowserElement.user=this.user,this.itemBrowserElement.selectionMode="multi"!==this.selectionMode?"single-sublayer":"multiple-sublayer",this.itemBrowserElement.addEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.addEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.addEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.popoverElement.autoClose=!1,this.popoverElement.hidden=!0,document.body.appendChild(this.itemBrowserElement)},this.closeModals=()=>{this.popoverElement.autoClose=!0,this.popoverElement.hidden=!1,void 0!==this.itemBrowserElement&&(this.itemBrowserElement.removeEventListener("analysisItemBrowserClose",this.closeModals),this.itemBrowserElement.removeEventListener("analysisItemBrowserAddToMap",this.handleItemBrowserAddToMap),this.itemBrowserElement.removeEventListener("analysisItemBrowserSelection",this.handleItemBrowserSelection),this.itemBrowserElement.remove(),this.itemBrowserElement=void 0)},this.addLayersToMap=(e,t)=>{const i=M(t,(e=>s.isTableLayer(e)));e.addMany(i[1]),e.tables.addMany(i[0])},this.handleItemBrowserAddToMap=e=>{this.addLayersToMap(this.mapView.map,e.detail),this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.handleItemBrowserSelection=e=>{this.analysisLayerInputPopoverLayerBrowsed.emit(e.detail),this.open=!1},this.onListChange=()=>{const e=this.listElement?.selectedItems;this.analysisLayerInputPopoverSelectionChange.emit(e?.map((e=>e.value))),"multi"!==this.selectionMode&&(this.open=!1)},this.hideAddToMap=!1,this.mapLayers=void 0,this.modelVariableLayers=void 0,this.analysisSessionLayers=[],this.hideBrowseButton=!1,this.showNoticeMessage=!1,this.noticeMessage=void 0,this.selectionMode=void 0,this.referenceElement=void 0,this.placement="auto",this.open=void 0,this.selectedLayerIds=void 0,this.popoverWidth=void 0,this.user=void 0,this.portal=void 0,this.mapView=void 0,this.itemBrowserAllowedGeometries=void 0,this.itemBrowserFilter="",this.itemBrowserQ="",this.layerFilterType=void 0,this.noSearchedLayersMessageActive=!1,this.calciteFilterSearchTerm=void 0}get bucketOptions(){const e=["my","favorites","group","org","all"];return!0===this.portal.isPortal&&this.portal.sourceJSON.portalDeploymentType===s.PortalDeploymentType.Kubernetes||e.splice(4,0,"living atlas analysis"),e}async componentWillLoad(){({strings:this.strings,dir:this.dir}=await s.fetchComponentLocaleStrings(this.hostElement,t.getAssetPath(".")))}componentDidLoad(){this.focusTimeoutId=setTimeout((async()=>{await(this.listElement?.setFocus?.())}),s.UIDefaults.PopoverTimer),setTimeout((()=>{this.popoverElement?.reposition?.()}),s.UIDefaults.PopoverTimer)}disconnectedCallback(){void 0!==this.focusTimeoutId&&clearTimeout(this.focusTimeoutId),this.closeModals()}async reposition(){await(this.popoverElement?.reposition?.())}render(){const e=this.popoverWidth??this.referenceElement?.getBoundingClientRect().width,i=s.formatMessage(this.strings.noMatchesFound,{searchTerm:this.calciteFilterSearchTerm??""}),r=0===this.analysisSessionLayers?.length&&0===this.mapLayers?.length&&(void 0===this.modelVariableLayers||0===this.modelVariableLayers?.length),a=!0===this.hideBrowseButton;return t.h(t.Host,{key:"bc273dfd8486dfe39a5eafd7a4227f6312a1945c",dir:this.dir,class:"analysis-popover js-app-flyout"},t.h("calcite-popover",{key:"183431896d2fe1e17cd4c75dde21dcb17576d718",ref:e=>{this.popoverElement=e},style:{width:void 0!==e?`${e}px`:void 0},autoClose:!0,closable:!0,heading:this.strings.heading,referenceElement:this.referenceElement??"analysis-layer-input",placement:this.placement,open:this.open,label:"",focusTrapDisabled:!0,onCalcitePopoverClose:()=>this.analysisLayerInputPopoverClose.emit()},t.h("calcite-panel",{key:"e25d32a762c6e7e24bf09856f0294b1b198e935b"},t.h("calcite-list",{key:"e46d33057372047fd187e66933c2cfc27c6a62b9",class:"popover-content",selectionMode:"multi"===this.selectionMode?"multiple":"single",filterEnabled:!0,ref:e=>{this.listElement=e},onCalciteListFilter:this.checkForMatchingLayer},t.h("calcite-notice",{key:"cbda51eb625c99d4ed4ef9970c2c113a4442def4",open:this.showNoticeMessage,class:this.showNoticeMessage?"half-margin":"",kind:"warning",scale:s.UIDefaults.Scale},t.h("div",{key:"cf63d528e817c42c79e31c40d82f384f4065cb30",slot:"message"},Array.from(new Set(this.noticeMessage))?.map((e=>t.h("p",{innerHTML:e}))))),this.noSearchedLayersMessageActive&&t.h("p",{key:"a50a4dbd842e71f9470b526d4f317c309c703f4a",class:T},i),r&&!1===this.noSearchedLayersMessageActive?t.h("p",{class:T},this.strings.noCompatibleLayers):t.h("div",null,t.h("calcite-list-item-group",{heading:this.strings.analysisSessionLayers,hidden:0===this.analysisSessionLayers?.length},(this.analysisSessionLayers??[]).map((e=>this.buildListItem(e)))),t.h("calcite-list-item-group",{heading:this.strings.mapLayers,hidden:0===this.mapLayers?.length},(this.mapLayers??[]).map((e=>this.buildListItem(e)))),(this.modelVariableLayers?.length??0)>0&&t.h("calcite-list-item-group",{heading:this.strings.modelVariableLayers},(this.modelVariableLayers??[]).map((e=>this.buildListItem(e)))))),!a&&t.h("calcite-button",{key:"6e5f55fd91907ff26badf58f0b4f1b43a694f4cb",slot:"footer-actions",appearance:"transparent",width:"full",onClick:this.openItemBrowser},this.strings.browseAnalysisLayers))))}static get assetsDirs(){return["t9n"]}get hostElement(){return this}static get style(){return":root{--analysis-quarter-spacing:0.25rem;--analysis-half-spacing:0.5rem;--analysis-three-quarter-spacing:0.75rem;--analysis-full-spacing:1rem;--analysis-component-default-width:100%;--analysis-ui-border-input:#d4d4d4;--analysis-label-font-size:var(--calcite-font-size--2);--analysis-popover-content-min-height-s:7.5rem;--analysis-popover-content-min-height-m:8.75rem;--analysis-popover-content-max-height:60vh;--analysis-popover-content-height:45vh}:host{display:flex}.popover-content{height:var(--analysis-popover-content-height)}.fab{justify-content:center;padding:var(--analysis-half-spacing)}.half-margin{margin:var(--analysis-half-spacing)}.list-message{margin:var(--analysis-half-spacing);font-size:var(--calcite-font-size--2)}"}},[1,"analysis-layer-input-popover",{hideAddToMap:[4,"hide-add-to-map"],mapLayers:[16],modelVariableLayers:[16],analysisSessionLayers:[16],hideBrowseButton:[516,"hide-browse-button"],showNoticeMessage:[4,"show-notice-message"],noticeMessage:[16],selectionMode:[513,"selection-mode"],referenceElement:[16],placement:[513],open:[1540],selectedLayerIds:[16],popoverWidth:[514,"popover-width"],user:[16],portal:[16],mapView:[16],itemBrowserAllowedGeometries:[16],itemBrowserFilter:[513,"item-browser-filter"],itemBrowserQ:[513,"item-browser-q"],layerFilterType:[1,"layer-filter-type"],noSearchedLayersMessageActive:[32],calciteFilterSearchTerm:[32],reposition:[64]}]);function A(){"undefined"!=typeof customElements&&["analysis-layer-input-popover","analysis-item-browser"].forEach((e=>{switch(e){case"analysis-layer-input-popover":customElements.get(e)||customElements.define(e,S);break;case"analysis-item-browser":customElements.get(e)||i.defineCustomElement()}}))}A(),e.AnalysisLayerInputPopover=S,e.baseIteratee=v,e.defineCustomElement=A,e.hasIn=f}));